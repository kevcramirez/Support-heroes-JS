(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{150:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'  <span id="draftGrowl" class="saved" style="display: none;">Saved</span>\n  <a href="javascript:void(0)" class="saveDraft" rel="tooltip" data-placement="bottom" data-original-title="Save Draft ('+t.escapeExpression("function"==typeof(s=null!=(s=a(i,"cmdCtrl")||(null!=e?a(e,"cmdCtrl"):e))?s:t.hooks.helperMissing)?s.call(null!=e?e:t.nullContext||{},{name:"cmdCtrl",hash:{},data:o,loc:{start:{line:4,column:120},end:{line:4,column:131}}}):s)+' + shift + d)" tabindex="-1">\n      <i class="icon-save"></i>\n      <i class="icon-saved"></i>\n  </a>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<section class="draftDelete pull-right">\n'+(null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"showSave"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:8,column:7}}}))?s:"")+'  <a href="javascript:void(0)" id="cancelTicket" rel="tooltip" data-placement="bottom" data-original-title="Discard (Esc)" tabindex="-1"><i class="icon-delete"></i></a>\n</section>'},useData:!0})},152:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(i(83));i(81);var s=a(i(35));function a(t){return t&&t.__esModule?t:{default:t}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var l=t.Model.extend({defaults:{text:""},urlRoot:function(){return appData.apiRoot+"v1/articles"},fetch:function(e){return t.Model.prototype.fetch.call(this,o.default.getOptions(e))},fetchDraft:function(t){return t=n.extend({},t,{data:{draft:!0}}),this.fetch(t)},destroy:function(e){var i=n.extend({url:appData.apiRoot+"v1/articles/"+this.get("id"),beforeSend:o.default.addHeaders},e);return t.Model.prototype.destroy.call(this,i)},discardDraft:function(e){var i=n.extend({url:appData.apiRoot+"v1/articles/"+this.get("id")+"/drafts",beforeSend:o.default.addHeaders},e);return t.Model.prototype.destroy.call(this,i)},saveDraft:function(e){var i=n.extend({beforeSend:o.default.addHeaders,url:this.url()+"/drafts?reload=true"},e);return t.Model.prototype.save.call(this,{text:this.get("text")},i)},save:function(e,i){var s=n.extend({beforeSend:o.default.addHeaders,url:this.url()+"?reload=true"},i);return t.Model.prototype.save.call(this,e,s)},validation:{name:{required:!0,msg:"Please enter a name for this article"},slug:{required:!1,pattern:/^[\w,\-]+$/,msg:'Please enter a valid slug (i.e. "article-title")'}},parse:function(t){return t&&t.article?t.article:t&&"object"===r(t)&&!t.article?t:void 0},wasUpdatedBeforeThisYear:function(){var t=(0,s.default)(this.get("updatedAt")),e=(0,s.default)();return t.isBefore(e,"year")}});e.default=l}).call(this,i(11),i(1))},173:function(t,e,n){(function(t){window;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){var n=0,o=function(t){return this[0]=t.startOffset,this[1]=t.endOffset,this.range=t,this};function s(t,e){return new s.prototype.init(t,e)}o.prototype.equals=function(){return this[0]===this[1]},t.fn.redactor=function(e){var i=[],n=Array.prototype.slice.call(arguments,1);return"string"==typeof e?this.each((function(){var o=t.data(this,"redactor");if(void 0===o||!t.isFunction(o[e]))return t.error('No such method "'+e+'" for Redactor');var s=o[e].apply(o,n);void 0!==s&&s!==o&&i.push(s)})):this.each((function(){t.data(this,"redactor")||t.data(this,"redactor",s(this,e))})),0===i.length?this:1===i.length?i[0]:i},t.Redactor=s,t.Redactor.VERSION="9.2.1",t.Redactor.opts={rangy:!1,iframe:!1,fullpage:!1,css:!1,lang:"en",direction:"ltr",placeholder:"",typewriter:!1,wym:!1,mobile:!0,cleanup:!0,tidyHtml:!0,pastePlainText:!1,removeEmptyTags:!0,cleanSpaces:!0,cleanFontTag:!0,templateVars:!1,xhtml:!1,visual:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,maxHeight:!1,shortcuts:!0,autosave:!1,autosaveInterval:60,plugins:!1,linkProtocol:"http://",linkNofollow:!1,linkSize:50,imageFloatMargin:"10px",imageGetJson:!1,dragUpload:!0,imageTabLink:!0,imageUpload:!1,imageUploadParam:"file",fileUpload:!1,fileUploadParam:"file",clipboardUpload:!0,clipboardUploadUrl:!1,dnbImageTypes:["image/png","image/jpeg","image/gif"],s3:!1,uploadFields:!1,observeImages:!0,observeLinks:!0,modalOverlay:!0,tabSpaces:!1,tabFocus:!0,air:!1,airButtons:["formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent"],toolbar:!0,toolbarFixed:!1,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarFixedBox:!1,toolbarExternal:!1,toolbarOverflow:!1,buttonSource:!0,toolbarCustom:{},buttonsAdd:[],buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","video","file","table","link","alignment","|","horizontalrule"],buttonsHideOnMobile:[],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify","table"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline",tr:"table",td:"table",table:"table"},formattingTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],linebreaks:!1,paragraphy:!0,convertDivs:!0,convertLinks:!0,convertImageLinks:!1,convertVideoLinks:!1,formattingPre:!1,phpTags:!1,allowedTags:!1,deniedTags:["html","head","link","body","meta","script","style","applet"],boldTag:"strong",italicTag:"em",indentValue:20,buffer:[],rebuffer:[],textareamode:!1,emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",rBlockTest:/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i,alignmentTags:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],ownLine:["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],contOwnLine:["li","dt","dt","h[1-6]","option","script"],newLevel:["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"],blockLevelElements:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","LI","BLOCKQUOTE","OUTPUT","FIGCAPTION","PRE","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE","TD"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit"}},beforeSend:function(){}},s.fn=t.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,TAB:9,CTRL:17,META:91,LEFT:37,LEFT_WIN:91},init:function(e,o){this.rtePaste=!1,this.$element=this.$source=t(e),this.uuid=n++;var s=t.extend(!0,{},t.Redactor.opts);if(this.opts=t.extend({},s,this.$element.data(),o),this.start=!0,this.dropdowns=[],this.sourceHeight=this.$source.css("height"),this.sourceWidth=this.$source.css("width"),this.opts.fullpage&&(this.opts.iframe=!0),this.opts.linebreaks&&(this.opts.paragraphy=!1),this.opts.paragraphy&&(this.opts.linebreaks=!1),this.opts.toolbarFixedBox&&(this.opts.toolbarFixed=!0),this.document=document,this.window=window,this.savedSel=!1,this.cleanlineBefore=new RegExp("^<(/?"+this.opts.ownLine.join("|/?")+"|"+this.opts.contOwnLine.join("|")+")[ >]"),this.cleanlineAfter=new RegExp("^<(br|/?"+this.opts.ownLine.join("|/?")+"|/"+this.opts.contOwnLine.join("|/")+")[ >]"),this.cleannewLevel=new RegExp("^</?("+this.opts.newLevel.join("|")+")[ >]"),this.rTestBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),!1===this.opts.linebreaks){if(!1!==this.opts.allowedTags){var a=["strong","em","del"],r=["b","i","strike"];for(i in"-1"===t.inArray("p",this.opts.allowedTags)&&this.opts.allowedTags.push("p"),a)"-1"!=t.inArray(a[i],this.opts.allowedTags)&&this.opts.allowedTags.push(r[i])}if(!1!==this.opts.deniedTags){var l=t.inArray("p",this.opts.deniedTags);"-1"!==l&&this.opts.deniedTags.splice(l,l)}}else this.opts.emptyHtml="&#x200b;";(this.browser("msie")||this.browser("opera"))&&(this.opts.buttons=this.removeFromArrayByValue(this.opts.buttons,"horizontalrule")),this.modalOverlayInit(),this.opts.curLang=this.opts.langs[this.opts.lang],this.buildStart()},toolbarInit:function(t){return{html:{title:t.html,func:"toggle"},formatting:{title:t.formatting,func:"show",dropdown:{p:{title:t.paragraph,func:"formatBlocks"},blockquote:{title:t.quote,func:"formatQuote",className:"redactor_format_blockquote"},pre:{title:t.code,func:"formatBlocks",className:"redactor_format_pre"},h1:{title:t.header1,func:"formatBlocks",className:"redactor_format_h1"},h2:{title:t.header2,func:"formatBlocks",className:"redactor_format_h2"},h3:{title:t.header3,func:"formatBlocks",className:"redactor_format_h3"},h4:{title:t.header4,func:"formatBlocks",className:"redactor_format_h4"},h5:{title:t.header5,func:"formatBlocks",className:"redactor_format_h5"}}},bold:{title:t.bold,exec:"bold"},italic:{title:t.italic,exec:"italic"},deleted:{title:t.deleted,exec:"strikethrough"},underline:{title:t.underline,exec:"underline"},unorderedlist:{title:"&bull; "+t.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+t.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+t.outdent,func:"indentingOutdent"},indent:{title:"> "+t.indent,func:"indentingIndent"},image:{title:t.image,func:"imageShow"},video:{title:t.video,func:"videoShow"},file:{title:t.file,func:"fileShow"},table:{title:t.table,func:"show",dropdown:{insert_table:{title:t.insert_table,func:"tableShow"},separator_drop1:{name:"separator"},insert_row_above:{title:t.insert_row_above,func:"tableAddRowAbove"},insert_row_below:{title:t.insert_row_below,func:"tableAddRowBelow"},insert_column_left:{title:t.insert_column_left,func:"tableAddColumnLeft"},insert_column_right:{title:t.insert_column_right,func:"tableAddColumnRight"},separator_drop2:{name:"separator"},add_head:{title:t.add_head,func:"tableAddHead"},delete_head:{title:t.delete_head,func:"tableDeleteHead"},separator_drop3:{name:"separator"},delete_column:{title:t.delete_column,func:"tableDeleteColumn"},delete_row:{title:t.delete_row,func:"tableDeleteRow"},delete_table:{title:t.delete_table,func:"tableDeleteTable"}}},link:{title:t.link,func:"show",dropdown:{link:{title:t.link_insert,func:"linkShow"},unlink:{title:t.unlink,exec:"unlink"}}},alignment:{title:t.alignment,func:"show",dropdown:{alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},justify:{title:t.align_justify,func:"alignmentJustify"}}},alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},alignjustify:{title:t.align_justify,func:"alignmentJustify"},horizontalrule:{exec:"inserthorizontalrule",title:t.horizontalrule}}},callback:function(e,i,n){var o=this.opts[e+"Callback"];return t.isFunction(o)?!1===i?o.call(this,n):o.call(this,i,n):n},destroy:function(){clearInterval(this.autosaveInterval),t(window).off(".redactor"),this.$source.off("redactor-textarea"),this.$element.off(".redactor").removeData("redactor");var e=this.get();if(this.opts.textareamode)this.$box.after(this.$source),this.$box.remove(),this.$source.val(e).show();else{var i=this.$editor;this.opts.iframe&&(i=this.$element),this.$box.after(i),this.$box.remove(),i.removeClass("redactor_editor").removeClass("redactor_editor_wym").removeAttr("contenteditable").html(e).show()}this.opts.toolbarExternal&&t(this.opts.toolbarExternal).html(""),this.opts.air&&t("#redactor_air_"+this.uuid).remove()},getObject:function(){return t.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getIframe:function(){return!!this.opts.iframe&&this.$frame},getToolbar:function(){return!!this.$toolbar&&this.$toolbar},get:function(){return this.$source.val()},getCodeIframe:function(){this.$editor.removeAttr("contenteditable").removeAttr("dir");var t=this.outerHtml(this.$frame.contents().children());return this.$editor.attr({contenteditable:!0,dir:this.opts.direction}),t},set:function(t,e,i){t=(t=t.toString()).replace(/\$/g,"&#36;"),this.opts.fullpage?this.setCodeIframe(t):this.setEditor(t,e),""==t&&(i=!1),!1!==i&&this.placeholderRemoveFromEditor()},setEditor:function(t,e){!1!==e&&(t=this.cleanSavePreCode(t),t=this.cleanStripTags(t),t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t,!0),t=!1===this.opts.linebreaks?this.cleanConverters(t):t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),t=t.replace(/&amp;#36;/g,"$"),t=this.cleanEmpty(t),this.$editor.html(t),this.setNonEditable(),this.setSpansVerified(),this.sync()},setCodeIframe:function(t){var e=this.iframePage();this.$frame[0].src="about:blank",t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t),t=this.cleanRemoveSpaces(t),e.open(),e.write(t),e.close(),this.opts.fullpage&&(this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction})),this.setNonEditable(),this.setSpansVerified(),this.sync()},setFullpageOnInit:function(t){t=this.cleanSavePreCode(t,!0),t=this.cleanConverters(t),t=this.cleanEmpty(t),this.$editor.html(t),this.setNonEditable(),this.setSpansVerified(),this.sync()},setSpansVerified:function(){var e=this.$editor.find("span");t.each(e,(function(){var e=this.outerHTML,i=new RegExp("<"+this.tagName,"gi"),n=e.replace(i,"<inline");i=new RegExp("</"+this.tagName,"gi"),n=n.replace(i,"</inline"),t(this).replaceWith(n)}))},setSpansVerifiedHtml:function(t){return(t=t.replace(/<span(.*?)>/,"<inline$1>")).replace(/<\/span>/,"</inline>")},setNonEditable:function(){this.$editor.find(".noneditable").attr("contenteditable",!1)},sync:function(e){var i="";if(this.cleanUnverified(),i=this.opts.fullpage?this.getCodeIframe():this.$editor.html(),i=this.syncClean(i),i=this.cleanRemoveEmptyTags(i),this.cleanRemoveSpaces(this.$source.val(),!1)==this.cleanRemoveSpaces(i,!1))return!1;if(i=i.replace(/<\/li><(ul|ol)>([\w\W]*?)<\/(ul|ol)>/gi,"<$1>$2</$1></li>"),"<br>"===t.trim(i)&&(i=""),this.opts.xhtml){t.each(["br","hr","img","link","input","meta"],(function(t,e){i=i.replace(new RegExp("<"+e+"(.*?[^/$]?)>","gi"),"<"+e+"$1 />")}))}if(i=this.callback("syncBefore",!1,i),this.$source.val(i),this.callback("syncAfter",!1,i),!1===this.start)if(void 0!==e)switch(e.which){case 37:case 38:case 39:case 40:break;default:this.callback("change",!1,i)}else this.callback("change",!1,i)},syncClean:function(e){return this.opts.fullpage||(e=this.cleanStripTags(e)),e=t.trim(e),"<p></p>"!=(e=(e=(e=(e=(e=(e=this.placeholderRemoveFromCode(e)).replace(/&#x200b;/gi,"")).replace(/&#8203;/gi,"")).replace(/<\/a>&nbsp;/gi,"</a> ")).replace(/\u200B/g,"")).replace(/&nbsp;<a/gi," <a"))&&"<p> </p>"!=e&&"<p>&nbsp;</p>"!=e||(e=""),this.opts.linkNofollow&&(e=(e=e.replace(/<a(.*?)rel="nofollow"(.*?)>/gi,"<a$1$2>")).replace(/<a(.*?)>/gi,'<a$1 rel="nofollow">')),e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("\x3c!--?php","<?php")).replace("?--\x3e","?>")).replace(/<(.*?)class="noeditable"(.*?) contenteditable="false"(.*?)>/gi,'<$1class="noeditable"$2$3>')).replace(/ data-tagblock=""/gi,"")).replace(/<br\s?\/?>\n?<\/(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)>/gi,"</$1>")).replace(/<span(.*?)id="redactor-image-box"(.*?)>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?)>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?)>(.*?)<\/span>/gi,"")).replace(/<(ul|ol)>\s*\t*\n*<\/(ul|ol)>/gi,""),this.opts.cleanFontTag&&(e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2")).replace(/<inline>/gi,"<span>")).replace(/<inline /gi,"<span ")).replace(/<\/inline>/gi,"</span>")).replace(/<span(.*?)class="redactor_placeholder"(.*?)>([\w\W]*?)<\/span>/gi,"")).replace(/<span>([\w\W]*?)<\/span>/gi,"$1")).replace(/™/gi,"&trade;")).replace(/©/gi,"&copy;")).replace(/…/gi,"&hellip;")).replace(/—/gi,"&mdash;")).replace(/‐/gi,"&dash;"),e=this.cleanReConvertProtected(e)},buildStart:function(){this.content="",this.$box=t('<div class="redactor_box" />'),this.$box.css("z-index",100-this.uuid),"TEXTAREA"===this.$source[0].tagName&&(this.opts.textareamode=!0),!1===this.opts.mobile&&this.isMobile()?this.buildMobile():(this.buildContent(),this.opts.iframe?(this.opts.autoresize=!1,this.iframeStart()):this.opts.textareamode?this.buildFromTextarea():this.buildFromElement(),this.opts.iframe||(this.buildOptions(),this.buildAfter()))},buildMobile:function(){this.opts.textareamode||(this.$editor=this.$source,this.$editor.hide(),this.$source=this.buildCodearea(this.$editor),this.$source.val(this.content)),this.$box.insertAfter(this.$source).append(this.$source)},buildContent:function(){this.opts.textareamode?this.content=t.trim(this.$source.val()):this.content=t.trim(this.$source.html())},buildFromTextarea:function(){this.$editor=t("<div />"),this.$box.insertAfter(this.$source).append(this.$editor).append(this.$source),this.buildAddClasses(this.$editor),this.buildEnable()},buildFromElement:function(){this.$editor=this.$source,this.$source=this.buildCodearea(this.$editor),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$source),this.buildEnable()},buildCodearea:function(e){return t("<textarea />").attr("name",e.attr("id")).css("height",this.sourceHeight)},buildAddClasses:function(e){t.each(this.$source.get(0).className.split(/\s+/),(function(t,i){e.addClass("redactor_"+i)}))},buildEnable:function(){this.$editor.addClass("redactor_editor").attr({contenteditable:!0,dir:this.opts.direction}),this.$source.attr("dir",this.opts.direction).hide(),this.set(this.content,!0,!1)},buildOptions:function(){var t=this.$editor;this.opts.iframe&&(t=this.$frame),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&t.css("min-height",this.opts.minHeight+"px"),this.browser("mozilla")&&this.opts.linebreaks&&this.$editor.css("padding-bottom","10px"),this.opts.maxHeight&&(this.opts.autoresize=!1,this.sourceHeight=this.opts.maxHeight),this.opts.wym&&this.$editor.addClass("redactor_editor_wym"),this.opts.typewriter&&this.$editor.addClass("redactor-editor-typewriter"),this.opts.autoresize||t.css("height",this.sourceHeight)},buildAfter:function(){if(this.start=!1,this.opts.toolbar&&(this.opts.toolbar=this.toolbarInit(this.opts.curLang),this.toolbarBuild()),this.modalTemplatesInit(),this.buildPlugins(),this.buildBindKeyboard(),this.opts.autosave&&this.autosave(),setTimeout(t.proxy(this.observeStart,this),4),this.browser("mozilla"))try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}this.opts.focus&&setTimeout(t.proxy(this.focus,this),100),this.opts.visual||setTimeout(t.proxy((function(){this.opts.visual=!0,this.toggle(!1)}),this),200),this.callback("init")},buildBindKeyboard:function(){var e;this.dblEnter=0,this.opts.dragUpload&&!1!==this.opts.imageUpload&&this.$editor.on("drop.redactor",t.proxy(this.buildEventDrop,this)),this.$editor.on("input.redactor",t.proxy(this.sync,this)),this.$editor.on("paste.redactor",t.proxy(this.buildEventPaste,this)),this.$editor.on("keydown.redactor",t.proxy(this.buildEventKeydown,this)),this.$editor.on("keyup.redactor",t.proxy(this.buildEventKeyup,this)),t.isFunction(this.opts.textareaKeydownCallback)&&this.$source.on("keydown.redactor-textarea",t.proxy(this.opts.textareaKeydownCallback,this)),t.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",t.proxy(this.opts.focusCallback,this)),t(document).mousedown((function(i){e=t(i.target)})),this.$editor.on("blur.redactor",t.proxy((function(i){t(e).hasClass("redactor_toolbar")||0!=t(e).parents(".redactor_toolbar").size()||(this.selectall=!1,t.isFunction(this.opts.blurCallback)&&this.callback("blur",i))}),this))},buildEventDrop:function(e){if(e=e.originalEvent||e,void 0===window.FormData||!e.dataTransfer)return!0;if(0==e.dataTransfer.files.length)return!0;e.preventDefault();var i=e.dataTransfer.files[0];if(!1!==this.opts.dnbImageTypes&&-1==this.opts.dnbImageTypes.indexOf(i.type))return!0;this.bufferSet();var n=t('<div id="redactor-progress"><span></span></div>');t(document.body).append(n),!1===this.opts.s3?this.dragUploadAjax(this.opts.imageUpload,i,!0,n,e,this.opts.imageUploadParam):this.s3uploadFile(i)},buildEventPaste:function(e){1===e.originalEvent.clipboardData.files.length&&e.preventDefault();var i=!1;this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")&&(this.browser("version").split(".")[0]<536&&(i=!0));if(i)return!0;if(this.browser("opera"))return!0;if(this.opts.clipboardUpload&&this.buildEventClipboardUpload(e))return!0;if(this.opts.cleanup){var n;this.rtePaste=!0,this.selectionSave(),this.selectall||(!0===this.opts.autoresize&&!0!==this.fullscreen?(this.$editor.height(this.$editor.height()),this.saveScroll=this.document.body.scrollTop):this.saveScroll=this.$editor.scrollTop());var o=window.scrollY;!function(){n=window.onscroll;var t=window.scrollX,e=window.scrollY;window.onscroll=function(){window.scrollTo(t,e)}}();var s=this.extractContent();setTimeout(t.proxy((function(){var e=this.extractContent();this.$editor.append(s),this.selectionRestore();var i=this.getFragmentHtml(e);this.pasteClean(i),!0===this.opts.autoresize&&!0!==this.fullscreen&&this.$editor.css("height","auto"),t(window).scrollTop(o),window.onscroll=n}),this),1)}},buildEventClipboardUpload:function(e){if(!t("#redactor-progress").length){var i=t('<div id="redactor-progress" style="display: none;"><span></span></div>');t(document.body).append(i)}var n=e.originalEvent||e;if(this.clipboardFilePaste=!1,void 0===n.clipboardData||!n.clipboardData.files.length)return!1;var o=n.clipboardData.files[0];if(null!==o){this.bufferSet(),this.clipboardFilePaste=!0,t("#redactor-progress").fadeIn();var s=new FileReader;return s.onload=t.proxy(this.pasteClipboardUpload,this),s.readAsDataURL(o),!0}return!1},buildEventKeydown:function(e){if(this.rtePaste)return!1;var i=e.which,n=e.ctrlKey||e.metaKey,o=this.getParent(),s=this.getCurrent(),a=this.getBlock(),r=!1;if(this.callback("keydown",e),this.imageResizeHide(!1),(o&&"PRE"===t(o).get(0).tagName||s&&"PRE"===t(s).get(0).tagName)&&(r=!0,i===this.keyCode.DOWN&&this.insertAfterLastElement(a)),i===this.keyCode.DOWN&&(o&&"BLOCKQUOTE"===t(o)[0].tagName&&this.insertAfterLastElement(o),s&&"BLOCKQUOTE"===t(s)[0].tagName&&this.insertAfterLastElement(s),o&&"P"===t(o)[0].tagName&&"BLOCKQUOTE"==t(o).parent()[0].tagName&&this.insertAfterLastElement(o,t(o).parent()[0]),s&&"P"===t(s)[0].tagName&&o&&"BLOCKQUOTE"==t(o)[0].tagName&&this.insertAfterLastElement(s,o)),n&&!e.shiftKey?this.shortcuts(e,i):n&&e.shiftKey&&(55===i?this.shortcutsLoad(e,"insertorderedlist"):56===i&&this.shortcutsLoad(e,"insertunorderedlist")),n&&90===i&&!e.shiftKey&&!e.altKey)return e.preventDefault(),void(this.opts.buffer.length?this.bufferUndo():this.document.execCommand("undo",!1,!1));if(n&&90===i&&e.shiftKey&&!e.altKey)return e.preventDefault(),void(0!=this.opts.rebuffer.length?this.bufferRedo():this.document.execCommand("redo",!1,!1));if(32==i){var l=(d=this.getRange())&&!d.collapsed;this.bufferSet(void 0,l)}if(n&&65===i?(this.bufferSet(),this.selectall=!0):i==this.keyCode.LEFT_WIN||n||(this.selectall=!1),i!=this.keyCode.ENTER||e.shiftKey||e.ctrlKey||e.metaKey)i===this.keyCode.ENTER&&e.shiftKey&&(this.bufferSet(),e.preventDefault(),this.insertLineBreak());else{var d=this.getRange();if(d&&!1===d.collapsed)this.getSelection().rangeCount&&d.deleteContents();if(this.browser("msie")&&1==o.nodeType&&("TD"==o.tagName||"TH"==o.tagName))return e.preventDefault(),this.bufferSet(),this.insertNode(document.createElement("br")),this.callback("enter",e),!1;if(a&&("BLOCKQUOTE"==a.tagName||"BLOCKQUOTE"==t(a).parent()[0].tagName))if(this.isEndOfElement()){if(1==this.dblEnter){var c,u;if("BLOCKQUOTE"==a.tagName?(u="br",c=a):(u="p",c=t(a).parent()[0]),e.preventDefault(),this.insertingAfterLastElement(c),this.dblEnter=0,"p"==u)t(a).parent().find("p").last().remove();else{var h=t.trim(t(a).html());t(a).html(h.replace(/<br\s?\/?>$/i,""))}return}this.dblEnter++}else this.dblEnter++;if(!0===r)return this.buildEventKeydownPre(e,s);if(!this.opts.linebreaks)if(a&&this.opts.rBlockTest.test(a.tagName))this.bufferSet(),setTimeout(t.proxy((function(){var e=this.getBlock();if("DIV"===e.tagName&&!t(e).hasClass("redactor_editor")){var i=t("<p>"+this.opts.invisibleSpace+"</p>");t(e).replaceWith(i),this.selectionStart(i)}}),this),1);else if(!1===a){this.bufferSet();var p=t("<p>"+this.opts.invisibleSpace+"</p>");return this.insertNode(p[0]),this.selectionStart(p),this.callback("enter",e),!1}if(this.opts.linebreaks){if(!a||!this.opts.rBlockTest.test(a.tagName)){if(!0===this.opts.preventLineBreak)return;return this.buildEventKeydownInsertLineBreak(e)}this.bufferSet(),setTimeout(t.proxy((function(){var e=this.getBlock();"DIV"!==e.tagName&&"P"!==e.tagName||t(e).hasClass("redactor_editor")||this.replaceLineBreak(e)}),this),1)}if("BLOCKQUOTE"==a.tagName||"FIGCAPTION"==a.tagName)return this.buildEventKeydownInsertLineBreak(e);this.callback("enter",e)}if((i===this.keyCode.TAB||e.metaKey&&219===i)&&this.opts.shortcuts)return this.buildEventKeydownTab(e,r,i);i===this.keyCode.BACKSPACE&&this.buildEventKeydownBackspace(s)},buildEventKeydownPre:function(e,i){e.preventDefault(),this.bufferSet();var n=t(i).parent().text();return this.insertNode(document.createTextNode("\n")),-1==n.search(/\s$/)&&this.insertNode(document.createTextNode("\n")),this.sync(),this.callback("enter",e),!1},buildEventKeydownTab:function(t,e,i){return!this.opts.tabFocus||(!(!this.isEmpty(this.get())||!1!==this.opts.tabSpaces)||(t.preventDefault(),!0!==e||t.shiftKey?!1!==this.opts.tabSpaces?(this.bufferSet(),this.insertNode(document.createTextNode(Array(this.opts.tabSpaces+1).join(" "))),this.sync(),!1):(t.shiftKey?this.indentingOutdent():this.indentingIndent(),!1):(this.bufferSet(),this.insertNode(document.createTextNode("\t")),this.sync(),!1)))},buildEventKeydownBackspace:function(e){var i;void 0!==e.tagName&&/^(H[1-6])$/i.test(e.tagName)&&(i=!1===this.opts.linebreaks?t("<p>"+this.opts.invisibleSpace+"</p>"):t("<br>"+this.opts.invisibleSpace),t(e).replaceWith(i),this.selectionStart(i));void 0!==e.nodeValue&&null!==e.nodeValue&&e.remove&&3===e.nodeType&&null==e.nodeValue.match(/[^\u200B]/g)&&e.remove()},buildEventKeydownInsertLineBreak:function(t){this.bufferSet(),t.preventDefault(),this.insertLineBreak(),this.callback("enter",t)},buildEventKeyup:function(e){if(this.rtePaste)return!1;var i=e.which,n=this.getParent(),o=this.getCurrent();if(!this.opts.linebreaks&&3==o.nodeType&&(0==n||"BODY"==n.tagName)){var s=t("<p>").append(t(o).clone());t(o).replaceWith(s);var a=t(s).next();void 0!==a[0]&&"BR"==a[0].tagName&&a.remove(),this.selectionEnd(s)}if((this.opts.convertLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&i===this.keyCode.ENTER&&this.buildEventKeyupConverters(),i===this.keyCode.DELETE||i===this.keyCode.BACKSPACE)return this.formatEmpty(e);this.callback("keyup",e),this.sync(e)},buildEventKeyupConverters:function(){this.formatLinkify(this.opts.linkProtocol,this.opts.convertLinks,this.opts.convertImageLinks,this.opts.convertVideoLinks,this.opts.linkSize),setTimeout(t.proxy((function(){this.opts.convertImageLinks&&this.observeImages(),this.opts.observeLinks&&this.observeLinks()}),this),5)},buildPlugins:function(){this.opts.plugins&&t.each(this.opts.plugins,t.proxy((function(e,i){RedactorPlugins[i]&&(t.extend(this,RedactorPlugins[i]),t.isFunction(RedactorPlugins[i].init)&&this.init())}),this))},iframeStart:function(){this.iframeCreate(),this.opts.textareamode?this.iframeAppend(this.$source):(this.$sourceOld=this.$source.hide(),this.$source=this.buildCodearea(this.$sourceOld),this.iframeAppend(this.$sourceOld))},iframeAppend:function(t){this.$source.attr("dir",this.opts.direction).hide(),this.$box.insertAfter(t).append(this.$frame).append(this.$source)},iframeCreate:function(){this.$frame=t('<iframe style="width: 100%;" frameborder="0" />').one("load",t.proxy((function(){if(this.opts.fullpage){this.iframePage(),""===this.content&&(this.content=this.opts.invisibleSpace),this.$frame.contents()[0].write(this.content),this.$frame.contents()[0].close();var e=setInterval(t.proxy((function(){this.$frame.contents().find("body").html()&&(clearInterval(e),this.iframeLoad())}),this),0)}else this.iframeLoad()}),this))},iframeDoc:function(){return this.$frame[0].contentWindow.document},iframePage:function(){var t=this.iframeDoc();return t.documentElement&&t.removeChild(t.documentElement),t},iframeAddCss:function(e){e=e||this.opts.css,this.isString(e)&&this.$frame.contents().find("head").append('<link rel="stylesheet" href="'+e+'" />'),t.isArray(e)&&t.each(e,t.proxy((function(t,e){this.iframeAddCss(e)}),this))},iframeLoad:function(){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(this.$editor.html()):this.set(this.content,!0,!1),this.buildOptions(),this.buildAfter()},placeholderStart:function(t){if(this.isEmpty(t)){if(this.$element.attr("placeholder")&&(this.opts.placeholder=this.$element.attr("placeholder")),""!==this.opts.placeholder)return this.opts.focus=!1,this.placeholderOnFocus(),this.placeholderOnBlur(),this.placeholderGet()}else this.placeholderOnBlur();return!1},placeholderOnFocus:function(){this.$editor.on("focus.redactor_placeholder",t.proxy(this.placeholderFocus,this))},placeholderOnBlur:function(){this.$editor.on("blur.redactor_placeholder",t.proxy(this.placeholderBlur,this))},placeholderGet:function(){return t('<span class="redactor_placeholder">').data("redactor","verified").attr("contenteditable",!1).text(this.opts.placeholder)},placeholderBlur:function(){var t=this.get();this.isEmpty(t)&&(this.placeholderOnFocus(),this.$editor.html(this.placeholderGet()))},placeholderFocus:function(){this.$editor.find("span.redactor_placeholder").remove();var t="";!1===this.opts.linebreaks&&(t=this.opts.emptyHtml),this.$editor.off("focus.redactor_placeholder"),this.$editor.html(t),!1===this.opts.linebreaks?this.selectionStart(this.$editor.children()[0]):this.focus(),this.sync()},placeholderRemoveFromEditor:function(){this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder")},placeholderRemoveFromCode:function(t){return t.replace(/<span class="redactor_placeholder"(.*?)>(.*?)<\/span>/i,"")},shortcuts:function(t,e){if(!this.opts.shortcuts)return 66!==e&&73!==e||t.preventDefault(),!1;77===e?this.shortcutsLoad(t,"removeFormat"):66!==e||t.altKey?73!==e||t.altKey?85!==e||t.altKey||this.shortcutsLoad(t,"underline"):this.shortcutsLoad(t,"italic"):this.shortcutsLoad(t,"bold")},shortcutsLoad:function(t,e){t.preventDefault(),this.execCommand(e,!1)},shortcutsLoadFormat:function(t,e){t.preventDefault(),this.formatBlocks(e)},focus:function(){this.browser("opera")?this.$editor.focus():this.window.setTimeout(t.proxy(this.focusSet,this,!0),1)},focusWithSaveScroll:function(){if(this.browser("msie"))var t=this.document.documentElement.scrollTop;this.$editor.focus(),this.browser("msie")&&(this.document.documentElement.scrollTop=t)},focusEnd:function(){if(this.browser("mozilla"))if(!1===this.opts.linebreaks){var t=this.$editor.children().last();this.$editor.focus(),this.selectionEnd(t)}else this.focusSet();else this.focusSet()},focusSet:function(t,e){this.$editor.focus(),void 0===e&&(e=this.$editor[0]);var i=this.getRange();i.selectNodeContents(e),i.collapse(t||!1);var n=this.getSelection();n.removeAllRanges(),n.addRange(i)},getMode:function(){return this.opts.visual?"visual":"code"},toggle:function(t){this.opts.visual?this.toggleCode(t):this.toggleVisual()},toggleVisual:function(){var t=this.$source.hide().val();void 0!==this.modified&&(this.modified=this.cleanRemoveSpaces(this.modified,!1)!==this.cleanRemoveSpaces(t,!1)),this.modified&&(this.opts.fullpage&&""===t?this.setFullpageOnInit(t):(this.set(t),this.opts.fullpage&&this.buildBindKeyboard())),this.opts.iframe?this.$frame.show():this.$editor.show(),this.opts.fullpage&&this.$editor.attr("contenteditable",!0),this.$source.off("keydown.redactor-textarea-indenting"),this.$editor.focus(),this.selectionRestore(),this.observeStart(),this.buttonActiveVisual(),this.buttonInactive("html"),this.opts.visual=!0},toggleCode:function(e){!1!==e&&this.selectionSave();var i=null;this.opts.iframe?(i=this.$frame.height(),this.opts.fullpage&&this.$editor.removeAttr("contenteditable"),this.$frame.hide()):(i=this.$editor.innerHeight(),this.$editor.hide()),t(".redactor-link-tooltip").remove();var n=this.$source.val();""!==n&&this.opts.tidyHtml&&this.$source.val(this.cleanHtml(n)),this.modified=n,this.$source.height(i).show().focus(),this.$source.on("keydown.redactor-textarea-indenting",this.textareaIndenting),this.buttonInactiveVisual(),this.buttonActive("html"),this.opts.visual=!1},textareaIndenting:function(e){if(9===e.keyCode){var i=t(this),n=i.get(0).selectionStart;return i.val(i.val().substring(0,n)+"\t"+i.val().substring(i.get(0).selectionEnd)),i.get(0).selectionStart=i.get(0).selectionEnd=n+1,!1}},autosave:function(){var e=!1;this.autosaveInterval=setInterval(t.proxy((function(){var i=this.get();if(e!==i){var n=this.$source.attr("name");t.ajax({url:this.opts.autosave,type:"post",data:"name="+n+"&"+n+"="+escape(encodeURIComponent(i)),success:t.proxy((function(n){var o=t.parseJSON(n);void 0===o.error?this.callback("autosave",!1,o):this.callback("autosaveError",!1,o),e=i}),this)})}}),this),1e3*this.opts.autosaveInterval)},toolbarBuild:function(){if(this.isMobile()&&this.opts.buttonsHideOnMobile.length>0&&t.each(this.opts.buttonsHideOnMobile,t.proxy((function(t,e){var i=this.opts.buttons.indexOf(e);this.opts.buttons.splice(i,1)}),this)),this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!this.opts.buttonSource){var e=this.opts.buttons.indexOf("html");this.opts.buttons.splice(e,1)}if(t.extend(this.opts.toolbar,this.opts.toolbarCustom),this.opts.toolbar&&t.each(this.opts.toolbar.formatting.dropdown,t.proxy((function(e,i){"-1"==t.inArray(e,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[e]}),this)),0===this.opts.buttons.length)return!1;this.airEnable(),this.$toolbar=t("<ul>").addClass("redactor_toolbar").attr("id","redactor_toolbar_"+this.uuid),this.opts.typewriter&&this.$toolbar.addClass("redactor-toolbar-typewriter"),this.opts.toolbarOverflow&&this.isMobile()&&this.$toolbar.addClass("redactor-toolbar-overflow"),this.opts.air?(this.$air=t('<div class="redactor_air">').attr("id","redactor_air_"+this.uuid).hide(),this.$air.append(this.$toolbar),t("body").append(this.$air)):this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),t(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar),t.each(this.opts.buttons,t.proxy((function(e,i){if(this.opts.toolbar[i]){var n=this.opts.toolbar[i];if(!1===this.opts.fileUpload&&"file"===i)return!0;this.$toolbar.append(t("<li>").append(this.buttonBuild(i,n)))}}),this)),this.$toolbar.find("a").attr("tabindex","-1"),this.opts.toolbarFixed&&(this.toolbarObserveScroll(),t(this.opts.toolbarFixedTarget).on("scroll.redactor",t.proxy(this.toolbarObserveScroll,this))),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor",t.proxy(this.buttonActiveObserver,this))},toolbarObserveScroll:function(){var e,i=t(this.opts.toolbarFixedTarget).scrollTop(),n=0,o=0;if(e=(n=this.opts.toolbarFixedTarget===document?this.$box.offset().top:1)+this.$box.height()+40,i>n){var s="100%";this.opts.toolbarFixedBox&&(o=this.$box.offset().left,s=this.$box.innerWidth(),this.$toolbar.addClass("toolbar_fixed_box")),this.toolbarFixed=!0,this.opts.toolbarFixedTarget===document?this.$toolbar.css({position:"fixed",width:s,zIndex:10005,left:o}):this.$toolbar.css({position:"absolute",width:s,zIndex:10005,left:0}),i<e?this.$toolbar.css("visibility","visible"):this.$toolbar.css("visibility","hidden")}else this.toolbarFixed=!1,this.$toolbar.css({position:"relative",width:"auto",top:0,left:o}),this.opts.toolbarFixedBox&&this.$toolbar.removeClass("toolbar_fixed_box")},airEnable:function(){this.opts.air&&this.$editor.on("mouseup.redactor keyup.redactor",this,t.proxy((function(e){var i=this.getSelectionText();if("mouseup"===e.type&&""!=i&&this.airShow(e),"keyup"===e.type&&e.shiftKey&&""!=i){var n=t(this.getElement(this.getSelection().focusNode)),o=n.offset();o.height=n.height(),this.airShow(o,!0)}}),this))},airShow:function(e,i){if(this.opts.air){var n,o;if(t(".redactor_air").hide(),i)n=e.left,o=e.top+e.height+14,this.opts.iframe&&(o+=this.$box.position().top-t(this.document).scrollTop(),n+=this.$box.position().left);else{var s=this.$air.innerWidth();n=e.clientX,t(this.document).width()<n+s&&(n-=s),o=e.clientY+14,this.opts.iframe?(o+=this.$box.position().top,n+=this.$box.position().left):o+=t(this.document).scrollTop()}this.$air.css({left:n+"px",top:o+"px"}).show(),this.airBindHide()}},airBindHide:function(){if(this.opts.air){var e=t.proxy((function(e){t(e).on("mousedown.redactor",t.proxy((function(i){0===t(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),this.selectionRemove(),t(e).off(i))}),this)).on("keydown.redactor",t.proxy((function(i){i.which===this.keyCode.ESC&&this.getSelection().collapseToStart(),this.$air.fadeOut(100),t(e).off(i)}),this))}),this);e(document),this.opts.iframe&&e(this.document)}},airBindMousemoveHide:function(){if(this.opts.air){var e=t.proxy((function(e){t(e).on("mousemove.redactor",t.proxy((function(i){0===t(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),t(e).off(i))}),this))}),this);e(document),this.opts.iframe&&e(this.document)}},dropdownBuild:function(e,i){t.each(i,t.proxy((function(i,n){var o;n.className||(n.className=""),"separator"===n.name?o=t('<a class="redactor_separator_drop">'):(o=t('<a href="#" class="'+n.className+" redactor_dropdown_"+i+'">'+n.title+"</a>")).on("click",t.proxy((function(t){t.preventDefault&&t.preventDefault(),this.browser("msie")&&(t.returnValue=!1),n.callback&&n.callback.call(this,i,o,n,t),n.exec&&this.execCommand(n.exec,i),n.func&&this[n.func](i),this.buttonActiveObserver(),this.opts.air&&this.$air.fadeOut(100)}),this)),e.append(o)}),this))},dropdownShow:function(e,i){if(!this.opts.visual)return e.preventDefault(),!1;var n=this.$toolbar.find(".redactor_dropdown_box_"+i),o=this.buttonGet(i);if(o.hasClass("dropact"))this.dropdownHideAll();else{this.dropdownHideAll(),this.callback("dropdownShow",{dropdown:n,key:i,button:o}),this.buttonActive(i),o.addClass("dropact");var s=o.position();this.toolbarFixed&&(s=o.offset());var a=n.width();s.left+a>t(document).width()&&(s.left-=a);var r=s.left+"px",l=o.innerHeight(),d="absolute",c=l+"px";this.opts.toolbarFixed&&this.toolbarFixed?d="fixed":this.opts.air||(c=s.top+l+"px"),n.css({position:d,left:r,top:c}).addClass("redactor_dropdown_open"),this.callback("dropdownShown",{dropdown:n,key:i,button:o})}var u=t.proxy((function(t){this.dropdownHide(t,n)}),this);t(document).one("click",u),this.$editor.one("click",u),e.stopPropagation(),this.focusWithSaveScroll()},dropdownHideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),t(".redactor_dropdown").removeClass("redactor_dropdown_open"),this.callback("dropdownHide")},dropdownHide:function(e,i){t(e.target).hasClass("dropact")||(i.removeClass("dropact"),this.dropdownHideAll())},buttonBuild:function(e,i,n){var o=t('<a href="javascript:;" title="'+i.title+'" tabindex="-1" class="re-icon re-'+e+'"></a>');if(void 0!==n&&o.addClass("redactor-btn-image"),o.on("click",t.proxy((function(t){if(t.preventDefault&&t.preventDefault(),this.browser("msie")&&(t.returnValue=!1),o.hasClass("redactor_button_disabled"))return!1;!1!==this.isFocused()||i.exec||this.focusWithSaveScroll(),i.exec?(this.focusWithSaveScroll(),this.execCommand(i.exec,e),this.airBindMousemoveHide()):i.func&&"show"!==i.func?(this[i.func](e),this.airBindMousemoveHide()):i.callback?(i.callback.call(this,e,o,i,t),this.airBindMousemoveHide()):i.dropdown&&this.dropdownShow(t,e),this.buttonActiveObserver(!1,e)}),this)),i.dropdown){var s=t('<div class="redactor_dropdown redactor_dropdown_box_'+e+'">');s.appendTo(this.$toolbar),this.dropdownBuild(s,i.dropdown)}return o},buttonGet:function(e){return!!this.opts.toolbar&&t(this.$toolbar.find("a.re-"+e))},buttonTagToActiveState:function(t,e){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},buttonActiveToggle:function(t){this.buttonGet(t).hasClass("redactor_act")?this.buttonInactive(t):this.buttonActive(t)},buttonActive:function(t){this.buttonGet(t).addClass("redactor_act")},buttonInactive:function(t){this.buttonGet(t).removeClass("redactor_act")},buttonInactiveAll:function(t){this.$toolbar.find("a.re-icon").not(".re-"+t).removeClass("redactor_act")},buttonActiveVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor_button_disabled")},buttonInactiveVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor_button_disabled")},buttonChangeIcon:function(t,e){this.buttonGet(t).addClass("re-"+e)},buttonRemoveIcon:function(t,e){this.buttonGet(t).removeClass("re-"+e)},buttonAwesome:function(t,e){var i=this.buttonGet(t);i.removeClass("redactor-btn-image"),i.addClass("fa-redactor-btn"),i.html('<i class="fa '+e+'"></i>')},buttonAdd:function(e,i,n,o){if(this.opts.toolbar){var s=this.buttonBuild(e,{title:i,callback:n,dropdown:o},!0);return this.$toolbar.append(t("<li>").append(s)),s}},buttonAddFirst:function(e,i,n,o){if(this.opts.toolbar){var s=this.buttonBuild(e,{title:i,callback:n,dropdown:o},!0);this.$toolbar.prepend(t("<li>").append(s))}},buttonAddAfter:function(e,i,n,o,s){if(this.opts.toolbar){var a=this.buttonBuild(i,{title:n,callback:o,dropdown:s},!0),r=this.buttonGet(e);return 0!==r.size()?r.parent().after(t("<li>").append(a)):this.$toolbar.append(t("<li>").append(a)),a}},buttonAddBefore:function(e,i,n,o,s){if(this.opts.toolbar){var a=this.buttonBuild(i,{title:n,callback:o,dropdown:s},!0),r=this.buttonGet(e);return 0!==r.size()?r.parent().before(t("<li>").append(a)):this.$toolbar.append(t("<li>").append(a)),a}},buttonRemove:function(t){this.buttonGet(t).remove()},buttonActiveObserver:function(e,i){var n=this.getParent();if(this.buttonInactiveAll(i),!1!==e||"html"===i){n&&"A"===n.tagName?this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_edit):this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_insert),t.each(this.opts.activeButtonsStates,t.proxy((function(e,i){0!=t(n).closest(e,this.$editor.get()[0]).length&&this.buttonActive(i)}),this));var o=t(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(o.length)switch(o.css("text-align")){case"right":this.buttonActive("alignright");break;case"center":this.buttonActive("aligncenter");break;case"justify":this.buttonActive("alignjustify");break;default:this.buttonActive("alignleft")}}else-1!=t.inArray(i,this.opts.activeButtons)&&this.buttonActiveToggle(i)},execPasteFrag:function(t){var e=this.getSelection();if(e.getRangeAt&&e.rangeCount){var i=this.getRange();i.deleteContents();var n=this.document.createElement("div");n.innerHTML=t;for(var o,s,a=this.document.createDocumentFragment();o=n.firstChild;)s=a.appendChild(o);a.firstChild;i.insertNode(a),s&&((i=i.cloneRange()).setStartAfter(s),i.collapse(!0)),e.removeAllRanges(),e.addRange(i)}},exec:function(t,e,i){"formatblock"===t&&this.browser("msie")&&(e="<"+e+">"),"inserthtml"===t&&this.browser("msie")?this.isIe11()?this.execPasteFrag(e):(this.focusWithSaveScroll(),this.document.selection.createRange().pasteHTML(e)):this.document.execCommand(t,!1,e),!1!==i&&this.sync(),this.callback("execCommand",t,e)},execCommand:function(t,e,i){if(!this.opts.visual)return this.$source.focus(),!1;if("bold"!==t&&"italic"!==t&&"underline"!==t&&"strikethrough"!==t||this.bufferSet(),"superscript"===t||"subscript"===t){var n=this.getParent();"SUP"!==n.tagName&&"SUB"!==n.tagName||this.inlineRemoveFormatReplace(n)}return"inserthtml"===t?(this.insertHtml(e,i),void this.callback("execCommand",t,e)):!(this.currentOrParentIs("PRE")&&!this.opts.formattingPre)&&("insertunorderedlist"===t||"insertorderedlist"===t?this.execLists(t,e):"unlink"===t?this.execUnlink(t,e):(this.exec(t,e,i),void("inserthorizontalrule"===t&&this.$editor.find("hr").removeAttr("id"))))},execUnlink:function(e,i){this.bufferSet();var n=this.currentOrParentIs("A");if(n){for(var o=n.childNodes.length,s=0;s<o;s++){var a=n.childNodes[s];a&&3==a.nodeType&&a.length>1&&(a.splitText(1),o=n.childNodes.length)}return t(n).replaceWith(n.childNodes),this.sync(),void this.callback("execCommand",e,i)}},execLists:function(e,i){this.bufferSet();var n=this.getParent(),o=t(n).closest("ol, ul");this.isParentRedactor(o)||0==o.size()||(o=!1);var s=!1;if(o&&o.length){s=!0;var a=o[0].tagName;("insertunorderedlist"===e&&"OL"===a||"insertorderedlist"===e&&"UL"===a)&&(s=!1)}if(this.selectionSave(),s){var r=this.getNodes(),l=this.getBlocks(r);void 0!==r[0]&&r.length>1&&3==r[0].nodeType&&l.unshift(this.getBlock());var d="",c="";t.each(l,t.proxy((function(e,i){if("LI"==i.tagName){var n=t(i),o=n.clone();o.find("ul","ol").remove(),!1===this.opts.linebreaks?d+=this.outerHtml(t("<p>").append(o.contents())):d+=o.html()+"<br>",0==e?(n.addClass("redactor-replaced").empty(),c=this.outerHtml(n)):n.remove()}}),this));var u=this.$editor.html().replace(c,"</"+a+">"+d+"<"+a+">");this.$editor.html(u),this.$editor.find(a+":empty").remove()}else{var h=t(this.getParent()).closest("td");this.document.execCommand(e);n=this.getParent(),o=t(n).closest("ol, ul");if(0!=h.size()&&o.wrapAll("<td>"),o.length){var p=o.parent();this.isParentRedactor(p)&&"LI"!=p[0].tagName&&this.nodeTestBlocks(p[0])&&p.replaceWith(p.contents())}this.browser("mozilla")&&this.$editor.focus()}this.selectionRestore(),this.sync(),this.callback("execCommand",e,i)},indentingIndent:function(){this.indentingStart("indent")},indentingOutdent:function(){this.indentingStart("outdent")},indentingStart:function(e){if(this.bufferSet(),"indent"===e){var i=this.getBlock();if(this.selectionSave(),i&&"LI"==i.tagName){var n=this.getParent(),o=t(n).closest("ol, ul")[0].tagName,s=this.getBlocks();t.each(s,(function(e,i){if("LI"==i.tagName){var n=t(i).prev();if(0!=n.size()&&"LI"==n[0].tagName){var s=n.children("ul, ol");0==s.size()?n.append(t("<"+o+">").append(i)):s.append(i)}}}))}else if(!1===i&&!0===this.opts.linebreaks){this.exec("formatBlock","blockquote");var a=this.getBlock();i=t('<div data-tagblock="">').html(t(a).html());t(a).replaceWith(i);var r=this.normalize(t(i).css("margin-left"))+this.opts.indentValue;t(i).css("margin-left",r+"px")}else{var l=this.getBlocks();t.each(l,t.proxy((function(e,i){var n=!1;if("TD"!==i.tagName){n=-1!==t.inArray(i.tagName,this.opts.alignmentTags)?t(i):t(i).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);var o=this.normalize(n.css("margin-left"))+this.opts.indentValue;n.css("margin-left",o+"px")}}),this))}this.selectionRestore()}else{if(this.selectionSave(),(i=this.getBlock())&&"LI"==i.tagName){s=this.getBlocks();this.insideOutdent(i,0,s)}else{l=this.getBlocks();t.each(l,t.proxy((function(e,i){var n=!1;n=-1!==t.inArray(i.tagName,this.opts.alignmentTags)?t(i):t(i).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);var o=this.normalize(n.css("margin-left"))-this.opts.indentValue;o<=0?!0===this.opts.linebreaks&&void 0!==n.data("tagblock")?n.replaceWith(n.html()):(n.css("margin-left",""),this.removeEmptyAttr(n,"style")):n.css("margin-left",o+"px")}),this))}this.selectionRestore()}this.sync()},insideOutdent:function(e,i,n){if(e&&"LI"==e.tagName){var o=t(e).parent().parent();0!=o.size()&&"LI"==o[0].tagName?o.after(e):void 0!==n[i]?(e=n[i],i++,this.insideOutdent(e,i,n)):this.execCommand("insertunorderedlist")}},alignmentLeft:function(){this.alignmentSet("","JustifyLeft")},alignmentRight:function(){this.alignmentSet("right","JustifyRight")},alignmentCenter:function(){this.alignmentSet("center","JustifyCenter")},alignmentJustify:function(){this.alignmentSet("justify","JustifyFull")},alignmentSet:function(e,i){if(this.bufferSet(),this.oldIE())return this.document.execCommand(i,!1,!1),!0;if(this.selectionSave(),!(o=this.getBlock())&&this.opts.linebreaks){this.exec("formatblock","div");var n=this.getBlock(),o=t('<div data-tagblock="">').html(t(n).html());t(n).replaceWith(o),t(o).css("text-align",e),this.removeEmptyAttr(o,"style"),""==e&&void 0!==t(o).data("tagblock")&&t(o).replaceWith(t(o).html())}else{var s=this.getBlocks();t.each(s,t.proxy((function(i,n){var o=!1;(o=-1!==t.inArray(n.tagName,this.opts.alignmentTags)?t(n):t(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]))&&(o.css("text-align",e),this.removeEmptyAttr(o,"style"))}),this))}this.selectionRestore(),this.sync()},cleanEmpty:function(t){var e=this.placeholderStart(t);return!1!==e?e:(!1===this.opts.linebreaks&&(""===t?t=this.opts.emptyHtml:-1!==t.search(/^<hr\s?\/?>$/gi)&&(t="<hr>"+this.opts.emptyHtml)),t)},cleanConverters:function(t){return this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")),this.opts.paragraphy&&(t=this.cleanParagraphy(t)),t},cleanConvertProtected:function(t){return this.opts.templateVars&&(t=(t=t.replace(/\{\{(.*?)\}\}/gi,"\x3c!-- template double $1 --\x3e")).replace(/\{(.*?)\}/gi,"\x3c!-- template $1 --\x3e")),t=(t=(t=t.replace(/<script(.*?)>([\w\W]*?)<\/script>/gi,'<title type="text/javascript" style="display: none;" class="redactor-script-tag"$1>$2</title>')).replace(/<style(.*?)>([\w\W]*?)<\/style>/gi,'<section$1 style="display: none;" rel="redactor-style-tag">$2</section>')).replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>'),t=this.opts.phpTags?t.replace(/<\?php([\w\W]*?)\?>/gi,'<section style="display: none;" rel="redactor-php-tag">$1</section>'):t.replace(/<\?php([\w\W]*?)\?>/gi,"")},cleanReConvertProtected:function(t){return this.opts.templateVars&&(t=(t=t.replace(/<!-- template double (.*?) -->/gi,"{{$1}}")).replace(/<!-- template (.*?) -->/gi,"{$1}")),t=(t=(t=t.replace(/<title type="text\/javascript" style="display: none;" class="redactor-script-tag"(.*?)>([\w\W]*?)<\/title>/gi,'<script$1 type="text/javascript">$2<\/script>')).replace(/<section(.*?) style="display: none;" rel="redactor-style-tag">([\w\W]*?)<\/section>/gi,"<style$1>$2</style>")).replace(/<section(.*?)rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>"),this.opts.phpTags&&(t=t.replace(/<section style="display: none;" rel="redactor-php-tag">([\w\W]*?)<\/section>/gi,"<?php\r\n$1\r\n?>")),t},cleanRemoveSpaces:function(e,i){if(!1!==i){i=[];var n=e.match(/<(pre|style|script|title)(.*?)>([\w\W]*?)<\/(pre|style|script|title)>/gi);if(null===n&&(n=[]),this.opts.phpTags){var o=e.match(/<\?php([\w\W]*?)\?>/gi);o&&(n=t.merge(n,o))}n&&t.each(n,(function(t,n){e=e.replace(n,"buffer_"+t),i.push(n)}))}return e=(e=(e=(e=(e=(e=e.replace(/\n/g," ")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <"),e=(e=this.cleanReplacer(e,i)).replace(/\n\n/g,"\n")},cleanReplacer:function(e,i){return!1===i||t.each(i,(function(t,i){e=e.replace("buffer_"+t,i)})),e},cleanRemoveEmptyTags:function(t){t=(t=t.replace(/<span>([\w\W]*?)<\/span>/gi,"$1")).replace(/[\u200B-\u200D\uFEFF]/g,"");for(var e=["<b>\\s*</b>","<b>&nbsp;</b>","<em>\\s*</em>"],i=["<pre></pre>","<blockquote>\\s*</blockquote>","<dd></dd>","<dt></dt>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<p>\\s*</p>","<p></p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],n=(i=this.opts.removeEmptyTags?i.concat(e):e).length,o=0;o<n;++o)t=t.replace(new RegExp(i[o],"gi"),"");return t},cleanParagraphy:function(e){if(e=t.trim(e),!0===this.opts.linebreaks)return e;if(""===e||"<p></p>"===e)return this.opts.emptyHtml;if(e+="\n",!1===this.opts.removeEmptyTags)return e;var i=[],n=e.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi);n||(n=[]);var o=e.match(/<!--([\w\W]*?)-->/gi);if(o&&(n=t.merge(n,o)),this.opts.phpTags){var s=e.match(/<section(.*?)rel="redactor-php-tag">([\w\W]*?)<\/section>/gi);s&&(n=t.merge(n,s))}function a(t,i,n){return e.replace(new RegExp(t,i),n)}n&&t.each(n,(function(t,n){i[t]=n,e=e.replace(n,"{replace"+t+"}\n")})),e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n");var r="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";e=a("(<"+r+"[^>]*>)","gi","\n$1"),e=a("(</"+r+">)","gi","$1\n\n"),e=a("\r\n","g","\n"),e=a("\r","g","\n");var l=(e=a("/\n\n+/","g","\n\n")).split(new RegExp("\ns*\n","g"),-1);for(var d in e="",l)l.hasOwnProperty(d)&&(-1==l[d].search("{replace")?(l[d]=l[d].replace(/<p>\n\t<\/p>/gi,""),l[d]=l[d].replace(/<p><\/p>/gi,""),""!=l[d]&&(e+="<p>"+l[d].replace(/^\n+|\n+$/g,"")+"</p>")):e+=l[d]);return e=a("<p><p>","gi","<p>"),e=a("</p></p>","gi","</p>"),e=a("<p>s?</p>","gi",""),e=a("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),e=a("<p>(</?"+r+"[^>]*>)</p>","gi","$1"),e=a("<p>(<li.+?)</p>","gi","$1"),e=a("<p>s?(</?"+r+"[^>]*>)","gi","$1"),e=a("(</?"+r+"[^>]*>)s?</p>","gi","$1"),e=a("(</?"+r+"[^>]*>)s?<br />","gi","$1"),e=a("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),e=a("\n</p>","gi","</p>"),e=a("<li><p>","gi","<li>"),e=a("</p></li>","gi","</li>"),e=a("</li><p>","gi","</li>"),e=a("<p>\t?\n?<p>","gi","<p>"),e=a("</dt><p>","gi","</dt>"),e=a("</dd><p>","gi","</dd>"),e=a("<br></p></blockquote>","gi","</blockquote>"),e=a("<p>\t*</p>","gi",""),t.each(i,(function(t,i){e=e.replace("{replace"+t+"}",i)})),t.trim(e)},cleanConvertInlineTags:function(t,e){var i="strong";"b"===this.opts.boldTag&&(i="b");var n="em";return"i"===this.opts.italicTag&&(n="i"),t=(t=t.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+n+">$1</"+n+">")).replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+i+">$1</"+i+">"),t="strong"===this.opts.boldTag?t.replace(/<b>([\w\W]*?)<\/b>/gi,"<strong>$1</strong>"):t.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),t="em"===this.opts.italicTag?t.replace(/<i>([\w\W]*?)<\/i>/gi,"<em>$1</em>"):t.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),t=!0!==e?t.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"):t.replace(/<del>([\w\W]*?)<\/del>/gi,"<strike>$1</strike>")},cleanStripTags:function(e){if(""==e||void 0===e)return e;var i=!1;!1!==this.opts.allowedTags&&(i=!0);var n=!0===i?this.opts.allowedTags:this.opts.deniedTags;return e=e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(e,o){return!0===i?t.inArray(o.toLowerCase(),n)>"-1"?e:"":t.inArray(o.toLowerCase(),n)>"-1"?"":e})),e=this.cleanConvertInlineTags(e)},cleanSavePreCode:function(e,i){var n=e.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==n&&t.each(n,t.proxy((function(t,n){var o=n.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);o[3]=o[3].replace(/&nbsp;/g," "),!1!==i&&(o[3]=this.cleanEncodeEntities(o[3])),o[3]=o[3].replace(/\$/g,"&#36;"),e=e.replace(n,"<"+o[1]+o[2]+">"+o[3]+"</"+o[1]+">")}),this)),e},cleanEncodeEntities:function(t){return(t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanUnverified:function(){var e=this.$editor.find("li, img, a, b, strong, sub, sup, i, em, u, small, strike, del, span, cite");e.filter('[style*="background-color: transparent;"][style*="line-height"]').css("background-color","").css("line-height",""),e.filter('[style*="background-color: transparent;"]').css("background-color",""),e.css("line-height",""),t.each(e,t.proxy((function(t,e){this.removeEmptyAttr(e,"style")}),this)),this.$editor.find('div[style="text-align: -webkit-auto;"]').contents().unwrap(),this.$editor.find("ul, ol, li").removeAttr("style")},cleanHtml:function(t){var e=0,i=t.length,n=0,o=null,s=null,a="",r="",l="";for(this.cleanlevel=0;e<i;e++){if(n=e,-1==t.substr(e).indexOf("<"))return r+=t.substr(e),this.cleanFinish(r);for(;n<i&&"<"!=t.charAt(n);)n++;for(e!=n&&((l=t.substr(e,n-e)).match(/^\s{2,}$/g)||("\n"==r.charAt(r.length-1)?r+=this.cleanGetTabs():"\n"==l.charAt(0)&&(r+="\n"+this.cleanGetTabs(),l=l.replace(/^\s+/,"")),r+=l),l.match(/\n/)&&(r+="\n"+this.cleanGetTabs())),o=n;n<i&&">"!=t.charAt(n);)n++;var d;if(e=n,"!--"==(a=t.substr(o,n-o)).substr(1,3)){if(!a.match(/--$/)){for(;"--\x3e"!=t.substr(n,3);)n++;n+=2,a=t.substr(o,n-o),e=n}"\n"!=r.charAt(r.length-1)&&(r+="\n"),r+=this.cleanGetTabs(),r+=a+">\n"}else"!"==a[1]?r=this.placeTag(a+">",r):"?"==a[1]?r+=a+">\n":(d=a.match(/^<(script|style|pre)/i))?(d[1]=d[1].toLowerCase(),a=this.cleanTag(a),r=this.placeTag(a,r),(s=String(t.substr(e+1)).toLowerCase().indexOf("</"+d[1]))&&(l=t.substr(e+1,s),e+=s,r+=l)):(a=this.cleanTag(a),r=this.placeTag(a,r))}return this.cleanFinish(r)},cleanGetTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="\t";return t},cleanFinish:function(e){var i=[],n=e.match(/<(pre|style|script)(.*?)>([\w\W]*?)<\/(pre|style|script)>/gi)||[];return t.each(n,(function(t,n){e=e.replace(n,"buffer_"+t),i.push(n)})),e=(e=(e=e.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,""),e=(e=this.cleanReplacer(e,i)).replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>"),this.cleanlevel=0,e},cleanTag:function(t){var e,i="",n="";for((t=(t=(t=t.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ")).match(/\/$/)&&(n="/",t=t.replace(/\/+$/,""));e=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)e[2]?i+=e[1].toLowerCase()+"="+e[2]:e[1]&&(i+=e[1].toLowerCase()),i+=" ",t=t.substr(e[0].length);return i.replace(/\s*$/,"")+n+">"},placeTag:function(t,e){var i=t.match(this.cleannewLevel);return(t.match(this.cleanlineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"==t.charAt(1)&&this.cleanlevel--,"\n"==e.charAt(e.length-1)&&(e+=this.cleanGetTabs()),i&&"/"!=t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.cleanlineAfter)||t.match(this.cleannewLevel))&&(e=e.replace(/ *$/,""),e+="\n"),e},formatEmpty:function(e){var i=t.trim(this.$editor.html());if(this.opts.linebreaks)""==i&&(e.preventDefault(),this.$editor.html(""),this.focus());else{var n=(i=i.replace(/<br\s?\/?>/i,"")).replace(/<p>\s?<\/p>/gi,"");if(""===i||""===n){e.preventDefault();var o=t(this.opts.emptyHtml).get(0);this.$editor.html(o),this.focus()}}this.sync()},formatBlocks:function(e){this.bufferSet();var i=this.getBlocks();this.selectionSave(),t.each(i,t.proxy((function(i,n){if("LI"!==n.tagName){var o=t(n).parent();if("p"===e){if("P"===n.tagName&&0!=o.size()&&"BLOCKQUOTE"===o[0].tagName||"BLOCKQUOTE"===n.tagName)return void this.formatQuote();if(this.opts.linebreaks){if(!n||0!=n.tagName.search(/H[1-6]/))return;t(n).replaceWith(n.innerHTML+"<br>")}else this.formatBlock(e,n)}else this.formatBlock(e,n)}}),this)),this.selectionRestore(),this.sync()},formatBlock:function(e,i){if(!1===i&&(i=this.getBlock()),!1===i&&!0===this.opts.linebreaks)return this.execCommand("formatblock",e),!0;var n="";if("pre"!==e?n=t(i).contents():(n=t(i).html(),""===t.trim(n)&&(n='<span id="selection-marker-1"></span>')),"PRE"===i.tagName&&(e="p"),!0===this.opts.linebreaks&&"p"===e)t(i).replaceWith(t("<div>").append(n).html()+"<br>");else{var o=this.getParent(),s=t("<"+e+">").append(n);t(i).replaceWith(s),o&&"TD"==o.tagName&&t(s).wrapAll("<td>")}},formatChangeTag:function(e,i,n){!1!==n&&this.selectionSave();var o=t("<"+i+"/>");return t(e).replaceWith((function(){return o.append(t(this).contents())})),!1!==n&&this.selectionRestore(),o},formatQuote:function(){if(this.bufferSet(),!1===this.opts.linebreaks){this.selectionSave();var e=this.getBlocks(),i=!1,n=e.length;if(e){var o="",s="",a=!1,r=!0;if(t.each(e,(function(t,e){"P"!==e.tagName&&(r=!1)})),t.each(e,t.proxy((function(l,d){if("BLOCKQUOTE"===d.tagName)this.formatBlock("p",d,!1);else if("P"===d.tagName)if("BLOCKQUOTE"==(i=t(d).parent())[0].tagName){var c=t(i).children("p").size();1==c?t(i).replaceWith(d):c==n?(a="blockquote",o+=this.outerHtml(d)):(a="html",o+=this.outerHtml(d),0==l?(t(d).addClass("redactor-replaced").empty(),s=this.outerHtml(d)):t(d).remove())}else!1===r||1==e.length?this.formatBlock("blockquote",d,!1):(a="paragraphs",o+=this.outerHtml(d));else"LI"!==d.tagName&&this.formatBlock("blockquote",d,!1)}),this)),a)if("paragraphs"==a)t(e[0]).replaceWith("<blockquote>"+o+"</blockquote>"),t(e).remove();else if("blockquote"==a)t(i).replaceWith(o);else if("html"==a){var l=this.$editor.html().replace(s,"</blockquote>"+o+"<blockquote>");this.$editor.html(l),this.$editor.find("blockquote").each((function(){""==t.trim(t(this).html())&&t(this).remove()}))}}this.selectionRestore()}else{var d=this.getBlock();if("BLOCKQUOTE"===d.tagName){this.selectionSave();l=t.trim(t(d).html());var c=t.trim(this.getSelectionHtml());if((l=l.replace(/<span(.*?)id="selection-marker(.*?)<\/span>/gi,""))==c)t(d).replaceWith(t(d).html()+"<br>");else{this.inlineFormat("tmp");var u=this.$editor.find("tmp");u.empty();var h=this.$editor.html().replace("<tmp></tmp>",'</blockquote><span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"+c+"<blockquote>");this.$editor.html(h),u.remove(),this.$editor.find("blockquote").each((function(){""==t.trim(t(this).html())&&t(this).remove()}))}this.selectionRestore(),this.$editor.find("span#selection-marker-1").attr("id",!1)}else{var p=this.selectionWrap("blockquote");l=t(p).html();t.each(["ul","ol","table","tr","tbody","thead","tfoot","dl"],(function(t,e){l=(l=l.replace(new RegExp("<"+e+"(.*?)>","gi"),"")).replace(new RegExp("</"+e+">","gi"),"")}));var f=this.opts.blockLevelElements;t.each(f,(function(t,e){l=(l=l.replace(new RegExp("<"+e+"(.*?)>","gi"),"")).replace(new RegExp("</"+e+">","gi"),"<br>")})),t(p).html(l),this.selectionElement(p);var m=t(p).next();0!=m.size()&&"BR"===m[0].tagName&&m.remove()}}this.sync()},blockRemoveAttr:function(e,i){var n=this.getBlocks();t(n).removeAttr(e),this.sync()},blockSetAttr:function(e,i){var n=this.getBlocks();t(n).attr(e,i),this.sync()},blockRemoveStyle:function(e){var i=this.getBlocks();t(i).css(e,""),this.removeEmptyAttr(i,"style"),this.sync()},blockSetStyle:function(e,i){var n=this.getBlocks();t(n).css(e,i),this.sync()},blockRemoveClass:function(e){var i=this.getBlocks();t(i).removeClass(e),this.removeEmptyAttr(i,"class"),this.sync()},blockSetClass:function(e){var i=this.getBlocks();t(i).addClass(e),this.sync()},inlineRemoveClass:function(e){this.selectionSave(),this.inlineEachNodes((function(i){t(i).removeClass(e),this.removeEmptyAttr(i,"class")})),this.selectionRestore(),this.sync()},inlineSetClass:function(e){var i=this.getCurrent();t(i).hasClass(e)||this.inlineMethods("addClass",e)},inlineRemoveStyle:function(e){this.selectionSave(),this.inlineEachNodes((function(i){t(i).css(e,""),this.removeEmptyAttr(i,"style")})),this.selectionRestore(),this.sync()},inlineSetStyle:function(t,e){this.inlineMethods("css",t,e)},inlineRemoveAttr:function(e){this.selectionSave();var i=this.getRange(),n=this.getElement(),o=this.getNodes();(i.collapsed||i.startContainer===i.endContainer&&n)&&(o=t(n)),t(o).removeAttr(e),this.inlineUnwrapSpan(),this.selectionRestore(),this.sync()},inlineSetAttr:function(t,e){this.inlineMethods("attr",t,e)},inlineMethods:function(e,i,n){this.bufferSet(),this.selectionSave();var o=this.getRange(),s=this.getElement();if(!o.collapsed&&o.startContainer!==o.endContainer||!s||this.nodeTestBlocks(s)){this.document.execCommand("fontSize",!1,4);var a=this.$editor.find("font");t.each(a,t.proxy((function(t,o){this.inlineSetMethods(e,o,i,n)}),this))}else t(s)[e](i,n);this.selectionRestore(),this.sync()},inlineSetMethods:function(e,i,n,o){var s,a=t(i).parent();return this.getSelectionText()==t(a).text()&&a&&"INLINE"===a[0].tagName&&0!=a[0].attributes.length?(s=a,t(i).replaceWith(t(i).html())):(s=t("<inline>").append(t(i).contents()),t(i).replaceWith(s)),t(s)[e](n,o),s},inlineEachNodes:function(e){var i,n=this.getRange(),o=this.getElement(),s=this.getNodes();(n.collapsed||n.startContainer===n.endContainer&&o)&&(s=t(o),i=!0),t.each(s,t.proxy((function(n,o){if(!i&&"INLINE"!==o.tagName){if(!(this.getSelectionText()==t(o).parent().text())||"INLINE"!==o.parentNode.tagName||t(o.parentNode).hasClass("redactor_editor"))return;o=o.parentNode}e.call(this,o)}),this))},inlineUnwrapSpan:function(){var e=this.$editor.find("inline");t.each(e,t.proxy((function(e,i){var n=t(i);void 0===n.attr("class")&&void 0===n.attr("style")&&n.contents().unwrap()}),this))},inlineFormat:function(e){this.selectionSave(),this.document.execCommand("fontSize",!1,4);var i=this.$editor.find("font");t.each(i,(function(i,n){var o=t("<"+e+"/>").append(t(n).contents());t(n).replaceWith(o),o})),this.selectionRestore(),this.sync()},inlineRemoveFormat:function(e){this.selectionSave();var i=e.toUpperCase(),n=this.getNodes(),o=t(this.getParent()).parent();t.each(n,(function(t,e){e.tagName===i&&this.inlineRemoveFormatReplace(e)})),o&&o[0].tagName===i&&this.inlineRemoveFormatReplace(o),this.selectionRestore(),this.sync()},inlineRemoveFormatReplace:function(e){t(e).replaceWith(t(e).contents())},insertHtml:function(e,i){var n=this.getCurrent(),o=n.parentNode;this.focusWithSaveScroll(),this.bufferSet();var s=t("<div>").append(t.parseHTML(e));e=s.html(),e=this.cleanRemoveEmptyTags(e),s=t("<div>").append(t.parseHTML(e));var a=this.getBlock();if(1==s.contents().length){var r=s.contents()[0].tagName;("P"!=r&&r==a.tagName||"PRE"==r)&&(s=t("<div>").append(e))}this.opts.linebreaks&&(e=e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),!this.opts.linebreaks&&1==s.contents().length&&3==s.contents()[0].nodeType&&(this.getRangeSelectedNodes().length>2||!n||"BODY"==n.tagName&&!o||"HTML"==o.tagName)&&(e="<p>"+e+"</p>"),e=this.setSpansVerifiedHtml(e),s.contents().length>1&&a||s.contents().is("p, :header, ul, ol, li, div, table, td, blockquote, pre, address, section, header, footer, aside, article")?this.browser("msie")?this.isIe11()?this.execPasteFrag(e):this.document.selection.createRange().pasteHTML(e):this.document.execCommand("inserthtml",!1,e):this.insertHtmlAdvanced(e,!1),this.selectall&&this.window.setTimeout(t.proxy((function(){this.opts.linebreaks?this.focusEnd():this.selectionEnd(this.$editor.contents().last())}),this),1),this.observeStart(),this.setNonEditable(),!1!==i&&this.sync()},insertHtmlAdvanced:function(t,e){t=this.setSpansVerifiedHtml(t);var i=this.getSelection();if(i.getRangeAt&&i.rangeCount){var n=i.getRangeAt(0);n.deleteContents();var o=this.document.createElement("div");o.innerHTML=t;for(var s,a,r=this.document.createDocumentFragment();s=o.firstChild;)a=r.appendChild(s);n.insertNode(r),a&&((n=n.cloneRange()).setStartAfter(a),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}!1!==e&&this.sync()},insertBeforeCursor:function(e){e=this.setSpansVerifiedHtml(e);var i=t(e),n=document.createElement("span");n.innerHTML="​";var o=this.getRange();o.insertNode(n),o.insertNode(i[0]),o.collapse(!1);var s=this.getSelection();s.removeAllRanges(),s.addRange(o),this.sync()},insertText:function(e){var i=t(t.parseHTML(e));i.length&&(e=i.text()),this.focusWithSaveScroll(),this.browser("msie")&&!this.isIe11()?this.document.selection.createRange().pasteHTML(e):this.document.execCommand("inserthtml",!1,e),this.sync()},insertNode:function(e){if("SPAN"==(e=e[0]||e).tagName){var i=e.outerHTML,n=new RegExp("<"+e.tagName,"i"),o=i.replace(n,"<inline");n=new RegExp("</"+e.tagName,"i"),o=o.replace(n,"</inline"),e=t(o)[0]}var s=this.getSelection();if(s.getRangeAt&&s.rangeCount){var a=s.getRangeAt(0);a.deleteContents(),a.insertNode(e),a.setEndAfter(e),a.setStartAfter(e),s.removeAllRanges(),s.addRange(a)}},insertNodeToCaretPositionFromPoint:function(t,e){var i,n=t.clientX,o=t.clientY;if(this.document.caretPositionFromPoint){var s=this.document.caretPositionFromPoint(n,o);(i=this.getRange()).setStart(s.offsetNode,s.offset),i.collapse(!0),i.insertNode(e)}else if(this.document.caretRangeFromPoint)(i=this.document.caretRangeFromPoint(n,o)).insertNode(e);else if(void 0!==document.body.createTextRange){(i=this.document.body.createTextRange()).moveToPoint(n,o);var a=i.duplicate();a.moveToPoint(n,o),i.setEndPoint("EndToEnd",a),i.select()}},insertAfterLastElement:function(e,i){if(void 0!==i&&(e=i),this.isEndOfElement()){if(this.opts.linebreaks){var n=t("<div>").append(t.trim(this.$editor.html())).contents(),o=n.last()[0];if("SPAN"==o.tagName&&""==o.innerHTML&&(o=n.prev()[0]),this.outerHtml(o)!=this.outerHtml(e))return!1}else if(this.$editor.contents().last()[0]!==e)return!1;this.insertingAfterLastElement(e)}},insertingAfterLastElement:function(e){if(this.bufferSet(),!1===this.opts.linebreaks){var i=t(this.opts.emptyHtml);t(e).after(i),this.selectionStart(i)}else{i=t('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0];t(e).after(i),t(i).after(this.opts.invisibleSpace),this.selectionRestore(),this.$editor.find("span#selection-marker-1").removeAttr("id")}},insertLineBreak:function(e){this.selectionSave();var i="<br>";1==e&&(i="<br><br>");var n=this.getParent(),o=n&&"A"===n.tagName;if(this.browser("mozilla")&&!o){var s=t("<span>").html(this.opts.invisibleSpace);this.$editor.find("#selection-marker-1").before(i).before(s).before(this.opts.invisibleSpace),this.setCaretAfter(s[0]),s.remove(),this.selectionRemoveMarkers()}else{if(n&&"A"===n.tagName&&(this.linkObserverTooltipClose(!1),this.isCaretAtEndOfNode(n))){this.selectionRemoveMarkers();var a=t('<span id="selection-marker-1" class="redactor-selection-marker">'+this.opts.invisibleSpace+"</span>",this.document)[0];return t(n).after(a),t(a).before(i+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore(),!0}this.$editor.find("#selection-marker-1").before(i+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()}},isCaretAtEndOfNode:function(t){var e=!1,i=this.getRange();if(i&&t){var n=document.createRange();n.selectNodeContents(t),n.setStart(i.endContainer,i.endOffset);var o=n.cloneContents();e=0===(o=o.textContent.replace(/[\u200B-\u200D\uFEFF]/g,"")).length}return e},insertDoubleLineBreak:function(){this.insertLineBreak(!0)},replaceLineBreak:function(e){var i=t("<br><span>"+this.opts.invisibleSpace+"</span>");t(e).replaceWith(i),this.selectionStart(i[1])},pasteClean:function(e){(e=this.callback("pasteBefore",!1,e),this.browser("msie"))&&(0==(i=t.trim(e)).search(/^<a(.*?)>(.*?)<\/a>$/i)&&(e=e.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")));if(this.opts.pastePlainText){var i=this.document.createElement("div");return e=e.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n"),i.innerHTML=e,e=i.textContent||i.innerText,e=(e=t.trim(e)).replace("\n","<br>"),e=this.cleanParagraphy(e),this.pasteInsert(e),!1}var n=!1;if(this.currentOrParentIs("TD")){n=!0;var o=this.opts.blockLevelElements;o.push("tr"),o.push("table"),t.each(o,(function(t,i){e=(e=e.replace(new RegExp("<"+i+"(.*?)>","gi"),"")).replace(new RegExp("</"+i+">","gi"),"<br>")}))}if(this.currentOrParentIs("PRE"))return e=this.pastePre(e),this.pasteInsert(e),!0;if((i=this.document.createElement("div")).innerHTML=e,t(i).find("style").remove(),e=(e=(e=(e=(e=(e=(e=(e=i.innerHTML).replace(/<img(.*?)v:shapes=(.*?)>/gi,"")).replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>")).replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>")).replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>")).replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>")).replace(/·/g,"")).replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),!0===this.opts.cleanSpaces&&(e=(e=e.replace(/(&nbsp;){2,}/gi,"&nbsp;")).replace(/&nbsp;/gi," ")),e=(e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.cleanStripTags(e)).replace(/<td>\u200b*<\/td>/gi,"[td]")).replace(/<td>&nbsp;<\/td>/gi,"[td]")).replace(/<td><br><\/td>/gi,"[td]")).replace(/<td(.*?)colspan="(.*?)"(.*?)>([\w\W]*?)<\/td>/gi,'[td colspan="$2"]$4[/td]')).replace(/<td(.*?)rowspan="(.*?)"(.*?)>([\w\W]*?)<\/td>/gi,'[td rowspan="$2"]$4[/td]')).replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]')).replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]")).replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]")).replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]")).replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]")).replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]")).replace(/<param(.*?)>/gi,"[param$1]")).replace(/<img(.*?)>/gi,"[img$1]")).replace(/ class="(.*?)"/gi,"")).replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),this.opts.linebreaks?(e=(e=e.replace(/<strong><\/strong>/gi,"")).replace(/<u><\/u>/gi,""),this.opts.cleanFontTag&&(e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")),e=(e=(e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2")).replace(/<span><\/span><br>/gi,"<br>")).replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"<br>")):e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<div>\s*?\t*?\n*?(<ul>|<ol>|<p>)/gi,"$1")).replace(/\[td colspan="(.*?)"\]([\w\W]*?)\[\/td\]/gi,'<td colspan="$1">$2</td>')).replace(/\[td rowspan="(.*?)"\]([\w\W]*?)\[\/td\]/gi,'<td rowspan="$1">$2</td>')).replace(/\[td\]/gi,"<td>&nbsp;</td>")).replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>')).replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>")).replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>")).replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>")).replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>")).replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>")).replace(/\[param(.*?)\]/gi,"<param$1>")).replace(/\[img(.*?)\]/gi,"<img$1>"),e=this.opts.convertDivs?(e=(e=(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")).replace(/<\/div><p>/gi,"<p>")).replace(/<\/p><\/div>/gi,"</p>")).replace(/<p><\/p>/gi,"<br />"):e.replace(/<div><\/div>/gi,"<br />"),this.currentOrParentIs("LI")?e=e.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br>"):!1===n&&(e=this.cleanParagraphy(e)),e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2")).replace(/<img>/gi,"")).replace(/<[^\/>][^>][^img|param|source|td][^<]*>(\s*|\t*|\n*| |<br>)<\/[^>]+>/gi,"")).replace(/\n{3,}/gi,"\n")).replace(/<p><p>/gi,"<p>")).replace(/<\/p><\/p>/gi,"</p>")).replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>")).replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),!0===this.opts.linebreaks&&(e=e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),e=(e=(e=e.replace(/<[^\/>][^>][^img|param|source|td][^<]*>(\s*|\t*|\n*| |<br>)<\/[^>]+>/gi,"")).replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,"")).replace(/<td(.*?)>(\s*|\t*|\n*)<p>([\w\W]*?)<\/p>(\s*|\t*|\n*)<\/td>/gi,"<td$1>$3</td>"),this.opts.convertDivs&&(e=(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2")).replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2")),this.pasteClipboardMozilla=!1,this.browser("mozilla")||this.browser("msie")&&window.clipboardData){if(this.opts.clipboardUpload){var s=e.match(/<img src="data:image(.*?)"(.*?)>/gi);if(null!==s)for(k in this.pasteClipboardMozilla=s,s){var a=s[k].replace("<img",'<img data-mozilla-paste-image="'+k+'" ');e=e.replace(s[k],a)}}for(;/<br>$/gi.test(e);)e=e.replace(/<br>$/gi,"")}if(e=e.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.browser("msie"))for(;/<font>([\w\W]*?)<\/font>/gi.test(e);)e=e.replace(/<font>([\w\W]*?)<\/font>/gi,"$1");!1===n&&(e=(e=(e=(e=e.replace(/<td(.*?)>([\w\W]*?)<p(.*?)>([\w\W]*?)<\/td>/gi,"<td$1>$2$4</td>")).replace(/<td(.*?)>([\w\W]*?)<\/p>([\w\W]*?)<\/td>/gi,"<td$1>$2$3</td>")).replace(/<td(.*?)>([\w\W]*?)<p(.*?)>([\w\W]*?)<\/td>/gi,"<td$1>$2$4</td>")).replace(/<td(.*?)>([\w\W]*?)<\/p>([\w\W]*?)<\/td>/gi,"<td$1>$2$3</td>")),e=(e=e.replace(/\n/g," ")).replace(/<p>\n?<li>/gi,"<li>"),this.pasteInsert(e)},pastePre:function(t){t=t.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n");var e=this.document.createElement("div");return e.innerHTML=t,this.cleanEncodeEntities(e.textContent||e.innerText)},pasteInsert:function(e){e=this.callback("pasteAfter",!1,e),this.selectall?(this.$editor.html(e),this.selectionRemove(),this.focusEnd(),this.sync()):this.insertHtml(e),this.selectall=!1,setTimeout(t.proxy((function(){this.rtePaste=!1,this.browser("mozilla")&&this.$editor.find("p:empty").remove(),!1!==this.pasteClipboardMozilla&&this.pasteClipboardUploadMozilla()}),this),100),this.opts.autoresize&&!0!==this.fullscreen?t(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},pasteClipboardAppendFields:function(i){return!1!==this.opts.uploadFields&&"object"===e(this.opts.uploadFields)&&t.each(this.opts.uploadFields,t.proxy((function(e,n){null!=n&&0===n.toString().indexOf("#")&&(n=t(n).val()),i[e]=n}),this)),i},pasteClipboardUploadMozilla:function(){var e=this.$editor.find("img[data-mozilla-paste-image]");t.each(e,t.proxy((function(e,i){var n=t(i),o=i.src.split(","),s={contentType:o[0].split(";")[0].split(":")[1],data:o[1]};s=this.pasteClipboardAppendFields(s),t.post(this.opts.clipboardUploadUrl,s,t.proxy((function(e){var i="string"==typeof e?t.parseJSON(e):e;n.attr("src",i.filelink),n.removeAttr("data-mozilla-paste-image"),this.sync(),this.callback("imageUpload",n,i)}),this))}),this))},pasteClipboardUpload:function(e){var i=e.target.result,n=i.split(","),o={contentType:n[0].split(";")[0].split(":")[1],data:n[1]};this.opts.clipboardUpload?(o=this.pasteClipboardAppendFields(o),t.ajax({type:"POST",url:this.opts.clipboardUploadUrl,data:o,success:t.proxy((function(e){var i="string"==typeof e?t.parseJSON(e):e,n='<img src="'+i.filelink+'" id="clipboard-image-marker" />';this.execCommand("inserthtml",n,!1);var o=t(this.$editor.find("img#clipboard-image-marker"));o.length?o.removeAttr("id"):o=!1,this.sync(),t("#redactor-progress").hide(),o&&this.callback("imageUpload",o,i)}),this),beforeSend:this.opts.beforeSend})):this.insertHtml('<img src="'+i+'" />')},bufferSet:function(t,e){void 0!==t||!1===t?this.opts.buffer.push(t):(!1!==e&&this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRemoveMarkers("buffer"))},bufferUndo:function(){0!==this.opts.buffer.length?(this.selectionSave(),this.opts.rebuffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.buffer.pop()),this.selectionRestore(),setTimeout(t.proxy(this.observeStart,this),100)):this.focusWithSaveScroll()},bufferRedo:function(){if(0===this.opts.rebuffer.length)return this.focusWithSaveScroll(),!1;this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.rebuffer.pop()),this.selectionRestore(!0),setTimeout(t.proxy(this.observeStart,this),4)},observeStart:function(){this.observeImages(),this.opts.observeLinks&&this.observeLinks()},observeLinks:function(){this.$editor.find("a").on("click",t.proxy(this.linkObserver,this)),this.$editor.on("click.redactor",t.proxy((function(t){this.linkObserverTooltipClose(t)}),this)),t(document).on("click.redactor",t.proxy((function(t){this.linkObserverTooltipClose(t)}),this))},observeImages:function(){if(!1===this.opts.observeImages)return!1;this.$editor.find("img").each(t.proxy((function(e,i){this.browser("msie")&&t(i).attr("unselectable","on"),this.imageResize(i)}),this))},linkObserver:function(e){var i=t(e.target);if(0!=i.size()&&"A"===i[0].tagName){var n=i.offset();if(this.opts.iframe){var o=this.$frame.offset();n.top=o.top+(n.top-t(this.document).scrollTop()),n.left+=o.left}var s=t('<span class="redactor-link-tooltip"></span>'),a=i.attr("href");void 0===a&&(a=""),a.length>24&&(a=a.substring(0,24)+"...");var r=t('<a href="'+i.attr("href")+'" target="_blank">'+a+"</a>").on("click",t.proxy((function(t){this.linkObserverTooltipClose(!1)}),this)),l=t('<a href="#">'+this.opts.curLang.edit+"</a>").on("click",t.proxy((function(t){t.preventDefault(),this.linkShow(),this.linkObserverTooltipClose(!1)}),this)),d=t('<a href="#">'+this.opts.curLang.unlink+"</a>").on("click",t.proxy((function(t){t.preventDefault(),this.execCommand("unlink"),this.linkObserverTooltipClose(!1)}),this));s.append(r),s.append(" | "),s.append(l),s.append(" | "),s.append(d),s.css({top:n.top+20+"px",left:n.left+"px"}),t(".redactor-link-tooltip").remove(),t("body").append(s)}},linkObserverTooltipClose:function(e){if(!1!==e&&"A"==e.target.tagName)return!1;t(".redactor-link-tooltip").remove()},getSelection:function(){return this.opts.rangy?this.opts.iframe?rangy.getSelection(this.$frame[0]):rangy.getSelection():this.document.getSelection()},getRange:function(){if(this.opts.rangy)return this.opts.iframe?rangy.createRange(this.iframeDoc()):rangy.createRange();if(this.document.getSelection){var t=this.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}return this.document.createRange()},selectionElement:function(t){this.setCaret(t)},selectionStart:function(t){this.selectionSet(t[0]||t,0,null,0)},selectionEnd:function(t){this.selectionSet(t[0]||t,1,null,1)},selectionSet:function(e,i,n,o){null==n&&(n=e),null==o&&(o=i);var s=this.getSelection();if(s){if("P"==e.tagName&&""==e.innerHTML&&(e.innerHTML=this.opts.invisibleSpace),"BR"==e.tagName&&!1===this.opts.linebreaks){var a=t(this.opts.emptyHtml)[0];t(e).replaceWith(a),n=e=a}var r=this.getRange();r.setStart(e,i),r.setEnd(n,o);try{s.removeAllRanges()}catch(l){}s.addRange(r)}},selectionWrap:function(t){t=t.toLowerCase();var e=this.getBlock();if(e){var i=this.formatChangeTag(e,t);return this.sync(),i}var n=this.getSelection().getRangeAt(0);return(i=document.createElement(t)).appendChild(n.extractContents()),n.insertNode(i),this.selectionElement(i),i},selectionAll:function(){var t=this.getRange();t.selectNodeContents(this.$editor[0]);var e=this.getSelection();e.removeAllRanges(),e.addRange(t)},selectionRemove:function(){this.getSelection().removeAllRanges()},getCaretOffset:function(e){var i=this.getRange(),n=i.cloneRange();return n.selectNodeContents(e),n.setEnd(i.endContainer,i.endOffset),t.trim(n.toString()).length},getCaretOffsetRange:function(){return new o(this.getSelection().getRangeAt(0))},setCaret:function(t,e,i){void 0===i&&(i=e),t=t[0]||t;var n=this.getRange();n.selectNodeContents(t);var o,s=this.getTextNodesIn(t),a=!1,r=0;if(1==s.length&&e)n.setStart(s[0],e),n.setEnd(s[0],i);else for(var l,d=0;l=s[d++];){if(o=r+l.length,!a&&e>=r&&(e<o||e==o&&d<s.length)&&(n.setStart(l,e-r),a=!0),a&&i<=o){n.setEnd(l,i-r);break}r=o}var c=this.getSelection();c.removeAllRanges(),c.addRange(n)},setCaretAfter:function(e){this.$editor.focus(),e=e[0]||e;var i=this.document.createRange();i.setStart(e,1),i.setEnd(e,1);var n=this.window.getSelection(),o=this.document.createRange(),s=this.document.createTextNode("​");t(e).after(s),o.setStartAfter(s),n.removeAllRanges(),n.addRange(o),t(s).remove()},getTextNodesIn:function(t){var e=[];if(3==t.nodeType)e.push(t);else for(var i=t.childNodes,n=0,o=i.length;n<o;++n)e.push.apply(e,this.getTextNodesIn(i[n]));return e},getCurrent:function(){var t=!1,e=this.getSelection();return e&&e.rangeCount>0&&(t=e.getRangeAt(0).startContainer),this.isParentRedactor(t)},getParent:function(e){return!!(e=e||this.getCurrent())&&this.isParentRedactor(t(e).parent()[0])},getBlock:function(e){for(void 0===e&&(e=this.getCurrent());e;){if(this.nodeTestBlocks(e))return!t(e).hasClass("redactor_editor")&&e;e=e.parentNode}return!1},getBlocks:function(e){var i=[];if(void 0===e){var n=this.getRange();if(n&&!0===n.collapsed)return[this.getBlock()];e=this.getNodes(n)}return t.each(e,t.proxy((function(e,n){if(!1===this.opts.iframe&&0==t(n).parents("div.redactor_editor").size())return!1;this.nodeTestBlocks(n)&&i.push(n)}),this)),0===i.length&&(i=[this.getBlock()]),i},nodeTestBlocks:function(t){return 1==t.nodeType&&this.rTestBlock.test(t.nodeName)},tagTestBlock:function(t){return this.rTestBlock.test(t)},getNodes:function(e,i){if(void 0===e||0==e)e=this.getRange();if(e&&!0===e.collapsed)return void 0===i&&this.tagTestBlock(i)?(a=this.getBlock()).tagName==i?[a]:[]:[this.getCurrent()];var n=[],o=[],s=this.document.getSelection();if(s.isCollapsed||(n=this.getRangeSelectedNodes(s.getRangeAt(0))),t.each(n,t.proxy((function(e,n){if(!1===this.opts.iframe&&0==t(n).parents("div.redactor_editor").size())return!1;void 0===i?""!=t.trim(n.textContent)&&o.push(n):n.tagName==i&&o.push(n)}),this)),0==o.length){var a;if(void 0===i&&this.tagTestBlock(i))return(a=this.getBlock()).tagName==i?o.push(a):[];o.push(this.getCurrent())}var r=o[o.length-1];return this.nodeTestBlocks(r)&&(o=o.slice(0,-1)),o},getElement:function(e){for(e||(e=this.getCurrent());e;){if(1==e.nodeType)return!t(e).hasClass("redactor_editor")&&e;e=e.parentNode}return!1},getRangeSelectedNodes:function(t){var e=(t=t||this.getRange()).startContainer,i=t.endContainer;if(e==i)return[e];for(var n=[];e&&e!=i;)n.push(e=this.nextNode(e));for(e=t.startContainer;e&&e!=t.commonAncestorContainer;)n.unshift(e),e=e.parentNode;return n},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},getSelectionText:function(){return this.getSelection().toString()},getSelectionHtml:function(){var t="",e=this.getSelection();if(e.rangeCount){for(var i=this.document.createElement("div"),n=e.rangeCount,o=0;o<n;++o)i.appendChild(e.getRangeAt(o).cloneContents());t=i.innerHTML}return this.syncClean(t)},selectionSave:function(){this.isFocused()||this.focusWithSaveScroll(),this.opts.rangy?this.savedSel=rangy.saveSelection():this.selectionCreateMarker(this.getRange())},selectionCreateMarker:function(e,i){if(e){var n=t('<span id="selection-marker-1" class="redactor-selection-marker">'+this.opts.invisibleSpace+"</span>",this.document)[0],o=t('<span id="selection-marker-2" class="redactor-selection-marker">'+this.opts.invisibleSpace+"</span>",this.document)[0];!0===e.collapsed?this.selectionSetMarker(e,n,!0):(this.selectionSetMarker(e,n,!0),this.selectionSetMarker(e,o,!1)),this.savedSel=this.$editor.html(),this.selectionRestore(!1,!1)}},selectionSetMarker:function(t,e,i){var n=t.cloneRange();n.collapse(i),n.insertNode(e),n.detach()},selectionRestore:function(t,e){if(this.opts.rangy)rangy.restoreSelection(this.savedSel);else{!0===t&&this.savedSel&&this.$editor.html(this.savedSel);var i=this.$editor.find("span#selection-marker-1"),n=this.$editor.find("span#selection-marker-2");this.browser("mozilla")?this.$editor.focus():this.isFocused()||this.focusWithSaveScroll(),0!=i.length&&0!=n.length?this.selectionSet(i[0],0,n[0],0):0!=i.length&&this.selectionSet(i[0],0,null,0),!1!==e&&(this.selectionRemoveMarkers(),this.savedSel=!1)}},selectionRemoveMarkers:function(e){this.opts.rangy?rangy.removeMarkers(this.savedSel):t.each(this.$editor.find("span.redactor-selection-marker"),(function(){""==t.trim(t(this).html().replace(/[^\u0000-\u1C7F]/g,""))?t(this).remove():t(this).removeAttr("class").removeAttr("id")}))},tableShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.table,this.opts.modal_table,300,t.proxy((function(){t("#redactor_insert_table_btn").click(t.proxy(this.tableInsert,this)),setTimeout((function(){t("#redactor_table_rows").focus()}),200)}),this))},tableInsert:function(){this.bufferSet(!1,!1);var e,i,n,o,s=t("#redactor_table_rows").val(),a=t("#redactor_table_columns").val(),r=t("<div></div>"),l=Math.floor(99999*Math.random()),d=t('<table id="table'+l+'"><tbody></tbody></table>');for(e=0;e<s;e++){for(i=t("<tr></tr>"),n=0;n<a;n++)o=t("<td>"+this.opts.invisibleSpace+"</td>"),0===e&&0===n&&o.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),t(i).append(o);d.append(i)}r.append(d);var c=r.html();if(this.modalClose(),this.selectionRestore(),(u=this.getBlock()||this.getCurrent())&&"BODY"!=u.tagName){if("LI"==u.tagName)var u=t(u).closest("ul, ol");t(u).after(c)}else this.insertHtmlAdvanced(c,!1);this.selectionRestore();var h=this.$editor.find("#table"+l);this.buttonActiveObserver(),h.find("span#selection-marker-1, inline#selection-marker-1").remove(),h.removeAttr("id"),this.sync()},tableDeleteTable:function(){var e=t(this.getParent()).closest("table");return!!this.isParentRedactor(e)&&(0!=e.size()&&(this.bufferSet(),e.remove(),void this.sync()))},tableDeleteRow:function(){var e=this.getParent(),i=t(e).closest("table");if(!this.isParentRedactor(i))return!1;if(0==i.size())return!1;this.bufferSet();var n=t(e).closest("tr"),o=n.prev().length?n.prev():n.next();if(o.length){var s=o.children("td").first();s.length&&s.prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>")}n.remove(),this.selectionRestore(),this.sync()},tableDeleteColumn:function(){var e=this.getParent(),i=t(e).closest("table");if(!this.isParentRedactor(i))return!1;if(0==i.size())return!1;this.bufferSet();var n=t(e).closest("td");n.is("td")||(n=n.closest("td"));var o=n.get(0).cellIndex;i.find("tr").each(t.proxy((function(e,i){var n=o-1<0?o+1:o-1;0===e&&t(i).find("td").eq(n).prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),t(i).find("td").eq(o).remove()}),this)),this.selectionRestore(),this.sync()},tableAddHead:function(){var e=t(this.getParent()).closest("table");if(!this.isParentRedactor(e))return!1;if(0==e.size())return!1;if(this.bufferSet(),0!==e.find("thead").size())this.tableDeleteHead();else{var i=e.find("tr").first().clone();i.find("td").html(this.opts.invisibleSpace);var n=t("<thead></thead>");n.append(i),e.prepend(n),this.sync()}},tableDeleteHead:function(){var e=t(this.getParent()).closest("table");if(!this.isParentRedactor(e))return!1;var i=e.find("thead");if(0==i.size())return!1;this.bufferSet(),i.remove(),this.sync()},tableAddRowAbove:function(){this.tableAddRow("before")},tableAddRowBelow:function(){this.tableAddRow("after")},tableAddColumnLeft:function(){this.tableAddColumn("before")},tableAddColumnRight:function(){this.tableAddColumn("after")},tableAddRow:function(e){var i=t(this.getParent()).closest("table");if(!this.isParentRedactor(i))return!1;if(0==i.size())return!1;this.bufferSet();var n=t(this.getParent()).closest("tr"),o=n.clone();o.find("td").html(this.opts.invisibleSpace),"after"===e?n.after(o):n.before(o),this.sync()},tableAddColumn:function(e){var i=this.getParent(),n=t(i).closest("table");if(!this.isParentRedactor(n))return!1;if(0==n.size())return!1;this.bufferSet();var o=0,s=this.getCurrent(),a=t(s).closest("tr"),r=t(s).closest("td");a.find("td").each(t.proxy((function(e,i){t(i)[0]===r[0]&&(o=e)}),this)),n.find("tr").each(t.proxy((function(i,n){var s=t(n).find("td").eq(o),a=s.clone();a.html(this.opts.invisibleSpace),"after"===e?s.after(a):s.before(a)}),this)),this.sync()},videoShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.video,this.opts.modal_video,600,t.proxy((function(){t("#redactor_insert_video_btn").click(t.proxy(this.videoInsert,this)),setTimeout((function(){t("#redactor_insert_video_area").focus()}),200)}),this))},videoInsert:function(){var e=t("#redactor_insert_video_area").val();e=this.cleanStripTags(e),this.$editor.focus(),this.selectionRestore();var i=this.getBlock()||this.getCurrent();i?t(i).after(e):this.insertHtmlAdvanced(e,!1),this.sync(),this.modalClose()},linkShow:function(){this.selectionSave();var e=t.proxy((function(){this.insert_link_node=!1;var e=this.getSelection(),i="",n="",o="",s=this.getParent(),a=t(s).parent().get(0);a&&"A"===a.tagName&&(s=a),s&&"A"===s.tagName?(i=s.href,n=t(s).text(),o=s.target,this.insert_link_node=s):n=e.toString(),t("#redactor_link_url_text").val(n);var r=self.location.href.replace(/\/$/i,"");if(i=(i=(i=i.replace(r,"")).replace(/^\/#/,"#")).replace("mailto:",""),!1===this.opts.linkProtocol){var l=new RegExp("^(http|ftp|https)://"+self.location.host,"i");i=i.replace(l,"")}t("#redactor_link_url").val(i),"_blank"===o&&t("#redactor_link_blank").prop("checked",!0),this.linkInsertPressed=!1,t("#redactor_insert_link_btn").click(t.proxy(this.linkProcess,this)),setTimeout((function(){t("#redactor_link_url").focus()}),200)}),this);this.modalInit(this.opts.curLang.link,this.opts.modal_link,460,e)},linkProcess:function(){if(!this.linkInsertPressed){this.linkInsertPressed=!0;var e="",i="",n=t("#redactor_link_url").val(),o=t("#redactor_link_url_text").val(),s=n.search("@")>=0,a=-1===n.search(/\?/),r=-1===n.search("#"),l=-1===n.search("http");if(s&&a&&r&&l)n="mailto:"+n;else if(-1!==n.search(/^skype\:/i))-1==n.search(/\?call$/i)&&(n+="?call");else if(-1!==n.search(/^tel\:/i));else if(-1==n.search("http")&&-1!=n.search("://"));else if(0!=n.search("#")){t("#redactor_link_blank").prop("checked")&&(e=' target="_blank"',i="_blank");var d="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",c=new RegExp("^(http|ftp|https)://"+d,"i"),u=new RegExp("^"+d,"i");-1==n.search(c)&&0==n.search(u)&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+n)}o=o.replace(/<|>/g,"");var h="&nbsp;";this.browser("mozilla")&&(h="&nbsp;"),this.linkInsert('<a href="'+n+'"'+e+">"+o+"</a>"+h,t.trim(o),n,i)}},linkInsert:function(e,i,n,o){if(this.selectionRestore(),""!==i){if(this.insert_link_node)this.bufferSet(),t(this.insert_link_node).text(i).attr("href",n),""!==o?t(this.insert_link_node).attr("target",o):t(this.insert_link_node).removeAttr("target");else{var s=t(e).addClass("redactor-added-link");this.exec("inserthtml",this.outerHtml(s),!1),(n=this.$editor.find("a.redactor-added-link")).removeAttr("style").removeClass("redactor-added-link").each((function(){""==this.className&&t(this).removeAttr("class")}))}this.sync()}setTimeout(t.proxy((function(){this.opts.observeLinks&&this.observeLinks()}),this),5),this.modalClose()},fileShow:function(){this.selectionSave();var e=t.proxy((function(){var e=this.getSelection(),i="";i=this.oldIE()?e.text:e.toString(),t("#redactor_filename").val(i),this.isMobile()||this.isIPad()||this.draguploadInit("#redactor_file",{url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.fileCallback,this),error:t.proxy((function(t,e){this.callback("fileUploadError",e)}),this),uploadParam:this.opts.fileUploadParam}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:t.proxy(this.fileCallback,this),error:t.proxy((function(t,e){this.callback("fileUploadError",e)}),this)})}),this);this.modalInit(this.opts.curLang.file,this.opts.modal_file,500,e)},fixInsertIntoEmptyEditorBug:function(){if(!this.get()){this.$editor.html(this.opts.emptyHtml);var t=this.$editor.children();t.length&&this.selectionElement(t[0])}},fileCallback:function(e){if(this.selectionRestore(),!1!==e){var i=t("#redactor_filename").val();""===i&&(i=e.filename);var n='<a href="'+e.filelink+'" id="filelink-marker">'+i+"</a>";this.browser("webkit")&&this.window.chrome&&(n+="&nbsp;"),this.fixInsertIntoEmptyEditorBug(),this.execCommand("inserthtml",n,!1);var o=t(this.$editor.find("a#filelink-marker"));0!=o.size()?o.removeAttr("id"):o=!1,this.sync(),this.callback("fileUpload",o,e)}this.modalClose()},imageShow:function(){this.selectionSave();var e=t.proxy((function(){this.opts.imageGetJson?t.getJSON(this.opts.imageGetJson,t.proxy((function(e){var i={},n=0;t.each(e,t.proxy((function(t,e){void 0!==e.folder&&(n++,i[e.folder]=n)}),this));var o=!1;if(t.each(e,t.proxy((function(e,n){var s="";void 0!==n.title&&(s=n.title);var a=0;t.isEmptyObject(i)||void 0===n.folder||(a=i[n.folder],!1===o&&(o=".redactorfolder"+a));var r=t('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+a+'" rel="'+n.image+'" title="'+s+'" />');t("#redactor_image_box").append(r),t(r).click(t.proxy(this.imageThumbClick,this))}),this)),!t.isEmptyObject(i)){t(".redactorfolder").hide(),t(o).show();var s=t('<select id="redactor_image_box_select">');t.each(i,(function(e,i){s.append(t('<option value="'+i+'">'+e+"</option>"))})),t("#redactor_image_box").before(s),s.change((function(e){t(".redactorfolder").hide(),t(".redactorfolder"+t(e.target).val()).show()}))}}),this)):t("#redactor-modal-tab-2").remove(),this.opts.imageUpload||this.opts.s3?(this.isMobile()||this.isIPad()||!1!==this.opts.s3||t("#redactor_file").length&&this.draguploadInit("#redactor_file",{url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.imageCallback,this),error:t.proxy((function(t,e){this.callback("imageUploadError",e)}),this),uploadParam:this.opts.imageUploadParam}),!1===this.opts.s3?this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:t.proxy(this.imageCallback,this),error:t.proxy((function(t,e){this.callback("imageUploadError",e)}),this)}):t("#redactor_file").on("change.redactor",t.proxy(this.s3handleFileSelect,this))):(t(".redactor_tab").hide(),this.opts.imageGetJson?(t("#redactor-modal-tab-1").remove(),t("#redactor-modal-tab-2").addClass("redactor_tabs_act"),t("#redactor_tab2").show()):(t("#redactor_tabs").remove(),t("#redactor_tab3").show())),this.opts.imageTabLink||!this.opts.imageUpload&&!this.opts.imageGetJson||t("#redactor-tab-control-3").hide(),t("#redactor_upload_btn").click(t.proxy(this.imageCallbackLink,this)),this.opts.imageUpload||this.opts.imageGetJson||setTimeout((function(){t("#redactor_file_link").focus()}),200)}),this);this.modalInit(this.opts.curLang.image,this.opts.modal_image,610,e)},imageEdit:function(e){var i=e,n=i.parent().parent(),o=t.proxy((function(){t("#redactor_file_alt").val(i.attr("alt")),t("#redactor_image_edit_src").attr("href",i.attr("src")),"block"==i.css("display")&&"none"==i.css("float")?t("#redactor_form_image_align").val("center"):t("#redactor_form_image_align").val(i.css("float")),"A"===t(n).get(0).tagName&&(t("#redactor_file_link").val(t(n).attr("href")),"_blank"==t(n).attr("target")&&t("#redactor_link_blank").prop("checked",!0)),t("#redactor_image_delete_btn").click(t.proxy((function(){this.imageRemove(i)}),this)),t("#redactorSaveBtn").click(t.proxy((function(){this.imageSave(i)}),this))}),this);this.modalInit(this.opts.curLang.edit,this.opts.modal_image_edit,380,o)},imageRemove:function(e){var i=t(e).parent().parent(),n=t(e).parent(),o=!1;i.length&&"A"===i[0].tagName?(o=!0,t(i).remove()):n.length&&"A"===n[0].tagName?(o=!0,t(n).remove()):t(e).remove(),n.length&&"P"===n[0].tagName&&(this.focusWithSaveScroll(),!1===o&&this.selectionStart(n)),this.callback("imageDelete",e),this.modalClose(),this.sync()},imageSave:function(e){var i=t(e),n=i.parent();i.attr("alt",t("#redactor_file_alt").val());var o=t("#redactor_form_image_align").val(),s="";this.imageResizeHide(!1),"left"===o?(s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0",i.css({float:"left",margin:s})):"right"===o?(s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin,i.css({float:"right",margin:s})):"center"===o?i.css({float:"",display:"block",margin:"auto"}):i.css({float:"",display:"",margin:""});var a=t.trim(t("#redactor_file_link").val());if(""!==a){var r=!1;if(t("#redactor_link_blank").prop("checked")&&(r=!0),"A"!==n.get(0).tagName){var l=t('<a href="'+a+'">'+this.outerHtml(e)+"</a>");r&&l.attr("target","_blank"),i.replaceWith(l)}else n.attr("href",a),r?n.attr("target","_blank"):n.removeAttr("target")}else"A"===n.get(0).tagName&&n.replaceWith(this.outerHtml(e));this.modalClose(),this.observeImages(),this.sync()},imageResizeHide:function(e){if(!1!==e&&0!=t(e.target).parent().size()&&"redactor-image-box"===t(e.target).parent()[0].id)return!1;var i=this.$editor.find("#redactor-image-box");if(0==i.size())return!1;this.$editor.find("#redactor-image-editter, #redactor-image-resizer").remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith((function(){return t(this).contents()})),t(document).off("click.redactor-image-resize-hide"),this.$editor.off("click.redactor-image-resize-hide"),this.$editor.off("keydown.redactor-image-delete"),this.sync()},imageResize:function(e){var i=t(e);i.on("mousedown",t.proxy((function(){this.imageResizeHide(!1)}),this)),i.on("dragstart",t.proxy((function(){this.$editor.on("drop.redactor-image-inside-drop",t.proxy((function(){setTimeout(t.proxy((function(){this.observeImages(),this.$editor.off("drop.redactor-image-inside-drop"),this.sync()}),this),1)}),this))}),this)),i.on("click",t.proxy((function(e){if(0!=this.$editor.find("#redactor-image-box").size())return!1;var n,o=i.width()/i.height(),s=this.imageResizeControls(i),a=!1;s.on("mousedown",(function(t){a=!0,t.preventDefault(),o=i.width()/i.height(),Math.round(t.pageX-i.eq(0).offset().left),n=Math.round(t.pageY-i.eq(0).offset().top)})),t(this.document.body).on("mousemove",t.proxy((function(t){if(a){Math.round(t.pageX-i.eq(0).offset().left);var e=Math.round(t.pageY-i.eq(0).offset().top)-n,s=i.height(),r=parseInt(s,10)+e,l=Math.round(r*o);l>20&&(i.width(l),l<100?this.imageEditter.css({marginTop:"-7px",marginLeft:"-13px",fontSize:"9px",padding:"3px 5px"}):this.imageEditter.css({marginTop:"-11px",marginLeft:"-18px",fontSize:"11px",padding:"7px 10px"})),Math.round(t.pageX-i.eq(0).offset().left),n=Math.round(t.pageY-i.eq(0).offset().top),this.sync()}}),this)).on("mouseup",(function(){a=!1})),this.$editor.on("keydown.redactor-image-delete",t.proxy((function(t){var e=t.which;this.keyCode.BACKSPACE!=e&&this.keyCode.DELETE!=e||(this.bufferSet(!1,!1),this.imageResizeHide(!1),this.imageRemove(i))}),this)),t(document).on("click.redactor-image-resize-hide",t.proxy(this.imageResizeHide,this)),this.$editor.on("click.redactor-image-resize-hide",t.proxy(this.imageResizeHide,this))}),this))},imageResizeControls:function(e){var i=t('<span id="redactor-image-box" data-redactor="verified">');i.css({position:"relative",display:"inline-block",lineHeight:0,outline:"1px dashed rgba(0, 0, 0, .6)",float:e.css("float")}),i.attr("contenteditable",!1),"auto"!=e[0].style.margin?(i.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):i.css({display:"block",margin:"auto"}),e.css("opacity",.5).after(i),this.imageEditter=t('<span id="redactor-image-editter" data-redactor="verified">'+this.opts.curLang.edit+"</span>"),this.imageEditter.css({position:"absolute",zIndex:5,left:"50%",marginTop:"-11px",marginLeft:"-18px",lineHeight:1,backgroundColor:"#000",color:"#fff",fontSize:"11px",padding:"7px 10px",cursor:"pointer"}),this.imageEditter.attr("contenteditable",!1),this.imageEditter.on("click",t.proxy((function(){this.imageEdit(e)}),this)),i.append(this.imageEditter);var n=t('<span id="redactor-image-resizer" data-redactor="verified"></span>');return n.css({position:"absolute",zIndex:2,lineHeight:1,cursor:"nw-resize",bottom:"-4px",right:"-5px",border:"1px solid #fff",backgroundColor:"#000",width:"8px",height:"8px"}),n.attr("contenteditable",!1),i.append(n),i.append(e),n},imageThumbClick:function(e){var i='<img id="image-marker" src="'+t(e.target).attr("rel")+'" alt="'+t(e.target).attr("title")+'" />',n=this.getParent();this.opts.paragraphy&&0==t(n).closest("li").size()&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)},imageCallbackLink:function(){var e=t("#redactor_file_link").val();if(""!==e){var i='<img id="image-marker" src="'+e+'" />';!1===this.opts.linebreaks&&(i="<p>"+i+"</p>");var n=this.imageInsert(i,!0);this.callback("imageLinkInsert",n)}else this.modalClose()},imageCallback:function(t){this.imageInsert(t)},imageInsert:function(e,i){if(this.selectionRestore(),!1!==e){var n="";if(!0!==i){n='<img id="image-marker" src="'+e.filelink+'" />';var o=this.getParent();this.opts.paragraphy&&0==t(o).closest("li").size()&&(n="<p>"+n+"</p>")}else n=e;this.fixInsertIntoEmptyEditorBug(),this.execCommand("inserthtml",n,!1);var s=t(this.$editor.find("img#image-marker"));s.length?s.removeAttr("id"):s=!1,this.sync(),!0!==i&&this.callback("imageUpload",s,e)}return this.modalClose(),this.observeImages(),s},modalTemplatesInit:function(){t.extend(this.opts,{modal_file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-progress" class="redactor-progress-inline" style="display: none;"><span></span></div><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>'+this.opts.curLang.filename+'</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="'+this.opts.fileUploadParam+'" /></div></form></section>',modal_image_edit:String()+'<section id="redactor-modal-image-edit"><label>'+this.opts.curLang.title+'</label><input type="text" id="redactor_file_alt" class="redactor_input" /><label>'+this.opts.curLang.link+'</label><input type="text" id="redactor_file_link" class="redactor_input" /><label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+"</label><label>"+this.opts.curLang.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+this.opts.curLang.none+'</option><option value="left">'+this.opts.curLang.left+'</option><option value="center">'+this.opts.curLang.center+'</option><option value="right">'+this.opts.curLang.right+'</option></select></section><footer><button id="redactorSaveBtn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.save+'</button><button id="redactor_image_delete_btn" class="redactor_modal_btn redactor_modal_delete_btn">'+this.opts.curLang._delete+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button></footer>",modal_image:String()+'<section id="redactor-modal-image-insert"><div id="redactor_tabs"><a href="#" id="redactor-tab-control-1" class="redactor_tabs_act">'+this.opts.curLang.upload+'</a><a href="#" id="redactor-tab-control-2">'+this.opts.curLang.choose+'</a><a href="#" id="redactor-tab-control-3">'+this.opts.curLang.link+'</a></div><div id="redactor-progress" class="redactor-progress-inline" style="display: none;"><span></span></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="'+this.opts.imageUploadParam+'" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+this.opts.curLang.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /><br><br></div></section><footer><button class="redactor_modal_btn redactor_modal_action_btn" id="redactor_upload_btn">'+this.opts.curLang.insert+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button></footer>",modal_link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="text" class="redactor_input" id="redactor_link_url" /><label>'+this.opts.curLang.text+'</label><input type="text" class="redactor_input" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+'</label></section><footer><button id="redactor_insert_link_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button></footer>",modal_table:String()+'<section id="redactor-modal-table-insert"><label>'+this.opts.curLang.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+this.opts.curLang.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></section><footer><button id="redactor_insert_table_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button></footer>",modal_video:String()+'<section id="redactor-modal-video-insert"><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></section><footer><button id="redactor_insert_video_btn" class="redactor_modal_btn redactor_modal_action_btn">'+this.opts.curLang.insert+'</button><button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button></footer>"})},modalOverlayInit:function(){this.$overlay=t("#redactor_modal_overlay"),this.$overlay.length||(this.$overlay=t('<div id="redactor_modal_overlay" class="hide""></div>'),t("body").prepend(this.$overlay))},modalInit:function(e,i,n,o){this.opts.modalOverlay&&this.$overlay.removeClass("hide").on("click",t.proxy(this.modalClose,this));var s=t("#redactor_modal");s.length||(this.$modal=s=t('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close"><i class="icon-circle-close"></i></div><header id="redactor_modal_header"><h5></h5></header><div id="redactor_modal_inner"></div></div>'),t("#redactor_modal_overlay").append(this.$modal),s.on("click",(function(t){t.stopPropagation()}))),this.$overlay.addClass("fade in").off(t.support.transition.end).one(t.support.transition.end,t.proxy((function(e){var i=s.outerHeight();s.css({height:"auto",minHeight:"auto",marginTop:"-"+(i+10)/2+"px"}),s.addClass("fade in"),t("#redactor_modal_close").on("click",t.proxy(this.modalClose,this)),this.hdlModalClose=t.proxy((function(t){if(t.keyCode===this.keyCode.ESC)return this.modalClose(),!1}),this),t(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),this.callback("modalOpened")}),this)),this.modalcontent=!1,0==i.indexOf("#")?(this.modalcontent=t(i),t("#redactor_modal_inner").empty().append(this.modalcontent.html()),this.modalcontent.html("")):t("#redactor_modal_inner").empty().append(i),s.find("#redactor_modal_header h5").html(e),void 0!==t.fn.draggable&&(s.draggable({handle:"#redactor_modal_header"}),s.find("#redactor_modal_header").css("cursor","move"));var a=t("#redactor_tabs");if(a.length){a.find("a").each((function(e,i){e++,t(i).on("click",(function(i){i.preventDefault(),a.find("a").removeClass("redactor_tabs_act"),t(this).addClass("redactor_tabs_act"),t(".redactor_tab").hide(),t("#redactor_tab"+e).show().find("input").focus(),t("#redactor_tab_selected").val(e)}))}))}s.find(".redactor_btn_modal_close").on("click",t.proxy(this.modalClose,this));var r=s.find("footer button"),l=r.size();l>0&&t(r).css("width",n/l+"px"),!0===this.opts.autoresize?this.saveModalScroll=this.document.documentElement.scrollTop||this.document.body.scrollTop:this.saveModalScroll=this.$editor.scrollTop(),!1===this.isMobile()?s.css({position:"fixed",left:"50%",width:n+"px",marginLeft:"-"+n/2+"px"}).show():s.css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof o&&o(),t(document).off("focusin.modal"),s.find("input[type=text]").keypress((function(t){13===t.which&&(s.find(".redactor_modal_action_btn").click(),t.preventDefault())}))},modalClose:function(){var e=t("#redactor_modal");if(e.length)return t("#redactor_modal_close").off("click",this.modalClose),this.$overlay.off("click",this.modalClose),t(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose),e.removeClass("in").off(t.support.transition.end).one(t.support.transition.end,t.proxy((function(i){i.stopImmediatePropagation(),this.$overlay.removeClass("in").one(t.support.transition.end,t.proxy((function(){this.$overlay.removeClass("fade").addClass("hide"),this.callback("modalClosed")}),this)),e.hide();var n=t("#redactor_modal_inner");!1!==this.modalcontent&&(this.modalcontent.html(n.html()),this.modalcontent=!1),n.html(""),this.selectionRestore(),this.opts.autoresize&&this.saveModalScroll?t(this.document).scrollTop(this.saveModalScroll):!1===this.opts.autoresize&&this.saveModalScroll&&this.$editor.scrollTop(this.saveModalScroll)}),this)),!1},modalSetTab:function(e){t(".redactor_tab").hide(),t("#redactor_tabs").find("a").removeClass("redactor_tabs_act").eq(e-1).addClass("redactor_tabs_act"),t("#redactor_tab"+e).show()},s3handleFileSelect:function(t){for(var e,i=t.target.files,n=0;e=i[n];n++)this.s3uploadFile(e)},s3uploadFile:function(e){this.s3executeOnSignedUrl(e,t.proxy((function(t){this.s3uploadToS3(e,t)}),this))},s3executeOnSignedUrl:function(e,i){var n=new XMLHttpRequest,o="?";"-1"!=this.opts.s3.search(/\?/)&&(o="&"),n.open("GET",this.opts.s3+o+"name="+e.name+"&type="+e.type,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(e){4==this.readyState&&200==this.status?(t("#redactor-progress").fadeIn(),i(decodeURIComponent(this.responseText))):4==this.readyState&&this.status},n.send()},s3createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=null,i},s3uploadToS3:function(e,i){var n=this.s3createCORSRequest("PUT",i);n&&(n.onload=t.proxy((function(){if(200==n.status){t("#redactor-progress, #redactor-progress-drag").hide();var e=i.split("?");if(!e[0])return!1;this.selectionRestore();var o="";o='<img id="image-marker" src="'+e[0]+'" />',this.opts.paragraphy&&(o="<p>"+o+"</p>"),this.execCommand("inserthtml",o,!1);var s=t(this.$editor.find("img#image-marker"));s.length?s.removeAttr("id"):s=!1,this.sync(),this.callback("imageUpload",s,!1),this.modalClose(),this.observeImages()}}),this),n.onerror=function(){},n.upload.onprogress=function(t){},n.setRequestHeader("Content-Type",e.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(e))},uploadInit:function(e,i){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},t.extend(this.uploadOptions,i);var n=t("#"+e);n.length&&"INPUT"===n[0].tagName?(this.uploadOptions.input=n,this.el=t(n[0].form)):this.el=n,this.element_action=this.el.attr("action"),this.uploadOptions.auto?t(this.uploadOptions.input).change(t.proxy((function(t){this.el.submit((function(t){return!1})),this.uploadSubmit(t)}),this)):this.uploadOptions.trigger&&t("#"+this.uploadOptions.trigger).click(t.proxy(this.uploadSubmit,this))},uploadSubmit:function(e){t("#redactor-progress").fadeIn(),this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var e=this.document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return e.innerHTML=i,t(e).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),t("#"+this.id).load(t.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(i,n){if(this.uploadOptions.input){var o="redactorUploadForm"+this.id,s="redactorUploadFile"+this.id;this.form=t('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+n+'" name="'+o+'" id="'+o+'" enctype="multipart/form-data" />'),!1!==this.opts.uploadFields&&"object"===e(this.opts.uploadFields)&&t.each(this.opts.uploadFields,t.proxy((function(e,i){null!=i&&0===i.toString().indexOf("#")&&(i=t(i).val());var n=t("<input/>",{type:"hidden",name:e,value:i});t(this.form).append(n)}),this));var a=this.uploadOptions.input,r=t(a).clone();t(a).attr("id",s).before(r).appendTo(this.form),t(this.form).css("position","absolute").css("top","-2000px").css("left","-2000px").appendTo("body"),this.form.submit()}else i.attr("target",n).attr("method","POST").attr("enctype","multipart/form-data").attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var e,i=t("#"+this.id)[0];if(e=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(t("#redactor-progress").hide(),void 0!==e){var n=e.body.innerHTML.match(/\{(.|\n)*\}/)[0];n=(n=n.replace(/^\[/,"")).replace(/\]$/,"");var o=t.parseJSON(n);void 0===o.error?this.uploadOptions.success(o):(this.uploadOptions.error(this,o),this.modalClose())}else this.modalClose(),alert("Upload failed!");this.el.attr("action",this.element_action),this.el.attr("target","")},draguploadInit:function(e,i){if(this.draguploadOptions=t.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:this.opts.curLang.drop_file_here,atext:this.opts.curLang.or_choose,uploadParam:!1},i),void 0===window.FormData)return!1;this.droparea=t('<div class="redactor_droparea"></div>'),this.dropareabox=t('<div class="redactor_dropareabox">'+this.draguploadOptions.text+"</div>"),this.dropalternative=t('<div class="redactor_dropalternative">'+this.draguploadOptions.atext+"</div>"),this.droparea.append(this.dropareabox),t(e).before(this.droparea),t(e).before(this.dropalternative),this.dropareabox.on("dragover",t.proxy((function(){return this.draguploadOndrag()}),this)),this.dropareabox.on("dragleave",t.proxy((function(){return this.draguploadOndragleave()}),this)),this.dropareabox.get(0).ondrop=t.proxy((function(t){t.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop"),this.dragUploadAjax(this.draguploadOptions.url,t.dataTransfer.files[0],!1,!1,!1,this.draguploadOptions.uploadParam)}),this)},dragUploadAjax:function(i,n,o,s,a,r){this.callback("drop",a);var l=new FormData;!1!==r?l.append(r,n):l.append("file",n),!1!==this.opts.uploadFields&&"object"===e(this.opts.uploadFields)&&t.each(this.opts.uploadFields,t.proxy((function(e,i){null!=i&&0===i.toString().indexOf("#")&&(i=t(i).val()),l.append(e,i)}),this));var d={url:i,dataType:"html",data:l,cache:!1,contentType:!1,processData:!1,type:"POST",success:t.proxy((function(e){var i="string"==typeof(e=(e=e.replace(/^\[/,"")).replace(/\]$/,""))?t.parseJSON(e):e;if(o){s.fadeOut("slow",(function(){t(this).remove()}));var n=t("<img>");n.attr("src",i.filelink).attr("id","drag-image-marker"),this.get()?this.insertNodeToCaretPositionFromPoint(a,n[0]):(this.fixInsertIntoEmptyEditorBug(),this.execCommand("inserthtml",t("<div/>").append(n[0]).html(),!1));var r=t(this.$editor.find("img#drag-image-marker"));r.length?r.removeAttr("id"):r=!1,this.sync(),this.observeImages(),r&&this.callback("imageUpload",r,i),void 0!==i.error&&this.callback("imageUploadError",i)}else void 0===i.error?this.draguploadOptions.success(i):(this.draguploadOptions.error(this,i),this.draguploadOptions.success(!1))}),this),error:t.proxy((function(e,i){console.log("error",i,e);var n=null;if(e&&e.responseText)try{n=t.parseJSON(e.responseText)}catch(a){console.log("Error: response was not JSON: ",e.responseText)}this.callback("imageUploadError",n)}),this)};if(!o){var c=t.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",t.proxy(this.uploadProgress,this),!1),d.xhr=function(){return c}}window.redactorXhr=t.ajax(d)},draguploadOndrag:function(){return this.dropareabox.addClass("hover"),!1},draguploadOndragleave:function(){return this.dropareabox.removeClass("hover"),!1},uploadProgress:function(t,e){var i=t.loaded?parseInt(t.loaded/t.total*100,10):t;this.dropareabox.text("Loading "+i+"% "+(e||""))},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isIPad:function(){return/iPad/.test(navigator.userAgent)},normalize:function(t){return void 0===t?0:parseInt(t.replace("px",""),10)},outerHtml:function(e){return t("<div>").append(t(e).eq(0).clone()).html()},stripHtml:function(t){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""},isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isEmpty:function(t){return""==(t=(t=(t=t.replace(/&#x200b;|<br>|<br\/>|&nbsp;/gi,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""))},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(t){var e=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==t:"opr"==i[1]?"webkit"==t:t==i[1]},oldIE:function(){return!!(this.browser("msie")&&parseInt(this.browser("version"),10)<9)},getFragmentHtml:function(t){var e=t.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(e),i.innerHTML},extractContent:function(){for(var t,e=this.$editor[0],i=this.document.createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i},isParentRedactor:function(e){return!!e&&((this.opts.iframe||0!=t(e).parents("div.redactor_editor").length&&!t(e).hasClass("redactor_editor"))&&e)},currentOrParentIs:function(t){var e=this.getParent(),i=this.getCurrent();return e&&e.tagName===t?e:!(!i||i.tagName!==t)&&i},isEndOfElement:function(){var e=this.getBlock();return this.getCaretOffset(e)==t.trim(t(e).text()).replace(/\n\r\n/g,"").length},isFocused:function(){var e,i=this.getSelection();return i&&i.rangeCount&&i.rangeCount>0&&(e=i.getRangeAt(0).startContainer),!!e&&(this.opts.iframe?!this.getCaretOffsetRange().equals()||!this.$editor.is(e):0!=t(e).closest("div.redactor_editor").length)},removeEmptyAttr:function(e,i){""==t(e).attr(i)&&t(e).removeAttr(i)},removeFromArrayByValue:function(t,e){for(var i=null;-1!==(i=t.indexOf(e));)t.splice(i,1);return t}},s.prototype.init.prototype=s.prototype,t.Redactor.fn.formatLinkify=function(e,i,n,o,s){for(var a=/(^|&lt;|\s)(www\.\S+?\..+?)([.),]?)(\s|\.\s+|\)|&gt;|$)/,r=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)([.),]?)(\s|\.\s+|\)|&gt;|$)/,l=/(https?:\/\/.*\.(?:png|jpg|jpeg|gif))/gi,d=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,c=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,u=(this.$editor?this.$editor.get(0):this).childNodes,h=u.length;h--;){var p=u[h];if(!(t(p).closest('pre, code, [style*="white-space: pre"]').length>0))if(3===p.nodeType){var f=p.nodeValue;if(f=f.replace(/[\u200B-\u200D\uFEFF]/g,""),o&&f){var m='<iframe width="500" height="281" src="',g='" frameborder="0" allowfullscreen></iframe>';f.match(d)?(f=f.replace(d,m+"//www.youtube.com/embed/$1"+g),t(p).after(f).remove()):f.match(c)&&(f=f.replace(c,m+"//player.vimeo.com/video/$2"+g),t(p).after(f).remove())}if(n&&f&&f.match(l)&&(f=f.replace(l,'<img src="$1">'),t(p).after(f).remove()),i&&f&&(f.match(a)||f.match(r))){for(var v=!0,b=!0;v;){var y,w=a,k=a.exec(f),C=r.exec(f);if(k&&k[2]&&C&&C[2])f.indexOf(k[2])<f.indexOf(C[2])?(y=k,w=a):(y=C,w=r);else k&&k[2]?(y=k,w=a):C&&C[2]&&(y=C,w=r);(v=y&&y.length)&&(y=y[2]);var x=y;if(v&&y&&y.length>s&&(x=y.substring(0,s)+"..."),b&&(f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),v&&y){var _=x.replace("$","$$$");f=w==a?f.replace(a,'$1<a href="'+e+'$2">'+t.trim(_)+"</a>$3$4"):f.replace(r,'$1<a href="$2">'+t.trim(_)+"</a>$5$6")}b=!1}t(p).after(f).remove()}}else 1!==p.nodeType||/^(a|button|textarea)$/i.test(p.tagName)||t.Redactor.fn.formatLinkify.call(p,e,i,n,o,s)}}}(t)}).call(this,n(8))},1774:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=S(i(5)),o=S(i(1)),s=S(i(8)),a=S(i(20)),r=S(i(70)),l=S(i(35)),d=S(i(293)),c=S(i(953)),u=S(i(5571)),h=S(i(6005)),p=S(i(6006)),f=S(i(6015)),m=S(i(6020)),g=S(i(993)),v=S(i(6030)),b=S(i(5615)),y=S(i(5630)),w=S(i(6031)),k=S(i(6033)),C=S(i(6035)),x=S(i(5635)),_=i(5575);function S(t){return t&&t.__esModule?t:{default:t}}var T=u.default.extend({template:h.default,className:"three-col s-ticket t-bg-grey-300",id:"ticket",tagName:"section",regions:{convoError:"#convoError",header:"#tkHeader",toolbar:".js-toolbar-container",replyRegion:".js-reply-container",leftNav:"#sidebar-lt",sidebar:"#sidebar-rt",threads:".threads-container",customFields:"#custom-fields-container",realtimeNewThreads:".realtime-threads-container"},ui:Object.assign(u.default.prototype.ui,{convoError:"#convoError",subject:"#subject",subjectLine:"#subjectLine",blockedImages:"#blockedImages",showImages:"#lnkEnableImages"}),events:{"click @ui.showImages":"showImages"},onShow:function(){var t=this.getTicketModel();this.listenTo(t.customer,"reset sync",this.renderSidebar),u.default.prototype.onShow&&u.default.prototype.onShow.apply(this,arguments),this.viewStartTime=new Date,(0,s.default)("body").removeClass("two-col").addClass("three-cols"),this.renderLeftNav(),this.header.show(new C.default({canUpdate:hsGlobal.memberPermissions.editConversationDetails,model:this.model})),this.setupConvoConcurrency(this.model),this.model.startRealtime(),this.listenTo(this.model,"redirect",this.doRedirect),this.listenTo(this.model,"realtime-change",this.validateCurrentFolder),this.listenTo(App,"route:before",(function(){this.clearTimeout("validate-folder")})),this.showCustomFields();var e=new p.default({model:this.model,ticketViewersModel:this.ticketViewersModel,workflows:App.data.get("dropdowns.workflow"),mailboxes:App.data.get("dropdowns.move"),tags:this.model.tags});this.toolbar.show(e),this.listenTo(c.default,"reply",this.reply),this.listenTo(e,"reply",this.reply),this.listenTo(c.default,"note",this.note),this.listenTo(e,"note",this.note),this.listenTo(c.default,"forward",this.forward),this.listenTo(e,"forward",this.forward),this.listenTo(App,"convo:missingEmail",this.displayMissingEmailConvoError);var i=new m.default({model:this.model,collection:this.model.threads,threadId:this.options.threadId});this.threads.show(i),this.listenTo(i,"blockedImagesLoaded",(function(){this.ui.blockedImages.show()})),this.listenTo(i,"itemview:edit",this.editDraft),this.listenTo(i,"itemview:refresh-threads",this.reloadThreads),this.realtimeNewThreads.show(new k.default({model:this.model,collection:this.model.threads.missingThreads})),this.listenTo(this.model,"refresh-threads",this.reloadThreads),this.listenTo(this.model,"ticket-deleted",(function(){var t="/mailbox/".concat(App.data.get("mailbox.slug"),"/").concat(App.data.folder.id,"/");a.default.history.navigate(t,{trigger:!0})})),this.listenTo(this.model,"customer-changed",(function(t){n.default.Controller.PubSub.publish("sidebar:updateCustomer",{id:t.id})})),this.model.customer&&this.renderSidebar(),this.checkForLocalDrafts(),this.updateTitle(),this.subId=n.default.Controller.PubSub.subscribe("ticket:customerChanged",o.default.bind((function(t){this.promise=this.model.fetch().then(o.default.bind((function(){App.ticket===this.model&&a.default.history.loadUrl()}),this))}),this)),this.customerSubId=n.default.Controller.PubSub.subscribe("sidebar:updateCustomer",this.handleCustomerSubEvent.bind(this)),this.customerLoadedSubId=n.default.Controller.PubSub.subscribe("sidebar:loadedCustomer",this.handleCustomerSubEvent.bind(this)),App.reqres.setHandler("ensure-ticket-id",this.ensureTicketId,this),App.reqres.setHandler("get-disabled-entry-ids",this.getDisabledEntryIds,this),n.default.Utils.Main.initPopovers(this.$('[data-toggle="popover"]')),c.default.start(c.default.TYPE_TICKET),(0,_.trackSampleConvo)(this.model,"Viewed Sample Convo")},handleCustomerSubEvent:function(t){var e=t.customer;if(e){var i=!!e.email,n=e.emails&&e.emails.length>0;(i||n)&&this.closeMissingEmailConvoError()}},validateCurrentFolder:function(){this.setTimeout("validate-folder",(function(){if(!App.data.folder.isValidForTicket(this.model)){var t=App.data.folder.getValidFolderType(this.model),e=t===n.default.Constants.Folder.TEAM?App.data.folders.findWhere({memberID:this.model.get("ownerId")}):App.data.folders.findWhere({type:t});e&&App.controller.setCurrentFolderId(e.id)}}),500)},doRedirect:function(t){this.setTimeout((function(){App.controller.routeOrReload(t),this.stopListening(this.model,"realtime-change")}))},getDisabledEntryIds:function(){var t=App.ticket.get("trafficCopInReplyToId");if(t){var e=App.ticket.threads.get(t);if(e){var i=[],n=e.get("emailId")||App.ticket.get("emailEntryId");return n&&i.push(n),i}}},displayMissingEmailConvoError:function(t){this.customerEmailUpdateView=new w.default({ticketId:this.model.get("id"),customerId:t?t.customerId:this.model.customer.get("id"),ticketType:this.model.get("type")}),this.convoError.show(this.customerEmailUpdateView),"chat"===this.model.get("type")&&this.ui.convoError.removeClass("is-error").addClass("is-info"),this.ui.convoError.removeClass("u-d-none").addClass("u-d-block"),this.listenTo(this.customerEmailUpdateView,"updated",o.default.bind(this.closeMissingEmailConvoError,this))},closeMissingEmailConvoError:function(){this.customerEmailUpdateView&&(this.ui.convoError.removeClass("u-d-block").addClass("u-d-none"),this.customerEmailUpdateView.close(),App.trigger("convo:missingEmailAdded"))},isMissingEmail:function(){return this.convoError&&this.convoError.currentView&&!this.convoError.currentView.isClosed},onClose:function(){n.default.Controller.PubSub.unsubscribe("ticket:customerChanged",this.subId),n.default.Controller.PubSub.unsubscribe("sidebar:updateCustomer",this.customerSubId),n.default.Controller.PubSub.unsubscribe("sidebar:loadedCustomer",this.customerLoadedSubId),(0,s.default)(window).off("unload.".concat(this.cid)),this.tearDownConvoConcurrency(this.model),this.model.stopRealtime(),c.default.stop(),App.reqres.removeHandler("ensure-ticket-id",this.ensureTicketId),App.reqres.removeHandler("get-disabled-entry-ids",this.getDisabledEntryIds)},heartbeat:function(){var t=!this.replyPanel,e=!t;App.convoConcurrencyManager.broadcast(this.model.get("number"),{viewing:t,replying:e})},notViewing:function(){App.convoConcurrencyManager.broadcast(this.model.get("number"),{viewing:!1,replying:!1})},updateTitle:function(){var t=this.model.get("subject")||"(no subject)",e=this.model.get("number");if(this.model.customer&&this.model.customer.hasName())var i=this.model.customer.fullName();(0,s.default)("title").html((0,v.default)({subject:t,number:e,customer:i}))},ensureTicketId:function(){return s.default.Deferred().resolve()},reply:function(){this.newThread(n.default.Constants.threadType.MESSAGE)},note:function(){this.newThread(n.default.Constants.threadType.NOTE)},forward:function(){this.newThread(n.default.Constants.threadType.FORWARD)},newThread:function(t,e){var i=new g.default({type:t,body:e},{parse:!0,ticket:this.model,useTicketCcDefaults:!0});this.isReplyPanelOpen()&&((i=this.replyPanel.model).set({type:t}),this.stopListening(this.replyPanel,"close",this.onPanelClose),this.replyPanel.close()),this.openThread(i)},isReplyPanelOpen:function(){return this.replyPanel&&!this.replyPanel.isClosed},openThread:function(t){t.get("type")===n.default.Constants.threadType.MESSAGE&&this.isMissingEmail()?n.default.Utils.Main.warning("Please update the customer email address before replying.",{timeout:4e3}):this.showReplyPanel(t)},showReplyPanel:function(t){this.replyPanel=new f.default({model:t,ticket:this.model,tags:this.model.tags,viewStartTime:this.viewStartTime}),this.listenTo(this.replyPanel,"close",this.onPanelClose),this.listenTo(this.replyPanel,"switch-to-note",this.switchToNote),this.replyRegion.show(this.replyPanel),this.heartbeat()},onPanelClose:function(){this.closed||this.replyPanel.sending||(this.setTimeout("reload-threads",this.reloadThreads),this.editingDraft&&(this.editingDraft.$el.show(),delete this.editingDraft)),delete this.replyPanel,this.heartbeat()},onThreadEdited:function(){this.closed||this.reloadThreads()},reloadThreads:function(){var t=this.model.threads.goTo(1,{reset:!0});return t.then(o.default.bind(this.onThreadsReloaded,this)),t},onThreadsReloaded:function(){if(this.model.threads.missingThreads.reset([],{silent:!0}),this.isReplyPanelOpen()){var t=this.replyPanel.model.get("id"),e=this.model.threads.get(t);if(e){var i=this.threads.currentView.children.findByModel(e);i&&this.hideEditingThreadView(i)}}},switchToNote:function(t){this.replyPanel.close(),this.newThread(n.default.Constants.threadType.NOTE,t)},editThread:function(t){var e=this.model.threads.get(t);if(e){var i=this.threads.currentView.children.findByModel(e);this.editDraft(i,e)}},hideEditingThreadView:function(t){this.editingDraft=t,t.$el.hide()},editDraft:function(t,e){this.openThread(e),this.hideEditingThreadView(t)},showImages:function(t){t&&t.preventDefault();var e=this.model.customer.get("id");e&&n.default.Utils.Ajax.put(["customer",e,"images"]),this.$("img[data-src]").each((function(){var t=(0,s.default)(this);t.attr("src",t.attr("data-src")),t.removeAttr("data-src"),n.default.Utils.Main.initPopupList(t,{type:"image",width:!1,height:!1,autoScale:!0,href:t.attr("src")})})),this.ui.blockedImages.hide()},checkForLocalDrafts:function(){var t=this.model.getLocalStorageDraftKey(),e=n.default.Utils.Main.getLocalDraft(t);if(e&&e.data&&e.data.body){var i=e.data,o=new Date(e.timestamp),s=i.id;this.shouldApplyLocalDraft(s,o)?this.applyLocalDraft(i):n.default.Utils.Main.clearLocalDraft(t)}else n.default.Utils.Main.clearLocalDraft(t)},shouldApplyLocalDraft:function(t,e){if(!t)return!0;var i=this.model.threads.findWhere({id:t});if(!i)return!1;var n=l.default.utc(i.get("createdAt")).toDate();return i.isDraft()&&e>n},applyLocalDraft:function(t){var e=t.id,i=e?this.model.threads.findWhere({id:e}):void 0;if(i){var n=this.threads.currentView.children.findByModel(i);if(i.isNote()&&i.attachments.length){var s=o.default.clone(i.attachments.toJSON());i.reset(t),i.attachments.reset(s)}else i.reset(t);this.editDraft(n,i)}else{var a=new g.default(t,{parse:!0,ticket:this.model,useTicketCcDefaults:!0});this.openThread(a)}},showCustomFields:function(){if(appData.hasOwnProperty("properties")&&appData.properties[n.default.Constants.Properties.CUSTOM_FIELDS]&&appData.mailbox.customFields.length){var t=new b.default({canUpdate:hsGlobal.memberPermissions.manageCustomFieldsInConversations,collection:new y.default(appData.mailbox.customFields,{ticket:this.model})});this.customFields.show(t)}}});r.default.mixin(T,d.default,x.default);var D=T;e.default=D},191:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(297)),s=a(i(305));function a(t){return t&&t.__esModule?t:{default:t}}var r=function(){return n.default.Utils.Main.isMobileDevice()?s.default:o.default};e.default=r},210:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=c(i(5)),s=c(i(211)),a=c(i(298)),r=c(i(276)),l=c(i(60)),d=c(i(23));function c(t){return t&&t.__esModule?t:{default:t}}window.EDITOR_MODES={HTML:1,TEXT:2};var u=t.ItemView.extend({tagName:"section",className:"hs-wysiwyg",events:{"change select[name=variable]":"insertVariable","change select[name=savedReply]":"insertSavedReply","click #savedReplyList li a":"insertSavedReply","click #savedReplyList":"replyTrigger"},savedReplyIds:[],savedReplyText:{},initialize:function(t){this.options.allowSaveReply=!1!==this.options.allowSaveReply,this.options.savedReplyIds&&(this.savedReplyIds=this.options.savedReplyIds),this.options.savedReplyText&&(this.savedReplyText=this.options.savedReplyText)},replyTrigger:function(t){t.target.className.includes("chzn-container-single")&&t.stopPropagation()},serializeData:function(){return n.extend(this.options,{mode:this.mode,cmdCtrl:o.default.Utils.Main.isAppleDevice()?"cmd":"ctrl"})},onRender:function(){},afterRender:function(){this.options.content&&this.setText(this.options.content),o.default.Utils.Main.initTooltips(this.$("[rel=tooltip]"))},insertSavedReplies:function(t){if(this.options.savedReplies){this.options.mailboxId||console.log("Error: must specify a mailboxId");var e=this.options.savedReplies.length>0;if(this.options.allowSaveReply||e){if(!t||!o.default.Utils.Main.isMobileDevice()){var i=(0,s.default)({savedReplies:this.options.savedReplies,allowSaveReply:this.options.allowSaveReply}),a=$(i);this.$("#savedReplyList").length?this.$("#savedReplyList").html(a.html()):this.ui.redactorToolbar&&this.ui.redactorToolbar.append(i),this.bindUIElements()}this.options.savedReplies.length>15?this.savedReplyChosen():o.default.Utils.dropdownEscapeSetup(this.ui.savedReplyList,"Saved-Replies",void 0,$.proxy(this.onSavedReplyClose,this)),this.bindUIElements(),this.delegateEvents()}n.each(this.savedReplyIds,$.proxy((function(t){o.default.Utils.Ajax.get(["api","v0","mailboxes",this.options.mailboxId,"saved-replies",t],$.proxy((function(e){this.savedReplyText[t]=e.text}),this))}),this))}},savedReplyChosen:function(){var t=this;(0,l.default)((function(){return $.contains(document,t.$el[0])}),$.proxy((function(){t.ui.savedReplySelect.data("placeholder",'<i class="icon-saved-replies"></i>').chosen(),o.default.Utils.chosenCssTransition(t.ui.savedReplySelect),o.default.Utils.chosenEscapeSetup(t.ui.savedReplySelect,"Saved-Replies",void 0,$.proxy(this.onSavedReplyClose,this)),t.ui.savedReplyList.find(".chzn-default").attr("title","Saved Replies"),t.bindUIElements(),t.delegateEvents()}),this),100)},insertSavedReply:function(t){var e=this,i=$(t.target).data("id");if("change"===t.type&&(i=$(t.target).val(),this.ui.savedReplySelect.val(null).trigger("liszt:updated")),"new"===i)this.newSavedReply(t);else{n.contains(this.savedReplyIds,i)||this.savedReplyIds.push(i),this.restoreSelection();var s=void 0;this.options.ticket&&(s={customerID:this.options.ticket.customer.get("id"),tid:this.options.ticket.get("id"),tnum:this.options.ticket.get("number")}),o.default.Utils.Ajax.get(["api","v0","mailboxes",this.options.mailboxId,"saved-replies",i],(function(t){e.savedReplyText[i]=t.text,e.addText(t.text)}),s)}},newSavedReply:function(t){t&&t.preventDefault();var e=new r.default({mailboxId:this.options.mailboxId,text:this.getText()}),i=new a.default({model:e,WysiView:this.getWysiViewClass()});App.modalRegion.wrapAndShow(i,{header:"New Saved Reply",modalClass:"modal-wide"}),this.listenToOnce(e,"sync",(function(t){this.options.savedReplies.push({id:t.get("id"),title:t.get("name")}),this.insertSavedReplies(!0),i.close(),this.restoreSelection()}))},getText:function(){return this},setText:function(t){return this},addText:function(t){return this},restoreSelection:function(){return this},onSavedReplyClose:function(){},focus:function(t){return this},getWysiViewClass:function(){console.error("Must override getWysiViewClass!")},getSavedRepliesInUse:function(t){var e=this.savedReplyIds.length>1?30:40;return n.filter(this.savedReplyIds,$.proxy((function(i){var n=this.savedReplyText[i];if(void 0!==n){var s=o.default.Utils.String.stripTags(n).toUpperCase();return o.default.Utils.String.similar_text(t,s,1)>=e||-1!==t.indexOf(s)}return!0}),this))},getSavedReplyIds:function(){if(this.savedReplyIds){var t=o.default.Utils.String.stripTags(this.getText()).toUpperCase();return t.length<2e3&&(this.savedReplyIds=this.getSavedRepliesInUse(t)),this.savedReplyIds.length?this.savedReplyIds.join(","):void 0}},hasText:function(){var t=this.getText();return null!=(t=o.default.Utils.Main.stripTags(t))&&!d.default.isBlank(t)||this.hasImage()},hasImage:function(){var t=this.getText();return o.default.Utils.Main.hasImage(t)},getEditorMode:function(){return this.mode}});e.default=u}).call(this,i(6),i(1))},211:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <select name="savedReply" class="chzn-select" data-placeholder="Saved Replies">\n            <option value=""></option>\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"allowSaveReply"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:12},end:{line:7,column:19}}}))?s:"")+(null!=(s=r(i,"each").call(a,null!=e?r(e,"savedReplies"):e,{name:"each",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:12},end:{line:10,column:21}}}))?s:"")+"        </select>\n\n"},2:function(t,e,i,n,o){return'                <option value="new">Save This Reply ...</option>\n'},4:function(t,e,i,n,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+a(s(null!=e?r(e,"id"):e,e))+'">'+a(s(null!=e?r(e,"title"):e,e))+"</option>\n"},6:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <a id="replyTrig" data-toggle="dropdown" class="dropdown-toggle replyView" href="javascript:void(0)" tabindex="-1" style="" rel="tooltip" data-placement="bottom" data-original-title="Saved Replies"><i class="icon-saved-replies"></i></a>\n        <ul class="dropdown-menu" role="menu">\n'+(null!=(s=r(i,"each").call(a,null!=e?r(e,"savedReplies"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:16,column:12},end:{line:18,column:21}}}))?s:"")+(null!=(s=r(i,"if").call(a,null!=e?r(e,"allowSaveReply"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:12},end:{line:26,column:19}}}))?s:"")+"        </ul>\n"},7:function(t,e,i,n,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <li><a data-id="'+a(s(null!=e?r(e,"id"):e,e))+'" href="#">'+a(s(null!=e?r(e,"title"):e,e))+"</a></li>\n"},9:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"savedReplies"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:20,column:16},end:{line:24,column:23}}}))?s:"")+'                <li><a class="new" data-id="new" href="#">Save This Reply ...</a></li>\n'},10:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=o(i(10)).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?l(e,"savedReplies"):e)?l(r,"length"):r,">",0,{name:"ifCond",hash:{},fn:t.program(11,a,0),inverse:t.noop,data:a,loc:{start:{line:21,column:20},end:{line:23,column:31}}}))?r:""},11:function(t,e,i,n,o){return'                        <li class="divider"></li>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li id="savedReplyList" class="replyView dropdown">\n'+(null!=(r=o(i(10)).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?l(e,"savedReplies"):e)?l(r,"length"):r,">",15,{name:"ifCond",hash:{},fn:t.program(1,a,0),inverse:t.program(6,a,0),data:a,loc:{start:{line:2,column:4},end:{line:28,column:15}}}))?r:"")+"</li>\n"},useData:!0})},244:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i(5)),o=r(i(245)),s=r(i(246));i(173);var a=["keyupCallback","keydownCallback","testareaKeydownCallback"];function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function d(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function c(e){var i="There was a problem uploading this file";e&&e.error?i=e.error:t.isObject(e)&&t.keys(e).length&&(i=t.map(e,(function(t,e){return e+": "+t})).join("<br>")),n.default.Utils.Main.error(i)}var u={defaults:{convertDivs:!0,linkSize:350,linebreaks:!0,tabFocus:!1,removeEmptyTags:!1,linkAnchor:!0,linkEmail:!0,cleanSpaces:!1,pasteBeforeCallback:function(t){var e=s.default.remove("windowPosBeforePaste",0);return $(window).scrollTop(e),t},pasteAfterCallback:function(t){var e=$.proxy((function(t){var i=String.fromCharCode(t.keyCode),n=/[a-zA-Z0-9-_ ]/.test(i);13===t.which||32===t.which?this.$editor.off("keydown",e):(8===t.which||46===t.which||!t.metaKey&&!t.ctrlKey&&n)&&(this.bufferSet(),this.$editor.off("keydown",e))}),this);return this.$editor.on("keydown",e),t},modalOpenedCallback:function(){n.default.stack.opened("RedactorModal",(function(){})),$("body").addClass("overflow-hidden")},modalClosedCallback:function(){n.default.stack.closed("RedactorModal"),$("body").removeClass("overflow-hidden")},dropdownShowCallback:function(t){var e=t.key,i=t.button;i.data("tooltip")&&i.data("tooltip").$tip.hide();var o="Dropdown:Redactor-"+e;n.default.stack.opened(o,(function(){n.default.stack.closed(o),i.hasClass("dropact")&&i.click()}))},dropdownHideCallback:function(){window.HS&&n.default.Controller&&n.default.Controller.PubSub.publish("User:Dropdown:CloseAll")},imageUploadErrorCallback:c,fileUploadErrorCallback:c,deniedTags:$.Redactor.opts.deniedTags.concat(["article","aside","audio","canvas","details","embed","figcaption","figure","footer","form","header","hgroup","iframe","input","main","nav","object","script","section","select","summary","textarea","video"])},customizeAlignmentDropdown:function(e){var i=$.Redactor.prototype.toolbarInit(e).alignment;return i.dropdown=t.extend(i.dropdown,{redactor_separator_drop:{title:"",className:"redactor_separator_drop"},indent:{title:"Indent",className:"indent",func:"indentingIndent"},outdent:{title:"Outdent",className:"outdent",func:"indentingOutdent"}}),i},getToolbarCustom:function(){var t=$.Redactor.opts.langs[$.Redactor.opts.lang];return{listdropdown:{title:"List",dropdown:{unorderedlist:{title:"&bull; "+t.unorderedlist,className:"unorderedlist",exec:"insertunorderedlist"},orderedlist:{title:"1. "+t.orderedlist,className:"orderedlist",exec:"insertorderedlist"}}},imagevideodropdown:{title:"Insert Image/Video/File",dropdown:{image:{title:t.image,className:"imageDropdownOption",func:"imageShow"},video:{title:t.video,className:"videoDropdownOption",func:"videoShow"},file:{title:t.file,className:"fileDropdownOption",func:"fileShow"}}},alignment:this.customizeAlignmentDropdown(t)}},getOptions:function(e,i){var n=["bold","italic","underline","listdropdown","link"];i&&i.images&&n.push("image"),i&&i.codeMode&&n.push("html");var o=$.Redactor.opts.activeButtons,s=$.Redactor.opts.activeButtonsStates;o.push("listdropdown"),t.extend(s,{ul:"listdropdown",ol:"listdropdown"}),$.Redactor.opts.langs.en.image_web_link="Image URL";var r=t.extend({},this.defaults,{buttons:n,activeButtons:o,activeButtonsStates:s,toolbarCustom:this.getToolbarCustom()},e);if(!hsGlobal.features.isKbShortcutsEnabled){var c=r;c.keyupCallback,c.keydownCallback,c.testareaKeydownCallback;r=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach((function(e){l(t,e,i[e])}))}return t}({},d(c,a),{shortcuts:!1})}return r},addCustomButton:function(t,e){var i=t.redactor("getToolbar"),n=(0,o.default)(e);i.append(e).append(n)},rememberWindowPosition:function(t){var e=$(window).scrollTop();s.default.add(t,e)}};e.default=u}).call(this,i(1))},245:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l="function",d=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="btnGroup">\n    <button id="'+d(typeof(s=null!=(s=c(i,"id")||(null!=e?c(e,"id"):e))?s:r)===l?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:2,column:16},end:{line:2,column:22}}}):s)+'" class="btn '+d(typeof(s=null!=(s=c(i,"className")||(null!=e?c(e,"className"):e))?s:r)===l?s.call(a,{name:"className",hash:{},data:o,loc:{start:{line:2,column:35},end:{line:2,column:48}}}):s)+'" title="'+d(typeof(s=null!=(s=c(i,"title")||(null!=e?c(e,"title"):e))?s:r)===l?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:2,column:57},end:{line:2,column:66}}}):s)+'" data-placement="bottom" rel="tooltip" data-cy="Docs.redactorButton.'+d(typeof(s=null!=(s=c(i,"id")||(null!=e?c(e,"id"):e))?s:r)===l?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:2,column:135},end:{line:2,column:141}}}):s)+'">'+d(typeof(s=null!=(s=c(i,"name")||(null!=e?c(e,"name"):e))?s:r)===l?s.call(a,{name:"name",hash:{},data:o,loc:{start:{line:2,column:143},end:{line:2,column:151}}}):s)+"</button>\n</li>"},useData:!0})},246:function(t,e){window;var i,n=(i={},{add:function(t,e){i[t]=e},remove:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0===i[t])return e;var n=i[t];return delete i[t],n},reset:function(){Object.keys(i).forEach((function(t){return delete i[t]}))}});t.exports=n},276:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=i(29))&&n.__esModule?n:{default:n};i(81);var s=o.default.extend({defaults:{id:null,mailboxId:null,name:"",text:""},url:function(){var t=hsGlobal.path+"api/v0/mailboxes/"+this.get("mailboxId")+"/saved-replies",e=this.get("id");return null==e?t:t+"/"+e},validation:{name:{required:!0},text:{required:!0}}});e.default=s},297:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(i(5)),o=u(i(210)),s=(u(i(173)),u(i(244))),a=u(i(300)),r=u(i(301)),l=u(i(150)),d=u(i(302)),c=u(i(303));function u(t){return t&&t.__esModule?t:{default:t}}var h=o.default.extend({template:a.default,ui:{redactor:".redactor",redactorEditor:".redactor_editor[contenteditable]",redactorToolbar:".redactor_toolbar",variables:"select[name=variable]",savedReplyList:"#savedReplyList",savedReplySelect:"select[name=savedReply]",savedReplyUl:"#savedReplyList ul.dropdown-menu"},isMobile:!1,mode:EDITOR_MODES.HTML,initialize:function(e){o.default.prototype.initialize.apply(this,arguments),t.bindAll(this,"onEffectiveBlur","removeSelection","onSelectOrDropdownClick","onEditorMousedown","onWindowFocus")},onRender:function(){var e=this;o.default.prototype.onRender.apply(this,arguments);var i=$.proxy(this.keydown,this),a=t.extend({},{linkAnchor:!1,keyupCallback:this.keyup,keydownCallback:i,textareaKeydownCallback:i,focusCallback:$.proxy((function(){this.selectionSaving||!0===this.selectionSaved&&this.removeSelection(),this.selectionSaving=!1}),this),blurCallback:function(){e.trigger("blur",e.getText())}},this.options.redactorOptions);a=s.default.getOptions(a,{images:this.options.images,codeMode:this.options.codeMode}),"tabindex"in this.options&&(a.tabindex=this.options.tabindex),!0===this.options.useMentions&&(a.plugins=a.plugins||[],a.plugins.push("mentions"),a.mentions_options={triggerString:"@",noMatchMax:2,labelValueHash:this.options.mentionNames||[],onDropdownShow:function(){n.default.stack.opened("Mentions-Plugin",t.bind(this.turnOff,this))},onDropdownHide:function(){n.default.stack.closed("Mentions-Plugin")}}),a.changeCallback=t.bind((function(){this.trigger("change",this.getText())}),this),a.pasteBeforeCallback=this.pasteBefore,this.ui.redactor.redactor(a),this.bindUIElements(),this.options.insertHtml&&this.addInsertHtmlButton(),this.options.useMentions&&this.addMentionsButton(),this.insertSavedReplies(),this.options.variables&&this.insertVariablesSelect(),this.options.saveDelete&&this.addSaveDeleteButtons(),this.createTooltips(),this.afterRender(),this.chosenDisplaySubId=n.default.Controller.PubSub.subscribe("Chozen:display",$.proxy((function(){this.onEffectiveBlur("force")}),this)),$(window).on("focus",this.onWindowFocus),$(document).on("mousedown",this.onEffectiveBlur).on("click","select:not([name=variable]),[data-toggle=dropdown]",this.onSelectOrDropdownClick),this.ui.redactorEditor.on("mousedown",this.onEditorMousedown)},onClose:function(){n.default.Controller.PubSub.unsubscribe("Chozen:display",this.chosenDisplaySubId),$(window).off("focus",this.onWindowFocus),$(document).off("mousedown",this.onEffectiveBlur).off("click","select:not([name=variable]),[data-toggle=dropdown]",this.onSelectOrDropdownClick),$("select,[data-toggle=dropdown]").off("click",this.onSelectOrDropdownClick),this.ui.redactor.redactor&&$.contains(document,this.ui.redactor)&&this.ui.redactor.redactor("destroy"),this.ui.redactorEditor&&this.ui.redactorEditor.trigger("close")},onWindowFocus:function(){this.selectionSaved&&this.restoreSelection()},onSelectOrDropdownClick:function(t){n.default.Utils.Main.removeWindowSelection(),this.onEffectiveBlur("force")},onEditorMousedown:function(t){(!this.isSelectionInRedactor()&&!this.hasFocus()||this.selectionSaved)&&this.removeSelection()},hasFocus:function(){return this.ui.redactor.redactor("isFocused")},removeSelection:function(){try{this.selectionSaved=!1,this.ui.redactor.redactor("selectionRemoveMarkers")}catch(t){console.error(t)}},onEffectiveBlur:function(t){try{var e=!1,i=!1,n=this.ui.redactorEditor;if("force"!==t){(n.length&&t.target===n[0]||n.has(t.target).length>0)&&(e=!0),this.ui.redactor.length&&(t.target===this.ui.redactor[0]||this.ui.redactor.has(t.target).length>0)&&(e=!0);var o=$(t.target);i=o.hasClass("re-icon")&&!$(t.target).hasClass("custom")||o.parent().is(".redactor_dropdown")||o.closest("#redactor_modal").length>0||o.closest(".redactor-link-tooltip").length>0}!this.isSelectionInRedactor()&&!this.hasFocus()||e||i||this.ui.redactor.length&&$.contains(document,this.ui.redactor[0])&&!this.selectionSaved&&this.selectionSave()}catch(s){console.error(s)}},isZombieView:function(){return this.isClosed||!this.$el.length||!$.contains(document,this.$el[0])},pasteBefore:function(t){return t=t.replace(/<span style=["']font-weight: 700;["']>([\w\W]*?)<\/span>/gi,"<strong>$1</strong>")},onSavedReplyClose:function(){setTimeout($.proxy((function(){this.selectionSaved&&this.restoreSelection()}),this),100)},isSelectionInRedactor:function(){var t=this.ui.redactorEditor,e=this.ui.redactor.redactor("getSelection");return e&&$.contains(t[0],e.baseNode)||$.contains(t[0],e.focusNode)||$.contains(t[0],e.extentNode)||t[0]===e.baseNode},addInsertHtmlButton:function(){var t=$('<li><a href="javascript:void(0);" title="Insert HTML" tabindex="-1" class="custom re-icon re-html" rel="tooltip"></a></li>');t.click($.proxy((function(t){t.preventDefault();var e=new c.default;this.listenTo(e,"close",$.proxy((function(){this.restoreSelection()}),this)),this.listenTo(e,"insert",(function(t){e.close();var i=t.html;t.preformatted?(i="<pre>"+n.default.Utils.String.escapeHTML(i)+"</pre>",this.ui.redactor.redactor("insertHtmlAdvanced",i)):this.ui.redactor.redactor("insertHtml",i)})),App.modalRegion.wrapAndShow(e,{header:"Insert HTML"})}),this)),this.ui.redactorToolbar.append(t)},addSaveDeleteButtons:function(){var t=(0,l.default)({showSave:this.options.showSave,cmdCtrl:n.default.Utils.Main.isAppleDevice()?"cmd":"ctrl"});this.ui.redactorToolbar.append(t),this.bindUIElements(),this.delegateEvents()},addMentionsButton:function(){var t=(0,d.default)();this.ui.redactorToolbar.append(t),this.bindUIElements(),this.delegateEvents()},triggerMentionsAutocomplete:function(){this.addText("@"),this.ui.redactorEditor.trigger("mention:trigger")},createTooltips:function(){this.ui.redactorToolbar.find("li a").attr("rel","tooltip").data("placement","bottom"),n.default.Utils.Main.initTooltips(this.$("[rel=tooltip]"))},onChange:function(t){this.trigger("change",t)},insertVariablesSelect:function(){var t={};switch(this.options.variables){case"savedreply":t=this.options.variableOptions?this.options.variableOptions:{conversation:!0,customer:!0,user:!0};break;case"autoreply":t={conversation:!0,customer:!0};break;case"signature":t={user:!0}}var e=(0,r.default)(t);this.ui.redactorToolbar.append(e),this.bindUIElements()},insertVariable:function(){var t=this.ui.variables.val();this.ui.variables.find("option").removeAttr("selected"),this.ui.redactor.data().redactor&&this.ui.redactor.data().redactor.opts.visual?this.addText(t):n.default.Utils.Main.insertAtCaret(this.ui.redactor[0],t)},keydown:function(t){switch(this.selectionSaved&&this.removeSelection(),t.which){case p.D:t.shiftKey&&(t.ctrlKey||t.metaKey)&&this.$el.is(":visible")&&(t.preventDefault(),this.trigger("saveDraft"));break;case p.A:t.shiftKey&&(t.ctrlKey&&!n.default.Utils.Main.isAppleDevice()||t.metaKey)&&this.$el.is(":visible")&&(t.preventDefault(),this.trigger("attachment"));break;case p.L:t.shiftKey&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.ui.redactorToolbar.find("a.redactor_dropdown_link").click());break;case p.K:(!n.default.Utils.Main.isAppleDevice()&&t.ctrlKey&&!t.altKey||t.metaKey)&&(t.preventDefault(),this.ui.redactorToolbar.find("a.redactor_dropdown_link").click());break;case p.S:t.shiftKey&&(t.ctrlKey||t.metaKey)&&this.options.savedReplies&&(t.preventDefault(),this.selectionSave(),this.options.savedReplies.length>15?this.ui.savedReplyList.find("a").mousedown():this.ui.savedReplyList.find("#replyTrig").click());break;case p.V:(t.ctrlKey||t.metaKey)&&s.default.rememberWindowPosition("windowPosBeforePaste");break;case p.slash:(t.ctrlKey||t.metaKey)&&(this.selectionSave(),App.trigger("docs-search-focus"),t.preventDefault());break;case p.enter:if(t.ctrlKey||t.metaKey)return this.trigger("submit"),t.preventDefault(),!1}},getText:function(){return this.ui.redactor.redactor("get")},setText:function(t){return"string"==typeof t&&this.ui.redactor.redactor("set",t),this},addText:function(t){return this.ui.redactor.redactor("insertHtml",t),this},restoreSelection:function(){this.selectionSaved=!1;try{this.ui.redactor.redactor("selectionRestore")}catch(t){console.log("caught unimportant restoreSelection error:",t)}return this},selectionSave:function(){this.selectionSaving=!0,this.ui.redactor.redactor("selectionSave"),this.selectionSaving=!1,this.selectionSaved=!0},focus:function(t){return t?this.ui.redactor.redactor("focusEnd"):this.ui.redactor.redactor("focus"),this},getWysiViewClass:function(){return h},getRedactorInstance:function(t){return this.ui.redactor.data("redactor")},setRedactorOption:function(t,e){this.ui.redactor.data("redactor").opts[t]=e},setRedactorProperty:function(t,e){this.ui.redactor.data("redactor")[t]=e},getRedactorProperty:function(t){return this.ui.redactor.data("redactor")[t]}}),p={escape:27,D:68,A:65,K:75,L:76,S:83,V:86,8:56,7:55,enter:13,slash:191},f=h;e.default=f}).call(this,i(1))},298:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,s=d(i(5)),a=d(i(299)),r=d(i(191)),l=d(i(61));function d(t){return t&&t.__esModule?t:{default:t}}var c=t.ItemView.extend({template:a.default,events:{"click .save":"save","click .delete":"deleteClick"},ui:{form:"form",name:"input[name=name]",save:".save",wysiwyg:".hs-wysiwyg"},initialize:function(t){this.mailboxes=appData.mailboxes||[],o=r.default?(0,r.default)():this.options.WysiView,this.viewValidator=new l.default(this,"sumo")},serializeData:function(){if(parseInt(this.model.get("id"))>0){var t=parseInt(this.model.get("mailboxId"));return this.mailboxes=this.mailboxes.filter((function(e){return e.id!==t})),n.extend(this.model.toJSON(),{mailboxes:this.mailboxes})}return this.model.toJSON()},onRender:function(){this.wysiView=new o({el:this.ui.wysiwyg,variables:"savedreply",codeMode:!0,redactorOptions:{minHeight:250,autoresize:!1}}).render(),void 0!==this.model.get("text")&&this.wysiView.setText(this.model.get("text")),this.listenTo(this.wysiView,"submit",this.save),this.ui.form.submit($.proxy(this.save,this))},onClose:function(){this.wysiView&&this.wysiView.close()},focus:function(){this.ui.name.focus()},save:function(t){t&&t.preventDefault();var e={name:this.ui.name.val(),text:this.wysiView.getText(),mode:this.wysiView.getEditorMode(),chatText:null};this.model.set(e),this.model.validate(e),this.model.isValid()&&(this.ui.save.button("loading"),this.model.save(this.model.toJSON(),{success:$.proxy((function(){this.isNew?(this.trigger("created",this.model),this.isNew=!1):this.trigger("updated",this.model)}),this)}).always(n.bind((function(){this.ui.save&&this.ui.save.button&&this.ui.save.button("reset")}),this)))},doDelete:function(t){this.model.destroy({success:$.proxy((function(){this.trigger("deleted")}),this),error:function(t,e){s.default.Utils.Ajax.fail(e)}},{wait:!0})},deleteClick:function(t){t&&t.preventDefault();var e=$.proxy(this.doDelete,this);s.default.Utils.Main.confirmDelete("Delete this Saved Reply?",e)}});e.default=c}).call(this,i(6),i(1))},299:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="pull-right">\n        <div class="btn-group copy">\n            <a href="javascript:void(0);" class="btn dropdown-toggle" data-toggle="dropdown" rel="tooltip" data-placement="bottom" data-original-title="Copy"><i class="icon-copy"></i><b class="caret"></b></a>\n            <ul class="dropdown-menu pull-right">\n                <li class="dropdown-submenu">\n                    <a tabindex="-1" href="javascript:void(0);">Copy to Mailbox ...</a>\n                    <ul class="dropdown-menu">\n'+(null!=(r=l(i,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"mailboxes"):e,{name:"each",hash:{},fn:t.program(2,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:10,column:24},end:{line:12,column:33}}}))?r:"")+"                    </ul>\n                </li>\n            </ul>\n        </div>\n    </div>\n"},2:function(t,e,i,n,o,s,a){var r=t.lambda,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                            <li><a href="/settings/saved-replies/'+l(r(null!=a[1]?d(a[1],"id"):a[1],e))+"/copy/"+l(r(null!=e?d(e,"id"):e,e))+'/" data-bypass="true">'+l(r(null!=e?d(e,"name"):e,e))+"</a></li>\n"},4:function(t,e,i,n,o){return'            <a href="javascript:void(0)" class="delete c-button c-button--link is-error" title="Delete">Delete</a>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o,s,a){var r,l,d=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<form class="replyForm form-horizontal" action="" method="post">\n'+(null!=(r=c(i,"if").call(d,null!=e?c(e,"id"):e,{name:"if",hash:{},fn:t.program(1,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:18,column:11}}}))?r:"")+'    <div class="control-group"><label class="control-label">Name</label>\n        <div class="controls">\n            <input type="text" name="name" maxlength="75" class="input-xlarge" id="replyName" value="'+t.escapeExpression("function"==typeof(l=null!=(l=c(i,"name")||(null!=e?c(e,"name"):e))?l:t.hooks.helperMissing)?l.call(d,{name:"name",hash:{},data:o,loc:{start:{line:21,column:101},end:{line:21,column:109}}}):l)+'">\n            <span class="help-block" data-error="name"></span>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">Reply</label>\n        <div class="controls">\n            <section class="hs-wysiwyg"></section>\n            <span class="help-block" data-error="text"></span>\n        </div>\n    </div>\n    <div class="form-actions">\n        <button type="button" class="save c-button c-button--primary" data-loading-text="Saving...">Save Reply</button>\n'+(null!=(r=c(i,"if").call(d,null!=e?c(e,"id"):e,{name:"if",hash:{},fn:t.program(4,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:34,column:8},end:{line:36,column:15}}}))?r:"")+"    </div>\n</form>\n"},useData:!0,useDepths:!0})},300:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<textarea class="redactor" name="'+l("function"==typeof(s=null!=(s=d(i,"textareaName")||(null!=e?d(e,"textareaName"):e))?s:r)?s.call(a,{name:"textareaName",hash:{},data:o,loc:{start:{line:1,column:33},end:{line:1,column:49}}}):s)+'"></textarea>\n<input type="hidden" name="'+l("function"==typeof(s=null!=(s=d(i,"textareaName")||(null!=e?d(e,"textareaName"):e))?s:r)?s.call(a,{name:"textareaName",hash:{},data:o,loc:{start:{line:2,column:27},end:{line:2,column:43}}}):s)+'Mode" value="'+l("function"==typeof(s=null!=(s=d(i,"mode")||(null!=e?d(e,"mode"):e))?s:r)?s.call(a,{name:"mode",hash:{},data:o,loc:{start:{line:2,column:56},end:{line:2,column:64}}}):s)+'"/>'},useData:!0})},301:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'            <optgroup label="Conversation">\n                <option value="{%conversation.number%}">Number</option>\n            </optgroup>\n'},3:function(t,e,i,n,o){return'            <optgroup label="Customer">\n                <option value="{%customer.fullName,fallback=%}">Full Name</option>\n                <option value="{%customer.firstName,fallback=%}">First Name</option>\n                <option value="{%customer.lastName,fallback=%}">Last Name</option>\n                <option value="{%customer.email,fallback=%}">Email Address</option>\n            </optgroup>\n'},5:function(t,e,i,n,o){return'            <optgroup label="User">\n                <option value="{%user.fullName%}">Full Name</option>\n                <option value="{%user.firstName%}">First Name</option>\n                <option value="{%user.lastName%}">Last Name</option>\n                <option value="{%user.email%}">Email Address</option>\n                <option value="{%user.profileImg%}">Profile Image</option>\n                <option value="{%user.profileImgUrl%}">Profile Image Url</option>\n                <option value="{%user.phone,fallback=%}">Phone</option>\n                <option value="{%user.jobTitle,fallback=%}">Job Title</option>\n            </optgroup>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li style="float: right">\n    <select name="variable" class="wsyiwyg-select pull-right" tabindex="-1">\n        <option value="">Insert variable ...</option>\n        <optgroup label="Mailbox">\n            <option value="{%mailbox.email%}">Email</option>\n            <option value="{%mailbox.name%}">Name</option>\n        </optgroup>\n\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"conversation"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:8},end:{line:13,column:15}}}))?s:"")+"\n\n"+(null!=(s=r(i,"if").call(a,null!=e?r(e,"customer"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:16,column:8},end:{line:23,column:15}}}))?s:"")+"\n"+(null!=(s=r(i,"if").call(a,null!=e?r(e,"user"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:8},end:{line:36,column:15}}}))?s:"")+"    </select>\n</li>\n"},useData:!0})},302:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<li class="mentionsButton">\n  <a href="javascript:void(0)" class="mentions" rel="tooltip" data-placement="bottom" data-original-title="Insert @mention" tabindex="-1"><i class="icon-mention"></i></a>\n</li>\n'},useData:!0})},303:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=i(304))&&n.__esModule?n:{default:n};var s=t.ItemView.extend({template:o.default,events:{"click .save":"save"},ui:{form:"form",textarea:"textarea",preformatted:".preformatted"},initialize:function(){},onRender:function(){this.ui.form.submit($.proxy(this.save,this))},save:function(t){t&&t.preventDefault();var e={html:this.ui.textarea.val(),preformatted:this.ui.preformatted.is(":checked")};this.trigger("insert",e)}});e.default=s}).call(this,i(6))},304:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<form method="post" action="#" id="insert-html">\n  <fieldset>\n    <div class="control-group">\n      <textarea name="codeEditor" class="codeEditor" cols="30" rows="10"></textarea>\n    </div>\x3c!-- /control-group --\x3e\n    <div class="control-group">\n      <label class="checkbox">\n          <input type="checkbox" class="preformatted"> This is preformatted code (will be wrapped in a &lt;pre&gt; tag)\n      </label>\n    </div>\x3c!-- /control-group --\x3e\n    <div class="form-actions">\n      <button type="submit" class="save btn btn-success">Insert HTML</button>\n    </div>\x3c!-- /form-actions --\x3e\n  </fieldset>\n</form>'},useData:!0})},305:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(210)),s=a(i(306));function a(t){return t&&t.__esModule?t:{default:t}}i(150);var r=o.default.extend({className:"wysiView mobile",template:s.default,ui:{textarea:"textarea",savedReplyList:"#savedReplyList",savedReplySelect:"select[name=savedReply]",savedReplyUl:"#savedReplyList ul.dropdown-menu"},isMobile:!0,mode:EDITOR_MODES.TEXT,initialize:function(t){o.default.prototype.initialize.apply(this,arguments)},onRender:function(){o.default.prototype.onRender.apply(this,arguments),this.ui.textarea.change(t.bind((function(){this.trigger("change",this.getText())}),this)),this.insertSavedReplies(),this.afterRender()},getText:function(){var t=this.ui.textarea.val();return t=n.default.Utils.Main.stripTags(t.replace(/\<br(\s*\/|)\>/g,"\r\n"))},setText:function(t){return this.ui.textarea.val(""),"string"==typeof t&&(t=l(t),this.ui.textarea.val(t)),this},addText:function(t){return"string"==typeof t&&(t=l(t),n.default.Utils.Main.insertAtCaret(this.ui.textarea,t)),this},focus:function(t){return this.ui.textarea.focus(),this},hasFocus:function(){return this.ui.textarea.is(":focus")},getWysiViewClass:function(){return r}});function l(t){return"string"==typeof t&&(t=t.replace(/\n/g,""),t=(t=n.default.Utils.Main.replaceLinks(t)).replace(/<\/li>/gi,"<br>"),t=n.default.Utils.Main.stripTags(t.replace(/\<br(\s*\/|)\>/g,"\r\n"))),t}var d=r;e.default=d}).call(this,i(1))},306:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,n,o,s){var a;return null!=(a=t.invokePartial(i(211),e,{name:"savedReplies",data:s,indent:"        ",helpers:n,partials:o,decorators:t.decorators}))?a:""},3:function(t,e,n,o,s){var a;return null!=(a=t.invokePartial(i(150),e,{name:"saveDelete",data:s,indent:"        ",helpers:n,partials:o,decorators:t.decorators}))?a:""},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lambda,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div id="editorBar" class="navbar">\n'+(null!=(s=d(i,"if").call(a,null!=e?d(e,"savedReplies"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:11}}}))?s:"")+"\n"+(null!=(s=d(i,"if").call(a,null!=e?d(e,"saveDelete"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:4},end:{line:8,column:11}}}))?s:"")+'</div>\n<textarea name="'+l(r(null!=e?d(e,"textareaName"):e,e))+'"></textarea>\n<input type="hidden" name="'+l(r(null!=e?d(e,"textareaName"):e,e))+'Mode" value="'+l(r(null!=e?d(e,"mode"):e,e))+'"/>\n'},usePartial:!0,useData:!0})},338:function(t,e){window;function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){function e(){return new Date(Date.UTC.apply(Date,arguments))}function n(e,i){var n=t(e).data(),o={},s=new RegExp("^"+i.toLowerCase()+"([A-Z])");i=new RegExp("^"+i.toLowerCase());for(var a in n)i.test(a)&&(o[a.replace(s,(function(t,e){return e.toLowerCase()}))]=n[a]);return o}function o(e){var i={};if(u[e]||(e=e.split("-")[0],u[e])){var n=u[e];return t.each(c,(function(t,e){e in n&&(i[e]=n[e])})),i}}var s=t(window),a=function(e,i){this._process_options(i),this.element=t(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=!!this.element.is(".date")&&this.element.find(".add-on, .btn"),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=t(h.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&(this.picker.addClass("datepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",(function(t,e){return parseInt(e)+1})),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};a.prototype={constructor:a,_process_options:function(e){this._o=t.extend({},this._o,e);var i=this.o=t.extend({},this._o),n=i.language;switch(u[n]||(n=n.split("-")[0],u[n]||(n=d.language)),i.language=n,i.startView){case 2:case"decade":i.startView=2;break;case 1:case"year":i.startView=1;break;default:i.startView=0}switch(i.minViewMode){case 1:case"months":i.minViewMode=1;break;case 2:case"years":i.minViewMode=2;break;default:i.minViewMode=0}i.startView=Math.max(i.startView,i.minViewMode),i.weekStart%=7,i.weekEnd=(i.weekStart+6)%7;var o=h.parseFormat(i.format);i.startDate!==-1/0&&(i.startDate=i.startDate?i.startDate instanceof Date?this._local_to_utc(this._zero_time(i.startDate)):h.parseDate(i.startDate,o,i.language):-1/0),1/0!==i.endDate&&(i.endDate=i.endDate?i.endDate instanceof Date?this._local_to_utc(this._zero_time(i.endDate)):h.parseDate(i.endDate,o,i.language):1/0),i.daysOfWeekDisabled=i.daysOfWeekDisabled||[],t.isArray(i.daysOfWeekDisabled)||(i.daysOfWeekDisabled=i.daysOfWeekDisabled.split(/[,\s]*/)),i.daysOfWeekDisabled=t.map(i.daysOfWeekDisabled,(function(t){return parseInt(t,10)}));var s=String(i.orientation).toLowerCase().split(/\s+/g),a=i.orientation.toLowerCase();if(s=t.grep(s,(function(t){return/^auto|left|right|top|bottom$/.test(t)})),i.orientation={x:"auto",y:"auto"},a&&"auto"!==a)if(1===s.length)switch(s[0]){case"top":case"bottom":i.orientation.y=s[0];break;case"left":case"right":i.orientation.x=s[0]}else a=t.grep(s,(function(t){return/^left|right$/.test(t)})),i.orientation.x=a[0]||"auto",a=t.grep(s,(function(t){return/^top|bottom$/.test(t)})),i.orientation.y=a[0]||"auto"},_events:[],_secondaryEvents:[],_applyEvents:function(t){for(var e,i,n=0;n<t.length;n++)e=t[n][0],i=t[n][1],e.on(i)},_unapplyEvents:function(t){for(var e,i,n=0;n<t.length;n++)e=t[n][0],i=t[n][1],e.off(i)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]],this._secondaryEvents=[[this.picker,{click:t.proxy(this.click,this)}],[t(window),{resize:t.proxy(this.place,this)}],[t(document),{"mousedown touchstart":t.proxy((function(t){this.element.is(t.target)||this.element.find(t.target).length||this.picker.is(t.target)||this.picker.find(t.target).length||this.hide()}),this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,i){var n=i||this.date,o=this._utc_to_local(n);this.element.trigger({type:e,date:o,format:t.proxy((function(t){var e=t||this.o.format;return h.formatDate(n,e,this.o.language)}),this)})},show:function(t){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),this._attachSecondaryEvents(),t&&t.preventDefault(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(t){return new Date(t.getTime()+6e4*t.getTimezoneOffset())},_local_to_utc:function(t){return new Date(t.getTime()-6e4*t.getTimezoneOffset())},_zero_time:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())},_zero_utc_time:function(t){return new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()))},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return this.date},setDate:function(t){this.setUTCDate(this._local_to_utc(t))},setUTCDate:function(t){this.date=t,this.setValue()},setValue:function(){var t=this.getFormattedDate();this.isInput?this.element.val(t).change():this.component&&this.element.find("input").val(t).change()},getFormattedDate:function(t){return void 0===t&&(t=this.o.format),h.formatDate(this.date,t,this.o.language)},setStartDate:function(t){this._process_options({startDate:t}),this.update(),this.updateNavArrows()},setEndDate:function(t){this._process_options({endDate:t}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(t){this._process_options({daysOfWeekDisabled:t}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var e=this.picker.outerWidth(),i=this.picker.outerHeight(),n=s.width(),o=s.height(),a=s.scrollTop(),r=parseInt(this.element.parents().filter((function(){return"auto"!=t(this).css("z-index")})).first().css("z-index"))+10,l=this.component?this.component.parent().offset():this.element.offset(),d=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),c=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),u=l.left,h=l.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(u-=e-c)):(this.picker.addClass("datepicker-orient-left"),l.left<0?u-=l.left-10:l.left+e>n&&(u=n-e-10));var p,f,m=this.o.orientation.y;"auto"===m&&(p=-a+l.top-i,f=a+o-(l.top+d+i),m=Math.max(p,f)===f?"top":"bottom"),this.picker.addClass("datepicker-orient-"+m),"top"===m?h+=d:h-=i+parseInt(this.picker.css("padding-top")),this.picker.css({top:h,left:u,zIndex:r})}},_allow_update:!0,update:function(){if(this._allow_update){var t,e=new Date(this.date),i=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?((t=arguments[0])instanceof Date&&(t=this._local_to_utc(t)),i=!0):(t=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),delete this.element.data().date),this.date=h.parseDate(t,this.o.format,this.o.language),i?this.setValue():t?e.getTime()!==this.date.getTime()&&this._trigger("changeDate"):this._trigger("clearDate"),this.date<this.o.startDate?(this.viewDate=new Date(this.o.startDate),this.date=new Date(this.o.startDate)):this.date>this.o.endDate?(this.viewDate=new Date(this.o.endDate),this.date=new Date(this.o.endDate)):(this.viewDate=new Date(this.date),this.date=new Date(this.date)),this.fill()}},fillDow:function(){var t=this.o.weekStart,e="<tr>";if(this.o.calendarWeeks){var i='<th class="cw">&nbsp;</th>';e+=i,this.picker.find(".datepicker-days thead tr:first-child").prepend(i)}for(;t<this.o.weekStart+7;)e+='<th class="dow">'+u[this.o.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;12>e;)t+='<span class="month">'+u[this.o.language].monthsShort[e++]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(e){e&&e.length?this.range=t.map(e,(function(t){return t.valueOf()})):delete this.range,this.fill()},getClassNames:function(e){var i=[],n=this.viewDate.getUTCFullYear(),o=this.viewDate.getUTCMonth(),s=this.date.valueOf(),a=new Date;return e.getUTCFullYear()<n||e.getUTCFullYear()==n&&e.getUTCMonth()<o?i.push("old"):(e.getUTCFullYear()>n||e.getUTCFullYear()==n&&e.getUTCMonth()>o)&&i.push("new"),this.o.todayHighlight&&e.getUTCFullYear()==a.getFullYear()&&e.getUTCMonth()==a.getMonth()&&e.getUTCDate()==a.getDate()&&i.push("today"),e.valueOf()==s&&i.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&i.push("disabled"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&i.push("range"),-1!=t.inArray(e.valueOf(),this.range)&&i.push("selected")),i},fill:function(){var i,n=new Date(this.viewDate),o=n.getUTCFullYear(),s=n.getUTCMonth(),a=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,r=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,l=1/0!==this.o.endDate?this.o.endDate.getUTCFullYear():1/0,d=1/0!==this.o.endDate?this.o.endDate.getUTCMonth():1/0;this.date&&this.date.valueOf(),this.picker.find(".datepicker-days thead th.datepicker-switch").text(u[this.o.language].months[s]+" "+o),this.picker.find("tfoot th.today").text(u[this.o.language].today).toggle(!1!==this.o.todayBtn),this.picker.find("tfoot th.clear").text(u[this.o.language].clear).toggle(!1!==this.o.clearBtn),this.updateNavArrows(),this.fillMonths();var c=e(o,s-1,28,0,0,0,0),p=h.getDaysInMonth(c.getUTCFullYear(),c.getUTCMonth());c.setUTCDate(p),c.setUTCDate(p-(c.getUTCDay()-this.o.weekStart+7)%7);var f=new Date(c);f.setUTCDate(f.getUTCDate()+42),f=f.valueOf();for(var m,g=[];c.valueOf()<f;){if(c.getUTCDay()==this.o.weekStart&&(g.push("<tr>"),this.o.calendarWeeks)){var v=new Date(+c+(this.o.weekStart-c.getUTCDay()-7)%7*864e5),b=new Date(+v+(11-v.getUTCDay())%7*864e5),y=new Date(+(y=e(b.getUTCFullYear(),0,1))+(11-y.getUTCDay())%7*864e5),w=(b-y)/864e5/7+1;g.push('<td class="cw">'+w+"</td>")}if((m=this.getClassNames(c)).push("day"),this.o.beforeShowDay!==t.noop){var k=this.o.beforeShowDay(this._utc_to_local(c));void 0===k?k={}:"boolean"==typeof k?k={enabled:k}:"string"==typeof k&&(k={classes:k}),!1===k.enabled&&m.push("disabled"),k.classes&&(m=m.concat(k.classes.split(/\s+/))),k.tooltip&&(i=k.tooltip)}m=t.unique(m),g.push('<td class="'+m.join(" ")+'"'+(i?' title="'+i+'"':"")+">"+c.getUTCDate()+"</td>"),c.getUTCDay()==this.o.weekEnd&&g.push("</tr>"),c.setUTCDate(c.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(g.join(""));var C=this.date&&this.date.getUTCFullYear(),x=this.picker.find(".datepicker-months").find("th:eq(1)").text(o).end().find("span").removeClass("active");C&&C==o&&x.eq(this.date.getUTCMonth()).addClass("active"),(a>o||o>l)&&x.addClass("disabled"),o==a&&x.slice(0,r).addClass("disabled"),o==l&&x.slice(d+1).addClass("disabled"),g="",o=10*parseInt(o/10,10);var _=this.picker.find(".datepicker-years").find("th:eq(1)").text(o+"-"+(o+9)).end().find("td");o-=1;for(var S=-1;11>S;S++)g+='<span class="year'+(-1==S?" old":10==S?" new":"")+(C==o?" active":"")+(a>o||o>l?" disabled":"")+'">'+o+"</span>",o+=1;_.html(g)},updateNavArrows:function(){if(this._allow_update){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-1/0&&e<=this.o.startDate.getUTCFullYear()&&i<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&e>=this.o.endDate.getUTCFullYear()&&i>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-1/0&&e<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),1/0!==this.o.endDate&&e>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(i){i.preventDefault();var n=t(i.target).closest("span, td, th");if(1==n.length)switch(n[0].nodeName.toLowerCase()){case"th":switch(n[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var o=h.modes[this.viewMode].navStep*("prev"==n[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,o),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,o),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var s=new Date;s=e(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0),this.showMode(-2);var a="linked"==this.o.todayBtn?null:"view";this._setDate(s,a);break;case"clear":var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.val("").change(),this._trigger("changeDate"),this.update(),this.o.autoclose&&this.hide()}break;case"span":if(!n.is(".disabled")){if(this.viewDate.setUTCDate(1),n.is(".month")){var l=1,d=n.parent().find("span").index(n),c=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(d),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(e(c,d,l,0,0,0,0))}else{c=parseInt(n.text(),10)||0,l=1,d=0;this.viewDate.setUTCFullYear(c),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(e(c,d,l,0,0,0,0))}this.showMode(-1),this.fill()}break;case"td":if(n.is(".day")&&!n.is(".disabled")){l=parseInt(n.text(),10)||1,c=this.viewDate.getUTCFullYear(),d=this.viewDate.getUTCMonth();n.is(".old")?0===d?(d=11,c-=1):d-=1:n.is(".new")&&(11==d?(d=0,c+=1):d+=1),this._setDate(e(c,d,l,0,0,0,0))}}},_setDate:function(t,e){var i;e&&"date"!=e||(this.date=new Date(t)),e&&"view"!=e||(this.viewDate=new Date(t)),this.fill(),this.setValue(),this._trigger("changeDate"),this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&i.change(),!this.o.autoclose||e&&"date"!=e||this.hide()},moveMonth:function(t,e){if(!e)return t;var i,n,o=new Date(t.valueOf()),s=o.getUTCDate(),a=o.getUTCMonth(),r=Math.abs(e);if(e=e>0?1:-1,1==r)n=-1==e?function(){return o.getUTCMonth()==a}:function(){return o.getUTCMonth()!=i},i=a+e,o.setUTCMonth(i),(0>i||i>11)&&(i=(i+12)%12);else{for(var l=0;r>l;l++)o=this.moveMonth(o,e);i=o.getUTCMonth(),o.setUTCDate(s),n=function(){return i!=o.getUTCMonth()}}for(;n();)o.setUTCDate(--s),o.setUTCMonth(i);return o},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.o.startDate&&t<=this.o.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))27==t.keyCode&&this.show();else{var e,i,n,o,s=!1;switch(t.keyCode){case 27:this.hide(),t.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;e=37==t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e),this._trigger("changeMonth",this.viewDate)):((i=new Date(this.date)).setUTCDate(this.date.getUTCDate()+e),(n=new Date(this.viewDate)).setUTCDate(this.viewDate.getUTCDate()+e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),s=!0);break;case 38:case 40:if(!this.o.keyboardNavigation)break;e=38==t.keyCode?-1:1,t.ctrlKey?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e),this._trigger("changeMonth",this.viewDate)):((i=new Date(this.date)).setUTCDate(this.date.getUTCDate()+7*e),(n=new Date(this.viewDate)).setUTCDate(this.viewDate.getUTCDate()+7*e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),s=!0);break;case 13:this.hide(),t.preventDefault();break;case 9:this.hide()}if(s)this._trigger("changeDate"),this.isInput?o=this.element:this.component&&(o=this.element.find("input")),o&&o.change()}},showMode:function(t){t&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+t))),this.picker.find(">div").hide().filter(".datepicker-"+h.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var r=function(e,i){this.element=t(e),this.inputs=t.map(i.inputs,(function(t){return t.jquery?t[0]:t})),delete i.inputs,t(this.inputs).datepicker(i).bind("changeDate",t.proxy(this.dateUpdated,this)),this.pickers=t.map(this.inputs,(function(e){return t(e).data("datepicker")})),this.updateDates()};r.prototype={updateDates:function(){this.dates=t.map(this.pickers,(function(t){return t.date})),this.updateRanges()},updateRanges:function(){var e=t.map(this.dates,(function(t){return t.valueOf()}));t.each(this.pickers,(function(t,i){i.setRange(e)}))},dateUpdated:function(e){var i=t(e.target).data("datepicker").getUTCDate(),n=t.inArray(e.target,this.inputs),o=this.inputs.length;if(-1!=n){if(i<this.dates[n])for(;n>=0&&i<this.dates[n];)this.pickers[n--].setUTCDate(i);else if(i>this.dates[n])for(;o>n&&i>this.dates[n];)this.pickers[n++].setUTCDate(i);this.updateDates()}},remove:function(){t.map(this.pickers,(function(t){t.remove()})),delete this.element.data().datepicker}};var l=t.fn.datepicker;t.fn.datepicker=function(e){var s,l=Array.apply(null,arguments);return l.shift(),this.each((function(){var c=t(this),u=c.data("datepicker"),h="object"==i(e)&&e;if(!u){var p=n(this,"date"),f=o(t.extend({},d,p,h).language),m=t.extend({},d,f,p,h);if(c.is(".input-daterange")||m.inputs){var g={inputs:m.inputs||c.find("input").toArray()};c.data("datepicker",u=new r(this,t.extend(m,g)))}else c.data("datepicker",u=new a(this,m))}return("string"!=typeof e||"function"!=typeof u[e]||void 0===(s=u[e].apply(u,l)))&&void 0})),void 0!==s?s:this};var d=t.fn.datepicker.defaults={autoclose:!1,beforeShowDay:t.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},c=t.fn.datepicker.locale_opts=["format","rtl","weekStart"];t.fn.datepicker.Constructor=a;var u=t.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},h={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return 0==t%4&&0!=t%100||0==t%400},getDaysInMonth:function(t,e){return[31,h.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(t){var e=t.replace(this.validParts,"\0").split("\0"),i=t.match(this.validParts);if(!e||!e.length||!i||0===i.length)throw new Error("Invalid date format.");return{separators:e,parts:i}},parseDate:function(i,n,o){if(i instanceof Date)return i;if("string"==typeof n&&(n=h.parseFormat(n)),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(i)){var s,r=/([\-+]\d+)([dmwy])/,l=i.match(/([\-+]\d+)([dmwy])/g);i=new Date;for(var d=0;d<l.length;d++)switch(f=r.exec(l[d]),s=parseInt(f[1]),f[2]){case"d":i.setUTCDate(i.getUTCDate()+s);break;case"m":i=a.prototype.moveMonth.call(a.prototype,i,s);break;case"w":i.setUTCDate(i.getUTCDate()+7*s);break;case"y":i=a.prototype.moveYear.call(a.prototype,i,s)}return e(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),0,0,0)}l=i&&i.match(this.nonpunctuation)||[],i=new Date;var c,p,f,m={},g=["yyyy","yy","M","MM","m","mm","d","dd"],v={yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){if(isNaN(t))return t;for(e-=1;0>e;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!=e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)}};v.M=v.MM=v.mm=v.m,v.dd=v.d,i=e(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);var b=n.parts.slice();if(l.length!=b.length&&(b=t(b).filter((function(e,i){return-1!==t.inArray(i,g)})).toArray()),l.length==b.length){d=0;for(var y=b.length;y>d;d++){if(c=parseInt(l[d],10),f=b[d],isNaN(c))switch(f){case"MM":p=t(u[o].months).filter((function(){var t=this.slice(0,l[d].length);return t==l[d].slice(0,t.length)})),c=t.inArray(p[0],u[o].months)+1;break;case"M":p=t(u[o].monthsShort).filter((function(){var t=this.slice(0,l[d].length);return t==l[d].slice(0,t.length)})),c=t.inArray(p[0],u[o].monthsShort)+1}m[f]=c}var w,k;for(d=0;d<g.length;d++)(k=g[d])in m&&!isNaN(m[k])&&(w=new Date(i),v[k](w,m[k]),isNaN(w)||(i=w))}return i},formatDate:function(e,i,n){"string"==typeof i&&(i=h.parseFormat(i));var o={d:e.getUTCDate(),D:u[n].daysShort[e.getUTCDay()],DD:u[n].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:u[n].monthsShort[e.getUTCMonth()],MM:u[n].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()};o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;e=[];for(var s=t.extend([],i.separators),a=0,r=i.parts.length;r>=a;a++)s.length&&e.push(s.shift()),e.push(o[i.parts[a]]);return e.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-caret-left"></i></th><th colspan="5" class="datepicker-switch"></th><th class="next"><i class="icon-caret-right"></i></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};h.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+h.headTemplate+"<tbody></tbody>"+h.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+h.headTemplate+h.contTemplate+h.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+h.headTemplate+h.contTemplate+h.footTemplate+"</table></div></div>",t.fn.datepicker.DPGlobal=h,t.fn.datepicker.noConflict=function(){return t.fn.datepicker=l,this},t(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',(function(e){var i=t(this);i.data("datepicker")||(e.preventDefault(),i.datepicker("show"))})),t((function(){t('[data-provide="datepicker-inline"]').datepicker()}))}(window.jQuery)},5550:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,s=(o=i(5))&&o.__esModule?o:{default:o};var a=0,r=t.ItemView.extend({TYPE_DROPDOWN:1,TYPE_CHOSEN:2,ui:{link:"a[data-toggle=dropdown]",menu:".dropdown-menu",chosenSelect:"select.chzn-select"},events:{"click .dropdown-menu li a":"onClick"},chosenIconClass:"",name:"DropdownView",initialize:function(t){this.name||(this.name="Dropdown-"+ ++a),this.chznWidth=t.chznWidth?t.chznWidth:48,this.keyboardShortcut&&this.listenTo(t.keyboard,this.keyboardShortcut,this.onShortcut)},onClose:function(){this.teardown()},teardown:function(){this.isOpen()&&(this.getType()===this.TYPE_DROPDOWN?this.$el.trigger("hidden.bs.dropdown"):this.ui.chosenWidget.trigger("liszt:hiding_dropdown"))},serializeData:function(){var t=this.getType();return n.extend({},this.model?this.model.toJSON():{},{items:n.result(this,"items"),isDropdown:t===this.TYPE_DROPDOWN,isChosen:t===this.TYPE_CHOSEN})},items:[],onRender:function(){var t=n.result(this,"items");t&&t.length?(this.getType()===this.TYPE_DROPDOWN?(s.default.Utils.dropdownEscapeSetup(this.$el,this.name),s.default.Utils.Main.initTooltips(this.ui.link)):(this.ui.chosenWidget=s.default.Utils.Main.chosenWidget(this.ui.chosenSelect,{name:'<i class="'+this.chosenIconClass+' lg"></i><b class="caret"></b>',title:this.ui.chosenSelect.attr("title"),callback:$.proxy(this.select,this),currentValue:this.getCurrentValue()}),this.$(".chzn-container").width(this.chznWidth)),this.highlightCurrentValue()):this.$el.hide()},getCurrentValue:function(){return this.options.currentValue},highlightCurrentValue:function(){var t=this.getCurrentValue();t&&(this.getType()===this.TYPE_DROPDOWN?this.highlightDropdownValue(t):this.highlightChosenValue(t))},highlightDropdownValue:function(t){void 0!==t&&this.ui.menu.find("a[data-id="+t+"]").addClass("active")},highlightChosenValue:function(t){void 0!==t&&(this.ui.chosenWidget.siblings("select").on("liszt:showing_dropdown",n.bind((function(){var e=n.chain(n.result(this,"items")).map((function(t){return parseInt(t.id,10)})).indexOf(parseInt(t,10)).value();this.ui.chosenWidget.find(".chzn-results > li:nth-child("+(e+1)+")").addClass("active")}),this)),this.ui.chosenSelect.val(t))},getType:function(){return(n.result(this,"items")||[]).length<16?this.TYPE_DROPDOWN:this.TYPE_CHOSEN},onClick:function(t){var e=$(t.currentTarget).data("id");this.select(e)},select:function(t){this.trigger("select",t)},onShortcut:function(t){this.disabled||(this.isOpen()||this.openDropdown(),t&&this.$("a[data-id="+t+"]").click())},isOpen:function(){return this.getType()===this.TYPE_DROPDOWN?this.$el.hasClass("open"):this.ui.chosenWidget&&this.ui.chosenWidget.hasClass("chzn-container-active")},closeDropdown:function(){this.isOpen()&&(this.getType()===this.TYPE_DROPDOWN?this.ui.link.click():$("body").click())},openDropdown:function(){this.isOpen()||(this.getType()===this.TYPE_DROPDOWN?this.ui.link.click():this.ui.chosenWidget.find("a:first").trigger("click").trigger("mousedown"))},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1}});e.default=r}).call(this,i(6),i(1))},5552:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=c(i(5)),o=c(i(1)),s=c(i(8)),a=c(i(70)),r=c(i(6)),l=c(i(293)),d=c(i(1561));function c(t){return t&&t.__esModule?t:{default:t}}var u=r.default.ItemView.extend({tag:"div",attributes:function(){var t="control-group custom-field";return this.model.get("required")&&(t+=" required"),{class:t}},ui:{responseInput:".response-input",requiredAsterisk:".js-required-asterisk",savedNotification:".custom-field-saved",errorMessage:'[data-error="error-msg"]'},events:{"blur @ui.responseInput":"onBlur","change @ui.responseInput":"onChange","keyup @ui.responseInput":"onKeyUp"},initialize:function(t){this.ticket=t.ticket||{},this.newConvo=t.newConvo||!1,this.recentSavePromise=s.default.Deferred(),this.responseInputHandler=this.debounce(this.handleResponseInput,500),this.debouncedEmojiHandler=this.debounce(this.handleEmojis,50),this.newConvo&&this.listenTo(this.ticket,"validating",this.validate)},onBlur:function(){this.showSavedNotification()},onKeyUp:function(){this.debouncedEmojiHandler(),this.responseInputHandler()},onChange:function(){this.debouncedEmojiHandler(),this.responseInputHandler()},onRender:function(){this.$el.toggle(this.isShowField()),this.toggleAsterisk(),n.default.Utils.Guard.respondTo("ticket-send",this.respondToSaveConvoRequest,this)},onClose:function(){n.default.Utils.Guard.stopResponding("ticket-send",this.respondToSaveConvoRequest,this),n.default.Utils.Main.clearPromises([this.promise,this.ensureIdPromise,this.savePromise])},isShowField:function(){var t=!!n.default.Utils.LocalStorage.get("custom-field-shown-state",{})[this.model.id];return!this.newConvo||this.model.get("required")||!this.valueIsEmpty()||t},handleResponseInput:function(){this.toggleAsterisk(),this.valueHasChanged()&&(this.ensureIdPromise=App.request("ensure-ticket-id"),this.ensureIdPromise&&this.ensureIdPromise.then(o.default.bind(this.save,this)))},handleEmojis:function(){var t=this.getValue();n.default.Utils.String.containsEmojis(t)&&(this.setValue(n.default.Utils.String.stripEmojis(t)),n.default.Utils.Main.error("Emojis aren't supported in custom fields"))},showSavedNotification:function(){this.newConvo||this.recentSavePromise.promise().then(o.default.bind((function(){this.triggerMethod("before:showSaveNotification"),this.ui.savedNotification.show(),this.triggerMethod("showSaveNotification"),this.setTimeout("hideSaveNotyTimeout",o.default.bind((function(){this.ui.savedNotification.fadeOut(500,o.default.bind((function(){!this.isClosed&&this.triggerMethod("after:showSaveNotification")}),this)),this.recentSavePromise=s.default.Deferred()}),this),2e3)}),this))},respondToSaveConvoRequest:function(t){this.ensureIdPromise=App.request("ensure-ticket-id");var e=s.default.Deferred();return this.ensureIdPromise.then(o.default.bind((function(){this.promise=this.valueHasChanged()?this.save():s.default.Deferred().resolve().promise(),this.promise.then(o.default.bind((function(){this.isResponseRequired(t)?(App.trigger("fields.required"),this.toggleUIValidationNotification(!1),e.reject()):(e.resolve(),this.toggleUIValidationNotification(!0))}),this))}),this)),this.ensureIdPromise.fail((function(){e.reject()})),e.promise()},isResponseRequired:function(t){return t.get("status")==n.default.Constants.Status.CLOSED&&this.model.get("required")&&this.valueIsEmpty()},validate:function(){this.isResponseRequired(this.ticket.thread)?(App.trigger("fields.required"),this.toggleUIValidationNotification(!1)):this.toggleUIValidationNotification(!0)},updateTicketResponses:function(t){var e=this.ticket.get("customFieldResponses"),i=o.default.reject(e,o.default.bind((function(e){return e.fieldId===t.fieldId}),this));i.push(t),this.ticket.set("customFieldResponses",i)},save:function(){var t=this.getValue();return this.valueHasChanged()?(this.savePromise=this.model.save("response",t,{error:function(t,e){n.default.Utils.Ajax.fail(e)}}),this.savePromise.then(o.default.bind((function(){this.updateTicketResponses(this.model.get("response")),this.recentSavePromise.resolve(),this.toggleUIValidationNotification(!0)}),this)),this.savePromise):s.default.Deferred().resolve()},valueHasChanged:function(){var t=this.model.get("response")||"";return this.getValue()!==t},getValue:function(){return this.ui.responseInput.val()},setValue:function(t){this.ui.responseInput.val(t)},valueIsEmpty:function(){return""==this.getValue()},toggleUIValidationNotification:function(t){t||this.ui.responseInput.focus(),this.ui.responseInput.closest(".control-group").toggleClass("error",!t)},toggleAsterisk:function(){this.ui.requiredAsterisk.toggle(this.model.get("required")&&this.valueIsEmpty())},show:function(){this.$el.show();var t=n.default.Utils.LocalStorage.get("custom-field-shown-state",{});return t[this.model.id]=!0,n.default.Utils.LocalStorage.set("custom-field-shown-state",t,{ttl:6e4}),this},focus:function(){this.ui.responseInput.focus()},serializeData:function(){var t=this.model.toJSON();return o.default.extend(t,{inputId:t.name.replace(/\W+/,"-").toLowerCase()})}});a.default.mixin(u,l.default),a.default.mixin(u,d.default);var h=u;e.default=h},5555:function(t,e,i){var n;window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=((n=i(20))&&n.__esModule?n:{default:n}).default.Model.extend({});e.default=o},5557:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(i(5)),s=r(i(5550)),a=r(i(5558));function r(t){return t&&t.__esModule?t:{default:t}}var l=s.default.extend({template:a.default,initialize:function(){s.default.prototype.initialize.apply(this,arguments),this.items=this.options.users},keyboardShortcut:"assign",chosenIconClass:"icon-avatar-lg",select:function(e){if(!this.disabled){e=parseInt(e,10);var i=App.request("get-checked-convo-ids");o.default.Utils.Ajax.post({url:"".concat(hsGlobal.apiPath,"conversations/assign"),params:{ids:i,owner:e},done:$.proxy((function(n){var o=t.find(this.items,(function(t){return t.id==e})),s=o?o.title:"",a=o?o.type:"",r=i.length>1?"conversations":"conversation";if(n&&n.growl)l=n.growl;else var l=i.length+" "+r+" assigned to "+s;this.trigger("updated",l,i,e,s,a)}),this),fail:function(t){try{json=n.parseJSON(t.responseText)}catch(e){console.error(e)}json&&json.alerts&&o.default.Utils.Main.error(json.alerts.join("\n")),json&&json.growl&&o.default.Utils.Main.flash(json.growl)}}),this.trigger("action")}}});e.default=l}).call(this,i(1),i(8))},5558:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <select id="assign-select" name="ownerId" class="chzn-select" data-placeholder="Assign" title="Assign (a)">\n        <option value=""></option>\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?s:"")+"    </select>\n"},2:function(t,e,n,s,a){var r,l=t.lambda,d=t.escapeExpression,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+d(l(null!=e?u(e,"id"):e,e))+'" title="'+d(l(null!=e?u(e,"title"):e,e))+'"'+(null!=(r=o(i(10)).call(c,null!=e?u(e,"type"):e,"==","4",{name:"ifCond",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:5,column:52},end:{line:5,column:140}}}))?r:"")+">"+(null!=(r=o(i(10)).call(c,null!=e?u(e,"type"):e,"==","4",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:5,column:141},end:{line:5,column:183}}}))?r:"")+d(l(null!=e?u(e,"title"):e,e))+"</option>\n"},3:function(t,e,i,n,o){return' class="teams-option" data-wrap-class="option-title"'},5:function(t,e,i,n,o){return"Team: "},7:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <a class="dropdown-toggle" id="assignTrig" data-toggle="dropdown" href="#assignMenu" rel="tooltip" aria-label="assign" data-placement="bottom" data-original-title="Assign (a)"><i class="icon-avatar-lg"></i><b class="caret"></b></a>\n    <div id=\'assign-dd\' class="dropdown-menu" role="menu">\n        <ul class="assignMenu">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:12},end:{line:14,column:21}}}))?s:"")+"        </ul>\n    </div>\n"},8:function(t,e,n,s,a){var r,l=t.lambda,d=t.escapeExpression,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <li data-id="'+d(l(null!=e?u(e,"id"):e,e))+'" title="'+d(l(null!=e?u(e,"title"):e,e))+'"'+(null!=(r=o(i(10)).call(c,null!=e?u(e,"type"):e,"==","4",{name:"ifCond",hash:{},fn:t.program(9,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:54},end:{line:13,column:111}}}))?r:"")+'><a data-id="'+d(l(null!=e?u(e,"id"):e,e))+'" aria-label="'+d(l(null!=e?u(e,"title"):e,e))+'" href="javascript:void(0);"><span class="option-title">'+(null!=(r=o(i(10)).call(c,null!=e?u(e,"type"):e,"==","4",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:209},end:{line:13,column:251}}}))?r:"")+d(l(null!=e?u(e,"title"):e,e))+"</span></a></li>\n"},9:function(t,e,i,n,o){return' class="teams-option"'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isChosen"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:1,column:0},end:{line:17,column:7}}}))?s:""},useData:!0})},5559:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(5550)),s=a(i(5560));function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.extend({template:s.default,name:"Status",keyboardShortcut:"status",initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.isSpam,i=void 0!==e&&e;return Object.assign(this,{isSpam:i}),o.default.prototype.initialize.apply(this,arguments)},items:function(){return this.isSpam?[{id:1,title:"Not Spam"}]:[{id:1,title:"Active"},{id:2,title:"Pending"},{id:3,title:"Closed"},{id:4,title:"Spam"}]},select:function(e){if(!this.disabled){var i=App.request("get-checked-convo-ids");n.default.Utils.Ajax.post({url:["actions",this.options.memberId,"convos",e],done:$.proxy((function(n){var o=i.length>1?"conversations":"conversation",s=t.findWhere(this.items,{id:e});if(n&&n.growl)a=n.growl;else if(s)var a=i.length+" "+o+" marked as "+s.title+".";this.trigger("updated",a,i,e)}),this),fail:function(t){t&&t.growl&&n.default.Utils.Main.flash(t.growl)},params:{ids:i,status:e}}),this.trigger("action")}}});e.default=r}).call(this,i(1))},5560:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <li data-id="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:5,column:25},end:{line:5,column:31}}}):s)+'"><a data-id="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:5,column:45},end:{line:5,column:51}}}):s)+'" aria-label="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:5,column:65},end:{line:5,column:74}}}):s)+'" href="javascript:void(0);">'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:5,column:103},end:{line:5,column:112}}}):s)+"</a></li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a class="dropdown-toggle" id="statusTrig" data-toggle="dropdown" href="#statusMenu" aria-label="status" rel="tooltip" data-placement="bottom" data-original-title="Status (s)"><i class="icon-flag lg"></i><b class="caret"></b></a>\n<div id=\'status-dd\' class="dropdown-menu" role="menu">\n    <ul class="statusMenu">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?s:"")+"    </ul>\n</div>\n"},useData:!0})},5561:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<h2>Move to mailbox "'+t.escapeExpression("function"==typeof(s=null!=(s=a(i,"title")||(null!=e?a(e,"title"):e))?s:t.hooks.helperMissing)?s.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:o,loc:{start:{line:1,column:21},end:{line:1,column:30}}}):s)+'"</h2>\n\n<p class="t-tx-charcoal-400">You are about to move your conversation to another mailbox.<br>\nDoing so will <b>remove this conversation\'s custom field data</b>.</p>'},useData:!0})},5562:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(5550)),s=a(i(5563));function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.extend({template:s.default,initialize:function(){o.default.prototype.initialize.apply(this,arguments),this.mailboxId=this.options.mailboxId,this.workflows=this.options.workflows||[],App.off("WorkflowIframe:applyWorkflow"),this.listenTo(App,"WorkflowIframe:applyWorkflow",this.doApplyWorkflow)},name:"Workflows",keyboardShortcut:"workflows",chosenIconClass:"icon-workflow-lg",onClose:function(){o.default.prototype.onClose.apply(this,arguments)},items:function(){var e=t.clone(this.workflows);return t.each(e,(function(t){t.title||(t.title=t.name)})),this.options.removeFromFolderLink&&e.push({divider:!0},{id:-1,title:"Remove from Folder"}),e},setData:function(t,e){this.workflows=e,this.mailboxId!=t&&(this.mailboxId=t,this.teardown(),this.render())},select:function(e){-1!=e?"separator"!=e&&"undefined"!=e&&void 0!==e&&(e=parseInt(e,10),t.findWhere(this.workflows,{id:e}).needsConfirm?n.default.Utils.Main.popup({href:hsGlobal.path+"workflow/confirm-popup/"+this.mailboxId+"/"+e+"/multi/",title:"Run Manual Workflow",width:650,height:505,margin:0,padding:0}):this.doApplyWorkflow({workflowId:e}),this.closeDropdown()):App.trigger("remove-from-folder",App.request("get-checked-convo-ids"))},doApplyWorkflow:function(e){var i=e.workflowId,o={ids:App.request("get-checked-convo-ids")};(e.email||e.forward||e.note)&&(o=t.extend(o,{email:e.email?e.email:null,forward:e.forward?e.forward:null,note:e.note?e.note:null})),this.closeDropdown(),n.default.Utils.Ajax.post({url:["actions",this.options.memberId,"workflows",i],params:o,done:$.proxy((function(t){var e="";t&&t.growl&&(e=t.growl),n.default.Utils.Main.cursorDefault(),this.trigger("updated",e)}),this),fail:function(t){t&&t.growl&&n.default.Utils.Main.error(t.growl),n.default.Utils.Main.cursorDefault()}}),n.default.Utils.Main.popupClose(),n.default.Utils.Main.cursorLoading(),this.trigger("action")}});e.default=r}).call(this,i(1))},5563:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <select id="workflow-select" class="chzn-select" data-placeholder="Workflow" title="Workflow (w)">\n        <option value=""></option>\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?s:"")+"    </select>\n"},2:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:5,column:27},end:{line:5,column:33}}}):s)+'">'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:5,column:35},end:{line:5,column:44}}}):s)+"</option>\n"},4:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <a class="dropdown-toggle" id="workflowTrig" data-toggle="dropdown" href="#workflowMenu" rel="tooltip" data-placement="bottom" data-original-title="Workflow (w)"><i class="icon-workflow-lg"></i><b class="caret"></b></a>\n    <div id=\'workflow-dd\' class="dropdown-menu" role="menu">\n        <ul class="workflowMenu">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:12},end:{line:18,column:21}}}))?s:"")+"        </ul>\n    </div>\n"},5:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"divider"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:13,column:16},end:{line:17,column:23}}}))?s:""},6:function(t,e,i,n,o){return'                    <li class="divider"></li>\n'},8:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <li data-id="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:16,column:33},end:{line:16,column:39}}}):s)+'"><a data-id="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:16,column:53},end:{line:16,column:59}}}):s)+'" href="javascript:void(0);">'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:16,column:88},end:{line:16,column:97}}}):s)+"</a></li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isChosen"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:1,column:0},end:{line:21,column:7}}}))?s:""},useData:!0})},5575:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.trackSampleConvo=void 0;var n=i(153);function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?Object(arguments[e]):{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach((function(e){s(t,e,i[e])}))}return t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t){var e=t.customer.get("email"),i=t.tags.first();return"help@helpscout.com"===e&&!(!i||"welcome"!==i.get("slug"))}e.trackSampleConvo=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};hsGlobal.isTrialAccount&&a(t)&&(0,n.trackWithMember)(e,o({ticketId:t.id,subject:t.get("subject")},i))}},5576:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(5)),o=l(i(1)),s=l(i(5595)),a=l(i(5597)),r=l(i(364));function l(t){return t&&t.__esModule?t:{default:t}}var d=l(i(6)).default.CollectionView.extend({tagName:"ul",className:"attachments",itemView:s.default,itemViewOptions:function(){return{mailboxSlug:this.options.mailboxSlug,memberId:this.options.memberId,thread:this.thread,ticket:this.ticket}},initialize:function(){o.default.bindAll(this,"attachmentUploaded","uploaderOnSubmit","onError"),this.ticket=this.options.ticket,this.thread=this.options.thread,this.customer=this.options.customer},getEndpoint:function(){return n.default.Utils.Main.url(hsGlobal.path,["file","action",this.options.mailboxSlug,this.options.memberId,this.ticket.get("number"),this.thread.get("id")])},onShow:function(){!1!==this.options.upload&&(this.initUploader(),this.listenTo(this.ticket,"destroy",this.stopInProgress),this.listenTo(this.thread,"destroy",this.stopInProgress))},onClose:function(){this.stopInProgress()},initUploader:function(){var t=this;n.default.Utils.Main.isMobileDevice()&&this.options.uploaderEl.hide(),this.uploader=new a.default.FineUploader({element:this.options.uploaderEl[0],debug:!1,validation:{sizeLimit:n.default.Constants.uploads.maxSize},listElement:this.$el[0],request:{inputName:"qqfile",endpointCallback:function(){return t.getEndpoint()},forceMultipart:!1},text:{dropProcessing:"",retry:"",retryButton:""},retry:{showAutoRetryNote:!1,autoRetryNote:"test",showButton:!1,preventRetryResponseProperty:!0,maxAutoAttempts:0,autoAttemptDelay:0},callbacks:{onComplete:this.attachmentUploaded,onSubmit:this.uploaderOnSubmit,onError:this.onError},showMessage:function(t){return n.default.Utils.Main.error(t)}}),n.default.Utils.Main.initTooltips(this.options.uploaderEl.find(".qq-upload-button").attr("title","Upload Attachments").data("placement","bottom"))},hideDropzone:function(){this.uploader._dnd.disableDropzone()},showDropzone:function(){this.uploader._dnd.enableDropzone()},attachmentUploaded:function(t,e,i){var n=this.uploader.getItemByFileId(t);(0,a.default)(n).remove(n),i.attachment&&this.collection.add(new r.default(i.attachment)),0==this.uploader.getInProgress()&&(App.trigger("TicketPanel:unlock"),this.isBusy=!1)},uploaderOnSubmit:function(t,e,i){this.isBusy=!0,this.trigger("upload",i)},stopInProgress:function(){this.uploader&&this.uploader.getInProgress()>0&&(App.trigger("TicketPanel:unlock"),this.aborting=!0,this.uploader._handler.cancelAll(),delete this.aborting,this.uploader.reset())},onError:function(t,e,i){if(!this.aborting){App.trigger("TicketPanel:unlock");var o="XHR returned response code";"Upload failure reason unknown"!==i&&i.substring(0,o.length)!==o||n.default.Utils.Main.error("Unable to upload attachment ".concat(e))}}});e.default=d},5591:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(6)),o=s(i(5592));function s(t){return t&&t.__esModule?t:{default:t}}var a=n.default.ItemView.extend({template:o.default,initialize:function(){this.listenTo(this.model,"change",this.render)}});e.default=a},5592:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div id="ticketViewing" class="view-reply">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"viewing"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:8},end:{line:9,column:17}}}))?s:"")+"    </div>\n\n"},2:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"photoUrl"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:4,column:12},end:{line:8,column:19}}}))?s:""},3:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <img src="'+l("function"==typeof(s=null!=(s=d(i,"photoUrl")||(null!=e?d(e,"photoUrl"):e))?s:r)?s.call(a,{name:"photoUrl",hash:{},data:o,loc:{start:{line:5,column:26},end:{line:5,column:38}}}):s)+'" alt="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:5,column:45},end:{line:5,column:54}}}):s)+'" title="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:5,column:63},end:{line:5,column:72}}}):s)+' is viewing">\n'},5:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <div class="no-photo" title="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:7,column:45},end:{line:7,column:54}}}):s)+' is viewing">'+l("function"==typeof(s=null!=(s=d(i,"initials")||(null!=e?d(e,"initials"):e))?s:r)?s.call(a,{name:"initials",hash:{},data:o,loc:{start:{line:7,column:67},end:{line:7,column:79}}}):s)+"</div>\n"},7:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div id="ticketEditing" class="view-reply reply">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"replying"):e,{name:"each",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:8},end:{line:21,column:17}}}))?s:"")+"    </div>\n"},8:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"photoUrl"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:16,column:12},end:{line:20,column:19}}}))?s:""},9:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <img class="reply" src="'+l("function"==typeof(s=null!=(s=d(i,"photoUrl")||(null!=e?d(e,"photoUrl"):e))?s:r)?s.call(a,{name:"photoUrl",hash:{},data:o,loc:{start:{line:17,column:40},end:{line:17,column:52}}}):s)+'" alt="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:17,column:59},end:{line:17,column:68}}}):s)+'" title="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:17,column:77},end:{line:17,column:86}}}):s)+' is replying">\n'},11:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <div class="reply no-photo" title="'+l("function"==typeof(s=null!=(s=d(i,"title")||(null!=e?d(e,"title"):e))?s:r)?s.call(a,{name:"title",hash:{},data:o,loc:{start:{line:19,column:51},end:{line:19,column:60}}}):s)+' is replying">'+l("function"==typeof(s=null!=(s=d(i,"initials")||(null!=e?d(e,"initials"):e))?s:r)?s.call(a,{name:"initials",hash:{},data:o,loc:{start:{line:19,column:74},end:{line:19,column:86}}}):s)+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=r(i,"if").call(a,null!=(s=null!=e?r(e,"viewing"):e)?r(s,"length"):s,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:12,column:7}}}))?s:"")+(null!=(s=r(i,"if").call(a,null!=(s=null!=e?r(e,"replying"):e)?r(s,"length"):s,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:0},end:{line:23,column:7}}}))?s:"")},useData:!0})},5593:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=m(i(5)),o=m(i(1)),s=m(i(8)),a=m(i(70)),r=m(i(6)),l=m(i(231)),d=m(i(293)),c=m(i(559)),u=m(i(191)),h=m(i(5594)),p=m(i(5576)),f=m(i(5598));i(5602);i(275);function m(t){return t&&t.__esModule?t:{default:t}}var g=(0,u.default)(),v=r.default.Layout.extend({tagName:"section",template:h.default,regions:{attachmentsRegion:".js-attachments-region",replySendContainer:".js-reply-send"},ui:{draftGrowl:"#draftGrowl",attachments:".attachments",uploader:".uploader",wysi:".wysi",hsWysiwyg:".hs-wysiwyg",save:".redactor_toolbar a.saveDraft",mentions:".redactor_toolbar a.mentions",footer:".footer",replySend:".js-reply-send",status:"#status",owner:"#owner",signature:".js-signature"},events:{"change @ui.status":"saveLocal","change @ui.owner":"saveLocal","click @ui.save":"onSaveClick","click @ui.mentions":"onMentionsClick","click a#cancelTicket":"onDeleteClick","click @ui.signature":"onSignatureClick"},initialize:function(t){o.default.bindAll(this,"detectClose","trackMouseMoves","dialogClosed","onFileClick"),this.viewStartTime=t.viewStartTime,this.parent=t.parent,this.ticket=this.options.ticket,this.thread=this.options.thread,this.listenTo(this.thread,"change",this.onThreadChange),this.listenTo(this.thread,"sync",this.savedGrowl),this.listenTo(this.ticket,"sync",this.savedGrowl),this.imagesUploading=0,this.listenTo(c.default,"down",this.onConnectionLost),this.listenTo(c.default,"up",this.onConnectionBack),this.listenTo(l.default,"docssearch:insert-link",this.insertDocsLink),this.listenTo(l.default,"docssearch:insert-content",this.insertDocsContent)},onShow:function(){this.initWysiView(),this.initAttachments(),this.initChosen(),this.bindUIElements(),this.createSendButton(),this.ui.save.toggle(this.isShowSave()),this.setTimeout((function(){var t=this.getDraftData();this.setDataCache(t),this.lastSyncedData=t}))},onClose:function(){this.wysiView.close(),this.attachmentManager&&this.attachmentManager.close(),this.stopTimer(),n.default.Utils.Main.abort(this.savingPromise),this.thread.abortSync()},serializeData:function(){return o.default.extend(this.options,{users:o.default.map(this.options.users,(function(t){return t.type==n.default.Constants.userType.TEAM?o.default.extend({},t,{title:"Team: ".concat(t.title)}):t})),ticket:this.ticket.toJSON(),thread:this.thread.toJSON(),ownerId:this.getOwnerId(),status:this.getStatus(),canEditConversationDetails:hsGlobal.memberPermissions.editConversationDetails})},getStatus:function(){return this.thread.isNote()?n.default.Constants.Status.ACTIVE:l.default.data.get("mailbox.ticketStatus")},getOwnerId:function(){if(this.thread.isNote())return this.ticket.get("ownerId");var t=l.default.data.get("mailbox.ticketAssignee");return t==n.default.Constants.ticketAssign.PERSON_REPLYING||t==n.default.Constants.ticketAssign.PERSON_REPLYING_UNASSIGNED&&this.ticket.get("ownerId")===n.default.Constants.ticketOwner.ANYONE?l.default.data.get("member.id"):this.ticket.get("ownerId")},createSendButton:function(){this.replySendButton=new f.default({model:this.thread,ticket:this.ticket}),this.replySendContainer.show(this.replySendButton),this.listenTo(this.replySendButton,"submit",this.submit)},onThreadChange:function(){this.changeImageUploadUrl()},isShowSave:function(){return!this.thread.isNote()||this.ticket.isDraft()},initWysiView:function(){var t={imageUploadCallback:o.default.bind(this.onRedactorImageUploadComplete,this),imageUploadErrorCallback:o.default.bind(this.onRedactorImageUploadComplete,this),imageLinkInsertCallback:o.default.bind(this.imageLinkInsertCallback,this),blurCallback:o.default.bind(this.onRedactorBlur,this),focusCallback:o.default.bind(this.onRedactorFocus,this)};this.wysiView=new g({el:this.ui.wysi,textareaName:this.options.textareaName||"reply",content:this.thread.get("body"),saveDelete:!0,type:this.thread.get("type"),showSave:this.isShowSave(),savedReplies:this.options.savedReplies,mailboxId:this.options.mailboxId,ticket:this.ticket,attachments:!0,insertHtml:!0,images:!0,redactorOptions:t,useMentions:this.shouldUseMentions(),mentionNames:this.options.mentionNames}).render(),n.default.Utils.Main.isMobileDevice()||(this.changeImageUploadUrl(),this.modifyRedactorImageUpload()),this.listenTo(this.wysiView,"attachment",(function(){this.$("input[type=file]").trigger("click")})),this.listenTo(this.wysiView,"saveDraft",(function(){this.$("a.saveDraft").trigger("click")})),this.listenTo(this.wysiView,"submit",(function(){this.replySendButton.sendDefaultClick()})),this.debounceSaveLocal(1)},onMentionsClick:function(t){t&&t.preventDefault(),this.wysiView.triggerMentionsAutocomplete()},debounceSaveLocal:function(t){var e=n.default.Utils.LocalStorage.writeSpeed||1;t=t||1,this.stopListening(this.wysiView,"change");var i=e+t;if(i<70){var s=10*i,a=o.default.debounce(this.saveLocal,s);this.listenTo(this.wysiView,"change",a)}},initAttachments:function(){this.attachmentManager=new p.default({uploaderEl:this.ui.uploader,collection:this.thread.attachments,mailboxId:this.options.mailboxId,mailboxSlug:this.options.mailboxSlug,memberId:this.options.memberId,thread:this.thread,ticket:this.ticket}),this.attachmentsRegion.show(this.attachmentManager),this.listenTo(this.attachmentManager,"upload",this.ensureThreadForUpload),this.monitorFileDialogInStack(),this.listenTo(this.attachmentManager,"reset",this.monitorFileDialogInStack)},initChosen:function(){n.default.Utils.Main.chosenInline(this.ui.owner)},modifyRedactorImageUpload:function(){n.default.Utils.Main.isMobileDevice()||(this.hideDropzoneWhenRedactorModalShown(),this.ensureThreadBeforeRedactorUpload("pasteClipboardUpload"),this.ensureThreadBeforeRedactorUpload("pasteClipboardUploadMozilla"),this.ensureThreadBeforeRedactorUpload("uploadSubmit"),this.ensureThreadBeforeRedactorUpload("dragUploadAjax",o.default.bind((function(t){return t.length&&o.default.isString(t[0])&&(t[0]=this.getImageUploadUrl()),t}),this)))},hideDropzoneWhenRedactorModalShown:function(){var t=this,e=this.wysiView.getRedactorProperty("modalInit");this.wysiView.setRedactorProperty("modalInit",(function(){t.attachmentManager.hideDropzone(),e.apply(this,arguments)}));var i=this.wysiView.getRedactorProperty("modalClose");this.wysiView.setRedactorProperty("modalClose",(function(){t.attachmentManager.showDropzone(),i.apply(this,arguments)}))},ensureThreadBeforeRedactorUpload:function(t,e){var i=this,n=this.wysiView.getRedactorInstance(),s=this.wysiView.getRedactorProperty(t);if(!s.modified){var a=function(){var t=o.default.toArray(arguments);i.ensureThreadForUpload((function(){i.imagesUploading++,e&&(t=e(t)),s.apply(n,t)}))};a.modified=!0,this.wysiView.setRedactorProperty(t,a)}},ensureThreadForUpload:function(t){this.replySendButton.lock('Uploading Attachments and Sending... <a id="cancel-send" href="javascript:void(0);">Cancel Send</a>'),this.thread.get("id")>0?t():this.save().then((function(){t()}))},onRedactorImageUploadComplete:function(t){this.imagesUploading--,this.isBusy()||this.replySendButton.unlock(),y(t),this.wysiView.getRedactorInstance().modalClose()},imageLinkInsertCallback:function(t){t.one("load",this.limitImageSize),this.limitImageSize.call(t),t.on("error",(function(){y({error:"The URL provided is not a valid image."}),t.remove()}))},limitImageSize:function(){var t=(0,s.default)(this);t.width()>600?(t.css("width",600),t.height()>800&&t.css("width","auto").css("height",800)):t.height()>800&&(t.css("height",800),t.width()>600&&t.css("height","auto").css("width",600))},getImageUploadUrl:function(t){var e={threadId:this.thread.get("id")},i="".concat(hsGlobal.path,"file/embed/image?");return t&&(e.encoded=!0),i+s.default.param(e)},changeImageUploadUrl:function(){if(!n.default.Utils.Main.isMobileDevice()){this.wysiView.setRedactorOption("clipboardUploadUrl",this.getImageUploadUrl(!0));var t=this.getImageUploadUrl();this.wysiView.setRedactorOption("imageUpload",t);var e=this.wysiView.getRedactorProperty("uploadOptions");e&&(e.url=t)}},onDeleteClick:function(t){t.preventDefault(),this.showDiscardDraftModal()},showDiscardDraftModal:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.confirmCb,o=void 0===i?function(){}:i,s=e.cancelCb,a=void 0===s?function(){}:s;if(this.hasContent()){var r="Discard this draft?";return n.default.Utils.Main.confirm(r,(function(){t.doDelete(),o()}),(function(){t.wysiView.focus(!0),a()}),{ok:"Yes"})}this.doDelete()},onSignatureClick:function(t){t&&t.preventDefault(),this.wysiView.focus(!0)},savedGrowl:function(){this.ui.draftGrowl.show().delay(5e3).fadeOut(3e3),this.ui.save.addClass("active"),this.setTimeout("growl",(function(){this.ui.save.removeClass("active")}),6500)},stopTimer:function(){return this.clearInterval("autoSave"),this},startTimer:function(){return this.setInterval("autoSave",this.autoSaveThread,3e4),this},onRedactorBlur:function(){this.stopTimer();var t=this.getText(),e=o.default.bind((function(t){var e=this.isClosed?t:this.getText();this.thread.set("body",e)}),this,t);this.savingPromise?this.savingPromise.always(e):e(),this.thread.isNote()?this.doSaveLocal(this.getDraftData()):this.setTimeout(this.autoSaveThread,300)},onRedactorFocus:function(){this.startTimer()},doAutoSave:function(t,e){return this.hasContent()&&!this.isBusy()&&!this.dataIsEqual(t,e)},autoSaveThread:function(){var t=this.getDraftData();if(this.doAutoSave(t,this.dataCache))return this.save(t)},dataIsEqual:function(t,e){var i=n.default.Utils.Main.unsetUndefinedAttrs(o.default.clone(t)),s=n.default.Utils.Main.unsetUndefinedAttrs(o.default.clone(e));return o.default.isEqual(i,s)},setDataCache:function(t){this.dataCache=t},isBusy:function(){return this.savingPromise||this.submittingPromise||this.imagesUploading>0||this.attachmentManager&&this.attachmentManager.isBusy},save:function(t){var e;return this.syncEditorData(),e=(t=t||this.getDraftData())?c.default.isUp()?this.saveAjax(t):this.saveLocal():s.default.Deferred().resolve().promise(),this.savingPromise=e,e.always(s.default.proxy(this.onSaveAlways,this,e)).fail(s.default.proxy(this.onSaveFail,this,t)),e},getLocalDraftId:function(){return this.ticket.getLocalStorageDraftKey()},doSaveLocal:function(t){this.hasContent()?n.default.Utils.Main.setLocalDraft(this.getLocalDraftId(),{timestamp:1*new Date,data:t}):n.default.Utils.Main.clearLocalDraft(this.getLocalDraftId())},saveLocal:function(){if(!this.isClosed&&!this.savingPromise){var t=new Date,e=this.getDraftData(),i=new Date-t;return this.doSaveLocal(e),this.debounceSaveLocal(i),(new s.default.Deferred).resolve(e).promise()}},deleteLocalDraft:function(){n.default.Utils.Main.clearLocalDraft(this.getLocalDraftId())},getLocalDraft:function(){var t=n.default.Utils.Main.getLocalDraft(this.getLocalDraftId());return t?t.data:void 0},saveAjax:function(t){return this.setDataCache(t),!this.replySendButton.isLocked()&&this.replySendButton.lock(),this.savingPromise=this.doSave(t),this.savingPromise},onSaveAlways:function(t){t===this.savingPromise&&delete this.savingPromise,this.$el&&this.$el.length&&s.default.contains(document,this.$el[0])&&(this.isBusy()||this.replySendButton.unlock())},onSaveFail:function(){delete this.dataCache,c.default.check()},onSync:function(){this.lastSyncedData=this.getDraftData(),this.deleteLocalDraft()},cleanUpLocalDraft:function(){var t=this.getLocalDraft();t&&!this.dataIsEqual(t,this.lastSyncedData)||this.deleteLocalDraft()},onSubmitFail:function(){delete this.dataCache,c.default.check(),!this.isClosed&&this.replySendButton.cancel()},submit:function(t){this.syncEditorData(),this.checkMissingAttachment((function(){if(this.hasContent()&&!c.default.isUp()){this.saveLocal();var e=o.default.bind((function(){this.stopListening(c.default,"up",e),this.stopListening(c.default,"down",i),this.executeSubmit(t)}),this),i=o.default.bind((function(){this.stopListening(c.default,"up",e),this.stopListening(c.default,"down",i)}),this);this.listenToOnce(c.default,"up",e),this.listenToOnce(c.default,"down",i),c.default.check()}else this.executeSubmit(t)}),(function(){this.replySendButton.cancel()}))},executeSubmit:function(t){var e=this.doSubmit(t);this.submittingPromise=e,e&&e.always&&e.always(o.default.bind((function(){this.submittingPromise===e&&delete this.submittingPromise}),this))},insertDocsLink:function(t){var e;e=n.default.Utils.Main.isMobileDevice()?t.url:'<a href="'.concat(t.url,'">').concat(t.name,"</a>"),this.wysiView.restoreSelection().addText(e)},insertDocsContent:function(t){var e,i=t.get("text");e=n.default.Utils.Main.isMobileDevice()?n.default.Utils.Main.stripTags(i):i,this.wysiView.restoreSelection().addText(e)},getText:function(){return this.wysiView.getText()},hasText:function(){return this.wysiView.hasText()},getEditorMode:function(){return this.wysiView.getEditorMode()},monitorFileDialogInStack:function(){this.clearTimeout("detectClose"),this.$("input[type=file]").off("click",this.onFileClick).on("click",this.onFileClick)},dialogClosed:function(){(0,s.default)(document).unbind("click keyup keydown keypress",this.dialogClosed).unbind("mousemove",this.trackMouseMoves),this.$("input[type=file]").unbind("change",this.dialogClosed),n.default.stack.closed("File-Dialog")},trackMouseMoves:function(t){this.mouseMoveCounter++,this.mouseMoveCounter>50&&this.dialogClosed(t)},onFileClick:function(){this.$(".tooltip").remove(),this.mouseMoveCounter=0,n.default.stack.opened("File-Dialog",this.dialogClosed),this.setTimeout("detectClose",this.detectClose,200)},detectClose:function(){(0,s.default)(document).bind("mousemove",this.trackMouseMoves).bind("click keyup keydown keypress",this.dialogClosed),this.$("input[type=file]").bind("change",this.dialogClosed)},onConnectionBack:function(){var t=n.default.Utils.Main.getLocalDraft(this.getLocalDraftId());t&&t.data&&!this.hasContent()&&this.saveAjax(t.data),n.default.Utils.Main.clearLocalDraft(this.getLocalDraftId())},onConnectionLost:function(){this.hasContent()&&this.saveLocal()},syncEditorData:function(){var t,e;!this.isClosed&&this.$el.length&&s.default.contains(document,this.$el[0])&&(this.thread.set({body:this.getText(),status:parseInt(null!==(t=this.ui.status.val())&&void 0!==t?t:this.getStatus(),10),owner:parseInt(null!==(e=this.ui.owner.val())&&void 0!==e?e:this.getOwnerId(),10),savedReplyID:this.wysiView.getSavedReplyIds(),editorMode:this.getEditorMode()}),l.default.trigger("sync-ui-to-ticket"))},checkMissingAttachment:function(t,e){var i,s,a=this.getText().match(/see attached|see attachment|see included|is attached|attached is|are attached|attached are|attached to this email|attached to this message|I'm attaching|I am attaching|I've attached|I have attached|I attach|I attached|find attached|find the attached|find included|find the included|attached file|see the attached|see attachments|attached files|see the attachment/i);return!this.hasAttachments()&&a&&a.length>0?(this.thread.isNote()?(i='You wrote "'.concat(a[0],'" but there are no files attached. Add your note anyway?'),s="Add Note"):(i='You wrote "'.concat(a[0],'" but there are no files attached. Send your message anyway?'),s="Send Reply"),n.default.Utils.Main.confirm(i,o.default.bind(t,this),o.default.bind(e,this),{ok:s})):t.apply(this)},hasAttachments:function(){var t=this.ui.attachments;return t&&t.children(":visible").length>0},getDraftData:function(){return this.syncEditorData(),this.doGetDraftData()},shouldUseMentions:function(){return hsGlobal.memberPermissions.mentionOthersInConversations&&(this.thread.isNote()||this.thread.isPhone()&&this.options.mentionsEnabled&&this.options.mentionNames&&this.options.mentionNames.length>0)},canEditThreads:function(){return!0},doGetDraftData:function(){},hasContent:function(){},doSave:function(){},doSubmit:function(){},doDelete:function(){}});a.default.mixin(v,d.default);var b=v;function y(t){t&&t.hasOwnProperty("error")&&n.default.Utils.Main.error(t.error)}e.default=b},5594:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,n,s,a){var r,l=null!=e?e:t.nullContext||{},d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <section class="statusBar">\n                <ul class="status">\n                    <li class="tkStatus">\n                        <label for="status">Status:</label>\n                        <select id="status" name="status">\n                            <option value="1" '+(null!=(r=o(i(10)).call(l,null!=e?d(e,"status"):e,"==",1,{name:"ifCond",hash:{},fn:t.program(2,a,0),inverse:t.noop,data:a,loc:{start:{line:18,column:46},end:{line:18,column:101}}}))?r:"")+'>Active</option>\n                            <option value="2" '+(null!=(r=o(i(10)).call(l,null!=e?d(e,"status"):e,"==",2,{name:"ifCond",hash:{},fn:t.program(2,a,0),inverse:t.noop,data:a,loc:{start:{line:19,column:46},end:{line:19,column:101}}}))?r:"")+'>Pending</option>\n                            <option value="3" '+(null!=(r=o(i(10)).call(l,null!=e?d(e,"status"):e,"==",3,{name:"ifCond",hash:{},fn:t.program(2,a,0),inverse:t.noop,data:a,loc:{start:{line:20,column:46},end:{line:20,column:101}}}))?r:"")+'>Closed</option>\n                        </select>\n                    </li>\n                    <li class="tkAssign">\n                        <label for="owner">Assign to:</label>\n                        <select id="owner" name="owner">\n                            '+t.escapeExpression(o(i(243)).call(l,null!=e?d(e,"users"):e,null!=e?d(e,"ownerId"):e,{name:"options",hash:{},data:a,loc:{start:{line:26,column:28},end:{line:26,column:53}}}))+"\n                        </select>\n                    </li>\n                </ul>\n            </section>\n"},2:function(t,e,i,n,o){return'selected="selected"'},4:function(t,e,i,n,o){return'<span class="help-block" data-error="body"></span>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="js-attachments-region"></div>\n<section class="hs-wysiwyg">\n    <div class="uploader"></div>\n    <section class="wysi"></section>\n    <div class="footer">\n        <section id="signature" class="js-signature">\n            <div id="sigHelp">\n                '+(null!=(s=t.lambda(null!=e?r(e,"signature"):e,e))?s:"")+'\n            </div>\n        </section>\n        <section id="btmBtns">\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"canEditConversationDetails"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:12},end:{line:31,column:19}}}))?s:"")+'            <div class="js-reply-send"></div>\n        </section>\n    </div>\n</section>\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"isNewConvo"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:37,column:0},end:{line:39,column:7}}}))?s:"")},useData:!0})},5595:function(t,e,i){(function(t,n,o){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(i(5)),a=r(i(5596));function r(t){return t&&t.__esModule?t:{default:t}}var l=t.ItemView.extend({tagName:"li",template:a.default,events:{"click .remove":"removeAttachment"},ui:{remove:"a.remove"},initialize:function(){this.thread=this.options.thread,this.ticket=this.options.ticket,this.model||(this.model=new n.Model)},serializeData:function(){return o.extend(this.model.toJSON(),{path:hsGlobal.path,size:s.default.Utils.Main.formatSize(this.model.get("size")),mailboxSlug:this.options.mailboxSlug,memberId:this.options.memberId,threadId:this.thread.get("id")})},onRender:function(){this.model.get("isViewableImage")&&(clearTimeout(window.initPopupTimeoutId),window.initPopupTimeoutId=setTimeout(s.default.Utils.Main.initPopups,500))},removeAttachment:function(t){t&&(t.preventDefault(),t.stopPropagation()),s.default.Utils.Ajax.del(this.ui.remove.attr("href"),$.proxy(this.removeAttachmentCB,this))},undoDelete:function(){var t=hsGlobal.path+"file/action/"+this.options.mailboxSlug+"/"+this.options.memberId+"/"+this.thread.get("id")+"/"+this.model.get("id")+"/";this.undoId>0&&(s.default.Utils.Ajax.put(t,$.proxy(this.undoDeleteCB,this)),this.undoId=0)},undoDeleteCB:function(){this.$el.show(),s.default.Utils.Main.flash("Deleted file has been undone.",{removeLast:!0})},removeAttachmentCB:function(t){this.$el.hide(),this.undoId=t.id;var e="undo"+t.id;s.default.Utils.Main.warning("<strong>"+t.filename+'</strong> deleted&nbsp;<a href="javascript:void(0)" id="'+e+'" class="undo">Undo</a>',{callback:{afterShow:$.proxy((function(){$("#"+e).on("click",$.proxy(this.undoDelete,this))}),this)}})}});e.default=l}).call(this,i(6),i(11),i(1))},5596:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'class="file fancyimg" '},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a target="_blank" href="'+c(typeof(a=null!=(a=u(i,"path")||(null!=e?u(e,"path"):e))?a:l)===d?a.call(r,{name:"path",hash:{},data:o,loc:{start:{line:1,column:25},end:{line:1,column:33}}}):a)+"file/"+c(typeof(a=null!=(a=u(i,"mailboxSlug")||(null!=e?u(e,"mailboxSlug"):e))?a:l)===d?a.call(r,{name:"mailboxSlug",hash:{},data:o,loc:{start:{line:1,column:38},end:{line:1,column:53}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"memberId")||(null!=e?u(e,"memberId"):e))?a:l)===d?a.call(r,{name:"memberId",hash:{},data:o,loc:{start:{line:1,column:54},end:{line:1,column:66}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"threadId")||(null!=e?u(e,"threadId"):e))?a:l)===d?a.call(r,{name:"threadId",hash:{},data:o,loc:{start:{line:1,column:67},end:{line:1,column:79}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"id")||(null!=e?u(e,"id"):e))?a:l)===d?a.call(r,{name:"id",hash:{},data:o,loc:{start:{line:1,column:80},end:{line:1,column:86}}}):a)+'/" '+(null!=(s=u(i,"if").call(r,null!=e?u(e,"isViewableImage"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:89},end:{line:1,column:141}}}))?s:"")+' rel="draft" title="View Attachment">'+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)===d?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:1,column:178},end:{line:1,column:186}}}):a)+'</a>\n<span class="size">'+c(typeof(a=null!=(a=u(i,"size")||(null!=e?u(e,"size"):e))?a:l)===d?a.call(r,{name:"size",hash:{},data:o,loc:{start:{line:2,column:19},end:{line:2,column:27}}}):a)+'</span> <a href="'+c(typeof(a=null!=(a=u(i,"path")||(null!=e?u(e,"path"):e))?a:l)===d?a.call(r,{name:"path",hash:{},data:o,loc:{start:{line:2,column:44},end:{line:2,column:52}}}):a)+"file/action/"+c(typeof(a=null!=(a=u(i,"mailboxSlug")||(null!=e?u(e,"mailboxSlug"):e))?a:l)===d?a.call(r,{name:"mailboxSlug",hash:{},data:o,loc:{start:{line:2,column:64},end:{line:2,column:79}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"memberId")||(null!=e?u(e,"memberId"):e))?a:l)===d?a.call(r,{name:"memberId",hash:{},data:o,loc:{start:{line:2,column:80},end:{line:2,column:92}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"threadId")||(null!=e?u(e,"threadId"):e))?a:l)===d?a.call(r,{name:"threadId",hash:{},data:o,loc:{start:{line:2,column:93},end:{line:2,column:105}}}):a)+"/"+c(typeof(a=null!=(a=u(i,"id")||(null!=e?u(e,"id"):e))?a:l)===d?a.call(r,{name:"id",hash:{},data:o,loc:{start:{line:2,column:106},end:{line:2,column:112}}}):a)+'/" class="remove" title="Remove Attachment"><i class="icon-close"></i></a>\n\n\n'},useData:!0})},5597:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(jQuery){var global=window;function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var qq=function t(e){return{hide:function(){return e.style.display="none",this},attach:function(i,n){return e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent("on"+i,n),function(){t(e).detach(i,n)}},detach:function(t,i){return e.removeEventListener?e.removeEventListener(t,i,!1):e.attachEvent&&e.detachEvent("on"+t,i),this},contains:function(t){return e===t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(i){return null!==i.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(i.filter="alpha(opacity="+Math.round(100*i.opacity)+")"),t.extend(e.style,i),this},hasClass:function(t){return new RegExp("(^| )"+t+"( |$)").test(e.className)},addClass:function(i){return t(e).hasClass(i)||(e.className+=" "+i),this},removeClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(i," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(i){var n,o=[];return e.querySelectorAll?e.querySelectorAll("."+i):(n=e.getElementsByTagName("*"),t.each(n,(function(e,n){t(n).hasClass(i)&&o.push(n)})),o)},children:function(){for(var t=[],i=e.firstChild;i;)1===i.nodeType&&t.push(i),i=i.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return t(e).setText("")}}},div;qq.log=function(t,e){window.console&&(e&&"info"!==e?window.console[e]||window.console.log("<"+e+"> "+t):window.console.log(t))},qq.isObject=function(t){return null!==t&&t&&"object"===_typeof(t)&&t.constructor===Object},qq.isFunction=function(t){return"function"==typeof t},qq.isFileOrInput=function(t){if(window.File&&t instanceof File)return!0;if(window.HTMLInputElement){if(t instanceof HTMLInputElement&&t.type&&"file"===t.type.toLowerCase())return!0}else if(t.tagName&&"input"===t.tagName.toLowerCase()&&t.type&&"file"===t.type.toLowerCase())return!0;return!1},qq.isXhrUploadSupported=function(){var t=document.createElement("input");return t.type="file",void 0!==t.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==(new XMLHttpRequest).upload},qq.isFolderDropSupported=function(t){return t.items&&t.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice)},qq.extend=function(t,e,i){qq.each(e,(function(e,n){i&&qq.isObject(n)?(void 0===t[e]&&(t[e]={}),qq.extend(t[e],n,!0)):t[e]=n}))},qq.indexOf=function(t,e,i){if(t.indexOf)return t.indexOf(e,i);i=i||0;var n=t.length;for(i<0&&(i+=n);i<n;i+=1)if(t.hasOwnProperty(i)&&t[i]===e)return i;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.firefox=function(){return-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},qq.toElement=(div=document.createElement("div"),function(t){div.innerHTML=t;var e=div.firstChild;return div.removeChild(e),e}),qq.each=function(t,e){var i;if(t)for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&!1===e(i,t[i]))break},qq.obj2url=function(t,e,i){var n,o,s=[],a="&",r=function(t,i){var n=e?/\[\]$/.test(e)?e:e+"["+i+"]":i;"undefined"!==n&&"undefined"!==i&&s.push("object"===_typeof(t)?qq.obj2url(t,n,!0):"[object Function]"===Object.prototype.toString.call(t)?encodeURIComponent(n)+"="+encodeURIComponent(t()):encodeURIComponent(n)+"="+encodeURIComponent(t))};if(!i&&e)a=/\?/.test(e)?/\?$/.test(e)?"":"&":"?",s.push(e),s.push(qq.obj2url(t));else if("[object Array]"===Object.prototype.toString.call(t)&&void 0!==t)for(n=-1,o=t.length;n<o;n+=1)r(t[n],n);else if(null!=t&&"object"===_typeof(t))for(n in t)t.hasOwnProperty(n)&&r(t[n],n);else s.push(encodeURIComponent(e)+"="+encodeURIComponent(t));return e?s.join(a):s.join(a).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(t,e,i){return e||(e=new FormData),qq.each(t,(function(t,n){t=i?i+"["+t+"]":t,qq.isObject(n)?qq.obj2FormData(n,e,t):qq.isFunction(n)?e.append(encodeURIComponent(t),encodeURIComponent(n())):e.append(encodeURIComponent(t),encodeURIComponent(n))})),e},qq.obj2Inputs=function(t,e){var i;return e||(e=document.createElement("form")),qq.obj2FormData(t,{append:function(t,n){(i=document.createElement("input")).setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}}),e},qq.setCookie=function(t,e,i){var n=new Date,o="";i&&(n.setTime(n.getTime()+24*i*60*60*1e3),o="; expires="+n.toGMTString()),document.cookie=t+"="+e+o+"; path=/"},qq.getCookie=function(t){for(var e,i=t+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(e=n[o];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(i))return e.substring(i.length,e.length)}},qq.getCookieNames=function(t){var e=document.cookie.split(";"),i=[];return qq.each(e,(function(e,n){var o=(n=n.trim()).indexOf("=");n.match(t)&&i.push(n.substr(0,o))})),i},qq.deleteCookie=function(t){qq.setCookie(t,"",-1)},qq.areCookiesEnabled=function(){var t="qqCookieTest:"+1e5*Math.random();return qq.setCookie(t,1),!!qq.getCookie(t)&&(qq.deleteCookie(t),!0)},qq.parseJson=function(json){return"function"==typeof JSON.parse?JSON.parse(json):eval("("+json+")")},qq.DisposeSupport=function(){var t=[];return{dispose:function(){var e;do{(e=t.shift())&&e()}while(e)},attach:function(){var t=arguments;this.addDisposer(qq(t[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(e){t.push(e)}}},qq.UploadButton=function(t){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(t){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,t),this._disposeSupport=new qq.DisposeSupport,this._element=this._options.element,qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq(this._input).remove(),qq(this._element).removeClass(this._options.focusClass),this._input=this._createInput()},_createInput:function(){var t=document.createElement("input");this._options.multiple&&t.setAttribute("multiple","multiple"),this._options.acceptFiles&&t.setAttribute("accept",this._options.acceptFiles),t.setAttribute("type","file"),t.setAttribute("tabindex","-1"),t.setAttribute("name",this._options.name),qq(t).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(t);var e=this;return this._disposeSupport.attach(t,"change",(function(){e._options.onChange(t)})),this._disposeSupport.attach(t,"mouseover",(function(){qq(e._element).addClass(e._options.hoverClass)})),this._disposeSupport.attach(t,"mouseout",(function(){qq(e._element).removeClass(e._options.hoverClass)})),this._disposeSupport.attach(t,"focus",(function(){qq(e._element).addClass(e._options.focusClass)})),this._disposeSupport.attach(t,"blur",(function(){qq(e._element).removeClass(e._options.focusClass)})),window.attachEvent&&t.setAttribute("tabIndex","-1"),t}},qq.UploadHandlerXhr=function(t,e,i){var n,o=t,s=e,a=i,r=[],l=o.chunking.enabled&&qq.isFileChunkingSupported(),d=o.resume.enabled&&l&&qq.areCookiesEnabled(),c=function(){if(null!==o.resume.id&&void 0!==o.resume.id&&!qq.isFunction(o.resume.id)&&!qq.isObject(o.resume.id))return o.resume.id}(),u=o.forceMultipart||o.paramsInBody;function h(t,e,i){return t.slice?t.slice(e,i):t.mozSlice?t.mozSlice(e,i):t.webkitSlice?t.webkitSlice(e,i):void 0}function p(t,e){var i=o.chunking.partSize,s=n.getSize(t),a=r[t].file,l=i*e,d=l+i>=s?s:l+i;return{part:e,start:l,end:d,count:f(t),blob:h(a,l,d)}}function f(t){var e=n.getSize(t),i=o.chunking.partSize;return Math.ceil(e/i)}function m(t){return r[t].xhr=new XMLHttpRequest,r[t].xhr}function g(t,e,i,s){var a=new FormData,l=o.demoMode?"GET":"POST",d=o.endpointCallback(),c=d,h=n.getName(s),p=n.getSize(s);return t[o.uuidParamName]=r[s].uuid,u&&(t[o.totalFileSizeParamName]=p),o.paramsInBody||(t[o.inputName]=h,c=qq.obj2url(t,d)),e.open(l,c,!0),u?(o.paramsInBody&&qq.obj2FormData(t,a),a.append(o.inputName,i),a):i}function v(t,e){var i=o.customHeaders,s=(n.getName(t),r[t].file);e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Cache-Control","no-cache"),u||(e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("X-Mime-Type",s.type)),qq.each(i,(function(t,i){e.setRequestHeader(t,i)}))}function b(t,e,i){var a=n.getName(t),l=n.getSize(t);r[t].attemptingResume=!1,o.onProgress(t,a,l,l),o.onComplete(t,a,e,i),delete r[t].xhr,s(t)}function y(t){var e,i,s=p(t,r[t].remainingChunkIdxs[0]),l=m(t),d=n.getSize(t),c=n.getName(t);void 0===r[t].loaded&&(r[t].loaded=0),function(t,e){var i=n.getUuid(t),s=_(t),a=i+"|"+e.part,r=o.resume.cookiesExpireIn;qq.setCookie(s,a,r)}(t,s),l.onreadystatechange=C(t,l),l.upload.onprogress=function(e){if(e.lengthComputable&&r[t].loaded<d){var i=e.loaded+r[t].loaded;o.onProgress(t,c,i,d)}},o.onUploadChunk(t,c,k(s)),i=o.paramsStore.getParams(t),function(t,e,i){var s=n.getSize(t),a=n.getName(t);e[o.chunking.paramNames.partIndex]=i.part,e[o.chunking.paramNames.partByteOffset]=i.start,e[o.chunking.paramNames.chunkSize]=i.end-i.start,e[o.chunking.paramNames.totalParts]=i.count,e[o.totalFileSizeParamName]=s,u&&(e[o.chunking.paramNames.filename]=a)}(t,i,s),r[t].attemptingResume&&function(t){t[o.resume.paramNames.resuming]=!0}(i),e=g(i,l,s.blob,t),v(t,l),a("Sending chunked upload request for "+t+": bytes "+(s.start+1)+"-"+s.end+" of "+d),l.send(e)}function w(t,e){var i;r[t]&&(a("xhr - server response received for "+t),a("responseText = "+e.responseText),function(t,e){return 200!==t.status||!e.success||e.reset}(e,i=function(t){var e;try{e=qq.parseJson(t.responseText)}catch(i){a("Error when attempting to parse xhr response text ("+i+")","error"),e={}}return e}(e))?(i.reset&&function(t){a("Server has ordered chunking effort to be restarted on next attempt for file ID "+t,"error"),d&&x(t),r[t].remainingChunkIdxs=[],delete r[t].loaded}(t),r[t].attemptingResume&&i.reset?function(t){r[t].attemptingResume=!1,a("Server has declared that it cannot handle resume for file ID "+t+" - starting from the first chunk","error"),n.upload(t,!0)}(t):function(t,e,i){var s=n.getName(t);o.onAutoRetry(t,s,e,i)||b(t,e,i)}(t,i,e)):l?function(t,e,i){var n=p(t,r[t].remainingChunkIdxs.shift());r[t].attemptingResume=!1,r[t].loaded+=n.end-n.start,r[t].remainingChunkIdxs.length>0?y(t):(x(t),b(t,e,i))}(t,i,e):b(t,i,e))}function k(t){return{partIndex:t.part,startByte:t.start+1,endByte:t.end,totalParts:t.count}}function C(t,e){return function(){4===e.readyState&&w(t,e)}}function x(t){var e=_(t);qq.deleteCookie(e)}function _(t){var e,i=n.getName(t),s=n.getSize(t),a=o.chunking.partSize;return e="qqfilechunk|"+encodeURIComponent(i)+"|"+s+"|"+a,void 0!==c&&(e+="|"+c),e}function S(t,e){var i,s,l,c=n.getName(t),u=0;if(!r[t].remainingChunkIdxs||0===r[t].remainingChunkIdxs.length)for(r[t].remainingChunkIdxs=[],d&&!e&&(i=function(t){var e,i=qq.getCookie(_(t));if(i)return e=i.indexOf("|"),{uuid:i.substr(0,e),part:parseInt(i.substr(e+1,i.length-e),10)}}(t))&&(s=p(t,i.part),!1!==o.onResume(t,c,k(s))&&(u=i.part,r[t].uuid=i.uuid,r[t].loaded=s.start,r[t].attemptingResume=!0,a("Resuming "+c+" at partition index "+u))),l=f(t)-1;l>=u;l-=1)r[t].remainingChunkIdxs.unshift(l);y(t)}return n={add:function(t){if(!(t instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");var e=r.push({file:t})-1;return r[e].uuid=qq.getUniqueId(),e},getName:function(t){var e=r[t].file;return null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},getSize:function(t){var e=r[t].file;return null!=e.fileSize?e.fileSize:e.size},getFile:function(t){if(r[t])return r[t].file},getLoaded:function(t){return r[t].loaded||0},isValid:function(t){return void 0!==r[t]},reset:function(){r=[]},getUuid:function(t){return r[t].uuid},upload:function(t,e){var i=this.getName(t);o.onUpload(t,i),l?S(t,e):function(t){var e,i,s=r[t].file,l=n.getName(t);r[t].loaded=0,(e=m(t)).upload.onprogress=function(e){e.lengthComputable&&(r[t].loaded=e.loaded,o.onProgress(t,l,e.loaded,e.total))},e.onreadystatechange=C(t,e),i=g(o.paramsStore.getParams(t),e,s,t),v(t,e),a("Sending upload request for "+t),e.send(i)}(t)},cancel:function(t){o.onCancel(t,this.getName(t)),r[t].xhr&&r[t].xhr.abort(),d&&x(t),delete r[t]},getResumableFilesData:function(){var t=[],e=[];return l&&d?(t=void 0===c?qq.getCookieNames(new RegExp("^qqfilechunk\\|.+\\|\\d+\\|"+o.chunking.partSize+"=")):qq.getCookieNames(new RegExp("^qqfilechunk\\|.+\\|\\d+\\|"+o.chunking.partSize+"\\|"+c+"=")),qq.each(t,(function(t,i){var n=i.split("|"),o=qq.getCookie(i).split("|");e.push({name:decodeURIComponent(n[1]),size:n[2],uuid:o[0],partIdx:o[1]})})),e):[]}}},qq.UploadHandler=function(t){var e,i,n,o,s=[];return e={debug:!1,forceMultipart:!0,paramsInBody:!1,paramsStore:{},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(t,e){},onProgress:function(t,e,i,n){},onComplete:function(t,e,i,n){},onCancel:function(t,e){},onUpload:function(t,e){},onUploadChunk:function(t,e,i){},onAutoRetry:function(t,e,i,n){},onResume:function(t,e,i){}},qq.extend(e,t),i=e.log,n=function(t){var i,n=qq.indexOf(s,t),a=e.maxConnections;s.splice(n,1),s.length>=a&&n<a&&(i=s[a-1],o.upload(i))},o=qq.isXhrUploadSupported()?new qq.UploadHandlerXhr(e,n,i):new qq.UploadHandlerForm(e,n,i),{add:function(t){return o.add(t)},upload:function(t){if(s.push(t)<=e.maxConnections)return o.upload(t)},retry:function(t){return qq.indexOf(s,t)>=0?o.upload(t,!0):this.upload(t)},cancel:function(t){i("Cancelling "+t),e.paramsStore.remove(t),o.cancel(t),n(t)},cancelAll:function(){qq.each(s,$.proxy((function(t,e){this.cancel(e)}),this)),s=[]},getName:function(t){return o.getName(t)},getSize:function(t){if(o.getSize)return o.getSize(t)},getFile:function(t){if(o.getFile)return o.getFile(t)},getQueue:function(){return s},reset:function(){i("Resetting upload handler"),s=[],o.reset()},getUuid:function(t){return o.getUuid(t)},isValid:function(t){return o.isValid(t)},getResumableFilesData:function(){return o.getResumableFilesData?o.getResumableFilesData():[]}}},qq.UploadHandlerForm=function(o,uploadCompleteCallback,logCallback){var options=o,inputs=[],uuids=[],detachLoadEvents={},uploadComplete=uploadCompleteCallback,log=logCallback,api;function attachLoadEvent(t,e){detachLoadEvents[t.id]=qq(t).attach("load",(function(){if(log("Received response for "+t.id),t.parentNode){try{if(t.contentDocument&&t.contentDocument.body&&"false"==t.contentDocument.body.innerHTML)return}catch(i){log("Error when attempting to access iframe during handling of upload response ("+i+")","error")}e()}}))}function getIframeContentJson(iframe){var response;try{var doc=iframe.contentDocument||iframe.contentWindow.document,innerHTML=doc.body.innerHTML;log("converting iframe's innerHTML to JSON"),log("innerHTML = "+innerHTML),innerHTML&&innerHTML.match(/^<pre/i)&&(innerHTML=doc.body.firstChild.firstChild.nodeValue),response=eval("("+innerHTML+")")}catch(error){log("Error when attempting to parse form upload response ("+error+")","error"),response={success:!1}}return response}function createIframe(t){var e=qq.toElement('<iframe src="javascript:false;" name="'+t+'" />');return e.setAttribute("id",t),e.style.display="none",document.body.appendChild(e),e}function createForm(t,e){var i=options.paramsStore.getParams(t),n=options.demoMode?"GET":"POST",o=qq.toElement('<form method="'+n+'" enctype="multipart/form-data"></form>'),s=options.endpointCallback(),a=s;return i[options.uuidParamName]=uuids[t],options.paramsInBody?qq.obj2Inputs(i,o):a=qq.obj2url(i,s),o.setAttribute("action",a),o.setAttribute("target",e.name),o.style.display="none",document.body.appendChild(o),o}return api={add:function(t){t.setAttribute("name",options.inputName);var e=inputs.push(t)-1;return uuids[e]=qq.getUniqueId(),t.parentNode&&qq(t).remove(),e},getName:function(t){return inputs[t].value.replace(/.*(\/|\\)/,"")},isValid:function(t){return void 0!==inputs[t]},reset:function(){qq.UploadHandler.prototype.reset.apply(this,arguments),inputs=[],uuids=[],detachLoadEvents={}},getUuid:function(t){return uuids[t]},cancel:function(t){options.onCancel(t,this.getName(t)),delete inputs[t],delete uuids[t],delete detachLoadEvents[t];var e=document.getElementById(t);e&&(e.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),qq(e).remove())},upload:function(t){var e=inputs[t],i=api.getName(t),n=createIframe(t),o=createForm(t,n);if(!e)throw new Error("file with passed id was not added, or already uploaded or cancelled");return options.onUpload(t,this.getName(t)),o.appendChild(e),attachLoadEvent(n,(function(){log("iframe loaded");var e=getIframeContentJson(n);setTimeout((function(){detachLoadEvents[t](),delete detachLoadEvents[t],qq(n).remove()}),1),!e.success&&options.onAutoRetry(t,i,e)||(options.onComplete(t,i,e),uploadComplete(t))})),log("Sending upload request for "+t),o.submit(),qq(o).remove(),t}},api},qq.FineUploaderBasic=function(t){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpointCallback:function(){},params:{},paramsInBody:!1,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:!0},callbacks:{onSubmit:function(t,e,i){},onComplete:function(t,e,i){},onCancel:function(t,e){},onUpload:function(t,e){},onUploadChunk:function(t,e,i){},onResume:function(t,e,i){},onProgress:function(t,e,i,n){},onError:function(t,e,i){},onAutoRetry:function(t,e,i){},onManualRetry:function(t,e){},onValidateBatch:function(t){},onValidate:function(t){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(t){return t.length>33&&(t=t.slice(0,19)+"..."+t.slice(-14)),t},text:{sizeSymbols:["kB","MB","GB","TB","PB","EB"]}},qq.extend(this._options,t,!0),this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._filesInProgress=[],this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._paramsStore=this._createParamsStore(),this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FineUploaderBasic.prototype={log:function(t,e){!this._options.debug||e&&"info"!==e?e&&"info"!==e&&qq.log("[FineUploader] "+t,e):qq.log("[FineUploader] "+t)},setParams:function(t,e){null==e?this._options.request.params=t:this._paramsStore.setParams(t,e)},getInProgress:function(){return this._filesInProgress.length},uploadStoredFiles:function(){for(var t;this._storedFileIds.length;)t=this._storedFileIds.shift(),this._filesInProgress.push(t),this._handler.upload(t)},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(t){return!!this._onBeforeManualRetry(t)&&(this._handler.retry(t),!0)},cancel:function(t){this._handler.cancel(t)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=[],this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset(),this._paramsStore.reset()},addFiles:function(t){var e,i,n=[];if(t){for(window.FileList&&t instanceof FileList||(t=[].concat(t)),e=0;e<t.length;e+=1)i=t[e],qq.isFileOrInput(i)?n.push(i):this.log(i+" is not a File or INPUT element!  Ignoring!","warn");this.log("Processing "+n.length+" files or inputs..."),this._uploadFileList(n)}},getUuid:function(t){return this._handler.getUuid(t)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(t){return this._handler.getSize(t)},getFile:function(t){return this._handler.getFile(t)},_createUploadButton:function(t){var e=this,i=new qq.UploadButton({element:t,multiple:this._options.multiple&&qq.isXhrUploadSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(t){e._onInputChange(t)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer((function(){i.dispose()})),i},_createUploadHandler:function(){var t=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointCallback:this._options.request.endpointCallback,chunking:this._options.chunking,resume:this._options.resume,log:function(e,i){t.log(e,i)},onProgress:function(e,i,n,o){t._onProgress(e,i,n,o),t._options.callbacks.onProgress(e,i,n,o)},onComplete:function(e,i,n,o){t._onComplete(e,i,n,o),t._options.callbacks.onComplete(e,i,n)},onCancel:function(e,i){t._onCancel(e,i),t._options.callbacks.onCancel(e,i)},onUpload:function(e,i){t._onUpload(e,i),t._options.callbacks.onUpload(e,i)},onUploadChunk:function(e,i,n){t._options.callbacks.onUploadChunk(e,i,n)},onResume:function(e,i,n){return t._options.callbacks.onResume(e,i,n)},onAutoRetry:function(e,i,n,o){return t._preventRetries[e]=n[t._options.retry.preventRetryResponseProperty],!!t._shouldAutoRetry(e,i,n)&&(t._maybeParseAndSendUploadError(e,i,n,o),t._options.callbacks.onAutoRetry(e,i,t._autoRetries[e]+1),t._onBeforeAutoRetry(e,i),t._retryTimeouts[e]=setTimeout((function(){t._onAutoRetry(e,i,n)}),1e3*t._options.retry.autoAttemptDelay),!0)}})},_preventLeaveInProgress:function(){var t=this;this._disposeSupport.attach(window,"beforeunload",(function(e){if(t._filesInProgress.length)return(e=e||window.event).returnValue=t._options.messages.onLeave,t._options.messages.onLeave}))},_onSubmit:function(t,e){this._options.autoUpload&&this._filesInProgress.push(t)},_onProgress:function(t,e,i,n){},_onComplete:function(t,e,i,n){this._removeFromFilesInProgress(t),this._maybeParseAndSendUploadError(t,e,i,n)},_onCancel:function(t,e){this._removeFromFilesInProgress(t),clearTimeout(this._retryTimeouts[t]);var i=qq.indexOf(this._storedFileIds,t);!this._options.autoUpload&&i>=0&&this._storedFileIds.splice(i,1)},_removeFromFilesInProgress:function(t){var e=qq.indexOf(this._filesInProgress,t);e>=0&&this._filesInProgress.splice(e,1)},_onUpload:function(t,e){},_onInputChange:function(t){qq.isXhrUploadSupported()?this.addFiles(t.files):this.addFiles(t),this._button.reset()},_onBeforeAutoRetry:function(t,e){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+e+"...")},_onAutoRetry:function(t,e,i){this.log("Retrying "+e+"..."),this._autoRetries[t]++,this._handler.retry(t)},_shouldAutoRetry:function(t,e,i){return!(this._preventRetries[t]||!this._options.retry.enableAuto)&&(void 0===this._autoRetries[t]&&(this._autoRetries[t]=0),this._autoRetries[t]<this._options.retry.maxAutoAttempts)},_onBeforeManualRetry:function(t){if(this._preventRetries[t])return this.log("Retries are forbidden for id "+t,"warn"),!1;if(this._handler.isValid(t)){var e=this._handler.getName(t);return!1!==this._options.callbacks.onManualRetry(t,e)&&(this.log("Retrying upload for '"+e+"' (id: "+t+")..."),this._filesInProgress.push(t),!0)}return this.log("'"+t+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(t,e,i,n){if(!i.success)if(n&&200!==n.status&&!i.error)this._options.callbacks.onError(t,e,"XHR returned response code "+n.status);else{var o=i.error?i.error:"Upload failure reason unknown";this._options.callbacks.onError(t,e,o)}},_uploadFileList:function(t){var e,i;if(e=this._getValidationDescriptors(t),!(!1===this._options.callbacks.onValidateBatch(e)))if(t.length>0){for(i=0;i<t.length;i++)if(this._validateFile(t[i]))this._uploadFile(t[i]);else if(this._options.validation.stopOnFirstInvalidFile)return}else this._error("noFilesError","")},_uploadFile:function(t){var e=this._handler.add(t),i=this._handler.getName(e),n=$.proxy((function(){this._onSubmit(e,i),this._options.autoUpload?this._handler.upload(e):this._storeFileForLater(e)}),this);this._options.callbacks.onSubmit(e,i,n)},_storeFileForLater:function(t){this._storedFileIds.push(t)},_validateFile:function(t){var e,i,n;return i=(e=this._getValidationDescriptor(t)).name,n=e.size,!1!==this._options.callbacks.onValidate(e)&&(this._isAllowedExtension(i)?0===n?(this._error("emptyError",i),!1):n&&this._options.validation.sizeLimit&&n>this._options.validation.sizeLimit?(this._error("sizeError",i),!1):!(n&&n<this._options.validation.minSizeLimit)||(this._error("minSizeError",i),!1):(this._error("typeError",i),!1))},_error:function(t,e){var i=this._options.messages[t];function n(t,e){i=i.replace(t,e)}var o=this._options.validation.allowedExtensions.join(", ").toLowerCase();return n("{file}",this._options.formatFileName(e)),n("{extensions}",o),n("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),n("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit)),this._options.callbacks.onError(null,e,i),i},_isAllowedExtension:function(t){var e=this._options.validation.allowedExtensions,i=!1;return!e.length||(qq.each(e,(function(e,n){var o=new RegExp("\\."+n+"$","i");if(null!=t.match(o))return i=!0,!1})),i)},_formatSize:function(t){var e=-1;do{t/=1024,e++}while(t>99);return Math.max(t,.1).toFixed(1)+this._options.text.sizeSymbols[e]},_wrapCallbacks:function(){var t,e;for(var i in t=this,e=function(e,i,n){try{return i.apply(t,n)}catch(o){t.log("Caught exception in '"+e+"' callback - "+o.message,"error")}},this._options.callbacks)!function(){var n,o;n=i,o=t._options.callbacks[n],t._options.callbacks[n]=function(){return e(n,o,arguments)}}()},_parseFileName:function(t){return t.value?t.value.replace(/.*(\/|\\)/,""):null!==t.fileName&&void 0!==t.fileName?t.fileName:t.name},_parseFileSize:function(t){var e;return t.value||(e=null!==t.fileSize&&void 0!==t.fileSize?t.fileSize:t.size),e},_getValidationDescriptor:function(t){var e,i,n;return n={},e=this._parseFileName(t),i=this._parseFileSize(t),n.name=e,i&&(n.size=i),n},_getValidationDescriptors:function(t){var e=this,i=[];return qq.each(t,(function(t,n){i.push(e._getValidationDescriptor(n))})),i},_createParamsStore:function(){var t={},e=this;return{setParams:function(e,i){var n={};qq.extend(n,e),t[i]=n},getParams:function(i){var n={};return null!=i&&t[i]?qq.extend(n,t[i]):qq.extend(n,e._options.request.params),n},remove:function(e){return delete t[e]},reset:function(){t={}}}}},qq.DragAndDrop=function(t){var e,i,n,o=[],s=0,a=0,r=new qq.DisposeSupport;function l(){s!==a||n||(e.callbacks.log("Grabbed "+o.length+" files after tree traversal."),i.dropDisabled(!1),e.callbacks.dropProcessing(!1,o))}function d(t){var e;s+=1,t.isFile?t.file((function(t){!function(t){o.push(t),a+=1,l()}(t)})):t.isDirectory&&(n=!0,t.createReader().readEntries((function(t){for(a+=1,e=0;e<t.length;e+=1)d(t[e]);n=!1,t.length||l()})))}function c(t){i=new qq.UploadDropZone({element:t,onEnter:function(i){qq(t).addClass(e.classes.dropActive),i.stopPropagation()},onLeaveNotDescendants:function(i){qq(t).removeClass(e.classes.dropActive)},onDrop:function(n){e.hideDropzones&&qq(t).hide(),qq(t).removeClass(e.classes.dropActive),function(t){var n,r,c;if(e.callbacks.dropProcessing(!0),i.dropDisabled(!0),t.files.length>1&&!e.multiple)e.callbacks.dropProcessing(!1),e.callbacks.error("tooManyFilesError",""),i.dropDisabled(!1);else if(o=[],s=0,a=0,qq.isFolderDropSupported(t))for(r=t.items,n=0;n<r.length;n+=1)(c=r[n].webkitGetAsEntry())&&(c.isFile?(o.push(r[n].getAsFile()),n===r.length-1&&l()):d(c));else e.callbacks.dropProcessing(!1,t.files),i.dropDisabled(!1)}(n.dataTransfer)}}),r.addDisposer((function(){i.dispose()})),e.hideDropzones&&qq(t).hide()}function u(){e.dropArea&&e.extraDropzones.push(e.dropArea);var t,n=e.extraDropzones;for(t=0;t<n.length;t+=1)c(n[t]);!e.dropArea||qq.ie()&&!qq.ie10()||r.attach(document,"dragenter",(function(o){if(!i.dropDisabled()&&(s=o,qq.each(s.dataTransfer.types,(function(t,e){if("Files"===e)return a=!0,!1})),a)){if(qq(e.dropArea).hasClass(e.classes.dropDisabled))return;for(e.dropArea.style.display="block",t=0;t<n.length;t+=1)n[t].style.display="block"}var s,a})),r.attach(document,"dragleave",(function(i){if(e.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(i))for(t=0;t<n.length;t+=1)qq(n[t]).hide()})),r.attach(document,"drop",(function(i){if(e.hideDropzones)for(t=0;t<n.length;t+=1)qq(n[t]).hide();i.preventDefault()}))}return e={dropArea:null,extraDropzones:[],hideDropzones:!0,multiple:!0,classes:{dropActive:null},callbacks:{dropProcessing:function(t,e){},error:function(t,e){},log:function(t,e){}}},qq.extend(e,t),{disableDropzone:function(){i.dropDisabled(!0)},enableDropzone:function(){i.dropDisabled(!1)},setup:function(){u()},setupExtraDropzone:function(t){e.extraDropzones.push(t),c(t)},removeExtraDropzone:function(t){var i,n=e.extraDropzones;for(i in n)if(n[i]===t)return n.splice(i,1)},dispose:function(){r.dispose(),i.dispose()}}},qq.UploadDropZone=function(t){var e,i,n,o,s=new qq.DisposeSupport;function a(){return qq.safari()||qq.firefox()&&qq.windows()}function r(t){if(qq.ie()&&!qq.ie10())return!1;var e,i=t.dataTransfer,n=qq.safari();return e=!!qq.ie10()||"none"!==i.effectAllowed,i&&e&&(i.files||!n&&i.types.contains&&i.types.contains("Files"))}function l(t){return void 0!==t&&(n=t),n}return e={element:null,onEnter:function(t){},onLeave:function(t){},onLeaveNotDescendants:function(t){},onDrop:function(t){}},qq.extend(e,t),i=e.element,o||(a?s.attach(document,"dragover",(function(t){t.preventDefault()})):s.attach(document,"dragover",(function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="none",t.preventDefault())})),o=!0),s.attach(i,"dragover",(function(t){if(r(t)){var e=qq.ie()?null:t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy",t.stopPropagation(),t.preventDefault()}})),s.attach(i,"dragenter",(function(t){if(!l()){if(!r(t))return;e.onEnter(t)}})),s.attach(i,"dragleave",(function(t){if(r(t)){e.onLeave(t);var i=document.elementFromPoint(t.clientX,t.clientY);qq(this).contains(i)||e.onLeaveNotDescendants(t)}})),s.attach(i,"drop",(function(t){if(!l()){if(!r(t))return;t.preventDefault(),e.onDrop(t)}})),{dropDisabled:function(t){return l(t)},dispose:function(){s.dispose()}}},qq.FineUploader=function(t){qq.FineUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to attach",dropProcessing:"Uploading attachments...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Uploading..."},template:'<div class="qq-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="qq-upload-button"><i class="icon-attach"></i></div>')+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(this._options.listElement?"":'<ul class="qq-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},showMessage:function(t){setTimeout((function(){alert(t)}),0)}},!0),qq.extend(this._options,t,!0),this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._dnd=this._setupDragAndDrop()},qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype),qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(t){this._dnd.setupExtraDropzone(t)},removeExtraDropzone:function(t){return this._dnd.removeExtraDropzone(t)},getItemByFileId:function(t){for(var e=this._listElement.firstChild;e;){if(e.qqFileId==t)return e;e=e.nextSibling}},cancel:function(t){qq.FineUploaderBasic.prototype.cancel.apply(this,arguments);var e=this.getItemByFileId(t);qq(e).remove()},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._dnd.dispose(),this._dnd=this._setupDragAndDrop()},_setupDragAndDrop:function(){var t,e,i,n=this,o=this._find(this._element,"dropProcessing");return e=function(t){t.preventDefault()},this._options.dragAndDrop.disableDefaultDropzone||(i=this._find(this._options.element,"drop")),(t=new qq.DragAndDrop({dropArea:i,extraDropzones:this._options.dragAndDrop.extraDropzones,hideDropzones:this._options.dragAndDrop.hideDropzones,multiple:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{dropProcessing:function(t,i){var s=n._button.getInput();t?(qq(o).css({display:"block"}),qq(s).attach("click",e)):(qq(o).hide(),qq(s).detach("click",e)),i&&n.addFiles(i)},error:function(t,e){n._error(t,e)},log:function(t,e){n.log(t,e)}}})).setup(),t},_leaving_document_out:function(t){return qq.safari()&&!qq.windows()&&(t.x<=0||t.x>=window.innerWidth||t.y<=0||t.y>=window.innerHeight)||(qq.chrome()||qq.safari()&&qq.windows())&&0==t.clientX&&0==t.clientY},_storeFileForLater:function(t){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var e=this.getItemByFileId(t);qq(this._find(e,"spinner")).hide()},_find:function(t,e){var i=qq(t).getByClass(this._options.classes[e])[0];if(!i)throw new Error("element not found "+e);return i},_onSubmit:function(t,e){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(t,e)},_onProgress:function(t,e,i,n){var o,s,a,r,l,d;qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments),o=this.getItemByFileId(t),s=this._find(o,"progressBar"),r=Math.round(i/n*100),i===n?(l=this._find(o,"cancel"),qq(l).hide(),qq(s).hide(),qq(this._find(o,"statusText")).setText(this._options.text.waitingForResponse),a=this._formatSize(n)):(a=this._formatProgress(i,n),qq(s).css({display:"block"})),qq(s).css({width:r+"%"}),d=this._find(o,"size"),qq(d).css({display:"inline"}),qq(d).setText(a)},_onComplete:function(t,e,i,n){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var o=this.getItemByFileId(t);qq(this._find(o,"statusText")).clearText(),qq(o).removeClass(this._classes.retrying),qq(this._find(o,"progressBar")).hide(),this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()||qq(this._find(o,"cancel")).hide(),qq(this._find(o,"spinner")).hide(),i.success?(qq(o).addClass(this._classes.success),this._classes.successIcon&&(this._find(o,"finished").style.display="inline-block",qq(o).addClass(this._classes.successIcon))):(qq(o).addClass(this._classes.fail),this._classes.failIcon&&(this._find(o,"finished").style.display="inline-block",qq(o).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[t]&&qq(o).addClass(this._classes.retryable),this._controlFailureTextDisplay(o,i))},_onUpload:function(t,e){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var i=this.getItemByFileId(t);this._showSpinner(i)},_onBeforeAutoRetry:function(t){var e,i,n,o,s,a;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),e=this.getItemByFileId(t),i=this._find(e,"progressBar"),this._showCancelLink(e),i.style.width=0,qq(i).hide(),this._options.retry.showAutoRetryNote&&(n=this._find(e,"statusText"),o=this._autoRetries[t]+1,s=this._options.retry.maxAutoAttempts,a=(a=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,o)).replace(/\{maxAuto\}/g,s),qq(n).setText(a),1===o&&qq(e).addClass(this._classes.retrying))},_onBeforeManualRetry:function(t){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var e=this.getItemByFileId(t);return this._find(e,"progressBar").style.width=0,qq(e).removeClass(this._classes.fail),qq(this._find(e,"statusText")).clearText(),this._showSpinner(e),this._showCancelLink(e),!0}return!1},_addToList:function(t,e){var i=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()){var n=this._find(i,"cancel");qq(n).remove()}i.qqFileId=t;var o=this._find(i,"file");qq(o).setText(this._options.formatFileName(e)),qq(this._find(i,"size")).hide(),this._options.multiple||this._clearList(),this._listElement.appendChild(i)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var t=this,e=this._listElement;this._disposeSupport.attach(e,"click",(function(e){var i=(e=e||window.event).target||e.srcElement;if(qq(i).hasClass(t._classes.cancel)||qq(i).hasClass(t._classes.retry)){qq.preventDefault(e);for(var n=i.parentNode;null==n.qqFileId;)n=i=i.parentNode;qq(i).hasClass(t._classes.cancel)?t.cancel(n.qqFileId):(qq(n).removeClass(t._classes.retryable),t.retry(n.qqFileId))}}))},_formatProgress:function(t,e){var i=this._options.text.formatProgress;function n(t,e){i=i.replace(t,e)}return n("{percent}",Math.round(t/e*100)),n("{total_size}",this._formatSize(e)),i},_controlFailureTextDisplay:function(t,e){var i,n,o,s,a;i=this._options.failedUploadTextDisplay.mode,n=this._options.failedUploadTextDisplay.maxChars,o=this._options.failedUploadTextDisplay.responseProperty,"custom"===i?((s=e[o])?s.length>n&&(a=s.substring(0,n)+"..."):(s=this._options.text.failUpload,this.log("'"+o+"' is not a valid property on the server response.","warn")),qq(this._find(t,"statusText")).setText(a||s),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(t,s)):"default"===i?qq(this._find(t,"statusText")).setText(this._options.text.failUpload):"none"!==i&&this.log("failedUploadTextDisplay.mode value of '"+i+"' is not valid","warn")},_showTooltip:function(t,e){t.title=e},_showSpinner:function(t){this._find(t,"spinner").style.display="inline-block"},_showCancelLink:function(t){this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()||(this._find(t,"cancel").style.display="inline")},_error:function(t,e){var i=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(i)}}),function(t){var e,i,n,o,s,a,r,l,d,c;a=["uploaderType"],n=function(t){if(t){var n=l(t);r(n),"basic"===s("uploaderType")?e(new qq.FineUploaderBasic(n)):e(new qq.FineUploader(n))}return i},o=function(t,e){var n=i.data("fineuploader");if(!e)return void 0===n?null:n[t];void 0===n&&(n={}),n[t]=e,i.data("fineuploader",n)},e=function(t){return o("uploader",t)},s=function(t,e){return o(t,e)},r=function(e){var n=e.callbacks={};t.each((new qq.FineUploaderBasic)._options.callbacks,(function(t,e){var o,s;o=(o=/^on(\w+)/.exec(t)[1]).substring(0,1).toLowerCase()+o.substring(1),s=i,n[t]=function(){var t=Array.prototype.slice.call(arguments);return s.triggerHandler(o,t)}}))},l=function(e,n){var o,r;if(o=void 0===n?"basic"!==e.uploaderType?{element:i[0]}:{}:n,t.each(e,(function(e,i){t.inArray(e,a)>=0?s(e,i):i instanceof t?o[e]=i[0]:t.isPlainObject(i)?(o[e]={},l(i,o[e])):t.isArray(i)?(r=[],t.each(i,(function(e,i){i instanceof t?t.merge(r,i):r.push(i)})),o[e]=r):o[e]=i})),void 0===n)return o},d=function(i){return"string"===t.type(i)&&!i.match(/^_/)&&void 0!==e()[i]},c=function(t){var i=[],n=Array.prototype.slice.call(arguments,1);return l(n,i),e()[t].apply(e(),i)},t.fn.fineUploader=function(o){var s=this,a=arguments,r=[];return this.each((function(l,u){if(i=t(u),e()&&d(o)){if(r.push(c.apply(s,a)),1===s.length)return!1}else"object"!==_typeof(o)&&o?t.error("Method "+o+" does not exist on jQuery.fineUploader"):n.apply(s,a)})),1===r.length?r[0]:r.length>1?r:this}}(jQuery),__webpack_exports__.default=qq}.call(this,__webpack_require__(8))},5598:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(i(5)),o=u(i(1)),s=u(i(8)),a=u(i(6)),r=u(i(231)),l=u(i(5599)),d=u(i(5600)),c=u(i(1705));function u(t){return t&&t.__esModule?t:{default:t}}var h={note:"btnNote",reply:"btnReply"},p=a.default.ItemView.extend({template:l.default,className:"btn-group",ui:{mainButton:"#sendBtn",sendCaret:"#sendCaret",originalCreatorOption:".originalCreator",originalCreatorLink:".originalCreator a"},events:{"click @ui.mainButton":"sendDefaultClick","click #js-changeRedirect":"changeRedirect","click a.sender":"sendClick"},initialize:function(t){this.ticket=t.ticket,this.listenTo(r.default,"send-ticket",this.sendDefaultClick)},serializeData:function(){return o.default.extend({thread:this.model.toJSON()},this.getConfig())},onRender:function(){this.markDefault(r.default.data.get("member.convRedirect")),this.listenTo(r.default,"TicketPanel:unlock",this.unlock),this.listenTo(r.default,"AddressLines:valid",this.enableButtons),this.listenTo(r.default,"AddressLines:invalid",this.disableButtons),(0,s.default)(document).on("click.".concat(this.cid),"#cancel-send",o.default.bind(this.cancel,this))},onClose:function(){delete this.submitting,(0,s.default)(document).off("click.".concat(this.cid)),this.noty&&this.noty.close()},getConfig:function(){var t,e,i=this.model.get("type"),o=this.model.ticket instanceof c.default,s="Sending...",a=h.reply;switch(i){case n.default.Constants.threadType.FORWARD:t="Forward",e="Send";break;case n.default.Constants.threadType.PHONE:case n.default.Constants.threadType.NOTE:o?(t="Create",e="Create",s="Creating..."):(t="Add Note",e="Add",s="Saving...",a=h.note);break;case n.default.Constants.threadType.MESSAGE:default:o?(t="Send",e="Create"):(t="Send Reply",e="Send")}return{mainButtonText:t,shortButtonText:e,sendingText:s,className:a,isNewConvo:o}},lock:function(t){this.locked&&this.lockedClickMessage&&!t||(this.locked=!0,this.lockedClickMessage=t)},unlock:function(){delete this.locked,delete this.lockedClickMessage,this.submitting&&(this.submit(this.sendValue),delete this.sendValue),delete this.submitting},isLocked:function(){return this.locked},submit:function(t){void 0===t&&(t=r.default.data.get("member.convRedirect")),this.trigger("submit",t)},cancel:function(t){t&&t.preventDefault(),delete this.submitting,this.setActive()},disableButtons:function(){this.ui.mainButton.attr("disabled","disabled").addClass("btnInactive"),this.ui.sendCaret.attr("disabled","disabled").addClass("btnInactive")},enableButtons:function(){this.ui.mainButton.removeAttr("disabled").removeClass("btnInactive"),this.ui.sendCaret.removeAttr("disabled").removeClass("btnInactive")},setActive:function(){this.onClose(),this.render()},setSending:function(){this.disableButtons();var t=this.getConfig();this.ui.mainButton.attr("title",t.sendingText).html(t.sendingText).removeClass(o.default.values(h).join(" ")),this.ui.sendCaret.button("loading")},sendDefaultClick:function(t){t&&t.preventDefault(),this.ui.mainButton.attr("disabled")||this.send(r.default.data.get("member.convRedirect"))},sendClick:function(t){if(t&&t.preventDefault(),!this.ui.mainButton.attr("disabled")){var e=(0,s.default)(t.currentTarget).data("val");this.send(e)}},send:function(t){this.disableButtons(),this.disableButtons(),this.setSending(),this.locked?(this.submitting=!0,this.lockedClickMessage&&(this.noty=n.default.Utils.Main.warning(this.lockedClickMessage,{timeout:!1}),this.sendValue=t)):(delete this.submitting,this.noty&&this.noty.close(),this.submit(t))},changeRedirect:function(t){t&&t.preventDefault(),this.changeRedirectView=new d.default,r.default.modalRegion.wrapAndShow(this.changeRedirectView,{header:"Redirect Options"}),this.listenTo(this.changeRedirectView,"changed",this.onDefaultChanged)},onDefaultChanged:function(t){r.default.data.set("member.convRedirect",t),this.render()},markDefault:function(t){this.$(".sender").each((function(){var t=(0,s.default)(this),e=t.text();t.html(e)}));var e=this.$("a.sender[data-val=".concat(t,"]")),i=e.text();e.html("<strong>".concat(i,"</strong>"))}});e.default=p},5599:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="originalCreator"><a href="#" class="sender" data-val="creator">Send as '+t.escapeExpression(t.lambda(null!=(s=null!=e?a(e,"thread"):e)?a(s,"originalCreatorName"):s,e))+'</a></li>\n    <li class="originalCreator divider"></li>\n'},3:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><a href="#" class="sender" data-val="2">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:12,column:52},end:{line:12,column:71}}}):s)+' and stay on page</a></li>\n        <li><a href="#" class="sender" data-val="1">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:13,column:52},end:{line:13,column:71}}}):s)+' and back to folder</a></li>\n        <li><a href="#" class="sender" data-val="3">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:14,column:52},end:{line:14,column:71}}}):s)+" and add another</a></li>\n"},5:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><a href="#" class="sender" data-val="2">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:16,column:52},end:{line:16,column:71}}}):s)+' and stay on page</a></li>\n        <li><a href="#" class="sender" data-val="1">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:17,column:52},end:{line:17,column:71}}}):s)+' and back to folder</a></li>\n        <li><a href="#" class="sender" data-val="0">'+l("function"==typeof(s=null!=(s=d(i,"shortButtonText")||(null!=e?d(e,"shortButtonText"):e))?s:r)?s.call(a,{name:"shortButtonText",hash:{},data:o,loc:{start:{line:18,column:52},end:{line:18,column:71}}}):s)+' and next active</a></li>\n        <li class="divider"></li>\n        <li><a id="js-changeRedirect" href="#" data-toggle="modal">Change default redirect</a></li>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button data-cy="sendButton" class="btn btn-success" id="sendBtn" data-loading-text="Creating...">'+t.escapeExpression("function"==typeof(a=null!=(a=l(i,"mainButtonText")||(null!=e?l(e,"mainButtonText"):e))?a:t.hooks.helperMissing)?a.call(r,{name:"mainButtonText",hash:{},data:o,loc:{start:{line:1,column:98},end:{line:1,column:116}}}):a)+'</button>\n<button class="btn btn-success dropdown-toggle" id="sendCaret" data-toggle="dropdown" data-loading-text=" ">\n    <i class="caret"></i>\n</button>\n<ul id="sendOptions" role="menu" class="dropdown-menu pull-right">\n'+(null!=(s=l(i,"if").call(r,null!=(s=null!=e?l(e,"thread"):e)?l(s,"originalCreatorName"):s,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:4},end:{line:9,column:11}}}))?s:"")+"\n"+(null!=(s=l(i,"if").call(r,null!=e?l(e,"isNewConvo"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:11,column:4},end:{line:21,column:11}}}))?s:"")+"</ul>\n"},useData:!0})},5600:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(5)),o=l(i(1)),s=l(i(6)),a=l(i(231)),r=l(i(5601));function l(t){return t&&t.__esModule?t:{default:t}}var d=s.default.ItemView.extend({tagName:"form",className:"form-horizontal",id:"changeRedirect",template:r.default,ui:{select:"select"},onRender:function(){this.$el.submit(o.default.bind(this.onSubmit,this))},serializeData:function(){return{redirectOptions:[{value:0,name:"Next active conversation"},{value:2,name:"Stay on the same page"},{value:1,name:"Back to folder"}],current:a.default.data.get("member.convRedirect")}},onSubmit:function(t){t&&t.preventDefault();var e=this.ui.select.val()||1;n.default.Utils.Main.cursorLoading(),n.default.Utils.Ajax.put({url:"".concat(hsGlobal.path,"user/").concat(a.default.data.get("member.id"),"/redirect-option/").concat(e,".json"),done:o.default.bind((function(){n.default.Plugins.Flash.success("Settings saved"),this.trigger("changed",e),this.close()}),this)}).always(n.default.Utils.Main.cursorDefault)}});e.default=d},5601:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,o,s){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="control-group">\n    <label for="redirect" class="control-label">Default redirect</label>\n    <div class="controls">\n        <select name="redirect" id="optionsRedirect">\n            '+t.escapeExpression((a=i(243),a&&(a.__esModule?a.default:a)).call(null!=e?e:t.nullContext||{},null!=e?r(e,"redirectOptions"):e,null!=e?r(e,"current"):e,{name:"options",hash:{},data:s,loc:{start:{line:5,column:12},end:{line:5,column:47}}}))+'\n        </select>\n        <p class="help-block">This setting gives you control over what page loads after you perform an action (send a reply, add a note, etc.).\x3c!-- For an explanation of each and to see how it works, <a href="#">check out this quick video.</a>--\x3e</p>\n    </div>\x3c!--/controls--\x3e\n</div>\x3c!--/control-group--\x3e\n<div class="form-actions">\n    <button class="btn btn-success" data-loading-text=\'Saving...\'>Save</button>\n    <button class="btn btn-link" data-dismiss="modal">Cancel</button>\n</div>\n'},useData:!0})},5602:function(t,e,i){(function(e){window;var n=i(5603);function o(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}window.RedactorPlugins=window.RedactorPlugins||{},RedactorPlugins.mentions={init:function(){this.opts.mentions_options&&(this.autocomplete=new a,this.autocomplete.init(this,this.opts.mentions_options))}};var a=function(){return{variables:{},redactor:!1,modifiers:["shift","ctrl","alt","leftMeta","rightMeta","Dead","capsLock","select","fireFoxMeta","altGraph"],keyDownEvent:{},init:function(t,e){var i=this;this.redactor=t,this.setupVariables(e);var s=t.opts.keydownCallback;t.opts.keydownCallback=function(t){s&&s(t);var e=i.keyToCharacter(t.keyCode,t.key);if(i.variables.isOn){if(["up","down","tab","return"].includes(e))return t.preventDefault(),!1}else"backspace"===e&&i.checkForMentionDeletion(t)},t.$editor.on("keyup.redactor-limiter",(function(t){var e=t.which,o=t.key;i.keyDownEvent&&i.keyDownEvent.key!==t.key&&"Dead"!==t.key&&(0,n.hasAccents)(i.keyDownEvent.key)&&(0,n.removeAccents)(i.keyDownEvent.key)===t.key&&(e=i.keyDownEvent.keyCode,o=i.keyDownEvent.key);var s=i.keyToCharacter(e,o);i.modifiers.includes(s)||(i.variables.isOn?i.performAutocomplete(t,s):(i.addToCappedQueue(e,t.shiftKey),i.triggerAutocompleteMode()),i.keyDownEvent=null)})),t.$editor.on("keypress.mentions-state",(function(t){var e=document.getSelection();if(e.rangeCount>0){var i=e.getRangeAt(0),n=e.focusNode,o=3==n.nodeType?n.parentNode:n;if($(o).hasClass("mention-highlight")){var s=document.createTextNode(" ");0===i.startOffset?(i.setStartBefore(o),i.setEndBefore(o)):(i.setStartAfter(o),i.setEndAfter(o)),i.insertNode(s),e.removeAllRanges(),e.addRange(i),32===t.which&&(t.preventDefault(),i.setStartAfter(s),i.setEndAfter(s),e.removeAllRanges(),e.addRange(i))}}})),t.$editor.on("keydown",(function(t){i.keyDownEvent=t;var e=i.keyToCharacter(t.keyCode,t.key);if(i.variables.isOn){["backspace","left","right"].includes(e)&&t.metaKey&&i.turnOff()}else"left"===e?i.checkIfCaretIsInMentionAndMoveItToThe("left")&&t.preventDefault():["right","down","up"].includes(e)&&setTimeout((function(){i.checkIfCaretIsInMentionAndMoveItToThe("right")}),0)})),t.$editor.on("close",this.destroy.bind(this)),t.$editor.on("click",this.turnOff.bind(this)),t.$editor.on("paste",(function(t){if(i.variables.isOn&&t.originalEvent&&t.originalEvent.clipboardData){var e=t.originalEvent.clipboardData.getData("Text"),n=e&&/[^\w]+/g.test(e);if(e&&!n){var s=o(e);i.variables.searchString=[].concat(o(i.variables.searchString),o(s)),i.updateDropDown()}else n&&i.turnOff()}})),t.$editor.on("mention:trigger",this.triggerAutocompleteMode.bind(this)),this.variables.$dropDownContainer.appendTo("body")},setupVariables:function(t){this.variables={},this.variables.triggerString=t.triggerString||"{{ ",this.variables.labelValueHash=t.labelValueHash,this.variables.onDropdownShow=t.onDropdownShow,this.variables.onDropdownHide=t.onDropdownHide,this.variables.cappedQueueLength=this.variables.triggerString.length,this.variables.cappedQueue=[],this.variables.previousLetter="",this.variables.isOn=!1,this.variables.searchString=[],this.variables.$dropDownContainer=this.buildDropDownContainer(),this.variables.$dropDownList=this.variables.$dropDownContainer.find("ul"),this.variables.$dropDownScrollable=this.variables.$dropDownContainer.find(".dropdown-menu"),this.variables.currentSelectedValue="",this.variables.mentionUsers=t.labelValueHash.map((function(t){return{display:t[0],mention:t[1].normalize(),mentionNoAccent:(0,n.removeAccents)(t[1].normalize()),fullName:t[2].normalize(),fullNameNoAccent:(0,n.removeAccents)(t[2].normalize()),email:t[3],avatar:t[4],initials:t[5]}}))},triggerAutocompleteMode:function(){var t=this.redactor.getCurrent().textContent,e=this.redactor.getCaretOffsetRange();if(t&&e.equals()){var i=e[0]-1,n=t.charAt(i),o=t.charAt(e[0]-2);if(n!==this.variables.triggerString){var s=t.indexOf(" ",i);-1===s&&(s=t.length);var a=/\S+$/.exec(t.slice(0,s)),r=a?a[0]:null;r&&0===r.indexOf(this.variables.triggerString)&&(n=this.variables.triggerString,i=t.indexOf(r),o=t.charAt(i-1))}if(n===this.variables.triggerString&&!this.isCaretInMention()){var l=""===o.replace(/\u200B/g,""),d=" "===o.replace(/\u00a0/g," ");if(l||d){this.redactor.selectionRemoveMarkers(),this.redactor.selectionSave();var c=this.redactor.getEditor().find("#selection-marker-1").parents("code, a, pre").length>0;this.redactor.selectionRemoveMarkers(),c||this.turnOn()}}}},turnOn:function(){this.variables.isOn=!0,this.updateDropDown()},turnOff:function(){this.variables.searchString=[],this.variables.isOn=!1,this.hideDropDown()},destroy:function(){this.turnOff(),this.variables.$dropDownContainer.remove()},updateDropDown:function(){var t=this;if(this.variables.isOn){var e=this.variables.searchString.join(""),i=new RegExp(e,"i"),o=!0;if(this.variables.$dropDownList.children("li").remove(),this.variables.mentionUsers.forEach((function(s){var a=$("<li></li>").addClass("c-menu__item"),r=-1!==s.mention.search(i)||-1!==s.fullName.search(i)||-1!==s.mentionNoAccent.search(i)||-1!==s.fullNameNoAccent.search(i),l=!1;if((0,n.hasAccents)(e)){var d=new RegExp((0,n.removeAccents)(e),"i");l=-1!==s.mention.search(d)||-1!==s.fullName.search(d)}(r||l)&&(t.buildDropDownLi(a,s),1==o&&(a.addClass("is-active"),o=!1,t.variables.currentSelectedValue=s.mention),a.appendTo(t.variables.$dropDownList))})),0===this.variables.$dropDownList.children("li").length)$('<li class="c-menu__item no-mention-match">No match found</li>').appendTo(this.variables.$dropDownList);else this.showAutocompleteDropdown()}},showAutocompleteDropdown:function(){var t,e,i,n=0,o=0,s=this.redactor.getBox();this.redactor.selectionRemoveMarkers(),this.redactor.selectionSave(),(i=this.redactor.getEditor().find("#selection-marker-1")).length>0&&(i.show(),n=i.position().top+i.outerHeight(),o=i.position().left,i.hide()),t=s.offset().top+$(".redactor_toolbar").outerHeight()+n+4,e=s.offset().left+o+-17,this.variables.$dropDownScrollable.scrollTop(0),this.variables.$dropDownContainer.css("top")!==t+"px"&&(this.variables.$dropDownContainer.css({top:t+"px",left:e+"px"}).show(),this.redactor.opts.preventLineBreak=!0,"function"==typeof this.variables.onDropdownShow&&this.variables.onDropdownShow.apply(this)),this.redactor.selectionRemoveMarkers()},buildDropDownContainer:function(){return $('<div class="hs-dd-mention open"><div class="dropdown-menu"><ul class="c-menu"></ul></div></div>').on("click",(function(t){t.stopPropagation()}))},buildDropDownLi:function(t,e){var i=this,n=this.buildDropDownLiMarkup(e);t.html(n).data("replace-value",e.mention).on("mousedown",(function(t){t.stopImmediatePropagation(),t.preventDefault(),i.replaceWithMatch(i.variables.searchString.join(""),$(this).data("replace-value"),!0)}))},buildDropDownLiMarkup:function(t){var i=e.isNull(t.avatar)?'<div class="c-avatar__initials tx-300" data-initial="'+t.initials+'">'+t.initials+"</div>":'<img src="'+t.avatar+'">';return['<div class="o-flexy" title="'+t.email+'">','<div class="o-flexy__item u-mrg-r-2">','<div class="c-avatar c-avatar--bordered u-centralize c-avatar--md">',i,"</div>","</div>",'<div class="o-flexy__block o-flexy--reset">','<h4 class="u-text-truncate">'+t.display+"</h4>",'<p class="u-text-truncate u-text-muted">',t.fullName,"</p>","</div>","</div>"].join("")},hideDropDown:function(){this.variables.$dropDownContainer.css({top:0,left:0}).hide(),this.redactor.opts.preventLineBreak=!1,"function"==typeof this.variables.onDropdownHide&&this.variables.onDropdownHide.apply(this)},dropDownUp:function(){var t=this.variables.$dropDownList.find(".is-active"),e=t.prev();e.length&&(t.removeClass("is-active"),e.addClass("is-active"),this.variables.currentSelectedValue=e.data("replace-value"),this.scrollContainer(e))},dropDownDown:function(){var t=this.variables.$dropDownList.find(".is-active"),e=t.next();e.length&&(t.removeClass("is-active"),e.addClass("is-active"),this.variables.currentSelectedValue=e.data("replace-value"),this.scrollContainer(e))},scrollContainer:function(t){var e=this.variables.$dropDownScrollable.scrollTop()-this.variables.$dropDownScrollable.height()+(t.position().top+t.outerHeight());this.variables.$dropDownScrollable.scrollTop(e)},keyToCharacter:function(t,e,i){var n={50:"@"},o={219:"{",8:"backspace",9:"tab",13:"return",17:"ctrl",18:"alt",16:"shift",32:"space",37:"left",38:"up",39:"right",40:"down",91:"leftMeta",92:"rightMeta",93:"select",20:"capsLock",224:"fireFoxMeta",225:"altGraph"};return"Dead"===e?e:t in o?o[t]:i&&t in n?n[t]:e||String.fromCharCode(t)},addToCappedQueue:function(t,e){var i=this.keyToCharacter(t,null,e);this.modifiers.includes(i)||this.variables.cappedQueue.push(i),this.variables.cappedQueue.length>this.variables.cappedQueueLength&&(this.variables.previousLetter=this.variables.cappedQueue.shift())},performAutocomplete:function(t,e){var i=t.altKey,n=t.ctrlKey;switch(e){case"tab":case"return":this.replaceWithMatch(this.variables.searchString.join(""),this.variables.currentSelectedValue);break;case"left":case"right":this.turnOff();break;case"up":this.dropDownUp();break;case"down":this.dropDownDown();break;default:this.updateSearchString(e,{altKey:i,ctrlKey:n})}},updateSearchString:function(t,e){var i=e.altKey,o=void 0!==i&&i,s=e.ctrlKey,a=void 0!==s&&s;switch(t){case"backspace":if(this.variables.searchString.length<1){this.turnOff();break}o?this.variables.searchString=[]:a?this.turnOff():this.variables.searchString.pop(),this.updateDropDown();break;case"space":this.checkForExactMatch();break;case"shift":case"Dead":break;default:(/^\w+$/.test(t)||(0,n.hasAccents)(t))&&this.variables.searchString.push(t),this.updateDropDown()}},checkForExactMatch:function(){var t=this.variables.searchString.join(""),e=this.variables.currentSelectedValue;return t.toLowerCase()===e.toLowerCase().replace("@","")?this.replaceWithMatch(this.variables.searchString.join("")+" ",this.variables.currentSelectedValue):this.turnOff()},replaceWithMatch:function(t,e,i){this.redactor.insertHtml("&nbsp;%*%"),this.redactor.selectionSave();var n=this.redactor.getEditor().html().replace(/&nbsp;/g," "),o=new RegExp(this.variables.triggerString+t+" %\\*%","i");if(-1!=(n=this.stripInvisibleHtmlSpaces(n)).search(o)){var s=""===e?"":'<b onmousedown="return false;" class="mention-highlight">'+e+"</b>&nbsp;";this.replaceSymbolsWithFinalProductAndSetCode(n,o,s)}else this.replaceSymbolsWithFinalProductAndSetCode(n," %*%","");this.turnOff(),this.redactor.selectionRestore(!0),""!==e&&this.addToCappedQueue(32),this.redactor.sync()},replaceSymbolsWithFinalProductAndSetCode:function(t,e,i){t=t.replace(e,i),this.redactor.savedSel=t},stripInvisibleHtmlSpaces:function(t){var e=$("<div></div>");return e.html(this.stringStripInvisibleWhiteSpaceCharacters(t)),(e=this.stripRedactorInvisibleSpace(e)).html()},stripRedactorInvisibleSpace:function(t){return(t=this.moveRedactorSelectionMarkersOutOfInvisibleSpaces(t)).find(".redactor-invisible-space").remove(),t},moveRedactorSelectionMarkersOutOfInvisibleSpaces:function(t){return t.find(".redactor-invisible-space .redactor-selection-marker").each((function(){$(this).insertBefore($(this).parent())})),t},stringStripInvisibleWhiteSpaceCharacters:function(t){return t.replace(/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g,"")},isCaretInMention:function(){var t=document.getSelection();if(t.rangeCount>0){t.getRangeAt(0);var e=t.focusNode,i=3==e.nodeType?e.parentNode:e;if($(i).hasClass("mention-highlight"))return!0}return!1},checkIfCaretIsInMentionAndMoveItToThe:function(t){var e=document.getSelection();if(e.rangeCount>0){var i=e.getRangeAt(0),n=e.anchorNode,o=3===n.nodeType?n.parentNode:n;if($(o).hasClass("mention-highlight"))return"left"===t?(i.setStartBefore(o),i.setEndBefore(o)):(i.setStartAfter(o),i.setEndAfter(o)),e.removeAllRanges(),e.addRange(i),!0}return!1},checkForMentionDeletion:function(t){var e=document.getSelection();if(e.rangeCount>0){var i=e.getRangeAt(0),n=e.focusNode,o=3==n.nodeType?n.parentNode:n;if($(o).hasClass("mention-highlight")){var s=document.createTextNode(" ");return i.deleteContents(),i.setStartAfter(o),i.setEndAfter(o),i.insertNode(s),e.removeAllRanges(),e.addRange(i),i.selectNode(o),i.deleteContents(),!0}}return!1}}};t.exports=a}).call(this,i(1))},5603:function(t,e){window;Object.defineProperty(e,"__esModule",{value:!0}),e.removeAccents=e.hasAccents=e.default=void 0;var i={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ấ":"A","Ắ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Æ":"AE","Ầ":"A","Ằ":"A","Ȃ":"A","Ç":"C","Ḉ":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ế":"E","Ḗ":"E","Ề":"E","Ḕ":"E","Ḝ":"E","Ȇ":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ḯ":"I","Ȋ":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ố":"O","Ṍ":"O","Ṓ":"O","Ȏ":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ấ":"a","ắ":"a","ẳ":"a","ẵ":"a","ặ":"a","æ":"ae","ầ":"a","ằ":"a","ȃ":"a","ç":"c","ḉ":"c","è":"e","é":"e","ê":"e","ë":"e","ế":"e","ḗ":"e","ề":"e","ḕ":"e","ḝ":"e","ȇ":"e","ì":"i","í":"i","î":"i","ï":"i","ḯ":"i","ȋ":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ố":"o","ṍ":"o","ṓ":"o","ȏ":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","C̆":"C","c̆":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","Ǵ":"G","ĝ":"g","ǵ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ḫ":"H","ḫ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ḱ":"K","ḱ":"k","K̆":"K","k̆":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"l","ł":"l","Ḿ":"M","ḿ":"m","M̆":"M","m̆":"m","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","N̆":"N","n̆":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","P̆":"P","p̆":"p","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","R̆":"R","r̆":"r","Ȓ":"R","ȓ":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","Ș":"S","ș":"s","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","ț":"t","Ț":"T","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","T̆":"T","t̆":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ȗ":"U","ȗ":"u","V̆":"V","v̆":"v","Ŵ":"W","ŵ":"w","Ẃ":"W","ẃ":"w","X̆":"X","x̆":"x","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Y̆":"Y","y̆":"y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ứ":"U","ứ":"u","Ṹ":"U","ṹ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o","Þ":"TH","þ":"th","Ṕ":"P","ṕ":"p","Ṥ":"S","ṥ":"s","X́":"X","x́":"x","Ѓ":"Г","ѓ":"г","Ќ":"К","ќ":"к","A̋":"A","a̋":"a","E̋":"E","e̋":"e","I̋":"I","i̋":"i","Ǹ":"N","ǹ":"n","Ồ":"O","ồ":"o","Ṑ":"O","ṑ":"o","Ừ":"U","ừ":"u","Ẁ":"W","ẁ":"w","Ỳ":"Y","ỳ":"y","Ȁ":"A","ȁ":"a","Ȅ":"E","ȅ":"e","Ȉ":"I","ȉ":"i","Ȍ":"O","ȍ":"o","Ȑ":"R","ȑ":"r","Ȕ":"U","ȕ":"u","B̌":"B","b̌":"b","Č̣":"C","č̣":"c","Ê̌":"E","ê̌":"e","F̌":"F","f̌":"f","Ǧ":"G","ǧ":"g","Ȟ":"H","ȟ":"h","J̌":"J","ǰ":"j","Ǩ":"K","ǩ":"k","M̌":"M","m̌":"m","P̌":"P","p̌":"p","Q̌":"Q","q̌":"q","Ř̩":"R","ř̩":"r","Ṧ":"S","ṧ":"s","V̌":"V","v̌":"v","W̌":"W","w̌":"w","X̌":"X","x̌":"x","Y̌":"Y","y̌":"y","A̧":"A","a̧":"a","B̧":"B","b̧":"b","Ḑ":"D","ḑ":"d","Ȩ":"E","ȩ":"e","Ɛ̧":"E","ɛ̧":"e","Ḩ":"H","ḩ":"h","I̧":"I","i̧":"i","Ɨ̧":"I","ɨ̧":"i","M̧":"M","m̧":"m","O̧":"O","o̧":"o","Q̧":"Q","q̧":"q","U̧":"U","u̧":"u","X̧":"X","x̧":"x","Z̧":"Z","z̧":"z","ß":"b","ẞ":"SS"},n=Object.keys(i).join("|"),o=new RegExp(n,"g"),s=new RegExp(n,"");function a(t){return i[t]}var r=function(t){return t.replace(o,a)};e.removeAccents=r;e.hasAccents=function(t){return!!t&&!!t.match(s)};var l=r;e.default=l},5604:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return"Forwarding"},3:function(t,e,i,n,o){return"Sending"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<span class="help-tip js-move-message" style="display: none;">\n    '+(null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isForward"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:2,column:4},end:{line:2,column:53}}}))?s:"")+' to a mailbox in your account isn\'t going to work.\n    Try\n    <a class="js-move-modal" title="Move conversations to different mailboxes" href="javascript:void(0)" data-beacon-article="536131f6e4b08476e7df2f89" style="display:none;">moving the conversation</a>\n    <a href="javascript:void(0)" class="js-move-action" title="Move this conversation" style="display:none;">moving the conversation</a>\n    instead.\n</span>\n'},useData:!0})},5605:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=g(i(5)),o=g(i(1)),s=g(i(8)),a=g(i(20)),r=g(i(70)),l=g(i(6)),d=g(i(231)),c=g(i(293)),u=g(i(5606)),h=g(i(5607)),p=g(i(5614)),f=g(i(152)),m=g(i(623));function g(t){return t&&t.__esModule?t:{default:t}}var v={enter:13,space:32,left:37,up:38,right:39,down:40};d.default.getLinkType=function(t){var e=!1;if(d.default.sites[t.get("siteId")]&&"published"===t.get("status")){var i="public"===t.get("visibility"),o=d.default.request("get-editor-thread-type");e=i||o==n.default.Constants.threadType.NOTE?"insert":m.default.isSupported()?"copy":"newTab"}return e},d.default.insertArticleContent=function(t){var e=new f.default({id:t}),i=e.fetch();return i.then(o.default.bind((function(){d.default.trigger("docssearch:insert-content",e)}),this)).always(n.default.Utils.Main.cursorDefault).fail((function(t,e){"abort"!==e&&n.default.Utils.Main.error("Unable to load article content")})),n.default.Utils.Main.cursorLoading(),i};var b=l.default.Layout.extend({template:p.default,events:{"keydown #docsSearch":"onKeyDown","keyup #docsSearch":"onKeyUp","focus #docsSearch":"onFocus","blur #docsSearch":"onBlur"},ui:{input:"input#docsSearch",collectSelect:"select#collSelect",results:"#results"},regions:{results:"#results"},initialize:function(){window.App=d.default,this.options.collections=this.options.collections||[],d.default.sites=this.options.sites,o.default.bindAll(this,"onKeydown"),this.searchResults=new u.default,this.listenTo(d.default,"close-search-results",this.closeSearchResults),this.listenTo(d.default,"show-modal",this.onShowModal),this.listenTo(d.default,"docs-search-focus",this.doFocus),this.listenTo(d.default,"modal-closed",this.onModalClosed),this.listenTo(this.searchResults,"change add remove sync reset",(function(){this.searchResults.length>0?(this.ui.results.show(),n.default.stack.opened("docsSearchResults",o.default.bind(this.closeSearchResults,this))):(this.ui.results.hide(),n.default.stack.closed("docsSearchResults"))})),this.searchState=new a.default.Model({searching:!1,noResults:!1})},onKeydown:function(t){191===t.which&&(t.ctrlKey||t.metaKey)&&this.doFocus()},onClose:function(){n.default.stack.closed("docsSearchResults"),(0,s.default)(document).off("keydown",this.onKeydown)},onShow:function(){this.results.ensureEl(),this.results.show(new h.default({collection:this.searchResults,searchState:this.searchState})),(0,s.default)(document).on("keydown",this.onKeydown)},closeSearchResults:function(t){this.searchResults.reset(),this.stopSearchTimer(),this.skipCloseOnBlur=!1,t&&this.ui.input.val(""),this.queryXhr&&this.queryXhr.abort(),n.default.stack.closed("docsSearchResults")},serializeData:function(){return{collections:this.options.collections,multiCollections:this.options.collections.length>1,cmdCtrl:n.default.Utils.Main.isAppleDevice()?"cmd":"ctrl",isDemoMailbox:appData.mailbox.isDemo}},doFocus:function(){this.ui.input.focus()},onBlur:function(){!0!==this.skipCloseOnBlur&&n.default.stack.close("docsSearchResults"),this.skipCloseOnBlur=!1},onKeyUp:function(t){if(this.searchState.set("noResults",!1),t.which==v.enter)this.results.currentView&&d.default.reqres.request("selected-id")?(d.default.trigger("show-modal",d.default.reqres.request("selected-id")),this.ui.input.blur()):this.doSearch(),this.stopSearchTimer();else if(t.which==v.space){var e=!0;if(this.results.currentView){var i=d.default.reqres.request("selected-id");if(i){var n=this.searchResults.get(i),s=d.default.getLinkType(n);if(n&&"insert"===s)this.results.currentView.children.findByModel(n).insertLink(),e=!1}}e&&this.startSearchTimer()}else t.which==v.up?d.default.trigger("search:arrowKey","up"):t.which==v.down?d.default.trigger("search:arrowKey","down"):27==t.which?(t.stopPropagation(),this.ui.input.val("").blur()):o.default.contains(o.default.values(v),t.which)||this.startSearchTimer()},onKeyDown:function(t){t.which!=v.enter&&t.which!=v.up&&t.which!=v.down||t.preventDefault()},doSearch:function(){var t=this.ui.input.val(),e=this.ui.collectSelect.val();this.lastQueryValue=t;var i={query:t};e&&(i.collectionId=e),this.queryXhr&&this.queryXhr.abort(),this.searchState.set("searching",!0),this.queryXhr=this.searchResults.fetch({data:i}).done(s.default.proxy((function(){this.searchState.set("noResults",0==this.searchResults.length&&this.ui.input.val()==this.lastQueryValue),this.searchState.set("searching",!1)}),this))},stopSearchTimer:function(){this.clearTimeout("check-search")},startSearchTimer:function(){this.setTimeout("check-search",this.checkSearch,200)},checkSearch:function(){var t=this.ui.input.val();t&&t.length&&t.replace(/\s/g,"").length?this.doSearch():(this.closeSearchResults(),this.lastQueryValue=t)},onShowModal:function(){this.skipCloseOnBlur=!0},onModalClosed:function(t){t?this.closeSearchResults(!0):this.ui.input.focus(),this.skipCloseOnBlur=!1}});r.default.mixin(b,c.default);var y=b;e.default=y},5606:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(20)),o=s(i(5555));function s(t){return t&&t.__esModule?t:{default:t}}var a=n.default.Collection.extend({url:"".concat(hsGlobal.path,"docsSearch"),model:o.default,parse:function(t){var e=void 0;return this.count=t&&t.articles&&t.articles.count?t.articles.count:0,t&&t.articles&&t.articles.results&&(e=t.articles.results),e}});e.default=a},5607:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(1)),o=l(i(6)),s=l(i(231)),a=l(i(5608)),r=l(i(5612));function l(t){return t&&t.__esModule?t:{default:t}}var d=o.default.CollectionView.extend({tagName:"ul",className:"searchResults",itemView:a.default,emptyView:r.default,events:{mousedown:"preventSearchBarBlurOnMousedown"},initialize:function(){this.listenTo(s.default,"search:arrowKey",this.arrowUpDown),this.listenTo(this,"itemview:select",this.selectItem),s.default.reqres.setHandler("selected-id",this.getSelectedId,this),this.listenTo(s.default,"search-results-select",this.selectById),this.listenTo(this.collection,"sync reset",this.reset)},onClose:function(){s.default.reqres.removeHandler("selected-id",this.getSelectedId)},reset:function(){this.selectedIndex=void 0,this.selectedModel=void 0,this.render()},arrowUpDown:function(t){this.setSelectedIndex(t),this.selectedModel=this.getSelectedModel(),this.render()},onRender:function(){this.scrollToSelected()},scrollToSelected:function(){if(null!=this.selectedIndex){var t=this.children.findByIndex(this.selectedIndex).$el;if(t.length){var e=this.$el.scrollTop(),i=t.position().top+e,n=e+this.$el.innerHeight();(i<e||i+t.height()>n)&&this.$el.scrollTop(i)}}},getSelectedModel:function(){var t=null;return this.selectedIndex>=0&&this.selectedIndex<this.collection.length&&(t=this.collection.at(this.selectedIndex)),t},setSelectedIndex:function(t){var e=this.selectedIndex;null!=e?"up"===t?e--:"down"===t&&e++:"up"===t?e=this.collection.length-1:"down"===t&&(e=0),(e<0||e>=this.collection.length)&&(e=void 0),this.selectedIndex=e},getSelectedId:function(){var t=this.getSelectedModel();if(t)return t.get("id")},selectItem:function(t,e){this.$("li.active").removeClass("active");var i=this.collection.indexOf(e);null!=i&&null!=i&&(this.selectedIndex=i)},selectById:function(t){this.selectedModel=this.collection.get(t),this.selectedIndex=this.collection.indexOf(this.selectedModel),this.render()},buildItemView:function(t,e,i){return new e(n.default.extend({model:t,selected:t===this.selectedModel,searchResults:this.collection,searchState:this.options.searchState},i))},preventSearchBarBlurOnMousedown:function(t){t.preventDefault()}});e.default=d},5608:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=f(i(5)),o=f(i(1)),s=f(i(8)),a=f(i(70)),r=f(i(6)),l=f(i(231)),d=f(i(5555)),c=f(i(5609)),u=f(i(5610)),h=f(i(293)),p=f(i(1560));function f(t){return t&&t.__esModule?t:{default:t}}var m=r.default.ItemView.extend({tagName:"li",template:c.default,model:new d.default,ui:{copy:".copyLink",insert:".insert",newTab:".newTab",tooltip:"[rel=tooltip]"},events:{click:"onClick","click @ui.insert":"insertLink","click @ui.newTab":"openInNewTab"},initialize:function(t){o.default.bindAll(this,"select"),this.listenTo(l.default,"show-modal",this.onShowModal),this.searchResults=t.searchResults},onShowModal:function(t){t===this.model.get("id")&&this.showModal()},onClose:function(){this.copyButton&&this.copyButton.destroy(),this.ui.tooltip.tooltip("destroy"),this.$el.unbind("mouseover")},select:function(){this.trigger("select",this.model),this.options.selected=!0,this.$el.addClass("active")},serializeData:function(){var t=l.default.getLinkType(this.model),e=this.model.toJSON();return o.default.isString(e.preview)&&(e.preview=e.preview.replace(/&nbsp;/g," ")),o.default.extend(e,{link:t,selected:this.options.selected})},onRender:function(){this.options.selected&&this.$el.addClass("active"),"private"===this.model.get("visibility")&&this.$el.addClass("private"),"notpublished"===this.model.get("status")&&this.$el.addClass("notpublished")},onShow:function(){"copy"==l.default.getLinkType(this.model)&&(this.copyButton=new p.default({el:this.ui.copy}),this.copyButton.on("copy",this.onCopy,this)),n.default.Utils.Main.initTooltips(this.ui.tooltip,{container:this.$el.closest("section"),placement:"bottom"}),this.setTimeout("hoverTimeout",(function(){this.$el.bind("mouseover",this.select)}),300)},onClick:function(t){t.preventDefault(),t.metaKey||t.ctrlKey?this.openInNewTab(t):l.default.trigger("show-modal",this.model.get("id"))},showModal:function(t){t&&t.stopPropagation&&t.stopPropagation();var e=this.searchResults.clone(),i=new u.default({model:this.model,searchResults:e});this.listenTo(i,"insert-link",this.insertLink),l.default.modalRegion.show(i,"docPreview")},insertLink:function(t){t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation(),(0,s.default)(t.currentTarget).trigger("mouseout")),l.default.trigger("docssearch:insert-link",this.model.toJSON());l.default.trigger("close-search-results",!0)},onCopy:function(){l.default.trigger("close-search-results",!0)},openInNewTab:function(t){t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),window.open(this.model.get("url"),"_blank"),l.default.trigger("close-search-results",!0)}});a.default.mixin(m,h.default);var g=m;e.default=g},5609:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,i,n,o){return" unpublished"},3:function(t,e,i,n,o){return'<i class="badge">Unpublished</i>'},5:function(t,e,i,n,o){return'<i class="badge">Private</i>'},7:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=e?s(e,"preview"):e,e))},9:function(t,e,i,n,o){return"(no preview)"},11:function(t,e,n,s,a){var r,l=null!=e?e:t.nullContext||{},d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="copyInsert">\n'+(null!=(r=o(i(10)).call(l,null!=e?d(e,"link"):e,"===","insert",{name:"ifCond",hash:{},fn:t.program(12,a,0),inverse:t.noop,data:a,loc:{start:{line:8,column:8},end:{line:10,column:19}}}))?r:"")+(null!=(r=o(i(10)).call(l,null!=e?d(e,"link"):e,"===","copy",{name:"ifCond",hash:{},fn:t.program(14,a,0),inverse:t.noop,data:a,loc:{start:{line:11,column:8},end:{line:13,column:19}}}))?r:"")+(null!=(r=o(i(10)).call(l,null!=e?d(e,"link"):e,"===","newTab",{name:"ifCond",hash:{},fn:t.program(16,a,0),inverse:t.noop,data:a,loc:{start:{line:14,column:8},end:{line:16,column:19}}}))?r:"")+"\n    </div>\x3c!--/copyInsert--\x3e\n"},12:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <a class="insert" target="_blank" href="'+t.escapeExpression(t.lambda(null!=e?s(e,"url"):e,e))+'" rel="tooltip" data-toggle="tooltip"  title="Insert (spacebar)"><i class="icon-doc-arrow"></i></a>\n'},14:function(t,e,i,n,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <a class="copyLink" href="'+a(s(null!=e?r(e,"url"):e,e))+'" data-clipboard-text="'+a(s(null!=e?r(e,"url"):e,e))+'" data-copy-message="Copied URL to clipboard" rel="tooltip" data-toggle="tooltip"  title="Copy URL to clipboard"><i class="icon-hyperlink"></i></a>\n'},16:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <a class="newTab" target="_blank" href="'+t.escapeExpression(t.lambda(null!=e?s(e,"url"):e,e))+'" rel="tooltip" data-toggle="tooltip" title="Open Article in new tab"><i class="icon-hyperlink"></i></a>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,a){var r,l=null!=e?e:t.nullContext||{},d=t.lambda,c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="link'+(null!=(r=o(i(10)).call(l,null!=e?u(e,"status"):e,"===","notpublished",{name:"ifCond",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:1,column:16},end:{line:1,column:78}}}))?r:"")+'">\n  <span class="previewFade"></span>\n  <a class="name" href="'+c(d(null!=e?u(e,"url"):e,e))+'">'+c(d(null!=e?u(e,"name"):e,e))+(null!=(r=o(i(10)).call(l,null!=e?u(e,"status"):e,"===","notpublished",{name:"ifCond",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:41},end:{line:3,column:123}}}))?r:"")+" "+(null!=(r=o(i(10)).call(l,null!=e?u(e,"visibility"):e,"===","private",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:124},end:{line:3,column:201}}}))?r:"")+'</a>\n  <p class="preview">'+(null!=(r=u(n,"if").call(l,null!=e?u(e,"preview"):e,{name:"if",hash:{},fn:t.program(7,a,0),inverse:t.program(9,a,0),data:a,loc:{start:{line:4,column:21},end:{line:4,column:74}}}))?r:"")+"</p>\n</div>\x3c!--/link--\x3e\n"+(null!=(r=u(n,"if").call(l,null!=e?u(e,"link"):e,{name:"if",hash:{},fn:t.program(11,a,0),inverse:t.noop,data:a,loc:{start:{line:6,column:0},end:{line:19,column:7}}}))?r:"")},useData:!0})},5610:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=g(i(5)),o=g(i(1)),s=g(i(8)),a=g(i(70)),r=g(i(6)),l=g(i(231)),d=g(i(5555)),c=g(i(5611)),u=g(i(1560)),h=g(i(622)),p=g(i(152)),f=g(i(293)),m=i(223);function g(t){return t&&t.__esModule?t:{default:t}}var v=r.default.ItemView.extend({template:c.default,model:new d.default,ui:{previewContainer:".previewContainer",previewIframe:"#previewIframe",copy:".copy",insert:".insert",insertContent:".insertContent"},events:{"click @ui.insert":"insertLink","click @ui.insertContent":"insertContent","click .next":"goNext","click .prev":"goPrev"},behaviors:{IframeContainerModal:{behaviorClass:h.default}},serializeData:function(){var t=this.model.get("docsUrl"),e=hsGlobal.path+t;return t&&t.length&&(e=hsGlobal.path+t.replace("/","")),o.default.extend(this.model.toJSON(),{canEditArticle:(0,m.canEditDocsArticle)(),editUrl:e,path:hsGlobal.path,link:l.default.getLinkType(this.model),next:!!this.nextModel&&this.nextModel.toJSON(),prev:!!this.prevModel&&this.prevModel.toJSON()})},initialize:function(t){o.default.bindAll(this,"onBodyKeyEvent"),this.searchResults=t.searchResults.clone(),this.model=this.searchResults.get(this.model.get("id")),(0,s.default)("body").bind("keydown",this.onBodyKeyEvent)},onBeforeRender:function(){var t=this.searchResults.indexOf(this.model);this.prevModel=void 0,this.nextModel=void 0,t>0&&(this.prevModel=this.searchResults.at(t-1)),t<this.searchResults.length-1&&(this.nextModel=this.searchResults.at(t+1))},onShow:function(){this.actionOccurred=!1;l.default.request("get-editor-state");"copy"==l.default.getLinkType(this.model)&&(this.copyButton=new u.default({el:this.ui.copy}),this.copyButton.on("copy",(function(){this.actionOccurred=!0,this.close()}),this)),this.setTimeout((function(){this.ui.insertContent.focus(),this.ui.insert.focus()}),400)},onClose:function(){this.copyButton&&this.copyButton.destroy(),n.default.Utils.Main.abort(this.promise),l.default.trigger("modal-closed",this.actionOccurred),(0,s.default)("body").unbind("keydown",this.onBodyKeyEvent)},insertLink:function(t){t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),l.default.trigger("docssearch:insert-link",this.model.toJSON()),this.actionOccurred=!0,this.close()},insertContent:function(t){t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation());var e=new p.default({id:this.model.get("id")});this.promise=e.fetch(),this.promise.then(o.default.bind((function(){this.actionOccurred=!0,this.close(),l.default.trigger("docssearch:insert-content",e)}),this)).always(n.default.Utils.Main.cursorDefault).fail((function(t,e){"abort"!==e&&n.default.Utils.Main.error("Unable to load article content")})),n.default.Utils.Main.cursorLoading()},goNext:function(){this.nextModel&&(this.model=this.nextModel,this.reload())},goPrev:function(){this.prevModel&&(this.model=this.prevModel,this.reload())},reload:function(){this.copyButton&&this.copyButton.destroy(),this.render(),this.onShow(),this.triggerMethod("show"),l.default.trigger("search-results-select",this.model.get("id"))},onBodyKeyEvent:function(t){75===t.which||75===t.keyCode?this.goNext():74!==t.which&&74!==t.keyCode||this.goPrev()}});a.default.mixin(v,f.default);var b=v;e.default=b},5611:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'    <button type="button" class="btn insert">Insert Link</button>\n'},3:function(t,e,i,n,o){return'    <button type="button" class="btn insertContent">Insert Content</button>\n'},5:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <button type="button" class="btn copy" data-clipboard-text="'+t.escapeExpression(t.lambda(null!=e?s(e,"url"):e,e))+'" data-copy-message="Copied URL to clipboard"\n      title="Copy URL">Copy Link</button>\n'},7:function(t,e,i,n,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <a class="btn" href="'+a(s(null!=e?r(e,"url"):e,e))+'" onclick="window.open(\''+a(s(null!=e?r(e,"url"):e,e))+"', '_blank');\" target=\"_blank\">Open In New Tab</a>\n"},9:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <a href="'+t.escapeExpression(t.lambda(null!=e?s(e,"editUrl"):e,e))+'" class="btn">Edit Article</a>\n'},11:function(t,e,i,n,o){return'    <a href="#" class="prev" title="Previous Article"><i class="icon-caret-left"></i></a>\n'},13:function(t,e,i,n,o){return'    <span class="prev"><i class="icon-caret-left inactive"></i></span>\n'},15:function(t,e,i,n,o){return'    <a href="#" class="next" title="Next Article"><i class="icon-caret-right"></i></a>\n'},17:function(t,e,i,n,o){return'    <span class="next"><i class="icon-caret-right inactive"></i></span>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,a){var r,l=t.lambda,d=t.escapeExpression,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-circle-close"></i></a>\n<div class="modal-header floats">\n  <h5>'+d(l(null!=e?u(e,"name"):e,e))+'</h5>\n  <div class="btn-group">\n'+(null!=(r=o(i(10)).call(c,null!=e?u(e,"link"):e,"===","insert",{name:"ifCond",hash:{},fn:t.program(1,a,0),inverse:t.program(3,a,0),data:a,loc:{start:{line:6,column:4},end:{line:10,column:15}}}))?r:"")+"\n"+(null!=(r=o(i(10)).call(c,null!=e?u(e,"link"):e,"===","copy",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:4},end:{line:16,column:15}}}))?r:"")+(null!=(r=o(i(10)).call(c,null!=e?u(e,"link"):e,"===","newTab",{name:"ifCond",hash:{},fn:t.program(7,a,0),inverse:t.noop,data:a,loc:{start:{line:17,column:4},end:{line:19,column:15}}}))?r:"")+"\n"+(null!=(r=u(n,"if").call(c,null!=e?u(e,"canEditArticle"):e,{name:"if",hash:{},fn:t.program(9,a,0),inverse:t.noop,data:a,loc:{start:{line:21,column:4},end:{line:23,column:11}}}))?r:"")+'  </div>\n  \x3c!--/btn-group--\x3e\n  <section class="pager">\n'+(null!=(r=u(n,"if").call(c,null!=e?u(e,"prev"):e,{name:"if",hash:{},fn:t.program(11,a,0),inverse:t.program(13,a,0),data:a,loc:{start:{line:27,column:4},end:{line:31,column:11}}}))?r:"")+(null!=(r=u(n,"if").call(c,null!=e?u(e,"next"):e,{name:"if",hash:{},fn:t.program(15,a,0),inverse:t.program(17,a,0),data:a,loc:{start:{line:32,column:4},end:{line:36,column:11}}}))?r:"")+'  </section>\n  \x3c!--/pager--\x3e\n</div>\n\x3c!--/modal-header--\x3e\n<div class="modal-body">\n  <div class="previewContainer">\n    <iframe src="'+d(l(null!=e?u(e,"path"):e,e))+"docs/article-preview/"+d(l(null!=e?u(e,"id"):e,e))+'/" id="previewIframe"></iframe>\n  </div>\n</div>\n'},useData:!0})},5612:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(6)),o=s(i(5613));function s(t){return t&&t.__esModule?t:{default:t}}var a=n.default.ItemView.extend({template:o.default,initialize:function(t){this.searchState=t.searchState,this.listenTo(this.searchState,"change",this.render)},serializeData:function(){return this.searchState.toJSON()}});e.default=a},5613:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return""},3:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"noResults"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:5,column:11}}}))?s:""},4:function(t,e,i,n,o){return'    <li class="noResults"><div>No results found</div>\x3c!--/noResults--\x3e</li>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"searching"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:6,column:7}}}))?s:""},useData:!0})},5614:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'class="wCollSelect"'},3:function(t,e,i,n,o){return'style="display:none;"'},5:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<b class="caret"></b>\n\t<select name="collSelect" id="collSelect" tabindex="-1">\n\t    <option value="">All collections</option>\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"collections"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:8},end:{line:10,column:17}}}))?s:"")+"\t</select>\n"},6:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <option value="'+l("function"==typeof(s=null!=(s=d(i,"id")||(null!=e?d(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:9,column:23},end:{line:9,column:29}}}):s)+'">'+l("function"==typeof(s=null!=(s=d(i,"name")||(null!=e?d(e,"name"):e))?s:r)?s.call(a,{name:"name",hash:{},data:o,loc:{start:{line:9,column:31},end:{line:9,column:39}}}):s)+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n<section id="docsApp" '+(null!=(s=l(i,"if").call(r,null!=e?l(e,"multiCollections"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:22},end:{line:2,column:72}}}))?s:"")+" "+(null!=(s=l(i,"if").call(r,null!=e?l(e,"isDemoMailbox"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:73},end:{line:2,column:122}}}))?s:"")+'>\n\t<input type="text" id="docsSearch" placeholder="Search Docs... ('+t.escapeExpression("function"==typeof(a=null!=(a=l(i,"cmdCtrl")||(null!=e?l(e,"cmdCtrl"):e))?a:t.hooks.helperMissing)?a.call(r,{name:"cmdCtrl",hash:{},data:o,loc:{start:{line:3,column:65},end:{line:3,column:76}}}):a)+' + /)" tabindex="-1" autocomplete="docs-search">\n'+(null!=(s=l(i,"if").call(r,null!=e?l(e,"multiCollections"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:2},end:{line:12,column:9}}}))?s:"")+'\t<div style="display:none;" id="results"></div>\n</section>\x3c!--/docsApp--\x3e\n'},useData:!0})},5615:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=g(i(5)),o=g(i(1)),s=g(i(8)),a=g(i(6)),r=g(i(231)),l=g(i(5616)),d=g(i(5617)),c=g(i(5619)),u=g(i(5621)),h=g(i(5623)),p=g(i(5625)),f=g(i(5627)),m=g(i(5629));function g(t){return t&&t.__esModule?t:{default:t}}var v=a.default.CompositeView.extend({SHOW_LINK_LIMIT:4,template:l.default,itemViewContainer:"#convo-custom-fields .masonry-container",ui:{fieldsContainer:"#convo-custom-fields .masonry-container",showLinksContainer:".custom-field-links",showFieldLinks:"a.show-field",showAllFieldsLink:"a.custom-field-show-all",showFieldsLabel:"#js-cf-view-fields-label",showFieldEllipsis:".show-links-ellipsis"},events:{"click @ui.showFieldLinks":"showField","click @ui.showAllFieldsLink":"showAllFields"},itemViewOptions:function(){return{ticket:this.ticket,newConvo:this.isNewConvoView()}},getItemView:function(t){var e,i=t.get("type");if(!this.canUpdate)return f.default;switch(i){case"singleline":e=d.default;break;case"multiline":e=c.default;break;case"dropdown":e=u.default;break;case"number":e=h.default;break;case"date":e=p.default}return e},initialize:function(t){var e=t.canUpdate,i=void 0===e||e,s=t.newConvoView,a=void 0!==s&&s;Object.assign(this,{canUpdate:i,newConvoView:a,ticket:this.collection.ticket});var l=this.collection.ticket.get("customFieldResponses")||[];o.default.each(l,o.default.bind((function(t){var e=this.collection.findWhere({id:t.fieldId});e&&e.set("response",t.value,{silent:!0})}),this)),this.listenTo(r.default,"fields.required",o.default.debounce((function(){n.default.Utils.Main.error("All required fields must be filled out to close this conversation")}),300,!0))},onRender:function(){this.ui.fieldsContainer.append('<div class="clear"/>')},onShow:function(){this.isNewConvoView()||(this.masonry=new m.default(this.ui.fieldsContainer[0],{itemSelector:".custom-field",columnWidth:".custom-field",percentPosition:!0})),this.showHideLinks()},onClose:function(){this.masonry&&this.masonry.destroy()},showField:function(t){t.preventDefault();var e=(0,s.default)(t.currentTarget),i=parseInt(e.data("field-id"),10),n=this.collection.get(i),o=this.children.findByModel(n);o&&o.show(),this.showHideLinks()},showAllFields:function(){this.children.invoke("show"),this.showHideLinks()},showHideLinks:function(){this.children.each(o.default.bind((function(t){var e=t.model.id;this.ui.showLinksContainer.find("[data-field-id=".concat(e,"]")).toggle(!t.$el.is(":visible"))}),this));var t=this.ui.showLinksContainer.find(".show-field:visible").length,e=this.$el.find(".custom-field:hidden").length;0===e?this.ui.showLinksContainer.hide():0===t&&e>0?this.ui.showFieldEllipsis.hide():1===t&&1===e&&(this.ui.showFieldsLabel.text("Show field:"),this.ui.showAllFieldsLink.hide())},isNewConvoView:function(){return this.newConvoView},serializeData:function(){return{isNewConvoView:this.isNewConvoView(),fields:o.default.map(this.collection.where({required:!1}),(function(t){return t.toJSON()})),SHOW_LINK_LIMIT:this.SHOW_LINK_LIMIT}}});e.default=v},5616:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,n,s,a,r,l){var d,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="custom-field-links">\n'+(null!=(d=u(n,"if").call(c,null!=(d=null!=e?u(e,"fields"):e)?u(d,"length"):d,{name:"if",hash:{},fn:t.program(2,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:6,column:4},end:{line:10,column:11}}}))?d:"")+"\n"+(null!=(d=u(n,"each").call(c,null!=e?u(e,"fields"):e,{name:"each",hash:{},fn:t.program(4,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:12,column:4},end:{line:16,column:13}}}))?d:"")+(null!=(d=o(i(10)).call(c,null!=(d=null!=e?u(e,"fields"):e)?u(d,"length"):d,">",null!=e?u(e,"SHOW_LINK_LIMIT"):e,{name:"ifCond",hash:{},fn:t.program(7,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:17,column:4},end:{line:19,column:15}}}))?d:"")+(null!=(d=o(i(10)).call(c,null!=(d=null!=e?u(e,"fields"):e)?u(d,"length"):d,">",1,{name:"ifCond",hash:{},fn:t.program(9,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:20,column:4},end:{line:22,column:15}}}))?d:"")+"</div>\n"},2:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <span id="js-cf-view-fields-label">\n        Show '+t.escapeExpression(o(i(84)).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?l(e,"fields"):e)?l(r,"length"):r,"field","fields",{name:"pluralize",hash:{},data:a,loc:{start:{line:8,column:13},end:{line:8,column:57}}}))+":\n    </span>\n"},4:function(t,e,n,s,a,r,l){var d,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(d=o(i(10)).call(null!=e?e:t.nullContext||{},a&&c(a,"index"),"<",null!=l[1]?c(l[1],"SHOW_LINK_LIMIT"):l[1],{name:"ifCond",hash:{},fn:t.program(5,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:13,column:8},end:{line:15,column:19}}}))?d:""},5:function(t,e,i,n,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <a href="#" class="show-field" data-field-id="'+a(s(null!=e?r(e,"id"):e,e))+'">'+a(s(null!=e?r(e,"name"):e,e))+"</a>\n"},7:function(t,e,i,n,o){return'        <span class="show-links-ellipsis">&#8230;</span>\n'},9:function(t,e,i,n,o){return'        <a href="#" class="custom-field-show-all">Show all</a>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<section id="convo-custom-fields" class="form-horizontal">\n\t<div class="masonry-container"></div>\n</section>\n'+(null!=(r=l(i,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"isNewConvoView"):e,{name:"if",hash:{},fn:t.program(1,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:4,column:0},end:{line:24,column:7}}}))?r:"")},useData:!0,useDepths:!0})},5617:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i(5618));function o(t){return t&&t.__esModule?t:{default:t}}var s=o(i(5552)).default.extend({template:n.default,onShow:function(){}});e.default=s},5618:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<i class="required js-required-asterisk" style="display: none;"></i>'},3:function(t,e,i,n,o){return""},5:function(t,e,i,n,o){return'placeholder="(optional)"'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="control-label" for="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:1,column:41},end:{line:1,column:52}}}):a)+'"><span class="custom-field-saved"><span class="saved-text">saved</span></span>'+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)===d?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:1,column:131},end:{line:1,column:139}}}):a)+(null!=(s=u(i,"if").call(r,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:139},end:{line:1,column:230}}}))?s:"")+'</label>\n<div class="controls">\n    <input type="text" id="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:34},end:{line:3,column:45}}}):a)+'" name="cf-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:56},end:{line:3,column:67}}}):a)+'" class="input-xlarge response-input" maxlength="255" value="'+c(typeof(a=null!=(a=u(i,"response")||(null!=e?u(e,"response"):e))?a:l)===d?a.call(r,{name:"response",hash:{},data:o,loc:{start:{line:3,column:128},end:{line:3,column:140}}}):a)+'" '+(null!=(s=u(i,"if").call(r,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:3,column:142},end:{line:3,column:197}}}))?s:"")+">\n</div>\n"},useData:!0})},5619:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(5)),o=l(i(1)),s=l(i(8)),a=l(i(5620)),r=l(i(5552));function l(t){return t&&t.__esModule?t:{default:t}}var d=r.default.extend({template:a.default,characterLimit:15e3,charCeilingTrigger:500,ui:o.default.extend({},r.default.prototype.ui,{charCounter:".js-char-count"}),events:o.default.extend({},r.default.prototype.events,{"keydown @ui.responseInput":"onKeyDown","paste @ui.responseInput":"onPaste","focus @ui.responseInput":"onFocus"}),onRender:function(){r.default.prototype.onRender.apply(this,arguments),this.toggleCharCounter(!this.ui.charCounter.is(":visible"))},onFocus:function(){this.ui.savedNotification.is(":hidden")&&this.unlockCharCounter(),this.checkCharacterLimit()},onBlur:function(){this.hasExceededMaxCharactersAllowed()||this.toggleCharCounter(!this.ui.charCounter.is(":visible")),r.default.prototype.onBlur.apply(this,arguments)},onKeyUp:function(){this.hasExceededMaxCharactersAllowed()||r.default.prototype.onKeyUp.apply(this,arguments),this.checkCharacterLimit()},onChange:function(){this.hasExceededMaxCharactersAllowed()||r.default.prototype.onChange.apply(this,arguments),this.checkCharacterLimit()},onKeyDown:function(t){8!==t.keyCode&&46!==t.keyCode||this.checkCharacterLimit()},onPaste:function(){setTimeout(o.default.bind((function(){this.checkCharacterLimit()}),this),0)},onBeforeShowSaveNotification:function(){this.lockCharCounter()},onAfterShowSaveNotification:function(){(this.hasExceededMaxCharactersAllowed()||this.ui.responseInput.is(":focus"))&&this.unlockCharCounter(),this.checkCharacterLimit()},checkCharacterLimit:function(){var t=!1,e=this.ui.responseInput.val().length,i=this.characterLimit-e;i<=this.charCeilingTrigger&&i>=0?(t=!0,this.ui.charCounter.text(i).removeClass("error"),0===i&&this.$el.removeClass("error")):i<0?(t=!0,this.ui.charCounter.text(i).addClass("error"),this.$el.addClass("error"),this.recentSavePromise=s.default.Deferred()):(t=!1,this.ui.charCounter.text("").removeClass("error"),this.$el.removeClass("error")),this.ui.charCounter.hasClass("lock")&&(t=!1),this.toggleCharCounter(t)},hasExceededMaxCharactersAllowed:function(){return this.ui.responseInput.val().length>this.characterLimit},toggleCharCounter:function(t){this.ui.charCounter.toggle(t)},lockCharCounter:function(){this.ui.charCounter.addClass("lock")},unlockCharCounter:function(){this.ui.charCounter.removeClass("lock")},respondToSaveConvoRequest:function(){return this.hasExceededMaxCharactersAllowed()?(n.default.Utils.Main.error("Multi-line custom fields are limited to ".concat(this.characterLimit," characters")),!1):r.default.prototype.respondToSaveConvoRequest.apply(this,arguments)}});e.default=d},5620:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<i class="required js-required-asterisk" style="display: none;"></i>'},3:function(t,e,i,n,o){return'placeholder="(optional)"'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="control-label" for="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:1,column:41},end:{line:1,column:52}}}):a)+'">\n    <span class="custom-field-saved"><span class="saved-text">saved</span></span>\n    '+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)===d?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:3,column:4},end:{line:3,column:12}}}):a)+(null!=(s=u(i,"if").call(r,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:12},end:{line:3,column:103}}}))?s:"")+'\n    <span class="js-char-count character-count" style="display: none;"></span>\n</label>\n<div class="controls">\n    <textarea class="response-input" id="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:7,column:48},end:{line:7,column:59}}}):a)+'" name="cf-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:7,column:70},end:{line:7,column:81}}}):a)+'" rows="3" '+(null!=(s=u(i,"unless").call(r,null!=e?u(e,"required"):e,{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:92},end:{line:7,column:147}}}))?s:"")+">"+c(typeof(a=null!=(a=u(i,"response")||(null!=e?u(e,"response"):e))?a:l)===d?a.call(r,{name:"response",hash:{},data:o,loc:{start:{line:7,column:148},end:{line:7,column:160}}}):a)+"</textarea>\n</div>\n"},useData:!0})},5621:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i(5)),o=r(i(1)),s=r(i(5622)),a=r(i(5552));function r(t){return t&&t.__esModule?t:{default:t}}var l=a.default.extend({template:s.default,onRender:function(){a.default.prototype.onRender.call(this),this.ui.responseInput.on("change",o.default.bind(this.manageOptionalState,this)),this.manageOptionalState()},onShow:function(){n.default.Utils.Main.chosenInline(this.ui.responseInput,{display:"block"})},manageOptionalState:function(){this.model.get("required")||this.ui.responseInput.toggleClass("unselected",""===this.getValue())}});e.default=l},5622:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<i class="required js-required-asterisk" style="display: none;"></i>'},3:function(t,e,i,n,o){return'            <option value="">Select an option...</option>\n'},5:function(t,e,i,n,o){return'            <option value="">(optional)</option>\n'},7:function(t,e,n,o,s,a,r){var l,d,c=t.lambda,u=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+u(c(null!=e?h(e,"id"):e,e))+'" '+(null!=(l=(d=i(10),d&&(d.__esModule?d.default:d)).call(null!=e?e:t.nullContext||{},null!=r[1]?h(r[1],"response"):r[1],"==",null!=e?h(e,"id"):e,{name:"ifCond",hash:{},fn:t.program(8,s,0,a,r),inverse:t.noop,data:s,loc:{start:{line:11,column:35},end:{line:11,column:85}}}))?l:"")+">"+u(c(null!=e?h(e,"label"):e,e))+"</option>\n"},8:function(t,e,i,n,o){return"selected"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o,s,a){var r,l=t.lambda,d=t.escapeExpression,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="control-label" for="custom-'+d(l(null!=e?u(e,"inputId"):e,e))+'"><span class="custom-field-saved"><span class="saved-text">saved</span></span>'+d(l(null!=e?u(e,"name"):e,e))+(null!=(r=u(i,"if").call(c,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(1,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:1,column:139},end:{line:1,column:230}}}))?r:"")+'</label>\n<div class="controls">\n    <select name="cf-'+d(l(null!=e?u(e,"inputId"):e,e))+'" class="input-xlarge response-input" id="custom-'+d(l(null!=e?u(e,"inputId"):e,e))+'">\n'+(null!=(r=u(i,"if").call(c,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(3,o,0,s,a),inverse:t.program(5,o,0,s,a),data:o,loc:{start:{line:4,column:8},end:{line:8,column:15}}}))?r:"")+"\n"+(null!=(r=u(i,"each").call(c,null!=e?u(e,"options"):e,{name:"each",hash:{},fn:t.program(7,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:10,column:8},end:{line:12,column:17}}}))?r:"")+"    </select>\n</div>"},useData:!0,useDepths:!0})},5623:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i(5624));function o(t){return t&&t.__esModule?t:{default:t}}var s=o(i(5552)).default.extend({template:n.default});e.default=s},5624:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<i class="required js-required-asterisk" style="display: none;"></i>'},3:function(t,e,i,n,o){return'placeholder="(optional)"'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="control-label" for="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:1,column:41},end:{line:1,column:52}}}):a)+'"><span class="custom-field-saved"><span class="saved-text">saved</span></span>'+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)===d?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:1,column:131},end:{line:1,column:139}}}):a)+(null!=(s=u(i,"if").call(r,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:139},end:{line:1,column:230}}}))?s:"")+'</label>\n<div class="controls">\n    <input type="number" id="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:36},end:{line:3,column:47}}}):a)+'" name="cf-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:58},end:{line:3,column:69}}}):a)+'" class="input-xlarge response-input" maxlength="255" value="'+c(typeof(a=null!=(a=u(i,"response")||(null!=e?u(e,"response"):e))?a:l)===d?a.call(r,{name:"response",hash:{},data:o,loc:{start:{line:3,column:130},end:{line:3,column:142}}}):a)+'" '+(null!=(s=u(i,"unless").call(r,null!=e?u(e,"required"):e,{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:144},end:{line:3,column:199}}}))?s:"")+">\n</div>\n"},useData:!0})},5625:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(5626)),o=s(i(5552));s(i(338));function s(t){return t&&t.__esModule?t:{default:t}}var a={format:"yyyy-mm-dd",todayHighlight:!0,autoclose:!0},r=o.default.extend({template:n.default,onRender:function(){o.default.prototype.onRender.call(this),this.ui.responseInput.datepicker(a),this.ui.responseInput.data("datepicker").picker.addClass("cf-datepicker")}});e.default=r},5626:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<i class="required js-required-asterisk" style="display: none;"></i>'},3:function(t,e,i,n,o){return"(optional)"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="control-label" for="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:1,column:41},end:{line:1,column:52}}}):a)+'"><span class="custom-field-saved"><span class="saved-text">saved</span></span>'+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)===d?a.call(r,{name:"name",hash:{},data:o,loc:{start:{line:1,column:131},end:{line:1,column:139}}}):a)+(null!=(s=u(i,"if").call(r,null!=e?u(e,"required"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:139},end:{line:1,column:230}}}))?s:"")+'</label>\n<div class="controls">\n    <input type="text" id="custom-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:34},end:{line:3,column:45}}}):a)+'" name="cf-'+c(typeof(a=null!=(a=u(i,"inputId")||(null!=e?u(e,"inputId"):e))?a:l)===d?a.call(r,{name:"inputId",hash:{},data:o,loc:{start:{line:3,column:56},end:{line:3,column:67}}}):a)+'" class="input-xlarge response-input" maxlength="10" value="'+c(typeof(a=null!=(a=u(i,"response")||(null!=e?u(e,"response"):e))?a:l)===d?a.call(r,{name:"response",hash:{},data:o,loc:{start:{line:3,column:127},end:{line:3,column:139}}}):a)+'" placeholder="yyyy-mm-dd '+(null!=(s=u(i,"unless").call(r,null!=e?u(e,"required"):e,{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:165},end:{line:3,column:206}}}))?s:"")+'">\n</div>\n'},useData:!0})},5627:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(18)),o=s(i(5628));function s(t){return t&&t.__esModule?t:{default:t}}var a=t.ItemView.extend({template:o.default,className:"control-group custom-field",tag:"div",getValue:function(t){var e=t.options,i=t.response;switch(t.type){case"dropdown":return this.getDropdownValue({options:e,response:i});case"multiline":return this.getMultiLineValue(i);default:return i}},getDropdownValue:function(t){var e=t.options,i=t.response;return e.find((function(t){return t.id==i})).label},getMultiLineValue:function(t){var e=n.default.Utils.escapeExpression(t);return new n.default.SafeString(e.split("\n").join("<br/>"))},serializeData:function(){var t=this.model.toJSON(),e=t.name,i=t.options,n=t.response,o=t.type;return{label:e,value:n?this.getValue({options:i,response:n,type:o}):"—"}}});e.default=a}).call(this,i(6))},5628:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<span class="control-label">'+l("function"==typeof(s=null!=(s=d(i,"label")||(null!=e?d(e,"label"):e))?s:r)?s.call(a,{name:"label",hash:{},data:o,loc:{start:{line:1,column:28},end:{line:1,column:37}}}):s)+'</span>\n<div class="controls">'+l("function"==typeof(s=null!=(s=d(i,"value")||(null!=e?d(e,"value"):e))?s:r)?s.call(a,{name:"value",hash:{},data:o,loc:{start:{line:2,column:22},end:{line:2,column:31}}}):s)+"</div>\n"},useData:!0})},5629:function(t,e,i){var n,o,s,a,r,l,d,c,u,h,p,f,m,g;window;function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*!
 * Masonry PACKAGED v3.3.2
 * Cascading grid layout library
 * http://masonry.desandro.com
 * MIT License
 * by David DeSandro
 */!function(n){var o=Array.prototype.slice;function s(){}m=[i(8)],void 0===(g="function"==typeof(f=function(t){if(t){var e="undefined"==typeof console?s:function(t){console.error(t)};return t.bridget=function(i,n){!function(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}(n),function(i,n){t.fn[i]=function(s){if("string"==typeof s){for(var a=o.call(arguments,1),r=0,l=this.length;r<l;r++){var d=this[r],c=t.data(d,i);if(c)if(t.isFunction(c[s])&&"_"!==s.charAt(0)){var u=c[s].apply(c,a);if(void 0!==u)return u}else e("no such method '"+s+"' for "+i+" instance");else e("cannot call methods on "+i+" prior to initialization; attempted to call '"+s+"'")}return this}return this.each((function(){var e=t.data(this,i);e?(e.option(s),e._init()):(e=new n(this,s),t.data(this,i,e))}))}}(i,n)},t.bridget}})?f.apply(e,m):f)||(t.exports=g)}(window),
/*!
 * eventie v1.0.6
 * event binding helper
 *   eventie.bind( elem, 'click', myFn )
 *   eventie.unbind( elem, 'click', myFn )
 * MIT license
 */
function(t){var e=document.documentElement,a=function(){};function r(e){var i=t.event;return i.target=i.target||i.srcElement||e,i}e.addEventListener?a=function(t,e,i){t.addEventListener(e,i,!1)}:e.attachEvent&&(a=function(t,e,i){t[e+i]=i.handleEvent?function(){var e=r(t);i.handleEvent.call(i,e)}:function(){var e=r(t);i.call(t,e)},t.attachEvent("on"+e,t[e+i])});var l=function(){};e.removeEventListener?l=function(t,e,i){t.removeEventListener(e,i,!1)}:e.detachEvent&&(l=function(t,e,i){t.detachEvent("on"+e,t[e+i]);try{delete t[e+i]}catch(n){t[e+i]=void 0}}),s={id:"eventie/eventie",exports:{},loaded:!1},n="function"==typeof(o={bind:a,unbind:l})?o.call(s.exports,i,s.exports,s):o,s.loaded=!0,void 0!==n||(n=s.exports)}(window),function(){function t(){}var e=t.prototype,i=this,n=i.EventEmitter;function o(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function s(t){return function(){return this[t].apply(this,arguments)}}e.getListeners=function(t){var e,i,n=this._getEvents();if(t instanceof RegExp)for(i in e={},n)n.hasOwnProperty(i)&&t.test(i)&&(e[i]=n[i]);else e=n[t]||(n[t]=[]);return e},e.flattenListeners=function(t){var e,i=[];for(e=0;e<t.length;e+=1)i.push(t[e].listener);return i},e.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&((e={})[t]=i),e||i},e.addListener=function(t,e){var i,n=this.getListenersAsObject(t),s="object"===v(e);for(i in n)n.hasOwnProperty(i)&&-1===o(n[i],e)&&n[i].push(s?e:{listener:e,once:!1});return this},e.on=s("addListener"),e.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},e.once=s("addOnceListener"),e.defineEvent=function(t){return this.getListeners(t),this},e.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},e.removeListener=function(t,e){var i,n,s=this.getListenersAsObject(t);for(n in s)s.hasOwnProperty(n)&&-1!==(i=o(s[n],e))&&s[n].splice(i,1);return this},e.off=s("removeListener"),e.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},e.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},e.manipulateListeners=function(t,e,i){var n,o,s=t?this.removeListener:this.addListener,a=t?this.removeListeners:this.addListeners;if("object"!==v(e)||e instanceof RegExp)for(n=i.length;n--;)s.call(this,e,i[n]);else for(n in e)e.hasOwnProperty(n)&&(o=e[n])&&("function"==typeof o?s.call(this,n,o):a.call(this,n,o));return this},e.removeEvent=function(t){var e,i=v(t),n=this._getEvents();if("string"===i)delete n[t];else if(t instanceof RegExp)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},e.removeAllListeners=s("removeEvent"),e.emitEvent=function(t,e){var i,n,o,s=this.getListenersAsObject(t);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].length;n--;)!0===(i=s[o][n]).once&&this.removeListener(t,i.listener),i.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},e.trigger=s("emitEvent"),e.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},e.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},e._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},e._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return i.EventEmitter=n,t},a=function(){return t}.apply(i,m=[])}.call(void 0),
/*!
 * getStyleProperty v1.0.4
 * original by kangax
 * http://perfectionkills.com/feature-testing-css-properties/
 * MIT license
 */
function(t){var i="Webkit Moz ms Ms O".split(" "),n=document.documentElement.style;function o(t){if(t){if("string"==typeof n[t])return t;var e;t=t.charAt(0).toUpperCase()+t.slice(1);for(var o=0,s=i.length;o<s;o++)if(e=i[o]+t,"string"==typeof n[e])return e}}r=function(){return o}.apply(e,m=[])}(window),
/*!
 * getSize v1.2.2
 * measure size of elements
 * MIT license
 */
function(t,i){function n(t){var e=parseFloat(t);return-1===t.indexOf("%")&&!isNaN(e)&&e}var o="undefined"==typeof console?function(){}:function(t){console.error(t)},s=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];m=[r],l="function"==typeof(f=function(e){var i,a,r,l=!1;function d(e,i){if(t.getComputedStyle||-1===i.indexOf("%"))return i;var n=e.style,o=n.left,s=e.runtimeStyle,a=s&&s.left;return a&&(s.left=e.currentStyle.left),n.left=i,i=n.pixelLeft,n.left=o,a&&(s.left=a),i}return function(c){if(function(){if(!l){l=!0;var s,d=t.getComputedStyle;if(s=d?function(t){return d(t,null)}:function(t){return t.currentStyle},i=function(t){var e=s(t);return e||o("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),e},a=e("boxSizing")){var c=document.createElement("div");c.style.width="200px",c.style.padding="1px 2px 3px 4px",c.style.borderStyle="solid",c.style.borderWidth="1px 2px 3px 4px",c.style[a]="border-box";var u=document.body||document.documentElement;u.appendChild(c);var h=i(c);r=200===n(h.width),u.removeChild(c)}}}(),"string"==typeof c&&(c=document.querySelector(c)),c&&"object"===v(c)&&c.nodeType){var u=i(c);if("none"===u.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0,i=s.length;e<i;e++){t[s[e]]=0}return t}();var h={};h.width=c.offsetWidth,h.height=c.offsetHeight;for(var p=h.isBorderBox=!(!a||!u[a]||"border-box"!==u[a]),f=0,m=s.length;f<m;f++){var g=s[f],b=u[g];b=d(c,b);var y=parseFloat(b);h[g]=isNaN(y)?0:y}var w=h.paddingLeft+h.paddingRight,k=h.paddingTop+h.paddingBottom,C=h.marginLeft+h.marginRight,x=h.marginTop+h.marginBottom,_=h.borderLeftWidth+h.borderRightWidth,S=h.borderTopWidth+h.borderBottomWidth,T=p&&r,D=n(u.width);!1!==D&&(h.width=D+(T?0:w+_));var E=n(u.height);return!1!==E&&(h.height=E+(T?0:k+S)),h.innerWidth=h.width-(w+_),h.innerHeight=h.height-(k+S),h.outerWidth=h.width+C,h.outerHeight=h.height+x,h}}})?f.apply(e,m):f}(window),
/*!
 * docReady v1.0.4
 * Cross browser DOMContentLoaded event emitter
 * MIT license
 */
function(t){var i=t.document,o=[];function s(t){"function"==typeof t&&(s.isReady?t():o.push(t))}function a(t){var e="readystatechange"===t.type&&"complete"!==i.readyState;s.isReady||e||r()}function r(){s.isReady=!0;for(var t=0,e=o.length;t<e;t++){(0,o[t])()}}s.isReady=!1,m=[n],d="function"==typeof(f=function(e){return"complete"===i.readyState?r():(e.bind(i,"DOMContentLoaded",a),e.bind(i,"readystatechange",a),e.bind(t,"load",a)),s})?f.apply(e,m):f}(window),function(t){var i,n=function(){if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0,n=e.length;i<n;i++){var o=e[i]+"MatchesSelector";if(t[o])return o}}();function o(t,e){return t[n](e)}function s(t){t.parentNode||document.createDocumentFragment().appendChild(t)}if(n){var a=o(document.createElement("div"),"div");i=a?o:function(t,e){return s(t),o(t,e)}}else i=function(t,e){s(t);for(var i=t.parentNode.querySelectorAll(e),n=0,o=i.length;n<o;n++)if(i[n]===t)return!0;return!1};c=function(){return i}.apply(e,m=[])}(Element.prototype),function(t,i){u=function(e,i){return function(t,e,i){var n={extend:function(t,e){for(var i in e)t[i]=e[i];return t},modulo:function(t,e){return(t%e+e)%e}},o=Object.prototype.toString;n.isArray=function(t){return"[object Array]"==o.call(t)},n.makeArray=function(t){var e=[];if(n.isArray(t))e=t;else if(t&&"number"==typeof t.length)for(var i=0,o=t.length;i<o;i++)e.push(t[i]);else e.push(t);return e},n.indexOf=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},n.removeFrom=function(t,e){var i=n.indexOf(t,e);-1!=i&&t.splice(i,1)},n.isElement="function"==typeof HTMLElement||"object"==("undefined"==typeof HTMLElement?"undefined":v(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"==v(t)&&1==t.nodeType&&"string"==typeof t.nodeName},n.setText=function(t,e){t[s=s||(void 0!==document.documentElement.textContent?"textContent":"innerText")]=e},n.getParent=function(t,e){for(;t!=document.body;)if(t=t.parentNode,i(t,e))return t},n.getQueryElement=function(t){return"string"==typeof t?document.querySelector(t):t},n.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.filterFindElements=function(t,e){for(var o=[],s=0,a=(t=n.makeArray(t)).length;s<a;s++){var r=t[s];if(n.isElement(r))if(e){i(r,e)&&o.push(r);for(var l=r.querySelectorAll(e),d=0,c=l.length;d<c;d++)o.push(l[d])}else o.push(r)}return o},n.debounceMethod=function(t,e,i){var n=t.prototype[e],o=e+"Timeout";t.prototype[e]=function(){var t=this[o];t&&clearTimeout(t);var e=arguments,s=this;this[o]=setTimeout((function(){n.apply(s,e),delete s[o]}),i||100)}},n.toDashed=function(t){return t.replace(/(.)([A-Z])/g,(function(t,e,i){return e+"-"+i})).toLowerCase()};var s;var a=t.console;return n.htmlInit=function(i,o){e((function(){for(var e=n.toDashed(o),s=document.querySelectorAll(".js-"+e),r="data-"+e+"-options",l=0,d=s.length;l<d;l++){var c,u=s[l],h=u.getAttribute(r);try{c=h&&JSON.parse(h)}catch(m){a&&a.error("Error parsing "+r+" on "+u.nodeName.toLowerCase()+(u.id?"#"+u.id:"")+": "+m);continue}var p=new i(u,c),f=t.jQuery;f&&f.data(u,o,p)}}))},n}(t,e,i)}.apply(e,m=[d,c])}(window),function(t,i){h=function(e,i,n,o){return function(t,e,i,n,o){var s=t.getComputedStyle,a=s?function(t){return s(t,null)}:function(t){return t.currentStyle};var r=n("transition"),l=n("transform"),d=r&&l,c=!!n("perspective"),u={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}[r],h=["transform","transition","transitionDuration","transitionProperty"],p=function(){for(var t={},e=0,i=h.length;e<i;e++){var o=h[e],s=n(o);s&&s!==o&&(t[o]=s)}return t}();function f(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}o.extend(f.prototype,e.prototype),f.prototype._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},f.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},f.prototype.getSize=function(){this.size=i(this.element)},f.prototype.css=function(t){var e=this.element.style;for(var i in t){e[p[i]||i]=t[i]}},f.prototype.getPosition=function(){var t=a(this.element),e=this.layout.options,i=e.isOriginLeft,n=e.isOriginTop,o=t[i?"left":"right"],s=t[n?"top":"bottom"],r=this.layout.size,l=-1!=o.indexOf("%")?parseFloat(o)/100*r.width:parseInt(o,10),d=-1!=s.indexOf("%")?parseFloat(s)/100*r.height:parseInt(s,10);l=isNaN(l)?0:l,d=isNaN(d)?0:d,l-=i?r.paddingLeft:r.paddingRight,d-=n?r.paddingTop:r.paddingBottom,this.position.x=l,this.position.y=d},f.prototype.layoutPosition=function(){var t=this.layout.size,e=this.layout.options,i={},n=e.isOriginLeft?"paddingLeft":"paddingRight",o=e.isOriginLeft?"left":"right",s=e.isOriginLeft?"right":"left",a=this.position.x+t[n];i[o]=this.getXValue(a),i[s]="";var r=e.isOriginTop?"paddingTop":"paddingBottom",l=e.isOriginTop?"top":"bottom",d=e.isOriginTop?"bottom":"top",c=this.position.y+t[r];i[l]=this.getYValue(c),i[d]="",this.css(i),this.emitEvent("layout",[this])},f.prototype.getXValue=function(t){var e=this.layout.options;return e.percentPosition&&!e.isHorizontal?t/this.layout.size.width*100+"%":t+"px"},f.prototype.getYValue=function(t){var e=this.layout.options;return e.percentPosition&&e.isHorizontal?t/this.layout.size.height*100+"%":t+"px"},f.prototype._transitionTo=function(t,e){this.getPosition();var i=this.position.x,n=this.position.y,o=parseInt(t,10),s=parseInt(e,10),a=o===this.position.x&&s===this.position.y;if(this.setPosition(t,e),!a||this.isTransitioning){var r=t-i,l=e-n,d={};d.transform=this.getTranslate(r,l),this.transition({to:d,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},f.prototype.getTranslate=function(t,e){var i=this.layout.options;return t=i.isOriginLeft?t:-t,e=i.isOriginTop?e:-e,c?"translate3d("+t+"px, "+e+"px, 0)":"translate("+t+"px, "+e+"px)"},f.prototype.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},f.prototype.moveTo=d?f.prototype._transitionTo:f.prototype.goTo,f.prototype.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},f.prototype._nonTransition=function(t){for(var e in this.css(t.to),t.isCleaning&&this._removeStyles(t.to),t.onTransitionEnd)t.onTransitionEnd[e].call(this)},f.prototype._transition=function(t){if(parseFloat(this.layout.options.transitionDuration)){var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);this.element.offsetHeight;null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0}else this._nonTransition(t)};var m="opacity,"+(g=p.transform||"transform",g.replace(/([A-Z])/g,(function(t){return"-"+t.toLowerCase()})));var g;f.prototype.enableTransition=function(){this.isTransitioning||(this.css({transitionProperty:m,transitionDuration:this.layout.options.transitionDuration}),this.element.addEventListener(u,this,!1))},f.prototype.transition=f.prototype[r?"_transition":"_nonTransition"],f.prototype.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},f.prototype.onotransitionend=function(t){this.ontransitionend(t)};var v={"-webkit-transform":"transform","-moz-transform":"transform","-o-transform":"transform"};f.prototype.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,i=v[t.propertyName]||t.propertyName;if(delete e.ingProperties[i],function(t){for(var e in t)return!1;return null,!0}(e.ingProperties)&&this.disableTransition(),i in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[i]),i in e.onEnd)e.onEnd[i].call(this),delete e.onEnd[i];this.emitEvent("transitionEnd",[this])}},f.prototype.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(u,this,!1),this.isTransitioning=!1},f.prototype._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var b={transitionProperty:"",transitionDuration:""};return f.prototype.removeTransitionStyles=function(){this.css(b)},f.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},f.prototype.remove=function(){if(r&&parseFloat(this.layout.options.transitionDuration)){var t=this;this.once("transitionEnd",(function(){t.removeElem()})),this.hide()}else this.removeElem()},f.prototype.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},f.prototype.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},f.prototype.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},f.prototype.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},f.prototype.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},f.prototype.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},f}(t,e,i,n,o)}.apply(e,m=[a,l,r,u])}(window),
/*!
 * Outlayer v1.4.2
 * the brains and guts of a layout library
 * MIT license
 */
function(t,i){p=function(e,i,n,o,s){return function(t,e,i,n,o,s){var a=t.console,r=t.jQuery,l=function(){},d=0,c={};function u(t,e){var i=o.getQueryElement(t);if(i){this.element=i,r&&(this.$element=r(this.element)),this.options=o.extend({},this.constructor.defaults),this.option(e);var n=++d;this.element.outlayerGUID=n,c[n]=this,this._create(),this.options.isInitLayout&&this.layout()}else a&&a.error("Bad element for "+this.constructor.namespace+": "+(i||t))}return u.namespace="outlayer",u.Item=s,u.defaults={containerStyle:{position:"relative"},isInitLayout:!0,isOriginLeft:!0,isOriginTop:!0,isResizeBound:!0,isResizingContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},o.extend(u.prototype,i.prototype),u.prototype.option=function(t){o.extend(this.options,t)},u.prototype._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),o.extend(this.element.style,this.options.containerStyle),this.options.isResizeBound&&this.bindResize()},u.prototype.reloadItems=function(){this.items=this._itemize(this.element.children)},u.prototype._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,n=[],o=0,s=e.length;o<s;o++){var a=new i(e[o],this);n.push(a)}return n},u.prototype._filterFindItemElements=function(t){return o.filterFindElements(t,this.options.itemSelector)},u.prototype.getItemElements=function(){for(var t=[],e=0,i=this.items.length;e<i;e++)t.push(this.items[e].element);return t},u.prototype.layout=function(){this._resetLayout(),this._manageStamps();var t=void 0!==this.options.isLayoutInstant?this.options.isLayoutInstant:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},u.prototype._init=u.prototype.layout,u.prototype._resetLayout=function(){this.getSize()},u.prototype.getSize=function(){this.size=n(this.element)},u.prototype._getMeasurement=function(t,e){var i,s=this.options[t];s?("string"==typeof s?i=this.element.querySelector(s):o.isElement(s)&&(i=s),this[t]=i?n(i)[e]:s):this[t]=0},u.prototype.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},u.prototype._getItemsForLayout=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var o=t[i];o.isIgnored||e.push(o)}return e},u.prototype._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){for(var i=[],n=0,o=t.length;n<o;n++){var s=t[n],a=this._getItemLayoutPosition(s);a.item=s,a.isInstant=e||s.isLayoutInstant,i.push(a)}this._processLayoutQueue(i)}},u.prototype._getItemLayoutPosition=function(){return{x:0,y:0}},u.prototype._processLayoutQueue=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];this._positionItem(n.item,n.x,n.y,n.isInstant)}},u.prototype._positionItem=function(t,e,i,n){n?t.goTo(e,i):t.moveTo(e,i)},u.prototype._postLayout=function(){this.resizeContainer()},u.prototype.resizeContainer=function(){if(this.options.isResizingContainer){var t=this._getContainerSize();t&&(this._setContainerMeasure(t.width,!0),this._setContainerMeasure(t.height,!1))}},u.prototype._getContainerSize=l,u.prototype._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},u.prototype._emitCompleteOnItems=function(t,e){var i=this;function n(){i.dispatchEvent(t+"Complete",null,[e])}var o=e.length;if(e&&o)for(var s=0,a=0,r=e.length;a<r;a++){e[a].once(t,l)}else n();function l(){++s===o&&n()}},u.prototype.dispatchEvent=function(t,e,i){var n=e?[e].concat(i):i;if(this.emitEvent(t,n),r)if(this.$element=this.$element||r(this.element),e){var o=r.Event(e);o.type=t,this.$element.trigger(o,i)}else this.$element.trigger(t,i)},u.prototype.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},u.prototype.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},u.prototype.stamp=function(t){if(t=this._find(t)){this.stamps=this.stamps.concat(t);for(var e=0,i=t.length;e<i;e++){var n=t[e];this.ignore(n)}}},u.prototype.unstamp=function(t){if(t=this._find(t))for(var e=0,i=t.length;e<i;e++){var n=t[e];o.removeFrom(this.stamps,n),this.unignore(n)}},u.prototype._find=function(t){if(t)return"string"==typeof t&&(t=this.element.querySelectorAll(t)),t=o.makeArray(t)},u.prototype._manageStamps=function(){if(this.stamps&&this.stamps.length){this._getBoundingRect();for(var t=0,e=this.stamps.length;t<e;t++){var i=this.stamps[t];this._manageStamp(i)}}},u.prototype._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},u.prototype._manageStamp=l,u.prototype._getElementOffset=function(t){var e=t.getBoundingClientRect(),i=this._boundingRect,o=n(t);return{left:e.left-i.left-o.marginLeft,top:e.top-i.top-o.marginTop,right:i.right-e.right-o.marginRight,bottom:i.bottom-e.bottom-o.marginBottom}},u.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},u.prototype.bindResize=function(){this.isResizeBound||(e.bind(t,"resize",this),this.isResizeBound=!0)},u.prototype.unbindResize=function(){this.isResizeBound&&e.unbind(t,"resize",this),this.isResizeBound=!1},u.prototype.onresize=function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout);var t=this;this.resizeTimeout=setTimeout((function(){t.resize(),delete t.resizeTimeout}),100)},u.prototype.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},u.prototype.needsResizeLayout=function(){var t=n(this.element);return this.size&&t&&t.innerWidth!==this.size.innerWidth},u.prototype.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},u.prototype.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},u.prototype.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},u.prototype.reveal=function(t){this._emitCompleteOnItems("reveal",t);for(var e=t&&t.length,i=0;e&&i<e;i++){t[i].reveal()}},u.prototype.hide=function(t){this._emitCompleteOnItems("hide",t);for(var e=t&&t.length,i=0;e&&i<e;i++){t[i].hide()}},u.prototype.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},u.prototype.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},u.prototype.getItem=function(t){for(var e=0,i=this.items.length;e<i;e++){var n=this.items[e];if(n.element===t)return n}},u.prototype.getItems=function(t){for(var e=[],i=0,n=(t=o.makeArray(t)).length;i<n;i++){var s=t[i],a=this.getItem(s);a&&e.push(a)}return e},u.prototype.remove=function(t){var e=this.getItems(t);if(this._emitCompleteOnItems("remove",e),e&&e.length)for(var i=0,n=e.length;i<n;i++){var s=e[i];s.remove(),o.removeFrom(this.items,s)}},u.prototype.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="";for(var e=0,i=this.items.length;e<i;e++){this.items[e].destroy()}this.unbindResize();var n=this.element.outlayerGUID;delete c[n],delete this.element.outlayerGUID,r&&r.removeData(this.element,this.constructor.namespace)},u.data=function(t){var e=(t=o.getQueryElement(t))&&t.outlayerGUID;return e&&c[e]},u.create=function(t,e){function i(){u.apply(this,arguments)}return Object.create?i.prototype=Object.create(u.prototype):o.extend(i.prototype,u.prototype),i.prototype.constructor=i,i.defaults=o.extend({},u.defaults),o.extend(i.defaults,e),i.prototype.settings={},i.namespace=t,i.data=u.data,i.Item=function(){s.apply(this,arguments)},i.Item.prototype=new s,o.htmlInit(i,t),r&&r.bridget&&r.bridget(t,i),i},u.Item=s,u}(t,e,i,n,o,s)}.apply(e,m=[n,a,l,u,h])}(window),window,m=[p,l,u],void 0===(g="function"==typeof(f=function(t,e,i){var n=t.create("masonry");return n.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns();var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0);this.maxY=0},n.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],i=t&&t.element;this.columnWidth=i&&e(i).outerWidth||this.containerWidth}var n=this.columnWidth+=this.gutter,o=this.containerWidth+this.gutter,s=o/n,a=n-o%n;s=Math[a&&a<1?"round":"floor"](s),this.cols=Math.max(s,1)},n.prototype.getContainerWidth=function(){var t=this.options.isFitWidth?this.element.parentNode:this.element,i=e(t);this.containerWidth=i&&i.innerWidth},n.prototype._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth%this.columnWidth,n=Math[e&&e<1?"round":"ceil"](t.size.outerWidth/this.columnWidth);n=Math.min(n,this.cols);for(var o=this._getColGroup(n),s=Math.min.apply(Math,o),a=i.indexOf(o,s),r={x:this.columnWidth*a,y:s},l=s+t.size.outerHeight,d=this.cols+1-o.length,c=0;c<d;c++)this.colYs[a+c]=l;return r},n.prototype._getColGroup=function(t){if(t<2)return this.colYs;for(var e=[],i=this.cols+1-t,n=0;n<i;n++){var o=this.colYs.slice(n,n+t);e[n]=Math.max.apply(Math,o)}return e},n.prototype._manageStamp=function(t){var i=e(t),n=this._getElementOffset(t),o=this.options.isOriginLeft?n.left:n.right,s=o+i.outerWidth,a=Math.floor(o/this.columnWidth);a=Math.max(0,a);var r=Math.floor(s/this.columnWidth);r-=s%this.columnWidth?0:1,r=Math.min(this.cols-1,r);for(var l=(this.options.isOriginTop?n.top:n.bottom)+i.outerHeight,d=a;d<=r;d++)this.colYs[d]=Math.max(l,this.colYs[d])},n.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this.options.isFitWidth&&(t.width=this._getContainerFitWidth()),t},n.prototype._getContainerFitWidth=function(){for(var t=0,e=this.cols;--e&&0===this.colYs[e];)t++;return(this.cols-t)*this.columnWidth-this.gutter},n.prototype.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!==this.containerWidth},n})?f.apply(e,m):f)||(t.exports=g)},5630:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(20)),o=s(i(5631));function s(t){return t&&t.__esModule?t:{default:t}}var a=n.default.Collection.extend({model:o.default,initialize:function(t,e){this.ticket=e.ticket},url:function(){return"".concat(hsGlobal.path,"api/v0/conversations/").concat(this.ticket.get("id"),"/fields")}});e.default=a},5631:function(t,e,i){var n;window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=((n=i(29))&&n.__esModule?n:{default:n}).default.extend({});e.default=o},5632:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=i(5633))&&n.__esModule?n:{default:n};var s=t.CollectionView.extend({itemView:o.default,className:"ticket_tags",id:"ticket_tags",initialize:function(){this.listenTo(this,"itemview:remove",(function(t){this.collection.remove(t.model)}))}});e.default=s}).call(this,i(6))},5633:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i(1569)),o=r(i(5634)),s=r(i(307)),a=r(i(23));function r(t){return t&&t.__esModule?t:{default:t}}var l=t.ItemView.extend({template:o.default,tagName:"span",className:"tagGroup",events:{"click .remove":"removeTag",click:"drilldown"},behaviors:{ConvoDrilldown:{behaviorClass:n.default,isWaitingSinceEnabled:hsGlobal.features.isWaitingSinceEnabled,getData:function(){return{tagId:this.view.model.get("tagId"),name:encodeURIComponent(this.view.model.get("name")),slug:this.view.model.get("slug")}}}},onRender:function(){var t=this.model.get("color");t&&this.$el.find(".tag").addClass((0,s.default)(t))},getTagText:function(){var t=this.model.toJSON(),e=t.name,i=t.tag,n=t.value;return e||(i||(n||"Untagged"))},serializeData:function(){return{canManageTagsInConversations:hsGlobal.memberPermissions.manageTagsInConversations,tagText:this.getTagText()}},removeTag:function(t){t.preventDefault(),t.stopPropagation(),this.trigger("remove")},drilldown:function(t){t&&t.preventDefault(),this.triggerMethod("Drilldown",{title:'Conversations tagged "'+a.default.unescapeHTML(this.model.get("name"))+'"',url:hsGlobal.path+"search/tags/convos.json",isWaitingSinceEnabled:hsGlobal.features.isWaitingSinceEnabled})}});e.default=l}).call(this,i(6))},5634:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return"removeIconDisplayed"},3:function(t,e,i,n,o){return'  <button class="remove" title="Remove Tag"><i class="icon icon-close" aria-hidden="true"></i></button>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button class="tag '+(null!=(s=l(i,"if").call(r,null!=e?l(e,"canManageTagsInConversations"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:19},end:{line:2,column:81}}}))?s:"")+'">'+(null!=(s="function"==typeof(a=null!=(a=l(i,"tagText")||(null!=e?l(e,"tagText"):e))?a:t.hooks.helperMissing)?a.call(r,{name:"tagText",hash:{},data:o,loc:{start:{line:2,column:83},end:{line:2,column:96}}}):a)?s:"")+"</button>\n"+(null!=(s=l(i,"if").call(r,null!=e?l(e,"canManageTagsInConversations"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:0},end:{line:5,column:7}}}))?s:"")},useData:!0})},5635:function(t,e){window;t.exports={setupConvoConcurrency:function(t){var e=t.get("number");this.ticketViewersModel=App.convoConcurrencyManager.getViewersModel(e),App.convoConcurrencyManager.broadcast(e,{viewing:!0,replying:!1}),this.listenTo(App.convoConcurrencyManager,"identify:"+e,this.heartbeat),this.setInterval("viewing-heartbeat",this.heartbeat,this.ticketViewersModel.EXPIRE_INTERVAL-2e3)},tearDownConvoConcurrency:function(t){var e=t.get("number");App.convoConcurrencyManager.broadcast(e,{viewing:!1,replying:!1}),App.convoConcurrencyManager.markForGC(e)}}},5666:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=v(i(8)),o=v(i(231)),s=v(i(20)),a=v(i(520)),r=v(i(474)),l=v(i(6021)),d=v(i(5)),c=v(i(6022)),u=v(i(6024)),h=v(i(6026)),p=v(i(335)),f=v(i(1)),m=i(72),g=v(i(6028));function v(t){return t&&t.__esModule?t:{default:t}}var b=p.default.extend({template:g.default,regions:f.default.extend({},p.default.prototype.regions,{inlineEdit:".inlineEdit",threadOptions:".threadOptions",dismissBouncedThreadConfirmationModal:".dismissBouncedThreadConfirmationModal"}),ui:f.default.extend({},p.default.prototype.ui,{sendTrafficCopThread:".js-send-traffic-cop",viewBounceDetails:".js-bounce-details",bounceRetry:".js-bounce-retry"}),events:f.default.extend({},p.default.prototype.events,{"click @ui.showPrevConvo":"togglePrevConvo","click .editThread":"debounceEditThread","click .edit":"debounceEditThread","click .delete":"debounceDeleteThread","click .js-bounce-dismiss":"toggleDisplayBouncedThreadDismissConfirmation","click @ui.viewBounceDetails":"viewBounceDetails","click @ui.bounceRetry":"bounceRetry"}),initialize:function(){this.debounceEditThread=f.default.debounce(this.editThread,500),this.debounceDeleteThread=f.default.debounce(this.deleteThread,500),this.dismissBouncedThreadModalDisplayModel=new s.default.Model({isOpen:!1}),this.listenTo(this.model,"change:state",this.rerender),this.listenTo(this.model,"realtime-removed-start",this.animateClose),this.listenTo(this.dismissBouncedThreadModalDisplayModel,"change:isOpen",this.renderDismissBouncedThreadConfirmationModal)},onRender:function(){p.default.prototype.onRender.apply(this,arguments),this.$('[rel="tooltip"]').tooltip()},onShow:function(){p.default.prototype.onShow.apply(this,arguments),this.renderThreadOptions(),this.initImagePreview(),this.renderDismissBouncedThreadConfirmationModal()},initImagePreview:function(){this.$(".messageBody img").each((function(){var t=(0,n.default)(this),e=t.attr("src");d.default.Utils.Main.initPopupList(t,{type:"image",width:!1,height:!1,autoScale:!0,href:e})}))},rerender:function(){this.render(),this.regionManager.closeRegions(),this.onShow()},renderThreadOptions:function(){if(!(this.model.get("isLineItem")||this.model.get("isUnderReview")||this.model.get("isBounced")||this.model.isDraft())){var t=new h.default({model:this.model});this.threadOptions.show(t),this.listenTo(t,"edit",this.debounceEditThread),this.listenTo(t,"delete",this.debounceDeleteThread),this.listenTo(t,"hide",this.hideThread),this.listenTo(t,"unhide",this.unhideThread)}},animateClose:function(){this.$el.slideUp(f.default.bind((function(){this.model.trigger("realtime-removed-end",this.model)}),this))},togglePrevConvo:function(t){if(!t.metaKey&&!t.ctrlKey){t&&t.preventDefault(),d.default.Utils.Main.cursorLoading();var e=this.model.get("forward");if(!e||!e.ticket)return d.default.Utils.Main.error("Unable to load conversation preview",{timeout:3e3}),void console.error("No forward.ticket found in ThreadModel",this.model.get("forward"),this.model.toJSON());var i=e.ticket,s=new a.default({id:i.id,number:i.ticketID});this.showPrevConvoPromise&&this.showPrevConvoPromise.abort(),this.showPrevConvoPromise=s.fetch({global:!1}),this.showPrevConvoPromise.always(d.default.Utils.Main.cursorDefault).fail(n.default.proxy((function(t,e){"abort"!=e&&(d.default.Utils.Main.error("Unable to load conversation preview",{timeout:3e3}),console.error("Error loading convo preview",t,e))}),this)).then(f.default.bind((function(){var t=new r.default({model:s,title:"Conversation #".concat(s.get("number")),showBack:!1});o.default.modalRegion.show(t,"modal-xwide")}),this))}},editThread:function(t){t&&t.preventDefault(),d.default.Utils.Main.cursorLoading();var e=this.model.toJSON();o.default.trigger("promise:start",this.model.fetch().then(f.default.bind((function(){var t=this;this.model.isDraft()||this.model.get("isBounced")?this.trigger("edit",this.model):(this.ui.threadContent.hide(),this.inlineEditor=new c.default({model:this.model,mentionNames:o.default.data.get("mailbox.mentionNames"),mentionsEnabled:o.default.data.properties.isMentionsEnabled()}),this.inlineEdit.show(this.inlineEditor),this.listenTo(this.inlineEditor,"updated",this.onThreadEdited),this.listenTo(this.inlineEditor,"permission-error",(function(){t.model.reset(e),t.closeInlineEditor()})),this.listenTo(this.inlineEditor,"cancel",(function(){this.model.reset(e),this.closeInlineEditor()})))}),this)).always(d.default.Utils.Main.cursorDefault))},onThreadEdited:function(){this.closeInlineEditor(),this.triggerThreadsRefresh()},closeInlineEditor:function(){this.inlineEdit.close(),this.rerender()},deleteThread:function(t){var e=this;t&&t.preventDefault();var i="Discard this draft?";return this.model.get("isDraft")||(i="Delete this ".concat(this.model.get("type"),"?")),d.default.Utils.Main.confirm(i,(function(){e.model.destroy({error:function(t,e){if(403===e.status){var i=JSON.parse(e.responseText).errors;d.default.Utils.Main.error(i[0])}},wait:!0})}),!1,{ok:"Yes"})},renderDismissBouncedThreadConfirmationModal:function(){this.dismissBouncedThreadConfirmationModal.show(new l.default({isOpen:this.dismissBouncedThreadModalDisplayModel.get("isOpen"),handleOnPrimaryClick:this.dismissBounceNotification.bind(this),handleOnSecondaryClick:this.toggleDisplayBouncedThreadDismissConfirmation.bind(this)}))},toggleDisplayBouncedThreadDismissConfirmation:function(){var t=this.dismissBouncedThreadModalDisplayModel.get("isOpen");this.dismissBouncedThreadModalDisplayModel.set({isOpen:!t})},dismissBounceNotification:function(){var t=this,e=this.model.get("ticketID"),i=this.model.id;(0,m.hsApiClient)().post("/conversations/".concat(e,"/threads/").concat(i,"/bounce/dismiss")).then((function(){t.triggerThreadsRefresh(),d.default.Utils.Main.success("Bounce dismissed")})).catch((function(){return d.default.Utils.Main.error("Something went wrong. Please try again.")}))},hideThread:function(){this.changeState(d.default.Constants.threadState.HIDDEN)},unhideThread:function(){this.changeState(d.default.Constants.threadState.PUBLISHED)},changeState:function(t){this.model.save({state:t},{wait:!0,patch:!0}).always(d.default.Utils.Main.cursorDefault).fail(d.default.Utils.Ajax.fail).then(f.default.bind(this.afterHideUnhide,this)),d.default.Utils.Main.cursorLoading()},afterHideUnhide:function(){this.render(),this.triggerThreadsRefresh()},triggerThreadsRefresh:function(){this.trigger("refresh-threads")},sendTrafficCopThread:function(t){t&&t.preventDefault(),d.default.Utils.Main.cursorLoading(),window.location.href=this.ui.sendTrafficCopThread.attr("href")},viewBounceDetails:function(t){t&&t.preventDefault(),o.default.modalRegion.wrapAndShow(new u.default({model:this.model}),{header:"Email Bounce Details",modalClass:"modal-wide c-modal--hsds"})},bounceRetry:function(t){var e=this;if(t&&t.preventDefault(),!(0,n.default)(t.target).hasClass("disabled")){d.default.Utils.Main.cursorLoading();var i=this.model.get("ticketID"),o=this.model.id;(0,m.hsApiClient)().post("/conversations/".concat(i,"/threads/").concat(o,"/bounce/retry")).then((function(){e.triggerThreadsRefresh(),d.default.Utils.Main.success("Email Sent")})).catch((function(){return d.default.Utils.Main.error("Unable to send email",{timeout:3e3})})).then((function(){return d.default.Utils.Main.cursorDefault()}))}}});e.default=b},6005:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return' style="display:none;" '},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="c-app-layout has-drawer">\n    <div class="c-app-layout__col sidebar-left">\n        <section id="sidebar-lt"\n            class="js-sidebarLt c-app-layout__sidebar c-app-layout__sidebar--has-drawer c-app-layout__sidebar--left"\n            data-cy="Mailbox.Sidebar.Left"></section>\n    </div>\n    <div class="c-app-layout__block">\n        <div class="c-app-layout__container c-app-layout__container--extend">\n            <div class="c-app-layout__content mailbox--conversation">\n                <section class="main-col u-pad-b-10">\n                    <section class="js-toolbar-container convo-toolbar"></section>\n                    <section id="tkWrap">\n                        <section id="tkHeader"></section>\n                        <div class="c-alert is-error u-d-none u-mrg-h-6 u-mrg-b-5" id="convoError">\n                        </div>\x3c!-- /c-alert --\x3e\n                        <section class="js-reply-container"></section>\n                        <section id="custom-fields-container"></section>\n                        <div id="blockedImages" class="c-alert displayImg u-pad-t-1 u-pad-b-1" '+(null!=(s=a(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"hasBlockedImages"):e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:18,column:95},end:{line:19,column:80}}}))?s:"")+'>\n                            <div class="c-alert__content">\n                                <i class="icon-image"></i>\n                                <div class="c-alert__block">\n                                    <p class="js-alert__text">\n                                        Images are not displayed. <a href="javascript:void(0)"\n                                            id="lnkEnableImages">Display images from this customer.</a>\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="realtime-threads-container"></div>\n                        <section class="threads-container"></section>\n                    </section>\n                </section>\n            </div>\n            <div class="c-app-layout__col">\n                <section id="sidebar-rt" class="c-app-layout__sidebar c-app-layout__sidebar--right"></section>\n            </div>\n        </div>\n    </div>\n</div>'},useData:!0})},6006:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=k(i(22)),o=k(i(5)),s=k(i(1)),a=k(i(8)),r=k(i(6)),l=k(i(0)),d=i(31),c=k(i(231)),u=k(i(953)),h=k(i(6007)),p=k(i(5561)),f=k(i(5570)),m=k(i(6008)),g=k(i(6009)),v=k(i(6010)),b=k(i(6011)),y=k(i(5591)),w=k(i(6014));function k(t){return t&&t.__esModule?t:{default:t}}var C=r.default.Layout.extend({template:h.default,className:"js-convo-toolbar c-convo-toolbar",regions:{viewingReplying:"#js-viewingReplying"},ui:{reply:"#navReply",note:"#navNote",assign:"#assignTkt",status:"#setStatus",tags:"#tagConvo",workflows:"#runWorkflow",workflowsBlankSlate:"#workflowBlankSlate",workflowsBlankSlateLink:"#workflowBlankSlate a",more:"#moreActions",prev:"#prevTicket",next:"#nextTicket"},events:{"click @ui.reply":"replyClick","click @ui.note":"noteClick","click @ui.prev":"prevClick","click @ui.next":"nextClick"},components:function(){return this.shouldShowFullToolbarUI?{}:{".js-add-note-button":l.default.createElement(n.default,{onClick:this.noteClick.bind(this),outlined:!0,size:"sm",theme:"grey"},"Add Note"),".js-follow-button":{component:w.default,initialState:{ticket:this.model},externalActions:{follow:this.follow.bind(this),unfollow:this.unfollow.bind(this)}}}},initialize:function(t){this.widgets={},this.renderSticky=s.default.throttle(this.stickify.bind(this),30),this.renderResize=s.default.throttle(this.resizify.bind(this),30);var e=(0,a.default)(window);e.on("scroll",this.renderSticky),e.on("resize",this.renderResize),(0,a.default)(document).on("click",this.onElsewhereClick),this.ticketViewersModel=t.ticketViewersModel,this.initializePermissions(),this.shouldShowFullToolbarUI=this.shouldShowFullToolbarUI()},initializePermissions:function(){var t=hsGlobal.memberPermissions,e=t.addNotes,i=t.deleteConversations,n=t.editConversationDetails,o=t.followConversations,s=t.manageTagsInConversations,a=t.replyToConversations,r=t.runConversationWorkflows;Object.assign(this,{canAddNotes:e,canEditConversationDetails:n,canFollowConversations:o,canManageTagsInConversations:s,canReplyToConversations:a,canRunConversationWorkflows:r,canDeleteConversations:i})},onShow:function(){this.buildWidgets(),this.viewingReplying.show(new y.default({model:this.ticketViewersModel,members:appData.dropdowns.assign})),this.canReplyToConversations&&(this.listenTo(c.default,"convo:missingEmail",(function(){this.ui.reply.addClass("inactive")})),this.listenTo(c.default,"convo:missingEmailAdded",(function(){this.ui.reply.removeClass("inactive")}))),this.listenTo(c.default,"editor-opened",this.editorOpened),this.listenTo(c.default,"editor-closed",this.editorClosed),this.listenTo(u.default,"prev",this.prevClick),this.listenTo(u.default,"next",this.nextClick),hsGlobal.memberPermissions.deleteConversations&&this.listenTo(u.default,"delete",this.deleteTicket),this.canFollowConversations&&this.listenTo(u.default,"follow",this.toggleFollow),"Unfollow"===appData.notyFlash&&(delete appData.notyFlash,this.unfollowed()),this.$container=this.$el.parent()},onClose:function(){s.default.invoke(this.widgets,"close");var t=(0,a.default)(window);t.off("scroll",this.renderSticky),t.off("resize",this.renderResize),(0,a.default)(document).off("click",this.onElsewhereClick)},serializeData:function(){return s.default.extend({},this.model.toJSON(),{workflows:this.options.workflows,path:hsGlobal.path,mailboxId:this.model.get("mailboxId"),hasWorkflowsAccess:this.hasWorkflowsAccess(),canAddNotes:this.canAddNotes,canEditConversationDetails:this.canEditConversationDetails,canFollowConversations:this.canFollowConversations,canManageTagsInConversations:this.canManageTagsInConversations,canReplyToConversations:this.canReplyToConversations,shouldShowFullToolbarUI:this.shouldShowFullToolbarUI})},onElsewhereClick:function(t){0==(0,a.default)(t.target).closest("#workflowBlankSlate").length&&(0,a.default)("#workflowBlankSlate .popover").is(":visible")&&(0,a.default)("#workflowBlankSlate a").trigger("click")},hasWorkflowsAccess:function(){return hsGlobal.memberPermissions.manageWorkflows},buildWidgets:function(){this.canEditConversationDetails&&(this.addWidget("assign",new m.default({el:this.ui.assign,ticketId:this.model.get("id"),model:this.model,keyboard:u.default,memberId:hsGlobal.memberId,users:c.default.data.get("dropdowns.usersWhoCanBeAssignedToConversations")})),this.addWidget("status",new g.default({el:this.ui.status,model:this.model,keyboard:u.default,memberId:hsGlobal.memberId,isSpam:this.model.get("status")===o.default.Constants.Status.SPAM}))),this.canManageTagsInConversations&&this.addWidget("tags",this.getTagsWidget());var t=c.default.data.get("dropdowns.workflow");this.shouldShowWorkflowsWidget(t)?(this.ui.workflows.show(),this.ui.workflowsBlankSlate.hide(),this.addWidget("workflow",new v.default({el:this.ui.workflows,model:this.model,keyboard:u.default,workflows:t,mailboxId:c.default.data.get("mailbox.id")}))):(this.ui.workflows.hide(),this.ui.workflowsBlankSlate.show(),this.ui.workflowsBlankSlateLink.popover()),this.shouldShowFullToolbarUI&&this.shouldShowMoreMenuWidget()&&this.addWidget("more",new b.default({el:this.ui.more,model:this.model,mailboxes:c.default.data.get("dropdowns.move")})),this.canDeleteConversations&&this.listenTo(this.widgets.more,"delete",this.deleteTicket),this.canEditConversationDetails&&(this.listenTo(this.widgets.more,"forward",this.forward),this.listenTo(this.widgets.more,"docs",this.toggleArticleSearchView),this.listenTo(this.widgets.more,"move",this.moveTicket),this.listenTo(c.default,"moveTicket",this.moveTicket)),this.canFollowConversations&&this.shouldShowFullToolbarUI&&(this.listenTo(this.widgets.more,"follow",this.follow),this.listenTo(this.widgets.more,"unfollow",this.unfollow)),o.default.Utils.Main.initTooltips(this.$("[rel=tooltip]"))},toggleArticleSearchView:function(){var t="disabled";"disabled"===a.default.cookie("docs-app-enabled")&&(t="enabled"),a.default.cookie("docs-app-enabled",t),c.default.trigger("toggle-docs-search")},getTagsWidget:function(){var t=new f.default({el:this.ui.tags,memberId:hsGlobal.memberId,model:this.model,keyboard:u.default,ticketTags:this.options.tags,ignoreValueChangeOnSelect:!1});return this.listenTo(this.options.tags,"remove",(function(e){this.model.removeTag(e,(function(e){e&&e.ticket&&e.ticket.slug&&!1!==e.tags&&t.updateAutocompleteTags(e.tags)}))})),t},buildAssignWidget:function(){this.listenTo(this.widgets.assign,"action",(function(t){}))},addWidget:function(t,e){return this.widgets[t]=e,e.render(),e},editorOpened:function(t){this.$(".convo-actions > li > a,.chzn-default").addClass("inactive"),"message"===t?this.ui.reply.removeClass("inactive"):"note"===t&&this.ui.note.removeClass("inactive")},editorClosed:function(){this.$(".convo-actions > li > a,.chzn-default").removeClass("inactive")},replyClick:function(t){t&&t.preventDefault(),this.scrollToTop(),this.trigger("reply")},noteClick:function(t){t&&t.preventDefault(),this.scrollToTop(),this.trigger("note")},prevClick:function(t){window.hj&&hj("event","convo_previous_button_clicked"),t&&(t.ctrlKey||t.metaKey)||o.default.stack.isOpen("Modal")||(t&&t.preventDefault(),this.model.prev(),o.default.Utils.Main.cursorLoading())},nextClick:function(t){window.hj&&hj("event","convo_next_button_clicked"),t&&(t.ctrlKey||t.metaKey)||o.default.stack.isOpen("Modal")||(t&&t.preventDefault(),this.model.next(),o.default.Utils.Main.cursorLoading())},deleteTicket:function(){hsGlobal.memberPermissions.deleteConversations&&o.default.Utils.Main.confirmDelete("Delete this conversation?",s.default.bind(this.doDelete,this))},doDelete:function(){this.model.destroy({error:function(t,e){if(403===e.status){var i=JSON.parse(e.responseText).errors;o.default.Utils.Main.error(i[0])}},wait:!0})},getConfirmText:function(t){var e=s.default.where(this.options.mailboxes,{id:t});return(0,p.default)(e[0])},warnCustomFieldBeforeMove:function(){var t=this.model.get("customFieldResponses");return!(!t||!t.length)&&t.filter((function(t){return""!=t.value})).length},moveTicket:function(t){this.warnCustomFieldBeforeMove()?o.default.Plugins.Flash.confirm(this.getConfirmText(t),this.model.performAction.bind(this.model,"move",{mailboxSlug:t})):this.model.performAction("move",{mailboxSlug:t})},forward:function(){u.default.trigger("forward")},toggleFollow:function(){this.options.model.get("isMemberFollowing")?this.unfollow():this.follow()},follow:function(){this.options.model.get("isMemberFollowing")||this.model.performAction("follow").then(s.default.bind(this.followed,this))},followed:function(){this.showUndoNoty("Following",s.default.bind(this.unfollow,this)),this.options.model.set("isMemberFollowing",!0),this.buildWidgets()},unfollow:function(){this.options.model.get("isMemberFollowing")&&this.model.performAction("unfollow").then(s.default.bind(this.unfollowed,this))},unfollowed:function(){this.showUndoNoty("Unfollowed",s.default.bind(this.follow,this)),this.options.model.set("isMemberFollowing",!1),this.buildWidgets()},showUndoNoty:function(t,e){o.default.Utils.Main.successWithUndo(t,{},e)},shouldSticky:function(){var t=this.$container.offset().top;return(0,a.default)(window).scrollTop()>t},stickify:function(){return this.isSticky=this.shouldSticky(),this.resizify(),this.$container.toggleClass("is-sticky",this.isSticky),this},resizify:function(){var t=this.$container.width(),e=this.$el.css("paddingRight"),i=parseInt(t,10)-parseInt(e,10);return this.isSticky?this.$el.width(i):this.$el.css("width",""),this},scrollToTop:function(){return this.isSticky&&(0,a.default)("html, body").animate({scrollTop:0},300),this},shouldShowWorkflowsWidget:function(t){return this.canRunConversationWorkflows&&t.length>0},shouldShowFullToolbarUI:function(){return this.canDeleteConversations||this.canEditConversationDetails||this.canManageTagsInConversations||this.canReplyToConversations||this.canRunConversationWorkflows},shouldShowMoreMenuWidget:function(){return this.canDeleteConversations||this.canFollowConversations||this.canEditConversationDetails}}),x=(0,d.ReactMounter)(C);e.default=x},6007:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <li class="ConvoActionList__item">\n                <a class="reply'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"missingEmail"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:31},end:{line:5,column:67}}}))?s:"")+'" href="javascript:void(0)" id="navReply" rel="tooltip"\n                    aria-label="reply" data-placement="bottom"\n                    data-original-title="'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"missingEmail"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:7,column:41},end:{line:7,column:103}}}))?s:"")+'"><i\n                        class="icon-reply"></i></a>\n            </li>\n'},2:function(t,e,i,n,o){return" inactive"},4:function(t,e,i,n,o){return"Reply is disabled "},6:function(t,e,i,n,o){return"Reply (r)"},8:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <li class="ConvoActionList__item">\n'+(null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"shouldShowFullToolbarUI"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:13,column:16},end:{line:18,column:23}}}))?s:"")+"            </li>\n"},9:function(t,e,i,n,o){return'                    <a class="note" href="javascript:void(0)" id="navNote" rel="tooltip" aria-label="note"\n                        data-placement="bottom" data-original-title="Note (n)"><i class="icon-add-note"></i></a>\n'},11:function(t,e,i,n,o){return'                    <div class="js-add-note-button add-note-button"></div>\n'},13:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"canFollowConversations"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o,loc:{start:{line:22,column:12},end:{line:26,column:19}}}))?s:""},14:function(t,e,i,n,o){return'                <li class="ConvoActionList__item">\n                    <div id="follow" class="js-follow-button follow-button"></div>\n                </li>\n'},16:function(t,e,i,n,o){return'            <li id="assignTkt" class="dropdown ConvoActionList__item"></li>\n            <li id="setStatus" class="dropdown ConvoActionList__item"></li>\n'},18:function(t,e,i,n,o){return'            <li id="tagConvo" class="dropdown ConvoActionList__item"></li>\n'},20:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li id="workflowBlankSlate" class="ConvoActionList__item">\n            <a href="javascript:void(0)" data-trigger="click" aria-label="workflow" data-placement="bottom"\n                data-html="true"\n                data-content=\'<p class="u-mrg-t-1">Run several actions at once with Manual Workflows, your easy button for:</p><p>- Adding a Tag<br>- Sending a Saved Reply<br>- Assigning to a Teammate<br>- And much more...</p><a href="'+l("function"==typeof(s=null!=(s=d(i,"path")||(null!=e?d(e,"path"):e))?s:r)?s.call(a,{name:"path",hash:{},data:o,loc:{start:{line:41,column:235},end:{line:41,column:243}}}):s)+"settings/workflows/"+l("function"==typeof(s=null!=(s=d(i,"mailboxId")||(null!=e?d(e,"mailboxId"):e))?s:r)?s.call(a,{name:"mailboxId",hash:{},data:o,loc:{start:{line:41,column:262},end:{line:41,column:275}}}):s)+'/new/#manual" target="_blank" class="btn btn-success u-mrg-t-1 u-mrg-b-2">Add a Manual Workflow</a>\'><i\n                    class="icon-workflow-lg"></i></a>\n        </li>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d=t.escapeExpression,c=t.lambda,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="actions__wrapper">\n    <ul class="convo-actions ConvoActionList">\n'+(null!=(s=u(i,"if").call(r,null!=e?u(e,"canReplyToConversations"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:8},end:{line:10,column:15}}}))?s:"")+(null!=(s=u(i,"if").call(r,null!=e?u(e,"canAddNotes"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:8},end:{line:20,column:15}}}))?s:"")+(null!=(s=u(i,"unless").call(r,null!=e?u(e,"shouldShowFullToolbarUI"):e,{name:"unless",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:21,column:8},end:{line:27,column:19}}}))?s:"")+(null!=(s=u(i,"if").call(r,null!=e?u(e,"canEditConversationDetails"):e,{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.noop,data:o,loc:{start:{line:28,column:8},end:{line:31,column:15}}}))?s:"")+(null!=(s=u(i,"if").call(r,null!=e?u(e,"canManageTagsInConversations"):e,{name:"if",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:32,column:8},end:{line:34,column:15}}}))?s:"")+'        \x3c!-- Workflow Dropdown if there are manual workflows --\x3e\n        <li id="runWorkflow" class="dropdown ConvoActionList__item"></li>\n'+(null!=(s=u(i,"if").call(r,null!=e?u(e,"hasWorkflowsAccess"):e,{name:"if",hash:{},fn:t.program(20,o,0),inverse:t.noop,data:o,loc:{start:{line:37,column:8},end:{line:44,column:15}}}))?s:"")+'        <li id="moreActions" class="dropdown ConvoActionList__item"></li>\n    </ul>\n    <div class="pager">\n        <a href="'+d("function"==typeof(a=null!=(a=u(i,"path")||(null!=e?u(e,"path"):e))?a:l)?a.call(r,{name:"path",hash:{},data:o,loc:{start:{line:48,column:17},end:{line:48,column:25}}}):a)+d(c(null!=(s=null!=e?u(e,"nav"):e)?u(s,"prevURL"):s,e))+'" data-bypass="true" id="prevTicket" class="prev up" rel="tooltip"\n            aria-label="previous conversation" data-placement="bottom" data-original-title="Newer (k)"><i\n                class="icon-caret-up"></i></a>\n        <a href="'+d("function"==typeof(a=null!=(a=u(i,"path")||(null!=e?u(e,"path"):e))?a:l)?a.call(r,{name:"path",hash:{},data:o,loc:{start:{line:51,column:17},end:{line:51,column:25}}}):a)+d(c(null!=(s=null!=e?u(e,"nav"):e)?u(s,"nextURL"):s,e))+'" data-bypass="true" id="nextTicket" class="next down" rel="tooltip"\n            aria-label="next conversation" data-placement="bottom" data-original-title="Older (j)"><i\n                class="icon-caret-down"></i></a>\n    </div>\n    \x3c!--/pager--\x3e\n    <section id="js-viewingReplying" class="ticket-view-reply"></section>\n</div>\n'},useData:!0})},6008:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(5557)),s=i(5575);function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.extend({initialize:function(){var t=this;o.default.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:ownerId",this.render),this.listenTo(this.model,"change:ownerId",(function(){(0,s.trackSampleConvo)(t.model,"Changed Sample Convo Assignee",{ownerId:t.model.get("ownerId")})}))},getCurrentValue:function(){return this.model.get("ownerId")},select:function(t){n.default.Utils.Main.cursorLoading(),this.model.performAction("assign",{ownerId:t}).always(n.default.Utils.Main.cursorDefault)}});e.default=r},6009:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(5559)),s=i(5575);function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.extend({initialize:function(){var t=this;o.default.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:status",this.render),this.listenTo(this.model,"change:status",(function(){(0,s.trackSampleConvo)(t.model,"Changed Sample Convo Status",{status:t.model.get("status")})}))},getCurrentValue:function(){return this.model.get("status")},select:function(t){n.default.Utils.Main.cursorLoading(),this.model.performAction("status",{statusId:t}).always(n.default.Utils.Main.cursorDefault)}});e.default=r},6010:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(5)),o=s(i(1));function s(t){return t&&t.__esModule?t:{default:t}}var a=s(i(5562)).default.extend({doApplyWorkflow:function(t){var e=t.workflowId,i={workflowId:e};(t.email||t.forward||t.note)&&(i=o.default.extend(i,{email:t.email?t.email:null,forward:t.forward?t.forward:null,note:t.note?t.note:null})),this.closeDropdown();o.default.findWhere(this.workflows,{id:e});n.default.Utils.Main.popupClose(),this.model.performAction("workflow",i).always(n.default.Utils.Main.cursorDefault),n.default.Utils.Main.cursorLoading()}});e.default=a},6011:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(6012)),o=l(i(6)),s=l(i(231)),a=l(i(6013)),r=l(i(953));function l(t){return t&&t.__esModule?t:{default:t}}var d=o.default.ItemView.extend({template:a.default,initialize:function(t){this.listenTo(r.default,"more",this.moreKey),this.mailboxes=t.mailboxes},ui:{link:"#actionsTrig"},onClose:function(){this.dropdown&&(this.dropdown.off(),this.dropdown.destroy())},onRender:function(){var t=[];hsGlobal.memberPermissions.deleteConversations&&t.push({id:"delete",title:"Delete"}),hsGlobal.memberPermissions.followConversations&&(this.showUnfollow()?t.push({id:"unfollow",title:"Unfollow"}):this.showFollow()&&t.push({id:"follow",title:"Follow"})),hsGlobal.memberPermissions.editConversationDetails&&t.push({id:"forward",title:"Forward"}),hsGlobal.memberPermissions.editConversationDetails&&s.default.data.get("companyMailboxes").length>1&&!appData.mailbox.isDemo&&t.push({id:"moveConvo",title:"Move ...",children:this.mailboxes}),hsGlobal.memberPermissions.editConversationDetails&&s.default.data.get("docs.isAvail")&&!appData.mailbox.isDemo&&t.push({id:"docs",title:"Toggle Docs Search"}),this.dropdown=new n.default({name:"more",trigger:this.$("#actionsTrig"),element:this.$("#actions-dd"),max:99,data:t}),this.dropdown.on("selected",this.action,this)},onShow:function(){this.ui.link.tooltip({delay:{show:600,hide:100}})},action:function(t){("delete"!==t||hsGlobal.memberPermissions.deleteConversations)&&("delete"===t||"forward"===t||"docs"===t||"follow"===t||"unfollow"===t?this.trigger(t):this.trigger("move",t))},moreKey:function(){this.dropdown.openDropdown()},isFollowing:function(){var t=this.options.model.get("isMemberFollowing")||!1;return t},showFollow:function(){return!this.isFollowing()},showUnfollow:function(){return this.isFollowing()}});e.default=d},6012:function(t,e,i){(function(t,n){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(i(90)),s=r(i(989)),a=i(755);function r(t){return t&&t.__esModule?t:{default:t}}s.default.PubSub.createChannel("User:Dropdown:Close"),s.default.PubSub.createChannel("User:Dropdown:Open"),s.default.PubSub.subscribe("User:Dropdown:Open",(function(){s.default.StateMachine.modules.Keyboard&&s.default.StateMachine.changeState("Keyboard","Dropdown",null),s.default.StateMachine.modules.KeyboardGlobal&&s.default.StateMachine.changeState("KeyboardGlobal","Dropdown",null)})),s.default.PubSub.subscribe("User:Dropdown:Close",(function(){s.default.StateMachine.modules.Keyboard&&s.default.StateMachine.changeState("Keyboard","Open",null),s.default.StateMachine.modules.KeyboardGlobal&&s.default.StateMachine.changeState("KeyboardGlobal","Open",null)}));new a.Class({constructor:function(t){this.list=t,this.firstLetter=this.getFirstLetter(t),this.uniqueLetter=this.getUniqueLetters()},getFirstLetter:function(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e++)t[e]&&("Me"===t[e]?n[e]="1":n[e]=t[e].slice(0,1).toLowerCase());return n},getUniqueLetters:function(){return["a"]},getNewPos:function(t,e){null==e&&(e=-1);var i={},n=-1;switch(this.uniqueLetter[t]&&(i=this.uniqueLetter[t]),!0){case 0===i.end:n=0;break;case i.start>e:n=i.start;break;case i.end<e:n=i.end;break;case i.end>e&&(e>i.start||e===i.start):n=e+1;break;case i.end===e:n=i.start}return n}});var l=new a.Class((function(){return{constructor:function(e){this.currVal=e.currVal,this.name=e.name,this.triggerEl=e.trigger,this.data=e.data,this.element=$(e.element),this.id=this.element.attr("id"),this.max=e.max,this.subMenu=0,this.position=null,this.visible=!1,this.jqBody=$("body"),t.extend(this,n.Events),s.default.StateMachine.registerModule("Dropdown-"+this.name,[{state:"Open",initCB:function(){o.default.stack.opened("App:Dropdown:Close",(function(){i.closeDropdown()}),null)},endCB:o.default.Utils.Function.noop},{state:"MultiOpen",initCB:o.default.Utils.Function.noop,endCB:o.default.Utils.Function.noop},{state:"Closed",initCB:function(){o.default.stack.closed("App:Dropdown:Close")},endCB:o.default.Utils.Function.noop}],"Closed"),e.width?this.width=e.width:this.width=160,t.bindAll(this,"triggerSelect"),this.renderContent();var i=this;this.triggerEl.on("click touchstart",(function(t){t.preventDefault(),t.stopPropagation(),setTimeout((function(){"Open"===i.getState()?(i.closeDropdown(),$("a:focus").trigger("blur")):(i.openDropdown(),$("a:focus").trigger("blur"))}),0)})),this.closeDropdown()},destroy:function(){this.closeDropdown(),this.subIdClose&&s.default.PubSub.unsubscribe("User:Dropdown:CloseAll",this.subIdClose),this.subIdActivate&&s.default.PubSub.unsubscribe("User:Keyboard:Dropdown:Activate",this.subIdActivate),this.jqBody.off("click").off("keydown").off("keyup"),$("#wrap").off("click"),this.element.find("a."+this.id).unbind("click",this.triggerSelect),this.triggerEl.off("click touchstart"),this.setState("Closed"),o.default.stack.closed("Dropdown-"+this.name),s.default.StateMachine.deleteModule("Dropdown-"+this.name)},closeDropdown:function(){s.default.PubSub.unsubscribe("User:Dropdown:CloseAll",this.subIdClose),delete this.subIdClose,s.default.PubSub.publish("User:Dropdown:Close",null),this.setState("Closed",null),this.visible=!1,this.element.closest(".dropdown").removeClass("open"),this.element.find(".dropdown-submenu").removeClass("open"),o.default.Utils.Main.isMobileDevice()&&this.element.find(".sub-menu li a").removeClass("hover"),o.default.Plugins.Keyboard.Utils.unpause(),$("a.hover."+this.id).removeClass("hover"),$("#wrap").off("click keyup")},openDropdown:function(){var t=this;s.default.PubSub.publish("User:Dropdown:CloseAll",null),null!=this.subIdClose&&s.default.PubSub.unsubscribe("User:Dropdown:CloseAll",this.subIdClose),this.subIdClose=s.default.PubSub.subscribe("User:Dropdown:CloseAll",(function(){t.closeDropdown(),o.default.Plugins.Keyboard.Utils.unpause()})),null!=this.subIdActivate&&s.default.PubSub.unsubscribe("User:Keyboard:Dropdown:Activate",this.subIdActivate),this.subIdActivate=s.default.PubSub.subscribe("User:Keyboard:Dropdown:Activate",(function(){t.executeActive()})),this.setState("Open",null),this.bindKeyAxis(),this.visible=!0,this.element.closest(".dropdown").addClass("open"),$("#wrap").on("click",(function(){t.closeDropdown()})),s.default.PubSub.publish("User:Dropdown:Open",null)},bindKeyAxis:function(){this.jqBody.off("keydown.dropdown").off("keyup.dropdown").off("keypress.dropdown").on("keydown.dropdown keyup.dropdown keypress.dropdown",t.bind((function(t){var e={40:"downAction",39:"rightAction",38:"upAction",37:"leftAction"}[t.which];!0===this.visible&&e&&(t.preventDefault(),"keyup"===t.type&&this[e]())}),this))},renderContent:function(){for(var t=this.data.length,e={},i='<ul class="'+this.name+'" >',n=0;n<t;n++)(e=this.data[n]).children&&e.children.length?(i+="<li class='"+this.id+" dropdown-submenu'><a id=\""+e.id+'" data-id="'+e.id+'" href="javascript:void(0);" class="'+this.id+'" data-id="'+this.id+'">'+e.title+"</a>",i+=this.renderSubMenu(e.children)):i+="<li class='"+this.id+"'><a id=\""+e.id+'" data-id="'+e.id+'" class="'+this.id+'">'+e.title+"</a>",i+="</li>";function s(t){var e=$(this),i=e.closest(".dropdown-submenu"),n=o.default.Utils.Main.isMobileDevice(),s=i.hasClass("open");if(i.toggleClass("open",!s),n)return e.toggleClass("hover",!s),!1}i+="</ul>",this.element.html(i);var a=this.element.parent().find("#"+this.id+"> ul > li");o.default.Utils.Main.isMobileDevice()?a.children("a").on("touchstart click",s):a.hover((function(){$(this).find("ul").addClass("open")}),(function(){$(this).find("ul").removeClass("open")})).children("a").on("touchstart click",s),this.element.find("a."+this.id).bind("click",this.triggerSelect)},renderSubMenu:function(t){var e,i=t.length,n='<ul class="dropdown-menu" id="'+this.subMenu+"-"+this.id+'">';for(e=0;e<i;e++)n+='<li><a data-id="'+t[e].id+'" href="javascript:void(0);" class="'+this.id+'">'+t[e].title+"</a></li>";return n+="</ul>",this.subMenu=this.subMenu++,n},scrollIntoView:function(t){if(!t)return!1;var e=t.closest(".dropdown-menu");if(!e)return!1;var i=e.outerHeight(),n=e.scrollTop(),o=t.position().top,s=o+t.outerHeight();return s>i?e.scrollTop(s):o<n&&e.scrollTop(o),t},scrollReset:function(t){return!!t&&(t.scrollTop(0),t)},upAction:function(){var t,e,i,n,o,s,a=$("a.hover."+this.id+":first"),r=a.parent(),l=a.closest("ul");if(a.length){if((t=r.prev()).hasClass("divider")&&(t=r.prev().prev()),a.removeClass("hover"),r.removeClass("open"),t.length)return e=t.find("a:first").addClass("hover"),(i=t.find(".dropdown-submenu")).length&&(this.scrollReset(i),t.addClass("open")),void this.scrollIntoView(e);o=l.find(" > li > a."+this.id+":last")}else o=this.element.parent().find("#"+this.id+" > ul > li > a."+this.id+":last");s=(n=o.closest("li")).find("ul"),o.addClass("hover"),this.scrollIntoView(o),s.length&&n.addClass("open")},downAction:function(){var t,e,i,n,o,s,a=$("a.hover."+this.id+":first"),r=a.parent(),l=a.closest("ul");if(a.length){if(n=r.next(),next=l.next(),(0===n.length||n.hasClass("divider"))&&(n=r.next().next()),a.removeClass("hover"),r.removeClass("open"),n.length)return o=n.find("a:first"),s=n.find("ul"),o.addClass("hover"),this.scrollIntoView(o),void(s.length&&(this.scrollReset(s),n.addClass("open")));e=a.parent().parent().find(" > li > a."+this.id+":first")}else e=this.element.parent().find("#"+this.id+" > ul > li > a."+this.id+":first");i=(t=e.closest("li")).find("ul"),this.scrollIntoView(e),e.addClass("hover"),i.length&&t.addClass("open")},leftAction:function(){var t=this.id,e=$("a.hover."+t),i=e.parent(),n=e.closest(".dropdown-submenu"),o=n.find("a:first");n.find(".dropdown-menu");o.length&&!i.prev().length&&(n.attr("id")!==t&&i.removeClass("open"),e.removeClass("hover"),o.addClass("hover"))},rightAction:function(){var t,e=this.id,i=$("a.hover."+e),n=i.parent(),o=i.closest(".dropdown-submenu");n.find("ul").length&&(t=n.find("ul > li > a."+e+":first"),o.addClass("open"),i.removeClass("hover"),t.addClass("hover"))},triggerSelect:function(t){if(!($(t.target).siblings().filter(".dropdown-menu").length>0)){var e=$(t.target).data("id");this.trigger("selected",e)}t.preventDefault()},setState:function(t,e){return this.state=s.default.StateMachine.changeState("Dropdown-"+this.name,t,e),this.state},getState:function(){return this.state=s.default.StateMachine.getState("Dropdown-"+this.name),this.state},executeActive:function(){if("Open"===this.getState()){var t=$("a.hover."+this.id);if(this.isSubMenuParentLink(t))return;this.trigger("selected",t.data("id")),this.closeDropdown()}},isSubMenuParentLink:function(t){var e=t.closest(".dropdown-submenu").length,i=e&&t.closest(".dropdown-menu").closest(".dropdown-submenu").length;return e&&!i}}}));e.default=l}).call(this,i(1),i(11))},6013:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<a class="dropdown-toggle" data-toggle="dropdown" href="#moreActions" id="actionsTrig" aria-label="more actions" rel="tooltip" data-placement="bottom" data-original-title="More Actions (m)"><i class="icon-more"></i></a>\n<div id=\'actions-dd\' class="dropdown-menu"></div>\n'},useData:!0})},6014:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i(22)),o=r(i(0)),s=r(i(2)),a=i(31);function r(t){return t&&t.__esModule?t:{default:t}}var l=function(t){var e=t.follow,i=t.isMemberFollowing,s=t.unfollow,a=i?"Unfollow":"Follow",r=i?s:e;return o.default.createElement(n.default,{linked:!0,onClick:r,size:"sm",theme:"grey"},a)};l.propTypes={follow:s.default.func.isRequired,isMemberFollowing:s.default.bool.isRequired,unfollow:s.default.func.isRequired};var d=(0,a.connect)((function(t){return{isMemberFollowing:t.ticket.isMemberFollowing}}),(function(t){var e=t.getStatelessExternalActions();return{follow:e.follow,unfollow:e.unfollow}}))(l);e.default=d},6015:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=p(i(5)),o=p(i(1)),s=p(i(8)),a=p(i(6)),r=p(i(231)),l=p(i(6016)),d=p(i(6017)),c=p(i(6018)),u=p(i(5605)),h=p(i(61));i(275);function p(t){return t&&t.__esModule?t:{default:t}}var f=a.default.Layout.extend({id:"tkReplyForm",tagName:"form",className:"form-horizontal",template:l.default,regions:{addressContainer:".js-addy-container",editorRegion:".thread-editor-region",appWindow:"#appWindow"},ui:{tkReply:"#tkReply",forwardTo:"#forwardTo",emailFields:"#addyLines",includePhone:"input#includePhone",switchToNote:"#noteWarning a"},events:{"click @ui.switchToNote":"switchToNote"},initialize:function(t){this.viewStartTime=t.viewStartTime,this.ticket=t.ticket,r.default.reqres.setHandler("is-editor-open",this.isEditorOpen)},onShow:function(){this.viewValidator=new h.default(this,"sumo",!0),this.editor=this.createThreadEditor(),r.default.reqres.setHandler("get-editor-thread-type",(function(){return this.model.get("type")}),this),this.renderAddressLine(),this.updateSubId=n.default.Controller.PubSub.subscribe("sidebar:updateCustomer",o.default.bind(this.onSidebarUpdateCustomer,this)),this.listenTo(r.default,"toggle-docs-search",(function(){this.showHideArticleSearch(!0)})),this.canEditConversationDetails()&&r.default.data.get("docs.isAvail")&&(this.appWindow.show(new u.default(r.default.data.get("docs"))),this.showHideArticleSearch())},onClose:function(){this.model.abortSync(),r.default.reqres.removeHandler("get-editor-thread-type"),n.default.Controller.PubSub.unsubscribe("sidebar:updateCustomer",this.updateSubId),n.default.stack.closed("Thread-Editor"),r.default.reqres.removeHandler("is-editor-open",this.isEditorOpen)},isEditorOpen:function(){return!0},serializeData:function(){return{ticket:this.ticket.toJSON(),thread:this.model.toJSON(),showIncludePhone:"phone"===this.ticket.get("type")&&this.model.get("type")===n.default.Constants.threadType.FORWARD,mailbox:r.default.data.get("mailbox"),shouldShowDocsSearchBar:this.canEditConversationDetails()&&r.default.data.get("docs.isAvail"),noteWarning:this.getNoteWarning()}},onSidebarUpdateCustomer:function(t){if(t.customer&&t.customer.emails){var e=t.customer.emails;this.ticket.customer.set({emails:e.toJSON?e.toJSON():e},{silent:!0}),this.renderAddressLine()}},renderAddressLine:function(){if(this.model.get("type")!==n.default.Constants.threadType.NOTE){var t=new c.default({ticket:this.ticket,thread:this.model});this.listenTo(t,"change:ccbcc",(function(){this.editor&&this.editor.autoSaveThread()})),this.listenTo(t,"change:from",(function(){this.editor&&this.editor.autoSaveThread()})),this.addressContainer.show(t)}},getNoteWarning:function(){var t=this.ticket.threads.find((function(t){return!t.get("isLineItem")&&!t.isDraft()}));if(this.model.get("type")===n.default.Constants.threadType.MESSAGE&&t&&t.get("type")===n.default.Constants.threadType.NOTE&&t.get("createdBy")!=r.default.data.get("member.id")){var e=t.get("createdBy"),i=n.default.Utils.Main.getMemberObjects([e]),o=i&&i.length?i[0]:void 0;return{enabled:!0,createdBy:o?o.title:"your team member"}}},createThreadEditor:function(){var t=new d.default({parent:this,tagName:"section",id:"replyWysiwyg",className:"textareaWrap",viewStartTime:this.viewStartTime,textareaName:"reply",ticket:this.ticket,thread:this.model,savedReplies:r.default.data.get("dropdowns.replies"),users:r.default.data.get("dropdowns.usersWhoCanBeAssignedToConversations"),signature:this.ticket.get("signature")||r.default.data.get("signature"),mailboxId:r.default.data.get("mailbox.id"),mailboxSlug:r.default.data.get("mailbox.slug"),memberId:r.default.data.get("member.id"),mentionsEnabled:r.default.data.properties.isMentionsEnabled(),mentionNames:r.default.data.get("mailbox.mentionNames")});return this.editorRegion.show(t),this.toggleTypeClass(),t.wysiView.focus(!0),this.listenTo(t,"delete",this.discardAndClose),this.listenTo(t,"save",this.closePanel),this.listenTo(t,"sent",(function(){this.sending=!0,this.close()})),this.listenTo(t,"draft-conflict",this.onDraftConflict),this.listenTo(this,"close",(function(){r.default.trigger("editor-closed")})),this.setUpThreadEditorEscStackHandler(t),r.default.trigger("editor-opened",this.model.get("type")),t},onDraftConflict:function(t){"save"===t?(this.model.unset("id"),this.saveAndClose()):this.close()},toggleTypeClass:function(){this.ui.tkReply.removeClass("fwd note").addClass(this.model.getTypeClass()),this.canEditThreads()&&this.ui.tkReply.addClass("canEditThreads")},closePanel:function(){this.editor.hasContent()?this.saveAndClose():this.model.get("id")?this.discardAndClose():this.close()},saveAndClose:function(){n.default.Utils.Main.cursorLoading(),this.editor.save().then(o.default.bind(this.close,this)).always(n.default.Utils.Main.cursorDefault)},discardAndClose:function(){n.default.Utils.Main.cursorLoading(),this.model.destroy().always(n.default.Utils.Main.cursorDefault).always(o.default.bind(this.close,this))},showHideArticleSearch:function(t){this.appWindow.currentView&&(this.appWindow.$el.toggle("disabled"!==s.default.cookie("docs-app-enabled")),this.appWindow.$el.is(":visible")&&t&&this.appWindow.currentView.trigger("focus"))},switchToNote:function(t){t&&t.preventDefault(),this.editor.syncEditorData();var e=this.model.get("body");this.model.destroy(),this.trigger("switch-to-note",e)},isIncludePhone:function(){return"phone"===this.ticket.get("type")&&this.ui.includePhone.is(":checked")},setUpThreadEditorEscStackHandler:function(t){var e=this;n.default.stack.opened("Thread-Editor",(function i(){e.model.get("type")===n.default.Constants.threadType.NOTE?t.showDiscardDraftModal({confirmCb:function(){return n.default.stack.closed("Thread-Editor")},cancelCb:function(){return n.default.stack.opened("Thread-Editor",i)}}):(e.closePanel(),n.default.stack.closed("Thread-Editor"))}))},canEditThreads:function(){return!0},canEditConversationDetails:function(){return hsGlobal.memberPermissions.editConversationDetails}});e.default=f},6016:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<section id="appWindow"></section>\n'},3:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<section id="noteWarning" class="c-alert u-pad-t-1 u-pad-b-1">\n  <div class="c-alert__content">\n    <i class="icon-alert"></i>\n    <div class="c-alert__block">\n      <p class="js-alert__text">\n        This reply will go to the customer. <a href="javascript:void(0)">Switch to a note</a> if you are replying to '+t.escapeExpression(t.lambda(null!=(s=null!=e?a(e,"noteWarning"):e)?a(s,"createdBy"):s,e))+".\n      </p>\n    </div>\n  </div>\n</section>\n"},5:function(t,e,i,n,o){return'    <label class="checkbox" id="fwdPhoneCtrl">\n      <input type="checkbox" id="includePhone" name="includePhone" value="1"> <span>Include phone attachment</span>\n    </label>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<section class="js-addy-container"></section>\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"shouldShowDocsSearchBar"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:4,column:7}}}))?s:"")+(null!=(s=r(i,"if").call(a,null!=(s=null!=e?r(e,"noteWarning"):e)?r(s,"enabled"):s,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:0},end:{line:17,column:7}}}))?s:"")+'<section id="tkReply">\n  <section class="thread-editor-region"></section>\n'+(null!=(s=r(i,"if").call(a,null!=e?r(e,"showIncludePhone"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:20,column:2},end:{line:24,column:9}}}))?s:"")+'  <div class="control-group">\n    <span class="help-block" data-error="body"></span>\n  </div>\n</section>\x3c!-- /tkReply --\x3e\n'},useData:!0})},6017:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=d(i(5)),o=d(i(1)),s=d(i(8)),a=d(i(231)),r=d(i(5593)),l=i(5575);function d(t){return t&&t.__esModule?t:{default:t}}var c=r.default.extend({onSaveClick:function(t){t&&t.preventDefault(),this.trigger("save")},doSave:function(t){return this.thread.save(t,{wait:!0,validate:!1,error:s.default.noop}).then(o.default.bind(this.onSync,this))},doSubmit:function(t){if(this.thread.validate(),this.thread.isValid()){n.default.Controller.PubSub.publish("CcBcc:update"),this.stopTimer();var e=this.thread.toJSON(),i=void 0;"creator"===t&&(t=a.default.data.get("member.convRedirect"),i=!0);var r={handleTime:(new Date-this.viewStartTime)/1e3,inReplyToId:this.ticket.get("trafficCopInReplyToId"),convRedirect:t,sendAsCreator:i,folderId:a.default.data.folder.get("id"),includePhone:this.parent.isIncludePhone(),folderParams:{folderId:a.default.data.folder.get("id"),owner:a.default.state.get("owner"),page:a.default.state.get("page"),sort:a.default.state.get("sort")}};o.default.extend(e,r);var l=new s.default.Deferred;return n.default.Utils.Guard.ifICan("ticket-send",this.thread).then(o.default.bind((function(){var t=new Date;this.thread.send(e).then(o.default.bind((function(e){o.default.each(r,o.default.bind((function(t,e){this.thread.unset(e,{silent:!0})}),this)),this.onSync(),this.trigger("sent"),this.onSent(e,t),l.resolve()}),this)).fail(o.default.bind((function(){l.reject(),this.onSubmitFail.apply(this,arguments)}),this))}),this)).fail(o.default.bind((function(){l.reject(),this.replySendButton.cancel()}),this)),l.promise()}this.replySendButton.cancel()},onSent:function(t,e){if(t&&t.next){var i=new Date,o=i-e,s=t.next||{};s.folders&&a.default.data.folders.reset(s.folders,{silent:!0,parse:!0});var r=t.destination;if(r){var d=r.replace(window.location.origin,"").replace(hsGlobal.path,"");a.default.appRouter.navigate(d,{trigger:!1})}if(s.ticket){var c="ticket";a.default.controller.bootstrapAndShowTicket(s.ticket)}else c="folder",s.convos?a.default.controller.bootstrapAndShowConvos(s.convos):(console.error("No valid response.next data"),a.default.controller.routeOrReload(r));var u=new Date-i;n.default.Utils.Main.newRelicEvent("create:".concat(this.thread.get("type")),{redirectType:c,serverTime:o,renderTime:u,totalTime:o+u}),function(t,e){var i;switch(e.get("type")){case n.default.Constants.threadType.NOTE:i="Added Note to Sample Convo";break;case n.default.Constants.threadType.FORWARD:i="Forwarded Sample Convo";break;case n.default.Constants.threadType.MESSAGE:default:i="Replied to Sample Convo"}(0,l.trackSampleConvo)(t,i)}(this.ticket,this.thread)}},doGetDraftData:function(){return this.thread.toJSON()},hasContent:function(){return!this.isClosed&&(this.wysiView.hasText()||this.wysiView.hasImage()||this.thread.attachments.length>0)},onSubmitFail:function(t){r.default.prototype.onSubmitFail.apply(this,arguments),t&&409===t.status&&this.trigger("draft-conflict","send")},onSaveFail:function(t){r.default.prototype.onSaveFail.apply(this,arguments),t&&409===t.status&&this.trigger("draft-conflict","save")},doDelete:function(){this.deleteLocalDraft(),this.trigger("delete")}});e.default=c},6018:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(i(5)),o=u(i(1)),s=u(i(70)),a=u(i(6)),r=u(i(231)),l=u(i(6019)),d=u(i(293)),c=u(i(1561));function u(t){return t&&t.__esModule?t:{default:t}}var h=a.default.ItemView.extend({tagName:"fieldset",className:"c-AddressLines",id:"addyLines",template:l.default,ui:{forwardFrom:"#forwardFrom",forwardTo:"#forwardTo",forwardToError:"#forwardToError",forwardToMoveMessage:"#forwardToLine .js-move-message",forwardToMove:"#forwardToLine .js-move-action",forwardToMoveModal:"#forwardToLine .js-move-modal",customer:"#customer",cc:"#cc",ccMoveMessage:"#cc-div .js-move-message",ccMove:"#cc-div .js-move-action",ccMoveModal:"#cc-div .js-move-modal",bcc:"#bcc",bccMoveMessage:"#bcc-div .js-move-message",bccMove:"#bcc-div .js-move-action",bccMoveModal:"#bcc-div .js-move-modal",ccBcc:"#ccBcc",ccBccLines:".ccbcc",from:"#from"},events:{"click @ui.ccBcc":"onCcBccClick","blur @ui.forwardTo":"onForwardToBlur","click @ui.forwardToMove":"onMoveToClick","click @ui.ccMove":"onMoveToClick","click @ui.bccMove":"onMoveToClick"},initialize:function(){this.ticket=this.options.ticket,this.thread=this.options.thread,this.mailboxes=r.default.data.get("dropdowns.move"),this.moveTo=null,this.listenTo(r.default,"sync-ui-to-ticket",this.syncModelData),this.debouncedTriggerChange=this.debounce(this.triggerChange,500)},serializeData:function(){var t=this.ticket.get("aliasList"),e=t&&t.length;return{isForward:this.thread.get("type")===n.default.Constants.threadType.FORWARD,fromTypeOptions:this.getFromTypeOptions(),canShowToLine:this.canShowToLine(),toAddressOptions:this.getToAddressOptions(this.ticket.customer,this.ticket.customers),customerEntryValue:this.getCustomerEntryValue(),ticket:this.ticket.toJSON(),thread:this.thread.toJSON(),mailbox:r.default.data.get("mailbox"),member:r.default.data.get("member"),moveTo:this.moveTo,path:hsGlobal.path,aliasList:t,hasAliases:e&&r.default.data.get("replyAsAliasEnabled"),previousAlias:this.getAliasIdSelected(),isBccDisabled:hsGlobal.features.isBccDisabled}},getAliasIdSelected:function(){return this.thread.get("aliasUsed")?this.thread.get("aliasUsed"):this.ticket.get("previousAlias")?this.ticket.get("previousAlias"):void 0},onShow:function(){this.initEmailPickers();var t=this.thread.get("cc"),e=this.thread.get("bcc");(t&&t.length||e&&e.length)&&this.showCcBcc(),n.default.Utils.Main.initPopups(),this.thread.get("type")===n.default.Constants.threadType.FORWARD&&(this.setTimeout((function(){this.forwardToEmailPicker.focus()})),n.default.Utils.Main.initPopups()),this.validateRecipientFields()},getToAddressOptions:function(t,e){var i=this,n=[],o=t.get("id"),s=t.get("fname"),a=t.get("lname");return t.emails.each((function(t){var e=i.getEmailAddressData(s,a,t.get("value"),o,t.get("id"));n.push(e)})),e.forEach((function(t){t.id!==o&&t.emails.forEach((function(e){var o=e.value,s=e.id,a=i.getEmailAddressData(t.fname,t.lname,o,t.id,s);n.push(a)}))})),n},getFullName:function(t,e){return t||e?"".concat(t," ").concat(e):""},getEmailAddressData:function(t,e,i,n,o){var s=this.getFullName(t,e);return{name:"".concat(s||i," <").concat(i,">"),email:i,value:"".concat(n,"-").concat(o)}},getFromTypeOptions:function(){return[{name:r.default.data.get("mailbox.email"),value:1},{name:r.default.data.get("member.email"),value:2}]},getCustomerEntryValue:function(){var t="";if(this.canShowToLine()){var e=this.thread.get("customer.id"),i=this.thread.get("customer.entryId");e&&i&&(t="".concat(e,"-").concat(i))}return t},canShowToLine:function(){var t=this.ticket.customer.emails.length;return(this.ticket.get("hasMultipleCustomers")||t>1)&&"message"===this.thread.get("type")},onClose:function(){this.forwardToEmailPicker&&this.forwardToEmailPicker.destroy(),this.ccEmailPicker&&this.ccEmailPicker.destroy(),this.bccEmailPicker&&this.bccEmailPicker.destroy()},initEmailPickers:function(){var t=[],e=this.getToAddressOptions(this.ticket.customer,this.ticket.customers);this.canShowToLine()&&e&&e.length&&(t=o.default.pluck(e,"email")),this.thread.get("type")===n.default.Constants.threadType.FORWARD&&(this.forwardToEmailPicker=new n.default.Plugins.EmailPicker(this.ui.forwardTo,this.thread.get("forwardTo"),t),this.forwardToEmailPicker.textboxList.addEvent("bitBoxAdd",o.default.bind(this.onChange,this)),this.forwardToEmailPicker.textboxList.addEvent("bitBoxRemove",o.default.bind(this.onChange,this))),this.ccEmailPicker=new n.default.Plugins.EmailPicker(this.ui.cc,this.thread.get("cc"),t),this.ccEmailPicker.textboxList.addEvent("bitBoxAdd",o.default.bind(this.onChange,this)),this.ccEmailPicker.textboxList.addEvent("bitBoxRemove",o.default.bind(this.onChange,this)),hsGlobal.features.isBccDisabled||(this.bccEmailPicker=new n.default.Plugins.EmailPicker(this.ui.bcc,this.thread.get("bcc"),t),this.bccEmailPicker.textboxList.addEvent("bitBoxAdd",o.default.bind(this.onChange,this)),this.bccEmailPicker.textboxList.addEvent("bitBoxRemove",o.default.bind(this.onChange,this)))},onCcBccClick:function(t){this.showCcBcc(),this.setTimeout((function(){this.ccEmailPicker.focus()}))},showCcBcc:function(){this.ui.ccBccLines.show(),this.ui.ccBcc.hide()},onChange:function(){this.syncModelData(),this.debouncedTriggerChange(),this.thread.get("type")===n.default.Constants.threadType.FORWARD&&(this.thread.validate(),this.validateForwardTo()),this.validateRecipientFields()},triggerChange:function(){this.trigger("change:ccbcc")},onMoveToClick:function(t){this.moveTo&&this.moveTo.id&&(n.default.Utils.Event.silence(t),r.default.trigger("moveTicket",this.moveTo.id))},validateForwardTo:function(){0===this.thread.get("forwardTo").length?(this.ui.forwardToError.show(),this.ui.forwardTo.closest(".control-group").addClass("error danger")):(this.ui.forwardToError.hide(),this.ui.forwardTo.closest(".control-group").removeClass("error danger"))},validateRecipientFields:function(){var t=hsGlobal.features;if(t&&t.isMailboxToMailboxEnabled)this.toggleSubmit();else{this.mailboxMoveError=!1;var e=[],i=this.thread.get("cc"),s=o.default.find(this.mailboxes,(function(t){return o.default.contains(i,t.email)})),a=this.thread.get("bcc"),r=o.default.find(this.mailboxes,(function(t){return o.default.contains(a,t.email)}));if(this.thread.get("type")===n.default.Constants.threadType.FORWARD){var l=this.thread.get("forwardTo");e=o.default.find(this.mailboxes,(function(t){return o.default.contains(l,t.email)})),this.validateRecipientFieldsLine("forwardTo",e,s||r)}this.validateRecipientFieldsLine("cc",s,e||r),this.validateRecipientFieldsLine("bcc",r,e||s),this.toggleSubmit()}},validateRecipientFieldsLine:function(t,e,i){e?(this.mailboxMoveError=!0,this.ui["".concat(t,"MoveMessage")].show(),this.ui[t].closest(".control-group").addClass("error danger"),1!==this.thread.get(t).length||i?this.disableMoveAction(this.ui["".concat(t,"Move")],this.ui["".concat(t,"MoveModal")]):this.enableMoveAction(e,this.ui["".concat(t,"Move")],this.ui["".concat(t,"MoveModal")])):(this.ui["".concat(t,"MoveMessage")].hide(),this.ui[t].closest(".control-group").removeClass("error danger"))},enableMoveAction:function(t,e,i){i.css({display:"none"}),e.css({display:"inline-block"}),e.attr("title","Move conversation to ".concat(t.title)),this.moveTo=t},disableMoveAction:function(t,e){e.css({display:"inline-block"}),t.css({display:"none"}),this.moveTo=null},toggleSubmit:function(t){!1===this.thread.isValid()||this.mailboxMoveError?r.default.trigger("AddressLines:invalid"):t||r.default.trigger("AddressLines:valid")},syncModelData:function(){var t=this.ui.from.val(),e={fromType:this.ui.forwardFrom.val(),cc:this.ccEmailPicker.getValue(),customer:this.ui.customer.val(),aliasUsed:-1===parseInt(t)?null:this.ui.from.val()};hsGlobal.features.isBccDisabled||(e.bcc=this.bccEmailPicker.getValue()),this.thread.get("type")===n.default.Constants.threadType.FORWARD&&(e.forwardTo=this.forwardToEmailPicker.getValue(),this.setTimeout(o.default.bind(this.toggleSubmit,this,!0),300)),this.thread.set(e)}});s.default.mixin(h,d.default),s.default.mixin(h,c.default);var p=h;e.default=p},6019:function(t,e,i){var n=i(4);function o(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="control-group" id="forwardFromLine">\n        <label for="forwardFrom" class="control-label">From</label>\n        <div class="controls">\n            <select name="forwardFrom" id="forwardFrom">\n                '+t.escapeExpression(o(i(243)).call(null!=e?e:t.nullContext||{},null!=e?l(e,"fromTypeOptions"):e,null!=(r=null!=e?l(e,"thread"):e)?l(r,"fromType"):r,{name:"options",hash:{},data:a,loc:{start:{line:6,column:16},end:{line:6,column:59}}}))+'\n            </select>\n        </div>\x3c!-- /controls --\x3e\n    </div>\x3c!-- /control-group --\x3e\n    <div class="control-group ccbcc" id="forwardToLine">\n        <label for="forwardTo" id="fwdToLabel" class="control-label">To</label>\n        <div class="controls">\n            <input type="text" name="forwardTo" id="forwardTo" value="">\n            <span class="help-tip" data-error="forwardTo" id="forwardToError"></span>\n'+(null!=(r=t.invokePartial(i(5604),e,{name:"../partials/addressLinesMove",data:a,indent:"            ",helpers:n,partials:s,decorators:t.decorators}))?r:"")+"        </div>\x3c!-- /controls --\x3e\n    </div>\x3c!-- /control-group --\x3e\n"},3:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=o(i(10)).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?l(e,"toAddressOptions"):e)?l(r,"length"):r,">",1,{name:"ifCond",hash:{},fn:t.program(4,a,0),inverse:t.noop,data:a,loc:{start:{line:20,column:4},end:{line:34,column:15}}}))?r:""},4:function(t,e,n,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <div class="control-group controlGroupTo" id="toLine">\n            <label for="customer" class="control-label">To</label>\n            <div class="controls">\n'+(null!=(r=o(i(10)).call(null!=e?e:t.nullContext||{},null!=(r=null!=e?l(e,"ticket"):e)?l(r,"isSmooch"):r,"===",!0,{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.program(7,a,0),data:a,loc:{start:{line:24,column:16},end:{line:31,column:27}}}))?r:"")+"            </div>\x3c!-- /controls --\x3e\n        </div>\x3c!-- /control-group --\x3e\n"},5:function(t,e,i,n,o){var s,a=t.lambda,r=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <input type="text" class="uneditable-input controlGroupTo__input"\n                           value="'+r(a(null!=(s=null!=(s=null!=e?l(e,"toAddressOptions"):e)?l(s,"0"):s)?l(s,"name"):s,e))+'" disabled="disabled">\n                    <input type="hidden" name="customer" id="customer" value="'+r(a(null!=(s=null!=(s=null!=e?l(e,"toAddressOptions"):e)?l(s,"0"):s)?l(s,"value"):s,e))+'">\n'},7:function(t,e,n,s,a){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <select name="customer" id="customer" class="controlGroupTo__select">'+t.escapeExpression(o(i(243)).call(null!=e?e:t.nullContext||{},null!=e?r(e,"toAddressOptions"):e,null!=e?r(e,"customerEntryValue"):e,{name:"options",hash:{},data:a,loc:{start:{line:29,column:89},end:{line:30,column:119}}}))+"</select>\n"},9:function(t,e,i,n,o,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="control-group aliasFrom">\n        <label for="from" class="control-label">From</label>\n        <div class="controls c-AddressLines__aliasSelectWrapper">\n            <select name="from" id="from" class="c-AddressLines__aliasSelect">\n                <option value="-1">'+t.escapeExpression(t.lambda(null!=(r=null!=e?l(e,"mailbox"):e)?l(r,"email"):r,e))+"</option>\n"+(null!=(r=l(i,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"aliasList"):e,{name:"if",hash:{},fn:t.program(10,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:42,column:16},end:{line:50,column:23}}}))?r:"")+"            </select>\n        </div>\x3c!-- /control-group --\x3e\n    </div>\n"},10:function(t,e,i,n,o,s,a){var r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <optgroup label="Aliases">\n'+(null!=(r=l(i,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"aliasList"):e,{name:"each",hash:{},fn:t.program(11,o,0,s,a),inverse:t.noop,data:o,loc:{start:{line:44,column:20},end:{line:48,column:29}}}))?r:"")+"                    </optgroup>\n"},11:function(t,e,n,s,a,r,l){var d,c=t.lambda,u=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                        <option value="'+u(c(null!=e?h(e,"id"):e,e))+'"\n                                '+(null!=(d=o(i(10)).call(null!=e?e:t.nullContext||{},null!=l[1]?h(l[1],"previousAlias"):l[1],"==",null!=e?h(e,"id"):e,{name:"ifCond",hash:{},fn:t.program(12,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:46,column:32},end:{line:46,column:103}}}))?d:"")+">"+u(c(null!=e?h(e,"email"):e,e))+"\n                        </option>\n"},12:function(t,e,i,n,o){return'selected="selected"'},14:function(t,e,n,o,s){var a;return'    <div class="control-group ccbcc" style="display:none;">\n        <label for="bcc" class="control-label">Bcc</label>\n        <div class="controls" id="bcc-div">\n            <input type="text" name="bcc" id="bcc">\n'+(null!=(a=t.invokePartial(i(5604),e,{name:"../partials/addressLinesMove",data:s,indent:"            ",helpers:n,partials:o,decorators:t.decorators}))?a:"")+"        </div>\x3c!-- /controls --\x3e\n    </div>\x3c!-- /control-group --\x3e\n"},16:function(t,e,i,n,o){return" and Bcc"},18:function(t,e,i,n,o){return"/Bcc"},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,a,r,l){var d,c=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(d=o(i(10)).call(c,null!=(d=null!=e?u(e,"thread"):e)?u(d,"type"):d,"===","forwardparent",{name:"ifCond",hash:{},fn:t.program(1,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:1,column:0},end:{line:18,column:11}}}))?d:"")+(null!=(d=u(n,"if").call(c,null!=e?u(e,"canShowToLine"):e,{name:"if",hash:{},fn:t.program(3,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:19,column:0},end:{line:35,column:7}}}))?d:"")+(null!=(d=u(n,"if").call(c,null!=e?u(e,"hasAliases"):e,{name:"if",hash:{},fn:t.program(9,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:36,column:0},end:{line:54,column:7}}}))?d:"")+'    <div class="control-group ccbcc" style="display:none;">\n        <label for="cc" class="control-label">Cc</label>\n        <div class="controls" id="cc-div">\n            <input type="text" name="cc" id="cc">\n'+(null!=(d=t.invokePartial(i(5604),e,{name:"../partials/addressLinesMove",data:a,indent:"            ",helpers:n,partials:s,decorators:t.decorators}))?d:"")+"        </div>\x3c!-- /controls --\x3e\n    </div>\x3c!-- /control-group --\x3e\n\n"+(null!=(d=u(n,"unless").call(c,null!=e?u(e,"isBccDisabled"):e,{name:"unless",hash:{},fn:t.program(14,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:63,column:0},end:{line:71,column:11}}}))?d:"")+'\n    <a id="ccBcc" href="javascript:void(0)" title="Show Cc'+(null!=(d=u(n,"unless").call(c,null!=e?u(e,"isBccDisabled"):e,{name:"unless",hash:{},fn:t.program(16,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:73,column:58},end:{line:73,column:102}}}))?d:"")+' fields" tabindex="-1">Cc'+(null!=(d=u(n,"unless").call(c,null!=e?u(e,"isBccDisabled"):e,{name:"unless",hash:{},fn:t.program(18,a,0,r,l),inverse:t.noop,data:a,loc:{start:{line:73,column:127},end:{line:73,column:167}}}))?d:"")+"</a>\n"},usePartial:!0,useData:!0,useDepths:!0})},6020:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=c(i(5)),o=c(i(1)),s=c(i(8)),a=c(i(6)),r=c(i(5666)),l=c(i(336)),d=c(i(6029));function c(t){return t&&t.__esModule?t:{default:t}}var u=a.default.CollectionView.extend({id:"tkContent",tagName:"section",itemView:function(t){var e=t.model;return e.get("isLineItem")?new l.default({model:e,isModal:!1}):e.get("type")===n.default.Constants.threadType.BEACON_CHAT?new d.default({model:e}):new r.default({model:e,isModal:!1})},collectionEvents:{"sync reset":"onThreadsLoaded"},onShow:function(){this.listenTo(this.model,"change:hasAvatars",this.toggleAvatars),this.toggleAvatars(),this.onThreadsLoaded(!0),(0,s.default)(window).bind("scroll.threads-".concat(this.model.get("id")),o.default.bind(this.onScroll,this)),this.onScroll()},onClose:function(){(0,s.default)(window).unbind("scroll.threads-".concat(this.model.get("id")))},toggleAvatars:function(){var t=!this.model.get("hasAvatars");this.$el.toggleClass("noAvatars",t)},onScroll:function(t){var e=window.scrollY+window.innerHeight>this.$el.height()+this.$el.offset().top-100,i=!this.loadThreadsPromise&&this.collection.hasMore();e&&i&&this.loadMoreThreads()},loadMoreThreads:function(){if(!this.collection.hasMore())return!1;n.default.Utils.Main.cursorLoading();var t=this.loadThreadsPromise=this.collection.requestNextPage().always(o.default.bind((function(){this.loadThreadsPromise===t&&(n.default.Utils.Main.cursorDefault(),delete this.loadThreadsPromise)}),this))},onThreadsLoaded:function(t){if(this.initCustomerThreadSidebarClicks(),this.showHideBlockedImages(),this.options.threadId){if(!this.threadLoaded(this.options.threadId))return void this.loadMoreThreads();var e=this.collection.get(this.options.threadId);if(e){var i=this.children.findByModel(e).$el;i.length&&(0,s.default)("html, body").animate({scrollTop:i.offset().top},500),delete this.options.threadId}}else!0===t&&(0,s.default)("html, body").animate({scrollTop:0},200);this.collection.findWhere({isLineItem:!1})||this.loadMoreThreads()},threadLoaded:function(t){return this.collection.get(parseInt(t,10))},showHideBlockedImages:function(){this.$("img[data-src]").length>0&&this.trigger("blockedImagesLoaded")},initCustomerThreadSidebarClicks:function(){var t=this.$(".threadTitle h4 a.cust");if(t&&0!=t.length){var e=[];s.default.each(t,(function(i,n){t[i]=(0,s.default)(n);var o=t[i].data("id");-1==s.default.inArray(o,e)&&e.push(o)})),1==e.length?s.default.each(t,(function(t,e){e.contents().unwrap()})):s.default.each(t,(function(t,e){var i=e.data("id");i&&e.on("click",(function(t){t.ctrlKey||t.metaKey||(t.preventDefault(),n.default.Controller.PubSub.publish("sidebar:updateCustomer",{id:i}))}))}))}}});e.default=u},6021:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(i(62)),o=l(i(2)),s=l(i(0)),a=i(31),r=l(i(166));function l(t){return t&&t.__esModule?t:{default:t}}var d=function(t){var e=t.isOpen,i=t.handleOnPrimaryClick,o=t.handleOnSecondaryClick;return s.default.createElement("div",{className:"c-dismissModal"},s.default.createElement(n.default,{version:2,isOpen:e,kind:"alert",title:"Dismiss bounce notification?",description:"Dismissing this bounce will set the thread to delivered and move the conversation out of the Needs Attention folder.",forceClosePortal:o},s.default.createElement(n.default.ActionFooter,{kind:"alert",showDefaultCancel:!1,onPrimaryClick:i,onSecondaryClick:o,primaryButtonText:"Dismiss",secondaryButtonText:"Cancel"})))};d.propTypes={isOpen:o.default.bool,handleOnPrimaryClick:o.default.func,handleOnSecondaryClick:o.default.func},d.defaults={isOpen:!1,handleOnPrimaryClick:r.default,handleOnSecondaryClick:r.default};var c=t.ItemView.extend({template:function(){var t=this.options;return s.default.createElement(d,t)}}),u=(0,a.ReactView)(c);e.default=u}).call(this,i(6))},6022:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=d(i(5)),o=d(i(1)),s=d(i(6)),a=d(i(231)),r=d(i(6023)),l=d(i(5576));function d(t){return t&&t.__esModule?t:{default:t}}var c=(0,d(i(191)).default)(),u=s.default.Layout.extend({className:"hs-wysiwyg",id:"tkReply",tagName:"article",template:r.default,regions:{attachmentsRegion:".js-attachments-region",wysiRegion:".js-wysi-region"},ui:{save:"#saveThreadBtn",cancel:".closeInline"},events:{"click @ui.save":"save","click @ui.cancel":"cancel"},onShow:function(){n.default.stack.opened("Inline-Editor",o.default.bind((function(){n.default.stack.closed("Inline-Editor"),this.cancel()}),this));var t,e=!1;this.model.isNote()&&this.options.mentionsEnabled&&this.options.mentionNames&&this.options.mentionNames.length&&(e=!0,t=this.options.mentionNames),this.wysiView=new c({className:"wysi",codeMode:!0,useMentions:e,mentionNames:t}),this.wysiRegion.show(this.wysiView),this.listenTo(this.wysiView,"submit",this.save),this.setEditorText(),this.model.get("type")!==n.default.Constants.threadType.NOTE&&this.model.get("type")!==n.default.Constants.threadType.PHONE||this.$el.addClass("note"),this.initAttachments(),this.wysiView.focus(!0)},setEditorText:function(){var t=this.model.get("body");try{this.wysiView.setText(t)}catch(i){var e=document.createElement("div");e.innerHTML=t,t=e.innerHTML,this.wysiView.setText(t)}},initAttachments:function(){this.model.attachments&&this.model.attachments.length&&this.attachmentsRegion.show(new l.default({tagName:"ul",className:"attachments",upload:!1,collection:this.model.attachments,thread:this.model,ticket:this.model.ticket,mailboxSlug:a.default.data.get("mailbox.slug"),memberId:a.default.data.get("member.id")}))},buttonLoading:function(t){t?(this.ui.save.button("loading"),this.ui.save.attr("disabled","disabled")):(this.ui.save.button("reset"),this.ui.save.removeAttr("disabled"))},save:function(t){var e=this;t&&t.preventDefault(),this.buttonLoading(!0),n.default.Utils.Main.cursorLoading(),this.model.save({body:this.wysiView.getText(),editorMode:this.wysiView.getEditorMode()},{patch:!0}).then(o.default.bind((function(){n.default.Utils.Main.cursorDefault(),this.trigger("updated",this.model),this.close()}),this)).fail((function(t){if(403===t.status){var i=JSON.parse(t.responseText).errors;n.default.Utils.Main.error(i[0]),e.trigger("permission-error",e.model)}n.default.Utils.Main.cursorDefault(),e.buttonLoading(!1)}))},cancel:function(t){t&&t.preventDefault(),this.trigger("cancel"),this.close()}});e.default=u},6023:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<section class="js-attachments-region"></section>\n<section id="inlineEditorWysiwyg" class="textareaWrap">\n    <section class="js-wysi-region"></section>\n    <section id="btmBtns">\n       <section class="statusBar" style="height:98%;">\n           <div class="status">\n               <a href="javascript:void(0)" class="closeInline">Cancel</a>\n           </div>\x3c!--/status--\x3e\n        </section>\x3c!--/statusBar--\x3e\n    <button class="btn btn-success btnReply saveThread" id="saveThreadBtn" data-loading-text="Saving...">Save Changes</button>\n    </section>\x3c!--/btmBtns--\x3e\n</section>\x3c!--/textareaWrap--\x3e\n'},useData:!0})},6024:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(6)),o=s(i(6025));function s(t){return t&&t.__esModule?t:{default:t}}var a=n.default.ItemView.extend({template:o.default});e.default=a},6025:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lambda,r=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>"+r(a(null!=(s=null!=e?l(e,"bounce"):e)?l(s,"description"):s,e))+'</p>\n<pre class="bounce-error">'+r(a(null!=(s=null!=e?l(e,"bounce"):e)?l(s,"error"):s,e))+'</pre>\n\n<div class="c-modal--hsds__footer">\n    <div class="form-actions">\n        <button class="c-button c-button--md" data-dismiss="modal">Close</button>\n    </div>\n</div>'},useData:!0})},6026:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(5)),o=a(i(6)),s=(a(i(231)),a(i(6027)));i(275);function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.ItemView.extend({tagName:"div",className:"dropdown",template:s.default,events:{"click .edit":function(){this.trigger("edit")},"click .delete":function(){this.trigger("delete")},"click .hide":function(){this.trigger("hide")},"click .unhide":function(){this.trigger("unhide")}},onRender:function(){var t=this.getOptions();this.$el.toggle(t&&t.length>0)},onShow:function(){n.default.Utils.Main.initPopups(this.$el)},serializeData:function(){return{thread:this.model.toJSON(),options:this.getOptions()}},getOptions:function(){var t=[],e=hsGlobal.memberPermissions.createConversations;switch(this.model.get("type")){case n.default.Constants.threadType.MESSAGE:hsGlobal.memberPermissions.editThreads&&l(t,this.getEditOption()),l(t,this.getHideUnhideOption()),l(t,this.getShowOriginalOption());break;case n.default.Constants.threadType.CUSTOMER:hsGlobal.memberPermissions.editThreads&&l(t,this.getEditOption()),l(t,this.getHideUnhideOption()),e&&l(t,this.getNewConvoOption()),l(t,this.getShowOriginalOption());break;case n.default.Constants.threadType.NOTE:this.shouldAddNotesOption(hsGlobal.memberPermissions.editNotes)&&l(t,this.getEditOption()),this.shouldAddNotesOption(hsGlobal.memberPermissions.deleteNotes)&&l(t,this.getDeleteOption());break;case n.default.Constants.threadType.FORWARD:break;case n.default.Constants.threadType.PHONE:l(t,this.getShowOriginalOption()),hsGlobal.memberPermissions.editThreads&&l(t,this.getEditOption());break;case n.default.Constants.threadType.CHAT:}return t},getEditOption:function(){return{className:"edit",name:"Edit"}},getDeleteOption:function(){return{className:"delete",name:"Delete"}},getShowOriginalOption:function(){if(this.model.get("canShowOriginal"))return{className:"showOriginal fancyNoTitle width:750 height:600",name:"Show Original",url:hsGlobal.path+["thread",this.model.ticket.id,this.model.id,"orig-popup/"].join("/"),title:"Show Original Email"}},getNewConvoOption:function(){return{className:"newConvo",name:"New Conversation",url:hsGlobal.path+["thread",this.model.ticket.id,this.model.id,"new-convo/"].join("/"),title:"Start a conversation with this thread"}},getHideUnhideOption:function(){if(this.model.get("state")===n.default.Constants.threadState.HIDDEN)var t="Unhide";else t="Hide";return{className:t.toLowerCase(),name:t}},shouldAddNotesOption:function(t){return!(!hsGlobal.features.isDisplayLightUsersEnabled||!this.isOwnThread())||t},isOwnThread:function(){return this.model.get("createdBy")===hsGlobal.memberId}});function l(t,e){e&&t.push(e)}e.default=r},6027:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lambda,r=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <li><a "+(null!=(s=l(i,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"url"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:4,column:15},end:{line:4,column:82}}}))?s:"")+' title="'+r(a(null!=e?l(e,"title"):e,e))+'" class="'+r(a(null!=e?l(e,"className"):e,e))+'">'+r(a(null!=e?l(e,"name"):e,e))+"</a></li>\n"},2:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'href="'+t.escapeExpression(t.lambda(null!=e?s(e,"url"):e,e))+'"'},4:function(t,e,i,n,o){return'href="javascript:void(0);")'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a class="dropdown-toggle" data-toggle="dropdown" href="#"><b class="caret"></b></a>\n<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">\n'+(null!=(s=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"options"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:5,column:13}}}))?s:"")+"</ul>"},useData:!0})},6028:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,o,s){var a;return'<section class="js-thread-content">'+(null!=(a=t.invokePartial(i(523),e,{name:"../../../common/templates/thread",data:s,helpers:n,partials:o,decorators:t.decorators}))?a:"")+'</section>\n<section class="inlineEdit"></section>\n'},usePartial:!0,useData:!0})},6029:function(t,e,i){window;var n=s(i(5666)),o=s(i(524));function s(t){return t&&t.__esModule?t:{default:t}}t.exports=(0,o.default)(n.default)},6030:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"- "+t.escapeExpression("function"==typeof(s=null!=(s=a(i,"customer")||(null!=e?a(e,"customer"):e))?s:t.hooks.helperMissing)?s.call(null!=e?e:t.nullContext||{},{name:"customer",hash:{},data:o,loc:{start:{line:1,column:42},end:{line:1,column:54}}}):s)},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"#"+d("function"==typeof(a=null!=(a=c(i,"number")||(null!=e?c(e,"number"):e))?a:l)?a.call(r,{name:"number",hash:{},data:o,loc:{start:{line:1,column:1},end:{line:1,column:11}}}):a)+" "+d("function"==typeof(a=null!=(a=c(i,"subject")||(null!=e?c(e,"subject"):e))?a:l)?a.call(r,{name:"subject",hash:{},data:o,loc:{start:{line:1,column:12},end:{line:1,column:23}}}):a)+" "+(null!=(s=c(i,"if").call(r,null!=e?c(e,"customer"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:24},end:{line:1,column:61}}}))?s:"")},useData:!0})},6031:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(231)),o=a(i(6)),s=a(i(6032));function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.ItemView.extend({template:s.default,tagName:"div",className:"message",ui:{updateLink:"a.updateEmailAddress"},events:{"click @ui.updateLink":"editCustomer"},initialize:function(t){this.ticketId=t.ticketId,this.customerId=t.customerId,this.ticketType=t.ticketType},editCustomer:function(){n.default.trigger("edit:customer",{autoFocus:"email"})},serializeData:function(){return{ticketTypeIsChat:"chat"===this.ticketType}}});e.default=r},6032:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'<div>A customer email address has not been added. To reply, please <a class="updateEmailAddress" href="javascript:void(0)" title="Add Customer Email Address">add an email address</a>.</div>\n'},3:function(t,e,i,n,o){return'<div>The customer\'s email address is invalid. To reply, please <a class="updateEmailAddress" href="javascript:void(0)" title="Update Customer Email Address">update the email address</a>.</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"ticketTypeIsChat"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?s:"")+"\n"},useData:!0})},6033:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i(1)),o=a(i(6)),s=a(i(6034));function a(t){return t&&t.__esModule?t:{default:t}}var r=o.default.ItemView.extend({template:s.default,className:"realtime-thread-update",tagName:"article",events:{"click a":"onClick"},initialize:function(){this.listenTo(this.collection,"add remove",this.render)},onClose:function(){this.$el.stop(!0)},serializeData:function(){return{newThreadCount:this.collection.length}},onRender:function(){this.collection.length&&this.$el.slideDown()},onClick:function(t){t&&t.preventDefault(),this.$el.slideUp("fast",n.default.bind((function(){this.model.trigger("refresh-threads")}),this))}});e.default=r},6034:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=e?s(e,"newThreadCount"):e,e))+" new threads"},3:function(t,e,i,n,o){return"new thread"},compiler:[8,">= 4.3.0"],main:function(t,e,n,o,s){var a,r,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<section class="threadTitle">\n    <a href="#">View '+(null!=(a=(r=i(10),r&&(r.__esModule?r.default:r)).call(null!=e?e:t.nullContext||{},null!=e?l(e,"newThreadCount"):e,">",1,{name:"ifCond",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:2,column:21},end:{line:2,column:112}}}))?a:"")+"</a>\n</section>\n"},useData:!0})},6035:function(t,e,i){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=d(i(5)),o=d(i(8)),s=d(i(18)),a=d(i(6)),r=d(i(6036)),l=d(i(5632));function d(t){return t&&t.__esModule?t:{default:t}}var c=a.default.Layout.extend({template:r.default,tagName:"hgroup",regions:{ticketTags:"#js-ticket-tags-region"},ui:{subject:"#subject",subjectLine:"#subjectLine"},initialize:function(t){var e=t.canUpdate,i=void 0===e||e;this.listenTo(this.model,"change:status",this.render),this.listenTo(this.model,"change:subject",this.render),this.listenTo(this.model,"ticket-deleted",this.render),this.canUpdate=i},onClose:function(){this.copyButton&&this.copyButton.destroy()},onDomRefresh:function(){this.canUpdate&&this.makeSubjectEditable(),this.ticketTags.show(new l.default({collection:this.model.tags}))},makeSubjectEditable:function(){this.ui.subjectLine.editable(n.default.Utils.Ajax.url(["conversation",this.model.get("id"),this.model.get("number"),"subject"]),{cancel:"Cancel",submit:"Save",escapeHtml:!0,onblur:"ignore"}).click((function(){(0,o.default)("#subject").trigger("mouseover")})),this.ui.subject.hover((function(){var t=(0,o.default)(this).find("#subjectLine form:visible").length?"none":"inline-block";(0,o.default)(this).find(".icon-pencil").css("display",t)}),(function(){(0,o.default)(this).find(".icon-pencil").css("display","none")}))},serializeData:function(){return{canUpdate:this.canUpdate,model:this.model,number:this.model.get("number"),ownerPhotoUrl:this.model.get("ownerPhotoUrl"),subject:this.model.get("subject"),ticketStatusBadge:this.getTicketStatusBadge()}},getTicketStatusBadge:function(){if(this.model){var t=this.model.get("isDeleted"),e=this.model.get("status"),i="";return t?i='<span class="badge closed">Deleted</span>':e===n.default.Constants.Status.PENDING?i='<span class="badge pending">Pending</span>':e===n.default.Constants.Status.ACTIVE?i='<span class="badge active">Active</span>':e===n.default.Constants.Status.CLOSED?i='<span class="badge closed">Closed</span>':e===n.default.Constants.Status.SPAM&&(i='<span class="badge spam">Spam</span>'),new s.default.SafeString(i)}}});e.default=c},6036:function(t,e,i){var n=i(4);t.exports=(n.default||n).template({1:function(t,e,i,n,o){return'class="canUpdate" title="Edit subject"'},3:function(t,e,i,n,o){var s,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img src="'+t.escapeExpression("function"==typeof(s=null!=(s=a(i,"ownerPhotoUrl")||(null!=e?a(e,"ownerPhotoUrl"):e))?s:t.hooks.helperMissing)?s.call(null!=e?e:t.nullContext||{},{name:"ownerPhotoUrl",hash:{},data:o,loc:{start:{line:11,column:10},end:{line:11,column:27}}}):s)+'">\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var s,a,r=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,d=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div id="tktSubject">\n    <h2 id="subject" class="form-horizontal">\n        <span id="subjectLine" '+(null!=(s=c(i,"if").call(r,null!=e?c(e,"canUpdate"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:31},end:{line:3,column:93}}}))?s:"")+">"+d("function"==typeof(a=null!=(a=c(i,"subject")||(null!=e?c(e,"subject"):e))?a:l)?a.call(r,{name:"subject",hash:{},data:o,loc:{start:{line:3,column:94},end:{line:3,column:105}}}):a)+'</span>\n    </h2>\n    <input type="text" name="tags" class="hints" id="tags" />\n    <div id="js-ticket-tags-region"></div>\n</div>\n\x3c!--/tktSubject --\x3e\n<p># <strong>'+d("function"==typeof(a=null!=(a=c(i,"number")||(null!=e?c(e,"number"):e))?a:l)?a.call(r,{name:"number",hash:{},data:o,loc:{start:{line:9,column:13},end:{line:9,column:23}}}):a)+"</strong> "+d("function"==typeof(a=null!=(a=c(i,"ticketStatusBadge")||(null!=e?c(e,"ticketStatusBadge"):e))?a:l)?a.call(r,{name:"ticketStatusBadge",hash:{},data:o,loc:{start:{line:9,column:33},end:{line:9,column:54}}}):a)+"</p>\n"+(null!=(s=c(i,"if").call(r,null!=e?c(e,"ownerPhotoUrl"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:0},end:{line:12,column:7}}}))?s:"")},useData:!0})},622:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=(n=i(5))&&n.__esModule?n:{default:n};var s=t.Behavior.extend({initialize:function(){this.view.listenTo(this.view,"show",$.proxy(this.onShow,this)),this.view.listenTo(this.view,"close",$.proxy(this.onClose,this))},onShow:function(){o.default.Utils.Main.cursorLoading();var t=this,e=this.view.ui.previewIframe[0];$.browser.msie?e.onreadystatechange=function(){"complete"==e.readyState&&t.onIframeLoad()}:e.contentWindow.onload=$.proxy(this.onIframeLoad,this)},onClose:function(){o.default.Utils.Main.cursorDefault(),clearTimeout(this.timeoutId)},onIframeLoad:function(t){o.default.Utils.Main.cursorDefault();var e=this.view.ui.previewIframe[0],i=o.default.Utils.Main.getContentDocument(e),n=$(i.body).height()+75;this.view.ui.previewContainer.height(Math.max(n,200)),!0!==t&&(this.timeoutId=setTimeout($.proxy(this.onIframeLoad,this,!0),800))}});e.default=s}).call(this,i(6))},83:function(t,e,i){(function(t){window;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i(526)),o=s(i(527));function s(t){return t&&t.__esModule?t:{default:t}}var a={addHeaders:function(t){t.setRequestHeader("Authorization","Basic "+appData.hash),t.setRequestHeader("Correlation-Id",hsGlobal.correlationId),t.setRequestHeader("helpscout-origin","hsapp-js")},getOptions:function(e){return t.extend({beforeSend:this.addHeaders},e)},getFileTypeFromExtension:function(t){var e=null;if(t)switch(t.toLowerCase()){case"markdown":case"mdown":case"mkdn":case"md":case"mkd":case"mdwn":case"mdtxt":case"mdtext":e="markdown";break;case"html":case"htm":e="html";break;case"txt":case"text":e="text";break;default:e=null}return e},cleanDocsArticlePreview:function(t){return t=(0,n.default)(t),t=(t=(t=(t=(new DOMParser).parseFromString(t,"text/html").documentElement.textContent).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")).trim()).replace(/\s+/g," "),(0,o.default)(t,126)}};e.default=a}).call(this,i(1))}}]);
//# sourceMappingURL=mailbox-ticket-23385ffec568f90388cf.js.map